<?xml version='1.0' encoding='UTF-8' ?>
<!--
Copyright (C) 2020 Technology Rediscovery LLC.

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Public Data Access Portal</title>
    </h:head>
    <h:body>
        <ui:composition template="./../../navContainer_public.xhtml">
            <ui:define name="content">
                <f:view id="sysHomeView">

                    <!-- MAIN CONTAINER -->
                    <div class="mainContainer">

                        <p:growl id="paccSearchMessages" showDetail="false"/>

                        <!-- TITLE COMPONENT -->
                        <div class="public-title">
                            <div class="public-title-main">
                                View/Edit Existing Concern
                            </div>
                            <div class="public-title-sub">
                                Check the status of an existing request, or add information to an existing request
                            </div>
                        </div>

                        <!-- CONTENTS CONTAINER -->
                        <div class="public-main-contents-containner">

                            <!--CONTENT MAIN COMPONENT -->
                            <div class="public-main-contents">

                                <!-- GUIDANCE COMPONENT -->
                                <div class="public-guide">

                                </div>

                                <h:form id="checkRequestStatusForm">

                                    <!-- CONTENT IO COMPONENT -->
                                    <div class="public-main-contents-io">

                                        <!-- CONTENT IO COMPONENT: CONTENT -->
                                        <div class="public-main-contents-io-content" >
                                            <p>
                                                Please enter your six-digit Public Access Control Code(PACC) provided to you after submitting your request.
                                            </p>

                                            <div class="ui-g data-container">
                                                <div class="ui-g-12 ui-md-6 ui-lg-6">
                                                    <p:inputText id="controlCode" 
                                                                 value="#{publicInfoBB.submittedPACC}" 
                                                                 tabindex="1" 
                                                                 required="true"
                                                                 />
                                                </div>

                                                <div class="ui-g-12 ui-md-1 ui-lg-1">

                                                </div>

                                                <div class="ui-g-12 ui-md-1 ui-lg-1">
                                                    <div class="gray_button">
                                                        <p:commandButton  id="submitCheckRequest"  
                                                                          tabindex="2"
                                                                          value="Search" 
                                                                          action="#{publicInfoBB.submitPACC()}"
                                                                          update="paccSearchMessages"
                                                                          immediate="false"
                                                                          style="width: 100%"
                                                                          icon="fa fa-search"/>
                                                    </div>
                                                </div>
                                            </div>

                                            <!--STUFF TO BE MOVED TO OTHER PAGES-->
                                            
                                            <ui:remove>
                                                
                                            <p>
                                                Please review the request(s) below for their status, or add additional information to this request. 
                                                Note that additional information will be sent directly to the code enforcement staff. Any additional 
                                                information received here become part of the permanent case record and may become public record.
                                            </p>

                                            <div class="ui-g data-container">
                                                <div class="ui-g-12 ui-md-12 ui-lg-12">
                                                    <p:dataTable id="paccrecord" 
                                                                 rowIndexVar="rowIndex"
                                                                 var="pib"
                                                                 value="#{publicInfoBB.publicInfoBundleList}"
                                                                 tabindex="3"
                                                                 editable="true">                                         

                                                        <p:column style="width: 15%">
                                                            <f:facet name="header">
                                                                <h:outputText value="PACC" />
                                                            </f:facet>
                                                            <h:outputText value="#{pib.pacc}" />
                                                        </p:column>

                                                        <p:column style="width: 15%">
                                                            <f:facet name="header">
                                                                <h:outputText value="Date of Request" />
                                                            </f:facet>
                                                            <h:outputText value="#{pib.dateOfRecord}" />
                                                        </p:column>

                                                        <p:column style="width: 15%">
                                                            <f:facet name="header">
                                                                <h:outputText value="Current Status" />
                                                            </f:facet>
                                                            <h:outputText value="#{pib.paccStatusMessage}" />
                                                        </p:column>

                                                        <p:column >
                                                            <f:facet name="header">
                                                                <h:outputText value="Additional Information to Append to Request" />
                                                            </f:facet>
                                                            <p:inputTextarea  style="width: 100%; height: 150px;" value="#{publicInfoBB.publicMessage}"/>
                                                        </p:column>

                                                        <p:column style="width: 15%; text-align: center">
                                                            <f:facet name="header">

                                                            </f:facet>
                                                            <p:commandButton ajax="true" 
                                                                             onstart="#{publicInfoBB.setSelectedBundle(pib)}"
                                                                             actionListener="#{publicInfoBB.attachMessage}"
                                                                             value="Submit" icon="fa fa-link"  
                                                                             update="paccSearchMessages
                                                                             paccrecord"
                                                                             />
                                                        </p:column>

                                                    </p:dataTable>

                                                </div>

                                                <ui:remove>
                                                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                                                        <p:dataList id="bundleDL" 
                                                                    value="#{publicInfoBB.publicInfoBundleList}" 
                                                                    var="pib" type="definition">

                                                            <div class="publicInfoBundleContainer">


                                                                <h:outputText escape="false" value="#{pib}"/>

                                                                <p:spacer height="5px"/>


                                                                <p:commandButton actionListener="#{publicInfoBB.setSelectedBundle(pib)}"
                                                                                 value="Attach Message"
                                                                                 oncomplete="PF('messageDialog').show()"
                                                                                 ajax="true" rendered="#{pib.showAddMessageButton}"/>

                                                                <p:commandButton action="#{publicInfoBB.viewPACCRecordDetails(pib)}"
                                                                                 value="View details"
                                                                                 ajax="false" rendered="#{pib.showDetailsPageButton}"/>

                                                            </div>

                                                        </p:dataList>
                                                    </div>
                                                </ui:remove>
                                            </div>
                                                
                                            </ui:remove>
                                        </div>
                                    </div>
                                </h:form>
                            </div>
                        </div>
                        <ui:remove>
                            <p:confirmDialog header="Attach Message"
                                             message="Type your message to the code enforcement staff in the box below. You are attaching a note to bundle with a type: #{publicInfoBB.selectedBundle.typeName}"
                                             severity="alert" 
                                             widgetVar="messageDialog">

                                <h:form id="messageForm">

                                    <p:spacer height="15px"/>
                                    <p:inputTextarea id="message-ita" style="width: 100%; height: 200px;" value="#{publicInfoBB.publicMessage}"/>
                                    <p:spacer height="15px"/>
                                    <p:commandButton ajax="true" actionListener="#{publicInfoBB.attachMessage}"
                                                     value="Submit" icon="fa fa-link" oncomplete="PF('messageDialog').hide()" 
                                                     update="paccSearchMessages
                                                     messageForm:message-ita"
                                                     />
                                    <p>Please note that all messages submitted through this portal become part of the permanent case record
                                        and may be included in documents prepare for town councils and magistrates. </p>
                                </h:form>
                            </p:confirmDialog>
                        </ui:remove>

                    </div>
                </f:view>

                <script>
                    var y = document.getElementById('public-reviewcase-arrow-id');
                    y.className += " public-menu-active";
                </script> 
            </ui:define>
        </ui:composition>
    </h:body>
</html>

