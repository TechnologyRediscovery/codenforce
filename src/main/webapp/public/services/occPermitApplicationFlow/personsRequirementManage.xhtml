<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <h:outputStylesheet name="css/style.css"/>
        <title>TCVCOG Code Enforcement Home</title>
    </h:head>
    <h:body>
        <ui:composition template="./../../navContainer_public.xhtml">

            <ui:define name="content">
                <f:view id="sysHomeView">

                    <div class="mainContainer">

                        <h:messages globalOnly="true" showDetail="true" showSummary="true"
                                    warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError"/>


                        <h:form id="personsRequirementManageForm">

                            <h1>Add People to Application</h1>

                            <p:outputLabel value="The selected reason for the application is: #{sessionBean.occPermitApplication.reason.title}"/>
                            <p:spacer height="5px"/>
                                <p:outputLabel value="#{sessionBean.occPermitApplication.reason.humanFriendlyDescription}"/>
                                
                            <ui:remove>
                                <p:spacer height="5px"/>
                                <p:outputLabel value="#{sessionBean.occPermitApplication.reason.humanFriendlyDescription}"/>

                                <p:dataTable var="requiredPersonType" value="#{sessionBean.occPermitApplication.reason.personsRequirement.requiredPersonTypes}">

                                    <p:column headerText="Required Persons">
                                        <h:outputText value="#{requiredPersonType.label}"/>
                                    </p:column>

                                    <p:column>
                                        <p:commandButton value="Add" action="#{occPermitApplicationBB.attachPerson(requiredPersonType)}"/>
                                    </p:column>
                                </p:dataTable>

                                <p:dataTable var="optionalPersonType" value="#{sessionBean.occPermitApplication.reason.personsRequirement.optionalPersonTypes}">

                                    <p:column headerText="Optional Persons">
                                        <h:outputText value="#{optionalPersonType.label}"/>
                                    </p:column>

                                    <p:column>
                                        <p:commandButton value="Add" action="#{occPermitApplicationBB.attachPerson(optionalPersonType)}"/>
                                    </p:column>
                                </p:dataTable>
                            </ui:remove>
                            <h:panelGrid id="menu" columns="1" cellpadding="10" columnClasses="gridTd-solid-back" style="width:100%">
                                <h:panelGroup >
                                    <h:panelGrid columns="2" cellpadding="10" footerClass="gridFooter">
                                        <h:panelGroup>
                                            <p:outputLabel id="last-name-ol" for="last-name-chkbx" value="Filter by last name?" />
                                            <p:selectBooleanCheckbox id="last-name-chkbx" value="#{personSearchPublicBB.params.filterByLastName}" >
                                                <p:ajax update="last-name-it"/>
                                            </p:selectBooleanCheckbox>               
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:inputText id="last-name-it" value="#{personSearchPublicBB.params.lastNameSS}" disabled="#{!personSearchPublicBB.params.filterByLastName}"/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="first-name-ol" for="first-name-chkbx" value="Filter by first name?" />
                                            <p:selectBooleanCheckbox id="first-name-chkbx" value="#{personSearchPublicBB.params.filterByFirstName}" >
                                                <p:ajax update="first-name-it"/>
                                            </p:selectBooleanCheckbox>               
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:inputText id="first-name-it" value="#{personSearchPublicBB.params.firstNameSS}" disabled="#{!personSearchPublicBB.params.filterByFirstName}"/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="email-ol" for="email-chkbx" value="Filter by email?" />
                                            <p:selectBooleanCheckbox id="email-chkbx" value="#{personSearchPublicBB.params.filterByEmail}" >
                                                <p:ajax update="email-it"/>
                                            </p:selectBooleanCheckbox>               
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:inputText id="email-it" value="#{personSearchPublicBB.params.emailSS}" disabled="#{!personSearchPublicBB.params.filterByEmail}"/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="phone-number-ol" for="phone-number-chkbx" value="Filter by phone?" />
                                            <p:selectBooleanCheckbox id="phone-number-chkbx" value="#{personSearchPublicBB.params.filterByPhoneNumber}" >
                                                <p:ajax update="phone-number-it"/>
                                            </p:selectBooleanCheckbox>               
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:inputText id="phone-number-it" value="#{personSearchPublicBB.params.phoneNumber}" disabled="#{!personSearchPublicBB.params.filterByPhoneNumber}"/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="street-ol" for="street-chkbx" value="Filter by street?" />
                                            <p:selectBooleanCheckbox id="street-chkbx" value="#{personSearchPublicBB.params.filterByAddressStreet}" >
                                                <p:ajax update="street-it"/>
                                            </p:selectBooleanCheckbox>               
                                        </h:panelGroup>                                        
                                        <h:panelGroup>
                                            <p:inputText id="street-it" value="#{personSearchPublicBB.params.addrStreetSS}" disabled="#{!personSearchPublicBB.params.filterByAddressStreet}"/>
                                        </h:panelGroup>

                                    </h:panelGrid>
                                    <p:commandButton value= "Search" action="#{personSearchPublicBB.queryPersons(personSearchPublicBB.params)}" 
                                                     update="results-dt" ajax="true"/>

                                    <p:dataTable id="results-dt" var="person" value="#{personSearchPublicBB.personSearchResults}" scrollable="true" scrollHeight="300">
                                        <p:column headerText="Last Name">
                                            <h:outputText value="#{person.lastName}" />
                                        </p:column>

                                        <p:column headerText="First Name">
                                            <h:outputText value="#{person.firstName}" />
                                        </p:column>

                                        <p:column headerText="Street Address">
                                            <h:outputText value="#{person.addressStreet}" />
                                        </p:column>

                                        <p:column headerText="Home Phone">
                                            <h:outputText value="#{person.phoneHome}" />
                                        </p:column>

                                        <p:column headerText="Cell Phone">
                                            <h:outputText value="#{person.phoneCell}" />
                                        </p:column>

                                        <p:column headerText="Work Phone">
                                            <h:outputText value="#{person.phoneWork}" />
                                        </p:column>

                                        <p:column headerText="Email">
                                            <h:outputText value="#{person.email}" />
                                        </p:column>

                                        <p:column>
                                            <p:commandButton ajax="true" update=":personsRequirementManageForm:applicationPersonTable" action="#{occPermitApplicationBB.addPersonToApplication(person)}" id="attach-person-cb" value="Attach" />
                                        </p:column>
                                        <!--
                                            <p:column>
                                                <p:commandButton id="edit-person-cb" value="Edit" action="{occPermitApplicationBB.editPersonInfo(person)}"/>
                                            </p:column>
                                        -->
                                    </p:dataTable>
                                </h:panelGroup>
                            </h:panelGrid>
                            <p:outputLabel> Can't find the person you are looking for? </p:outputLabel>
                            <p:commandButton update="applicationPersonTable" value="Add a new person" action="#{occPermitApplicationBB.addANewPerson}" />

                            <p:spacer height="10px"/>

                            <p:outputLabel value="#{occPermitApplicationBB.personRequirementDescription.get(0)}"/>
                            
                            <p:spacer height="10px"/>
                            
                            <p:outputLabel value="#{occPermitApplicationBB.personRequirementDescription.get(1)}"/>
                            
                            <p:spacer height="10px"/>
                            
                            <p:outputLabel value="#{occPermitApplicationBB.personRequirementDescription.get(2)}"/>

                            <p:dataTable id="applicationPersonTable"
                                         var="applicationPerson" value="#{occPermitApplicationBB.attachedPersons}" 
                                         selectionMode="single"
                                         selection="#{occPermitApplicationBB.applicant}"
                                         scrollable="true" scrollHeight="300"
                                         rowKey="#{applicationPerson.personID}"
                                         editable="true">                                
                                <p:column headerText="Name">
                                    <h:outputText value="#{applicationPerson.firstName} #{applicationPerson.lastName}"/>
                                </p:column>

                                <p:column headerText="Person Type">
                                    <p:selectOneMenu value="#{applicationPerson.personType}">
                                        <f:selectItems value="#{occPermitApplicationBB.optAndReqPersons}" var="type" itemLabel="#{type.label}" itemValue="#{type}"/>
                                    </p:selectOneMenu> 
                                </p:column>  

                                <p:column headerText="This is me">
                                    <h:selectBooleanCheckbox value="#{applicationPerson.applicant}"/>
                                </p:column>

                                <p:column headerText="Edit?">

                                    <p:rowEditor/>
                                </p:column>

                                <p:column>
                                    <p:commandButton ajax="true" value="Remove" 
                                                     action="#{occPermitApplicationBB.removePersonFromApplication(applicationPerson)}"
                                                     update="#{p:component('applicationPersonTable')}"
                                                     /> 
                                </p:column>

                            </p:dataTable>


                            <p:commandButton ajax="false" value="Review application"
                                             action="#{occPermitApplicationBB.reviewApplication}"/>

                        </h:form>

                    </div>
                </f:view>

            </ui:define>
        </ui:composition>
    </h:body>
</html>

