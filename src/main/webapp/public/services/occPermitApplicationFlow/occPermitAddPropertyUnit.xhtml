<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Configure Unit List</title>
    </h:head>
    <h:body>
        <ui:composition template="./../../navContainer_public.xhtml">
            <ui:define name="content">
                <f:view id="occPermitApplicationFlowView">
                    <h:form id="occPermitApplicationAddPropertyUnitForm">

                        <!-- VALIDATION MESSAGE -->
                        <p:growl id="growl" showDetail="false"/>

                        <!-- MAIN CONTAINER -->
                        <div class="mainContainer">

                            <!-- TITLE COMPONENT -->
                            <div class="public-title">
                                <div class="public-title-main">
                                    Apply For An Occupancy Permit
                                </div>
                                <div class="public-title-sub">
                                    Step 3: Configure Unit List
                                </div>
                            </div>

                            <!-- CONTENTS CONTAINER -->
                            <div class="public-main-contents-containner">

                                <!--CONTENT MAIN COMPONENT -->
                                <div class="public-main-contents">

                                    <!-- GUIDANCE COMPONENT -->
                                    <div class="public-guide occpermit">
                                        <p:steps activeIndex="2" styleClass="custom" >
                                            <p:menuitem value="Step 1: Choose Municipality" containerStyleClass="complete"/>
                                            <p:menuitem value="Step 2: Choose Property" containerStyleClass="complete"/>
                                            <p:menuitem value="Step 3: Configure Unit List" />
                                            <p:menuitem value="Step 4: Select Units" />
                                            <p:menuitem value="Step 5: Choose Reason" />
                                            <p:menuitem value="Step 6: Add People" />
                                            <p:menuitem value="Step 7: Review And Submit" />
                                        </p:steps>
                                    </div>

                                    <!-- CONTENT IO COMPONENT -->
                                    <div class="public-main-contents-io">
                                        <p>
                                            1. Before applying for occupancy, 
                                            please create a complete list of 
                                            all the units in the property, including 
                                            those that you do not want to apply for.
                                            Press "Add Unit" to add
                                            an empty unit, and click the pencil 
                                            in the edit column to fill out the information.
                                            The Unit Number is required, a 
                                            description may be left blank. 
                                            The description should just 
                                            describe what the room is (e.g. basement).
                                            If you intend to rent please explain your plans under
                                            "Rental notes".
                                        </p>

                                        <p:dataTable id="propertyUnitsToAddTable"
                                                     widgetVar="datatable"
                                                     rowIndexVar="rowIndex"
                                                     var="unit"
                                                     value="#{occPermitApplicationBB.workingPropUnits}"
                                                     selectionMode="single" 
                                                     tabindex="1"
                                                     selection="#{occPermitApplicationBB.selectedUnit}"
                                                     rowKey="#{unit.bundledUnit.unitID}"
                                                     editable="true">                                         

                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputText value="Unit Number" />
                                                </f:facet>
                                                <p:cellEditor>
                                                    <f:facet name="output"><h:outputText value="#{unit.bundledUnit.unitNumber}" /></f:facet>
                                                    <f:facet name="input">
                                                        <p:inputText value="#{unit.bundledUnit.unitNumber}"
                                                                     onkeydown="PF('datatable').onKeyDown(event)"
                                                                     onkeyup="PF('datatable').onKeyUp(event, #{rowIndex})"/>
                                                    </f:facet>
                                                </p:cellEditor>
                                            </p:column>

                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputText value="Rental notes" />
                                                </f:facet>
                                                <p:cellEditor>
                                                    <f:facet name="output">
                                                        <h:outputText value="#{unit.bundledUnit.rentalNotes}" />
                                                    </f:facet>
                                                    <f:facet name="input"> 
                                                        <p:inputText value="#{unit.bundledUnit.rentalNotes}"
                                                                     onkeydown="PF('datatable').onKeyDown(event)"
                                                                     onkeyup="PF('datatable').onKeyUp(event, #{rowIndex})"/>
                                                    </f:facet>
                                                </p:cellEditor>
                                            </p:column>

                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputText value="Unit Description" />
                                                </f:facet>
                                                <p:cellEditor>
                                                    <f:facet name="output">
                                                        <h:outputText value="#{unit.bundledUnit.notes}" />
                                                    </f:facet>
                                                    <f:facet name="input">
                                                        <p:inputText value="#{unit.bundledUnit.notes}" 
                                                                     onkeydown="PF('datatable').onKeyDown(event)"
                                                                     onkeyup="PF('datatable').onKeyUp(event, #{rowIndex})"/>
                                                    </f:facet>
                                                </p:cellEditor>
                                            </p:column>

                                            <p:column style="text-align: center">
                                                <f:facet name="header">
                                                    <h:outputText value="Edit" />
                                                </f:facet>
                                                <p:rowEditor/>
                                            </p:column>

                                            <p:column style="text-align: center">
                                                <f:facet name="header">
                                                    <h:outputText value="Remove" />
                                                </f:facet>

                                                <p:commandButton ajax="true" 
                                                                 value="Remove" 
                                                                 action="#{occPermitApplicationBB.removeSelectedUnit(unit)}"
                                                                 update="#{p:component('propertyUnitsToAddTable')}
                                                                 occPermitApplicationAddPropertyUnitForm"
                                                                 />                                      

                                            </p:column>

                                        </p:dataTable>

                                        <script type="text/javascript">

                                            $(function () {
                                                $.extend(PF("datatable"), {
                                                    onKeyDown: function (e) {
                                                        var key = e.which,
                                                                keyCode = $.ui.keyCode;

                                                        if ((key === keyCode.ENTER || key === keyCode.NUMPAD_ENTER)) {
                                                            e.preventDefault();
                                                        }
                                                    },

                                                    onKeyUp: function (e, rowIndex) {
                                                        var key = e.which,
                                                                keyCode = $.ui.keyCode;
                                                        //.ui-row-editor-check .ui-icon-check .ui-c
                                                        if ((key === keyCode.ENTER || key === keyCode.NUMPAD_ENTER)) {
                                                            this.tbody
                                                                    .find('.ui-row-editor .ui-icon-check')
                                                                    .eq(rowIndex)
                                                                    .click();
                                                        }

                                                        if (key === keyCode.ESCAPE) {
                                                            this.tbody
                                                                    .find('.ui-row-editor .ui-icon-close')
                                                                    .eq(rowIndex)
                                                                    .click();
                                                        }
                                                    }
                                                });
                                            });

                                        </script>

                                        <p:spacer height="20px"/>

                                        <p:commandButton ajax="true"                                                   
                                                         action="#{occPermitApplicationBB.addUnitToNewPropUnits()}" 
                                                         update="propertyUnitsToAddTable"
                                                         value="Add unit"/>

                                    </div>

                                    <!-- CONTENT BUTTON -->
                                    <div class="public-main-contents-button">
                                        <p:commandButton id="goBack" ajax="false"
                                                         value="Go Back" styleClass="buttonOwnLine"
                                                         action="#{occPermitApplicationBB.goBack()}"/>
                                        <p:commandButton ajax="false"                                                   
                                                         action="#{occPermitApplicationBB.finalizeUnitList()}" 
                                                         value="Confirm and Continue"
                                                         style="width: 100%" styleClass="buttonOwnLine"/>

                                    </div>

                                </div>
                            </div>
                        </div>
                    </h:form>
                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
