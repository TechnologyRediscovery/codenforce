<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Human Resources Department</title>
    </h:head>
    <h:body>
        <ui:composition template="../navContainer_restricted.xhtml">
            <ui:define name="content">
                <div class="mainContainer">
                    <h:messages globalOnly="true" 
                                    warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                    </h:messages>
                            
                    <h1>Person manager</h1>
                    <p>Add, adjust, and coordinate person-level information for use by modules across the system.</p>
                    <f:view>
                        <h2>Add a new person:</h2>
                        <h:form id="personNavForm">
                            <p:commandButton id="addNewPersonCB" action="personAdd" value="Add new person" ajax="false"/>
                            
                        </h:form>
                        
                          <h2>Search for a different person</h2>
                            
                            <h:form id="change-person-form">
                                  
                                <h:messages id="person-search-messages" globalOnly="true" showDetail="true" showSummary="true"
                                            warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                </h:messages>
                                
                                
                                <h:panelGrid columns="2" cellpadding="10" footerClass="gridFooter"
                                                     columnClasses="gridTd-solid-back, gridTd-solid-back">

                                    <h:panelGroup>
                                        <p:outputLabel for="muniSelectMenu-person">
                                            <h:outputText value="Municipality:"/>
                                        </p:outputLabel>
                                        <p:spacer height="5px"/>

                                            <p:selectOneMenu id="muniSelectMenu-person" 
                                                             tabindex="1" 
                                                             value="#{personBB.searchParams.muni}">
                                                <f:converter converterId="muniConverter"/>
                                                <f:selectItem itemLabel="select muni..." noSelectionOption="true"  itemDisabled="true"/>
                                                <f:selectItems id="muniNameList" value="#{sessionBean.facesUser.authMunis}" var="m" itemValue="#{m}" itemLabel="#{m.muniName}" />
                                            </p:selectOneMenu>
                                    </h:panelGroup>
                                    
                                    <h:panelGroup class="spacer"></h:panelGroup>    
                                    

                                    <h:panelGroup>
                                        <p:outputLabel id="filter-by-fname-ol" for="filter-by-fname-cb" value="Filter by first name?"/>
                                        <p:spacer height="5px"/>
                                        <p:selectBooleanCheckbox id="filter-by-fname-cb" value="#{personBB.searchParams.filterByFirstName}" />
                                    </h:panelGroup>
                                    
                                    <h:panelGroup>
                                        <p:outputLabel for="formFirstName-person">
                                            <h:outputText value="First Name"/>
                                        </p:outputLabel>
                                        <p:inputText id="formFirstName-person" value="#{personBB.searchParams.firstNameSS}" 
                                              style="width: 200px;" tabindex="1" required="false" styleClass="inputText"/>
                                        <h:message for="formFirstName-person" showDetail="false" showSummary="true" 
                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <p:outputLabel id="filter-by-lname-ol" for="filter-by-lname-cb" value="Filter by last name?"/>
                                        <p:spacer height="5px"/>
                                        <p:selectBooleanCheckbox id="filter-by-lname-cb" value="#{personBB.searchParams.filterByLastName}" />
                                    </h:panelGroup>
                                    
                                    <h:panelGroup id="lname-person-person">
                                        <p:outputLabel for="formLastName-person">
                                            <h:outputText value="Last Name"/>
                                        </p:outputLabel>
                                        <p:inputText id="formLastName-person" value="#{personBB.searchParams.lastNameSS}" 
                                              style="width: 200px;" tabindex="4" required="false" styleClass="inputText"/>
                                        <h:message for="formLastName-person" showDetail="false" showSummary="true" 
                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </h:panelGroup>


                                    <h:panelGroup>
                                        <p:outputLabel id="filter-by-personid-ol" for="filter-by-personid-cb" value="Filter by person ID?"/>
                                        <p:spacer height="5px"/>
                                        <p:selectBooleanCheckbox id="filter-by-personid-cb" value="#{personBB.searchParams.filterByObjectID}" />
                                    </h:panelGroup>
                                    
                                    
                                    
                                    <h:panelGroup id="personID">
                                        <p:outputLabel for="formPersonID">
                                            <h:outputText value="Person ID number"/>
                                        </p:outputLabel>
                                        <p:inputText id="formPersonID" value="#{personBB.searchParams.objectID}" 
                                              style="width: 25%;" tabindex="3" required="true" styleClass="inputText"/>
                                        <h:message for="formPersonID" showDetail="false" showSummary="true" 
                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    </h:panelGroup>
                                </h:panelGrid>
                                
                                <p:commandButton
                                            value="Search for Persons" tabindex="4" ajax="true" icon="fa fa-search"
                                            actionListener="#{personBB.searchForPersons}" 
                                            update=    "change-person-form:filter-by-personid-cb
                                                        change-person-form:formPersonID
                                                        change-person-form:filter-by-fname-cb
                                                        change-person-form:formFirstName-person
                                                        change-person-form:filter-by-lname-cb
                                                        change-person-form:formLastName-person
                                                        change-person-form:muniSelectMenu-person
                                                        change-person-form:personTable
                                                        change-person-form:person-search-messages
                                                        "/>
                                <h3>Chosen Person:</h3>
                                <h:outputText id="confirm-person-ot" value="ID #{personBB.selectedPerson.personID}: 
                                              #{personBB.selectedPerson.lastName} "/>




                                <h2>Search Results</h2>

                                <p:dataTable
                                id="personTable"
                                var="p"
                                value="#{personBB.personList}"
                                rowKey="#{p.personID}"
                                tableStyleClass="primeDataTable"
                                scrollable="true"
                                scrollHeight="300"
                                rowExpandMode="single"
                                expandedRow="false"
                                filteredValue="#{personBB.filteredPersonList}"
                                widgetVar="personSelectListTable">
                                    <!--<p:ajax event="rowSelect" update="selectedRowLabel"/>-->

                                    <p:column width="3%">
                                        <f:facet name="header">
                                            <h:outputText value="Exp"/>
                                        </f:facet>
                                        <p:rowToggler/>
                                    </p:column>
                                    <p:column width="8%">
                                        <f:facet name="header">
                                            <h:outputText value="ID" />
                                        </f:facet>
                                        <h:outputText value="#{p.personID}"/>
                                    </p:column>

                                    <p:column width="10%" sortBy="#{p.personType.label}"
                                              filterBy="#{p.personType.label}">
                                        <f:facet name="header">
                                            <h:outputText value="Person Type" />
                                        </f:facet>
                                        <h:outputText value="#{p.personType.label}"/>
                                    </p:column>


                                    <p:column width="10%" sortBy="#{p.firstName}"
                                              filterBy="#{p.firstName}">
                                        <f:facet name="header">
                                            <h:outputText value="First" />
                                        </f:facet>
                                        <h:outputText value="#{p.firstName}"/>
                                    </p:column>

                                    <p:column width="15%" filterBy="#{p.lastName}"
                                              sortBy="#{p.lastName}">
                                        <f:facet name="header">
                                            <h:outputText value="Last" />
                                        </f:facet>
                                        <h:outputText value="#{p.lastName}"/>
                                    </p:column>

                                    <p:column sortBy="#{p.address_street}"
                                              filterBy="#{p.address_street}">
                                        <f:facet name="header">
                                            <h:outputText value="Address" />
                                        </f:facet>
                                        <h:outputText escape="false" value="#{p.address_street}"/>
                                        <p:spacer height="5px"/>
                                        <h:outputText value="#{p.address_city}, #{p.address_state} #{p.address_zip}"/>
                                    </p:column>

                                    <p:column width="10%" >
                                        <f:facet name="header">
                                            <h:outputText value="Select" />
                                        </f:facet>
                                        <p:commandButton actionListener="#{personBB.selectPerson(p)}"
                                                         ajax="true"
                                                         value="select"
                                                         update="change-person-form:confirm-person-ot"/>
                                    </p:column>


                                    <p:rowExpansion>
                                        <div class="outlinedBox">

                                        <h2>Full person listing for <h:outputText value="#{p.firstName} #{p.lastName}"/> </h2>
                                        <h:panelGrid columns="4" cellpadding="10" footerClass="gridFooter"
                                                     columnClasses="gridTd, gridTd, gridTd, gridTd">

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="First Name"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.firstName}"/>
                                                </div>
                                            </h:panelGroup>


                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Last Name"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.lastName}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Muni"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.muni.muniName}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Type"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.personType.label}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Job Title"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.jobTitle}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Email"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.email}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Address"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="#{p.address_street}"/>
                                                    <p:spacer height="5px"/>
                                                    <h:outputText value="#{p.address_city}, #{p.address_state} #{p.address_zip}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Under 19"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.under18}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Active?"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.active}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Last Updated"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.lastUpdated}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Expires"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.expiryDate.toString}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Phone home"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.phoneHome}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Phone work"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.phoneWork}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Phone cell"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.phoneCell}"/>
                                                </div>
                                            </h:panelGroup>

                                            <f:facet name="footer">
                                                <h:outputLabel styleClass="bold" value="Person notes"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="#{p.notes}"/>
                                                </div>
                                            </f:facet>
                                        </h:panelGrid>
                                        </div>
                                    </p:rowExpansion>
                                </p:dataTable>

                            
                            <p:commandButton ajax="false" value="View profile of selected person" 
                                             action="#{personBB.viewPersonProfile}"/>
                            
                            </h:form>
                        
                        
                        
                           
                            
                            
                    </f:view>
                </div>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

