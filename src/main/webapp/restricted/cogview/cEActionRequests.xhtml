<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Code Enforcement Action Requests</title>
    </h:head>
    <h:body>
        <ui:composition template="../navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view id="CEActionRequestsView">
                    <div class="mainContainer">
                        <h:form id="msgForm">
                            
                        <h:messages id="ceActionRequestsMessages" globalOnly="true" showDetail="true" showSummary="true"
                                    warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                        </h:messages>
                        </h:form>

                        <h1>Code Enforcement Action Requests in <h:outputText value="#{sessionBean.activeMuni.muniName}"/></h1>


                        <h:panelGrid columns="2" cellpadding="10" footerClass="gridFooter"
                                     columnClasses="gridTd-splitPage, gridTd-splitPage">

                            <h:panelGroup style="width:50%;">
                                <h:form id="actionRequestListForm">

                                    <h2>Current Request List</h2>
                                    <h3>Results below show all unattached action requests. Use advanced search options to specify a different result set.</h3>

                                    <p:fieldset legend="Advanced search options"
                                                toggleable="true" collapsed="true" style="background-color: white;">
                                        <h:panelGrid columns="2" cellpadding="10" footerClass="gridFooter"
                                                     columnClasses="gridTd, gridTd">

                                            <h:panelGroup>
                                                <p:outputLabel id="eventDateCalStartOL" for="eventDateCalStart" value="Query start date "/>
                                                <p:calendar id="eventDateCalStart" value="#{cEActionRequestsBB.searchParams.startDateUtilDate}" 
                                                            mode="popup"  
                                                            showOn="button" pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                            navigator="true" tabindex="16" timeInput="true" showHour="true" showMinute="true" showSecond="false" showMillisec="false"
                                                            showButtonPanel="true" showTodayButton="true"
                                                            required="true"/>
                                                <h:message for="eventDateCalStart" showDetail="false" showSummary="true" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel id="eventDateCalEndOL" for="eventDateCalEnd" value="Query end date "/>
                                                <p:calendar id="eventDateCalEnd" value="#{cEActionRequestsBB.searchParams.endDateUtilDate}" 
                                                            mode="popup" 
                                                            showOn="button" pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                            navigator="true" tabindex="16" timeInput="true" showHour="true" showMinute="true" showSecond="false" showMillisec="false"
                                                            showButtonPanel="true" showTodayButton="true"
                                                            required="true" />
                                                <h:message for="eventDateCalEnd" showDetail="false" showSummary="true" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel id="useAttachedToCaseOL" for="useAttachedToCase" value="Filter by case attachment?"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanCheckbox id="useAttachedToCase" value="#{cEActionRequestsBB.searchParams.useAttachedToCase}" />
                                            </h:panelGroup>
                                            
                                            <h:panelGroup>
                                                <p:outputLabel id="attachedToCaseOL" for="attachedToCaseCB" value="Attached to case"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanCheckbox id="attachedToCaseCB" value="#{cEActionRequestsBB.searchParams.attachedToCase}" disabled="false" />
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel id="useMarkedUrgentol" for="useMarkedUrgent" value="Filter by safety hazard?"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanCheckbox id="useMarkedUrgent" value="#{cEActionRequestsBB.searchParams.useMarkedUrgent}" />
                                            </h:panelGroup>
                                            
                                            <h:panelGroup>
                                                <p:outputLabel id="markedUrgentOL" for="useMarkedUrgentcb" value="Safety hazard"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanCheckbox id="useMarkedUrgentcb" value="#{cEActionRequestsBB.searchParams.markedUrgent}" disabled="false" />
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel id="useRequestIDOL" for="useRequestIDCB" value="Search by Request ID?"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanCheckbox id="useRequestIDCB" value="#{cEActionRequestsBB.searchParams.useRequestID}" />
                                            </h:panelGroup>
                                            
                                            <h:panelGroup>
                                                <p:outputLabel id="requestIDOL" for="requestIDIT" value="Request ID:"/>
                                                <p:spacer height="5px"/>
                                                <p:inputText id="requestIDIT" value="#{cEActionRequestsBB.searchParams.requestID}" disabled="false"/>
                                                <h:message for="requestIDIT" showDetail="false" showSummary="true" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel id="useActionRequestStatusOL" for="useRequestIDCB" value="Search by Request status?"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanCheckbox id="useActionRequestStatusSB" value="#{cEActionRequestsBB.searchParams.useRequestStatus}" />
                                            </h:panelGroup>
                                            
                                            <h:panelGroup>
                                                <p:selectOneMenu id="ceactionrequeststatusmenuSearch" required="false" value="#{cEActionRequestsBB.searchParams.requestStatus}">
                                                    <f:converter converterId="ceActionRequestStatusConverter"/>
                                                    <f:selectItems value="#{cEActionRequestsBB.statusList}"
                                                                   var="cearqs" itemValue="#{cearqs}" itemLabel="#{cearqs.statusTitle}"/>
                                                </p:selectOneMenu>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel id="useNotAtAddressOL" for="useNotAtAddressCB" value="Filter by not at address?"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanCheckbox id="useNotAtAddressCB" value="#{cEActionRequestsBB.searchParams.useNotAtAddress}" />
                                            </h:panelGroup>
                                            
                                            <h:panelGroup>
                                                <p:outputLabel id="notAtAddressOL" for="notAtAddressCB" value="Not at an address"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanCheckbox id="notAtAddressCB" value="#{cEActionRequestsBB.searchParams.notAtAnAddress}" disabled="false" />
                                            </h:panelGroup>
                                        </h:panelGrid>
                                        <p:spacer height="15px"/>

                                        <p:commandButton ajax="true" value="Update results" actionListener="#{cEActionRequestsBB.updateRequestList}"
                                                         update="
                                                         actionRequestListForm:eventDateCalStart
                                                         actionRequestListForm:eventDateCalEnd
                                                         actionRequestListForm:useAttachedToCase
                                                         actionRequestListForm:attachedToCaseCB
                                                         actionRequestListForm:useMarkedUrgent
                                                         actionRequestListForm:useMarkedUrgentcb
                                                         actionRequestListForm:useRequestIDCB
                                                         actionRequestListForm:requestIDIT
                                                         actionRequestListForm:useActionRequestStatusSB
                                                         actionRequestListForm:useNotAtAddressCB
                                                         actionRequestListForm:notAtAddressCB
                                                         actionRequestListForm:actionRequestTable"/>

                                    </p:fieldset>

                                    <h2>Code Enforcement Action Requests</h2>
                                    <h:messages id="actionQueryMessages" globalOnly="true" showDetail="true" showSummary="true"
                                                warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                    </h:messages>

                                    <p:dataTable
                                        id="actionRequestTable"
                                        var="r"
                                        rowKey="#{r.requestID}"
                                        value="#{cEActionRequestsBB.requestList}"
                                        tableStyleClass="primeDataTable"
                                        resizableColumns="true"
                                        reflow="true"
                                        expandedRow="false"
                                        >
                                        <p:column width="3%">
                                            <f:facet name="header">
                                                <h:outputText value="ID" />
                                            </f:facet>
                                            <div class="wrapText">
                                                <h:outputText value="#{r.requestID}"/>
                                            </div>
                                        </p:column>

                                        <p:column width="8%">
                                            <f:facet name="header">
                                                <h:outputText value="Issue Type" />
                                            </f:facet>
                                            <div class="wrapText">
                                                <h:outputText value="#{r.issueTypeString}"/>
                                            </div>
                                        </p:column>
                                        
                                        <p:column width="8%">
                                            <f:facet name="header">
                                                <h:outputText value="Address" />
                                            </f:facet>
                                            <div class="rowExpansion">
                                                <h:outputText value="#{r.requestProperty.address}"/>
                                            </div>
                                        </p:column>
                                        
                                        <p:column width="10%">
                                            <f:facet name="header">
                                                <h:outputText value="Status" />
                                            </f:facet>
                                            <div class="wrapText">
                                                <h:outputText value="#{r.requestStatus.statusTitle}"/>
                                            </div>
                                        </p:column>

                                        <p:column width="5%">
                                            <f:facet name="header">
                                                <h:outputText value="Age" />
                                            </f:facet>
                                            <h:outputText value="#{r.daysSinceDateOfRecord}"/>
                                        </p:column>

                                        <p:column width="8%">
                                            <p:commandButton actionListener="#{cEActionRequestsBB.manageActionRequest(r)}"
                                                             ajax="true" value="manage"
                                                             update="req-details-form:selr-status-ot
                                                             req-details-form:selr-id
                                                             req-details-form:selr-issueType
                                                             req-details-form:selr-prop-address
                                                             req-details-form:selr-attachedCase
                                                             req-details-form:selr-prop-muni
                                                             req-details-form:selr-pacc
                                                             req-details-form:selr-access-sbcb
                                                             req-details-form:selr-pacc-access-ot
                                                             req-details-form:selr-submitted-ts
                                                             req-details-form:selr-isurgent
                                                             req-details-form:selr-persontype
                                                             req-details-form:selr-pers-fn
                                                             req-details-form:selr-pers-ln
                                                             req-details-form:selr-pers-str
                                                             req-details-form:selr-pers-city
                                                             req-details-form:selr-pers-state
                                                             req-details-form:selr-pers-zip
                                                             req-details-form:selr-pers-phone-cell
                                                             req-details-form:selr-pers-phone-work
                                                             req-details-form:selr-pers-email
                                                             req-details-form:selr-descr
                                                             req-details-form:selr-notes-internal
                                                             req-details-form:selr-notes-muni
                                                             req-details-form:selr-notes-public
                                                             req-details-form:open-new-case-cb
                                                             req-details-form:attach-to-case-cb
                                                             req-details-form:no-violation-found-cb
                                                             req-details-form:invalid-request-cb
                                                             req-details-form:header-id-ot
                                                             req-details-form:header-type-ot
                                                             req-details-form:header-addr-ot
                                                             req-details-form:header-muni-ot
                                                             "/>
                                        </p:column>
                                    </p:dataTable>

                                    <p:spacer height="15px"/>

                                    <p:commandLink value="Export table as pdf report" ajax="false">
                                        <p:dataExporter type="pdf" target="actionRequestTable" fileName="actionRequestReport_#{sessionBean.activeMuni.muniName}"/>
                                    </p:commandLink>
                                    
                                </h:form>

                            </h:panelGroup>

                            <h:panelGroup>
                                <h:form id="req-details-form">

                                    <h2>
                                        Request ID #<h:outputText   id="header-id-ot" value="#{cEActionRequestsBB.selectedRequest.requestID}"/>: 
                                        <h:outputText id="header-type-ot" value="#{cEActionRequestsBB.selectedRequest.issueTypeString}"/>
                                        at <h:outputText id="header-addr-ot" value="#{cEActionRequestsBB.selectedRequest.requestProperty.address} "/>  
                                        <h:outputText id="header-muni-ot" value="(#{cEActionRequestsBB.selectedRequest.requestProperty.muni.muniName})"/>)  
                                    
                                    </h2>

                                    <h:outputLabel styleClass="bold" value="Status:"/>
                                    <p:spacer height="5px"/>
                                    
                                    <h:outputText id="selr-status-ot" value="#{cEActionRequestsBB.selectedRequest.requestStatus.statusTitle}"/>
                                    
                                    
                                    <p:spacer height="15px"/>
                                    
                                    <h:outputLabel styleClass="bold" value="Available actions:"/>

                                    <p:spacer height="5px"/>
                                    
                                    <p:commandButton    id="open-new-case-cb"
                                                        ajax="false" value="Open new code enf case at this property" 
                                                        disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                        action="#{cEActionRequestsBB.path1CreateNewCaseAtProperty}"
                                                        update="ceActionRequestsMessages" icon="fa fa-folder" 
                                                        styleClass="cear-actions-button"/>
                                    <p:spacer height="5px"/>
                                    
                                    <p:commandButton    id="attach-to-case-cb"
                                                        value="Attach to existing code enf case"
                                                        disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                        onclick="PF('attach-to-case-dialog').show()"
                                                        update="attach-to-existing-case-form:cases-on-selected-request-property-DS"
                                                        icon="fa fa-book" />
                                    <p:spacer height="5px"/>
                                    
                                    
                                    <p:commandButton    id="no-violation-found-cb"
                                                        value="No violation found on site"
                                                        disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                        onclick="PF('no-violation-found-dialog').show()"
                                                        icon="fa fa-circle-o"/>
                                    <p:spacer height="5px"/>

                                    <p:commandButton    id="invalid-request-cb"
                                                        value="Invalid request"
                                                        disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                        onclick="PF('invalid-dialog').show()"
                                                        icon="fa fa-exclamation-circle"/>
                                    
                                    <p:spacer height="5px"/>

                                    <p:commandButton    id="manually-override-status-cb"
                                                        value="Manually override request status"
                                                        rendered="#{sessionBean.accessKeyCard.hasSysAdminPermissions}"
                                                        onclick="PF('override-request-status-dialog').show()"
                                                        icon="fa fa-gears"/>
                                    
                                    <p:spacer height="5px"/>
                                    
                                    

                                <div class="outlinedBox">
                                    <h3>Code Enforcement Action Request</h3>
                                    <h:panelGrid columns="2" cellpadding="10" footerClass="gridFooter"
                                                 columnClasses="gridTd, gridTd" id="selectedRequestDetails">

                                        <h:panelGroup>
                                            <h:outputLabel styleClass="bold" value="ID"/>
                                            <p:spacer height="5px"/>
                                            <div class="wrapText">
                                                <h:outputText id="selr-id" value="#{cEActionRequestsBB.selectedRequest.requestID}"/>
                                            </div>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <h:outputLabel class="bold" value="Issue Type" />
                                            <p:spacer height="5px"/>
                                            <div class="wrapText">
                                                <h:outputText id="selr-issueType" value="#{cEActionRequestsBB.selectedRequest.issueTypeString}"/>
                                            </div>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <h:outputLabel class="bold" value="Attached Case" />
                                            <p:spacer height="5px"/>
                                            <div class="wrapText">
                                                <h:outputText id="selr-attachedCase" value="#{cEActionRequestsBB.selectedRequest.caseID}"/>
                                            </div>
                                        </h:panelGroup>
                                        
                                        <h:panelGroup>
                                            
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <h:outputLabel class="bold" value="Address" />
                                            <p:spacer height="5px"/>
                                            <div class="rowExpansion">
                                                <h:outputText id="selr-prop-address" value="#{cEActionRequestsBB.selectedRequest.requestProperty.address}"/><br/>
                                                <h:outputText id="selr-prop-muni" value="#{cEActionRequestsBB.selectedRequest.requestProperty.muni.muniName}"/>
                                            </div>
                                            <p:spacer height="5px"/>
                                            <p:commandButton onclick="PF('change-property-dialog').show()" 
                                                             value="change property" 
                                                             styleClass="noFill button-size-small"
                                                             icon="fa fa-home"
                                                             rendered="#{sessionBean.accessKeyCard.hasMuniStaffPermissions}"/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <h:outputLabel class="bold" value="Public access reference num" />
                                            <div class="rowExpansion">
                                                <h:outputText id="selr-pacc" value="#{cEActionRequestsBB.selectedRequest.requestPublicCC}"/>
                                            </div>
                                            <p:spacer height="5px"/>
                                            <p:selectBooleanCheckbox id="selr-access-sbcb" value="#{cEActionRequestsBB.selectedRequest.paccEnabled}"
                                                                     disabled="#{cEActionRequestsBB.disablePACCControl}">
                                                <p:ajax listener="#{cEActionRequestsBB.changePACCAccess}" update="msgForm:ceActionRequestsMessages" />
                                            </p:selectBooleanCheckbox>
                                            <h:outputText value=" Allow access using ref num?"/>
                                            <p:spacer height="5px"/>
                                            
                                        </h:panelGroup>
                                        
                                        <h:panelGroup>
                                            <h:outputLabel class="bold" value="Date Submitted" />
                                            <p:spacer height="5px"/>
                                            <div class="wrapText">
                                                <h:outputText id="selr-submitted-ts"  value="#{cEActionRequestsBB.selectedRequest.formattedSubmittedTimeStamp}"/>
                                            </div>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <div class="wrapText">
                                                <h:outputLabel styleClass="bold" value="Human safety issue?"/>
                                                <p:spacer height="5px"/>
                                                <h:outputText id="selr-isurgent"  value="#{cEActionRequestsBB.selectedRequest.isUrgent}"/>
                                            </div>
                                        </h:panelGroup>

                                        <h:panelGroup>

                                            <div class="wrapText">
                                                <h:outputLabel id="selr-persontype" styleClass="bold" value="Requestor ID:#{cEActionRequestsBB.selectedRequest.actionRequestorPerson.personID} 
                                                                (#{cEActionRequestsBB.selectedRequest.actionRequestorPerson.personType.label}): "/>
                                                <p:spacer height="5px"/>

                                                <h:outputText id="selr-pers-fn" value="#{cEActionRequestsBB.selectedRequest.actionRequestorPerson.firstName} "/> 
                                                <h:outputText id="selr-pers-ln" value="#{cEActionRequestsBB.selectedRequest.actionRequestorPerson.lastName}"/><br/> 
                                                <h:outputText id="selr-pers-str" value="#{cEActionRequestsBB.selectedRequest.actionRequestorPerson.address_street}"/> <br/>
                                                <h:outputText id="selr-pers-city" value="#{cEActionRequestsBB.selectedRequest.actionRequestorPerson.address_city}, "/> 
                                                <h:outputText id="selr-pers-state" value="#{cEActionRequestsBB.selectedRequest.actionRequestorPerson.address_state} "/> 
                                                <h:outputText id="selr-pers-zip" value="#{cEActionRequestsBB.selectedRequest.actionRequestorPerson.address_zip}"/> 
                                            </div>
                                            
                                            <p:spacer height="5px"/>
                                            <p:commandButton onclick="PF('muni-message-dialog').show()" 
                                                                 value="change person" 
                                                                 styleClass="noFill button-size-small" 
                                                                 icon="fa fa-child"
                                                                 rendered="#{sessionBean.accessKeyCard.hasMuniStaffPermissions}" />
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <h:outputLabel styleClass="bold" value="Contact: "/>
                                            <p:spacer height="5px"/>
                                            <div class="wrapText"> 
                                                <h:outputText value="Phone (cell): "/>
                                                <h:outputText id="selr-pers-phone-cell" value="#{cEActionRequestsBB.selectedRequest.actionRequestorPerson.phoneCell}"/> <br/>
                                                <h:outputText  value="Phone (work): "/>
                                                <h:outputText id="selr-pers-phone-work" value="#{cEActionRequestsBB.selectedRequest.actionRequestorPerson.phoneWork}"/> <br/>
                                                <h:outputText value="Phone (home): "/>
                                                <h:outputText id="selr-pers-phone-home" value="#{cEActionRequestsBB.selectedRequest.actionRequestorPerson.phoneHome}"/> <br/>
                                                <h:outputText value="Email: "/>
                                                <h:outputText id="selr-pers-email" value="#{cEActionRequestsBB.selectedRequest.actionRequestorPerson.email}"/>
                                            </div>
                                        </h:panelGroup>



                                        <f:facet name="footer" class="leftalign">
                                            <h:outputLabel styleClass="bold" value="Request description:"/>
                                            <div class="rowExpansion" style="leftalign">
                                                <h:outputText id="selr-descr" escape="false" value="#{cEActionRequestsBB.selectedRequest.requestDescription}"/>
                                            </div>
                                            
                                            <p:spacer height="5px"/>
                                            <hr />
                                            <p:spacer height="5px"/>
                                            
                                            <h:outputLabel styleClass="bold" value="Internal notes: "/>
                                            <p:commandButton onclick="PF('internal-message-dialog').show()" 
                                                             icon="fa fa-pencil-square-o"
                                                             value="new note" 
                                                             styleClass="noFill button-size-small" 
                                                             rendered="#{sessionBean.accessKeyCard.hasCOGStaffPermissions}" />
                                                <p:spacer height="5px"/>
                                            <div class="rowExpansion" style="leftalign">
                                                <h:outputText id="selr-notes-internal" escape="false" value="#{cEActionRequestsBB.selectedRequest.cogInternalNotes}"/>
                                            </div>

                                            <p:spacer height="5px"/>
                                            <hr />
                                            <p:spacer height="5px"/>
                                            
                                            <h:outputLabel styleClass="bold" value="Staff-only notes: "/>
                                            <p:commandButton onclick="PF('muni-message-dialog').show()" 
                                                             value="new note"
                                                             icon="fa fa-pencil-square-o"
                                                             styleClass="noFill button-size-small" 
                                                             rendered="#{sessionBean.accessKeyCard.hasMuniStaffPermissions}" />
                                            <p:spacer height="5px"/>
                                            <div class="rowExpansion" style="leftalign">
                                                <h:outputText id="selr-notes-muni" escape="false" value="#{cEActionRequestsBB.selectedRequest.muniNotes}"/>
                                            </div>
                                            
                                            <p:spacer height="5px"/>
                                            <hr />
                                            <p:spacer height="5px"/>
                                            
                                            <h:outputLabel styleClass="bold" value="Public notes: "/>
                                            <p:commandButton onclick="PF('public-message-dialog').show()" 
                                                             value="new note" 
                                                             icon="fa fa-pencil-square-o"
                                                             styleClass="noFill button-size-small" 
                                                             rendered="#{sessionBean.accessKeyCard.hasMuniStaffPermissions}" />
                                                <p:spacer height="5px"/>
                                                <div class="rowExpansion" style="leftalign">
                                                    <h:outputText id="selr-notes-public" escape="false" value="#{cEActionRequestsBB.selectedRequest.publicExternalNotes}"/>
                                                </div>
                                        </f:facet>
                                    </h:panelGrid>
                                </div>
                                    
                                    <p:spacer height="5px"/>

                                    
                                </h:form>
                            </h:panelGroup>
                        </h:panelGrid>

                        
                        
                        <p:confirmDialog message="Attach request to existing case" 
                                         severity="alert" widgetVar="attach-to-case-dialog"
                                         closable="true"
                                         rendered="#{sessionBean.accessKeyCard.hasEnfOfficialPermissions}">

                            <h:form id="attach-to-existing-case-form">
                                
                                <p>Choose an existing case on <h:outputLabel for="invalidMessageITA" value="#{cEActionRequestsBB.selectedRequest.requestProperty.address}"/>:</p>
                                <p:dataScroller
                                    id="cases-on-selected-request-property-DS"
                                    value="#{cEActionRequestsBB.caseListForSelectedProperty}"
                                    var="c">
                                    <p>Case ID: <h:outputText value="#{c.caseID}"/> <br/>
                                        Name: <h:outputText value="#{c.caseName}" /> <br/>
                                        Phase: <h:outputText value="#{c.casePhase.label}"/> <br/>
                                        Opening date: <h:outputText value="#{c.originiationDatePretty}"/> <br/>
                                        Closing date: <h:outputText value="#{c.closingDatePretty}"/> <br/>
                                    </p>
                                    <p:commandButton value="Assign request to this case"
                                                     actionListener="#{cEActionRequestsBB.path2UseSelectedCaseForAttachment(c)}"
                                                     update="msgForm:ceActionRequestsMessages
                                                     req-details-form:selr-status-ot
                                                     actionRequestListForm:actionRequestTable
                                                     req-details-form:selr-notes-public
                                                     req-details-form:selr-attachedCase
                                                     "
                                                     rendered="#{sessionBean.accessKeyCard.hasEnfOfficialPermissions}"
                                                     oncomplete="PF('attach-to-case-dialog').hide()"/>
                                    <p:commandButton ajax="true" 
                                                     value="Cancel" icon="fa fa-stop" 
                                                     onclick="PF('attach-to-case-dialog').hide()"/>
                                    <hr/>
                                    
                                </p:dataScroller>
                            </h:form>
                        </p:confirmDialog>
                        
                        <p:confirmDialog message="Mark request as invalid" 
                                         severity="alert" widgetVar="invalid-dialog"
                                         closable="true"
                                         rendered="#{sessionBean.accessKeyCard.hasEnfOfficialPermissions}">

                            <h:form id="invalid-form">
                                <h:outputLabel for="invalidMessageITA" value="What makes this an invalid request?"/>
                                <p:spacer height="15px"/>
                                <p:inputTextarea id="invalidMessageITA" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.invalidMessage}"/>
                                <p:spacer height="15px"/>
                                <p>This message, your name, and a timestamp will be appended <br/>to the public note section of request ID 
                                    <h:outputText escape="false" value="#{cEActionRequestsBB.selectedRequest.requestID}"/> </p>

                                <p:spacer height="15px"/>
                                <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.path3AttachInvalidMessage}"
                                                 value="Submit" icon="fa fa-link" oncomplete="PF('invalid-dialog').hide()"
                                                 rendered="#{sessionBean.accessKeyCard.hasEnfOfficialPermissions}"
                                                 update="req-details-form:selr-notes-public
                                                 msgForm:ceActionRequestsMessages
                                                 req-details-form:selr-status-ot
                                                 actionRequestListForm:actionRequestTable"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('invalid-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>
                        
                        
                        
                        <p:confirmDialog message="Mark request: No Violation Found" 
                                         severity="alert" widgetVar="no-violation-found-dialog"
                                         closable="true"
                                         rendered="#{sessionBean.accessKeyCard.hasEnfOfficialPermissions}">

                            <h:form id="no-violation-form">
                                <h:outputLabel for="noViolationMessageITA" value="Describe the results of your request investigation:"/>
                                <p:spacer height="15px"/>
                                <p:inputTextarea id="noViolationMessageITA" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.noViolationFoundMessage}"/>
                                <p:spacer height="15px"/>
                                <p>This message, your name, and a timestamp will be appended <br/>to the public note section of request ID 
                                    <h:outputText escape="false" value="#{cEActionRequestsBB.selectedRequest.requestID}"/> </p>

                                <p:spacer height="15px"/>
                                <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.path4AttachNoViolationFoundMessage}"
                                                 value="Submit" icon="fa fa-link" oncomplete="PF('no-violation-found-dialog').hide()"
                                                 rendered="#{sessionBean.accessKeyCard.hasEnfOfficialPermissions}"
                                                 update="req-details-form:selr-notes-public
                                                 msgForm:ceActionRequestsMessages
                                                 req-details-form:selr-status-ot
                                                 actionRequestListForm:actionRequestTable"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('no-violation-found-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>
                        
                        <p:confirmDialog message="Override request status" 
                                         severity="alert" widgetVar="override-request-status-dialog"
                                         closable="true"
                                         rendered="#{sessionBean.accessKeyCard.hasEnfOfficialPermissions}">

                            <h:form id="override-request-status-form">
                                    
                                    <h:outputLabel styleClass="bold" for="ceactionrequeststatusmenu" value="Change status to:"/>
                                    
                                    <p:selectOneMenu id="ceactionrequeststatusmenu" required="false" value="#{cEActionRequestsBB.selectedChangeToStatus}">
                                        <f:converter converterId="ceActionRequestStatusConverter"/>
                                        <f:selectItem itemLabel="select one..." noSelectionOption="true" itemDisabled="true"/>
                                        <f:selectItems value="#{cEActionRequestsBB.statusList}"
                                                       var="cearqs" itemValue="#{cearqs}" itemLabel="#{cearqs.statusTitle}"/>
                                    </p:selectOneMenu>
                                    
                                    <p:commandButton    id="change-request-status-cb"
                                                        ajax="true" value="Change request status" 
                                                        actionListener="#{cEActionRequestsBB.updateActionRequestStatus}"
                                                        update="actionRequestListForm:actionRequestTable
                                                        req-details-form:selr-status-ot
                                                        req-details-form:selr-notes-public"
                                                        oncomplete="PF('override-request-status-dialog').hide()"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('manage-public-access-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>

                        
                        <ui:remove>
                            
                        
                        <p:confirmDialog message="Manage public access" 
                                         severity="alert" widgetVar="manage-public-access-dialog"
                                         closable="true"
                                         rendered="#{sessionBean.accessKeyCard.hasMuniStaffPermissions}">

                            <h:form id="manage-public-access-form">
                                
                                
                                <p:spacer height="15px"/>
                                <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.changePACCAccess}"
                                                 value="Save" icon="fa fa-link" oncomplete="PF('manage-public-access-dialog').hide()"
                                                 rendered="#{sessionBean.accessKeyCard.hasEnfOfficialPermissions}"
                                                 update="req-details-form:selr-notes-public
                                                 msgForm:ceActionRequestsMessages"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('manage-public-access-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>
                        
                        </ui:remove>
                        
                        <p:confirmDialog message="Change property" 
                                         severity="alert" widgetVar="change-property-dialog"
                                         closable="true"
                                         rendered="#{sessionBean.accessKeyCard.hasEnfOfficialPermissions}">

                            <h:form id="change-property-form">
                               
                                    
                                
                            <p:selectOneMenu id="muniSelectMenu" 
                                             tabindex="1" 
                                             value="#{cEActionRequestsBB.muniForPropSwitchSearch}">
                                <f:converter converterId="muniConverter"/>
                                <f:selectItem itemLabel="select one..." noSelectionOption="true"  itemDisabled="true"/>
                                <f:selectItems id="muniNameList" value="#{missionControlBB.muniList}" var="m" itemValue="#{m}" itemLabel="#{m.muniName}" />
                            </p:selectOneMenu>

                                <p:panelGrid columns="3" layout="grid">

                                    <h:panelGroup>
                                        <p:outputLabel for="propSearchHouseNumIT">
                                            <h:outputText value="House number"/>
                                        </p:outputLabel>
                                        <p:inputText id="propSearchHouseNumIT" value="#{cEActionRequestsBB.houseNumSearch}" 
                                                     style="width: 100px;" tabindex="3" required="false" styleClass="inputText">
                                        </p:inputText>
                                        <h:message for="propSearchHouseNumIT" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <p:outputLabel for="propSearchStreetIT">
                                            <h:outputText value="Street name"/>
                                        </p:outputLabel>
                                        <p:inputText id="propSearchStreetIT" value="#{cEActionRequestsBB.streetNameSearch}" 
                                                     style="width: 200px;" tabindex="4" required="false" styleClass="inputText">
                                        </p:inputText>
                                        <h:message for="propSearchStreetIT" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <p:commandButton
                                            value="Search in Selected Municipality" tabindex="4" ajax="true" icon="fa fa-search"
                                            actionListener="#{cEActionRequestsBB.searchForProperties}" 
                                            update=    "change-property-form:propSearchHouseNumIT
                                                        change-property-form:propSearchStreetIT
                                                        change-property-form:propertyResultTable"/>
                                    </h:panelGroup>

                                </p:panelGrid> 

                                 <h3>Search Results:</h3>
                                        <p>Click to select the desired property or try your search again</p>

                                        <p:dataTable
                                            id="propertyResultTable"
                                            var="prop" 
                                            value="#{cEActionRequestsBB.propertyList}"
                                            selectionMode="single" tabindex="5"
                                            scrollable="true" scrollHeight="150" 
                                            selection="#{cEActionRequestsBB.propertyForPropSwitch}"
                                            rowKey="#{prop.propertyID}">
                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputText value="Address" />
                                                </f:facet>
                                                <h:outputText value="#{prop.address}"/>
                                            </p:column>
                                            <p:column>

                                                <f:facet name="header">
                                                    <h:outputText value="Municipality" />
                                                </f:facet>
                                                <h:outputText value="#{prop.muni.muniName}"/>

                                            </p:column>

                                            <p:column>

                                                <f:facet name="header">
                                                    <h:outputText value="Type" />
                                                </f:facet>
                                                <h:outputText value="#{prop.propertyUseType}"/>

                                            </p:column>

                                        </p:dataTable>

                                        <p:spacer height="10px"/>

                                    <p:commandButton value="Assign request to selected property"
                                                     actionListener="#{cEActionRequestsBB.updateRequestProperty}"
                                                     rendered="#{sessionBean.accessKeyCard.hasEnfOfficialPermissions}"
                                                     update="   msgForm:ceActionRequestsMessages
                                                                req-details-form:selr-prop-address
                                                                req-details-form:selr-prop-muni
                                                                actionRequestListForm:actionRequestTable
                                                                req-details-form:selr-status-ot"
                                                     oncomplete="PF('change-property-dialog').hide()"/>
                                    <p:commandButton ajax="true" 
                                                     value="Cancel" icon="fa fa-stop" 
                                                     onclick="PF('change-property-dialog').hide()"/>
                                    <hr/>
                                    
                            </h:form>
                        </p:confirmDialog>
                        
                        
                        <p:confirmDialog message="Attach internal message" 
                                         severity="alert" widgetVar="internal-message-dialog"
                                         closable="true"
                                         rendered="#{sessionBean.accessKeyCard.hasCOGStaffPermissions}">

                            <h:form id="internal-message-form">
                                <h:outputLabel for="internal-message-ita" value="Message text"/>
                                <p:spacer height="15px"/>
                                <p:inputTextarea id="internal-message-ita" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.internalMessageText}"/>
                                <p:spacer height="15px"/>
                                <h:outputText escape="false" value="Your name and a timestamp will be bundled with this message 
                                              and attached to #{cEActionRequestsBB.selectedRequest.requestID}"/>

                                <p:spacer height="15px"/>
                                <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.attachInternalMessage}"
                                                 value="Submit" icon="fa fa-link" oncomplete="PF('internal-message-dialog').hide()"
                                                 rendered="#{sessionBean.accessKeyCard.hasCOGStaffPermissions}"
                                                 update="req-details-form:selr-notes-internal
                                                 msgForm:ceActionRequestsMessages"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('internal-message-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>
                        
                        
                        <p:confirmDialog message="Attach municipality message" 
                                         severity="alert" widgetVar="muni-message-dialog"
                                         closable="true"
                                         rendered="#{sessionBean.accessKeyCard.hasMuniStaffPermissions}">

                            <h:form id="muni-message-form">
                                <h:outputLabel for="muni-message-ita" value="Message text"/>
                                <p:spacer height="15px"/>
                                <p:inputTextarea id="muni-message-ita" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.muniMessageText}"/>
                                <p:spacer height="15px"/>
                                <h:outputText escape="false" value="Your name and a timestamp will be bundled with this message 
                                              and attached to #{cEActionRequestsBB.selectedRequest.requestID}"/>
                                <p:spacer height="15px"/>
                                <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.attachMuniMessage}"
                                                 value="Submit" icon="fa fa-link" oncomplete="PF('muni-message-dialog').hide()"
                                                 rendered="#{sessionBean.accessKeyCard.hasMuniStaffPermissions}"
                                                 update="req-details-form:selr-notes-muni"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('muni-message-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>
                        
                        
                        <p:confirmDialog message="Attach public message" 
                                         severity="alert" widgetVar="public-message-dialog"
                                         closable="true"
                                         rendered="#{sessionBean.accessKeyCard.hasMuniStaffPermissions}">

                            <h:form id="public-message-form">
                                <h:outputLabel for="public-message-ita" value="Message text"/>
                                <p:spacer height="15px"/>
                                <p:inputTextarea id="public-message-ita" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.publicMessageText}"/>
                                <p:spacer height="15px"/>
                                <h:outputText escape="false" value="Your name and a timestamp will be bundled with this message 
                                              and attached to #{cEActionRequestsBB.selectedRequest.requestID}"/> 

                                <p:spacer height="15px"/>
                                <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.attachPublicMessage}"
                                                 value="Submit" icon="fa fa-link" oncomplete="PF('public-message-dialog').hide()"
                                                 rendered="#{sessionBean.accessKeyCard.hasMuniStaffPermissions}"
                                                 update="req-details-form:selr-notes-public"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('public-message-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>
                        
                        
                        
                        
                    </div>
                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

