<?xml version="1.0" encoding="UTF-8"?>
<!--
Copyright (C) 2018 Adam Gutonski

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Occupancy Inspection</title>
    </h:head>
    <h:body>
        <ui:composition template="../../navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view id="view-inspections">
                    <div class="mainContainer">



                        <div class="two-column-page-flex-container">

                            <div class="list-column">

                                <h2>Inspection template</h2>

                                <h:form id="form-inspection-messages-global">

                                    <h:messages id="messages-inspection-global" globalOnly="true" showDetail="true" showSummary="true"
                                                warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                    </h:messages>
                                </h:form>



                                <h1>Occupancy Inspection ID:<h:outputText value="#{sessionBean.sessionOccInspection.inspectionID}"/></h1>
                                <h:form id="form-inspection-template">



                                    <p:tabView id="tabview-inspection-templateviews">
                                        <p:tab  id="tab-activelookup"
                                                title="tab-active-lookup">

                                            <p:selectOneListbox id="listbox-occspacetype" required="true" value="#{occInspectionBB.selectedOccSpaceType}" tabindex="1">
                                                <p:ajax update="scroller-template-spacetypelist-spacelist" 
                                                        immediate="true"/> 
                                                <f:converter converterId="occSpaceTypeConverter" />
                                                <f:selectItems value="#{occInspectionBB.currentInspection.checklistTemplate.occSpaceTypeTemplateList}" 
                                                               var="st" itemLabel="#{st.spaceTypeTitle}" />
                                            </p:selectOneListbox>

                                            <h:message for="newEventTypeMenu" showDetail="false" showSummary="true" 
                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                            <p:dataScroller
                                                id="scroller-template-spacetypelist-spacelist"
                                                widgetVar="var-scroller-inspectiontemplate-spacetypelist-spacelist"
                                                var="space"
                                                value="#{occInspectionBB.browseSpaceList}"
                                                rowIndexVar="#{space.spaceID}">

                                                <div class="outlinedBox">


                                                    <div class="datum">
                                                        <h:outputText styleClass="ui-label-inline" value="Space name: " />
                                                        <h:outputText styleClass="data-text" value="#{space.name}" />

                                                        <p:commandButton       id="button-occperiodtable-editperiod"
                                                                               ajax="true" 
                                                                               actionListener="#{occInspectionBB.addSpaceToChecklist(space)}"
                                                                               rendered="#{sessionBean.sessionUser.keyCard.hasEnfOfficialPermissions}"
                                                                               value="inspect this space"  
                                                                               icon="fa fa-open"
                                                                               update="form-inspection-messages-inspecteditems"/>



                                                    </div>

                                                    <p:dataScroller
                                                        id="scroller-template-spacetypelist-spacelist-elementlist"
                                                        widgetVar="var-scroller-inspectiontemplate-spacetypelist-spacelist-elementlist"
                                                        var="codeElement"
                                                        value="#{space.elementList}"
                                                        rowIndexVar="#{codeElement.elementID}">

                                                        <div class="outlinedBox">

                                                            <h:outputLabel styleClass="bold" value="Ordindance: "  />
                                                            <p:spacer height="5px" />
                                                            <h:outputText  value="&#167;#{codeElement.ordSecNum}:" />
                                                            <h:outputText  value="#{codeElement.ordSecTitle}; " />
                                                            <h:outputText  value="&#167;&#167;#{codeElement.ordSubSecNum} " />
                                                            <h:outputText  value="#{codeElement.ordSubSecTitle}" />
                                                            <p:spacer height="2px" />

                                                        </div>
                                                    </p:dataScroller>
                                                </div>
                                            </p:dataScroller>


                                        </p:tab>


                                        <p:tab  id="tab-fulllisting"
                                                title="tab-full-template">

                                            <h3>Space types in this checklist</h3>

                                            <p:dataScroller
                                                id="scroller-template-spacetypelist"
                                                widgetVar="var-scroller-inspectiontemplate-spacetypelist"
                                                var="spaceType"
                                                value="#{occInspectionBB.currentInspection.checklistTemplate.occSpaceTypeTemplateList}"
                                                rowIndexVar="#{spaceType.spaceTypeID}">

                                                <h2><h:outputText styleClass="data-text" value="#{spaceType.spaceTypeTitle}" /></h2>
                                                <div class="datum">
                                                    <h:outputText styleClass="ui-label-inline" value="Type: " />
                                                    <h:outputText styleClass="data-text" value="#{spaceType.spaceTypeTitle}" />

                                                    <p:spacer height="5px" />

                                                    <h:outputText styleClass="ui-label-inline" value="Description: " />
                                                    <h:outputText styleClass="data-text" value="#{spaceType.spaceTypeDescription}" />
                                                </div>

                                                <div class="datum">
                                                    <h:outputText styleClass="ui-label-inline" value="Type ID:" />
                                                    <h:outputText styleClass="data-text" value="#{spaceType.spaceTypeID}" />
                                                </div>

                                                <div class="outlinedBox">

                                                    <h4>Spaces in this type</h4>

                                                    <p:dataScroller
                                                        id="scroller-template-spacetypelist-spacelist"
                                                        widgetVar="var-scroller-inspectiontemplate-spacetypelist-spacelist"
                                                        var="space"
                                                        value="#{spaceType.spaceList}"
                                                        rowIndexVar="#{space.spaceID}">

                                                        <div class="outlinedBox">


                                                            <div class="datum">
                                                                <h:outputText styleClass="ui-label-inline" value="Space name: " />
                                                                <h:outputText styleClass="data-text" value="#{space.name}" />

                                                                <p:spacer height="5px" />

                                                                <h:outputText styleClass="ui-label-inline" value="Description: " />
                                                                <h:outputText styleClass="data-text" value="#{space.description}" />
                                                            </div>

                                                            <div class="datum">
                                                                <h:outputText styleClass="ui-label-inline" value="Space ID:" />
                                                                <h:outputText styleClass="data-text" value="#{space.spaceID}" />
                                                            </div>
                                                            <p:dataScroller
                                                                id="scroller-template-spacetypelist-spacelist-elementlist"
                                                                widgetVar="var-scroller-inspectiontemplate-spacetypelist-spacelist-elementlist"
                                                                var="codeElement"
                                                                value="#{space.elementList}"
                                                                rowIndexVar="#{codeElement.elementID}">

                                                                <div class="outlinedBox">

                                                                    <h:outputLabel styleClass="bold" value="Ordindance: "  />
                                                                    <p:spacer height="5px" />
                                                                    <h:outputLabel value="#{codeElement.source.sourceName} 
                                                                                   (#{codeElement.source.sourceYear}), " />
                                                                    <h:outputText  value="Ch. #{codeElement.ordchapterNo}:" />
                                                                    <h:outputText  value="#{codeElement.ordchapterTitle}" />
                                                                    <p:spacer height="2px" />

                                                                    <h:outputText  value="&#167;#{codeElement.ordSecNum}:" />
                                                                    <h:outputText  value="#{codeElement.ordSecTitle}; " />
                                                                    <h:outputText  value="&#167;&#167;#{codeElement.ordSubSecNum} " />
                                                                    <h:outputText  value="#{codeElement.ordSubSecTitle}" />

                                                                    <p:spacer height="2px" />

                                                                    <h:panelGrid    id="violation-ord-fulltext-pg" columns="1" columnClasses="gridTD" 
                                                                                    rendered="true">
                                                                        <h:panelGroup>
                                                                            <h:outputLabel styleClass="bold" value="Full ordinance text: "/>
                                                                            <div class="ord-text">
                                                                                <h:outputText value="#{codeElement.ordTechnicalText}"/>
                                                                            </div>
                                                                        </h:panelGroup>

                                                                    </h:panelGrid>
                                                                </div>
                                                            </p:dataScroller>
                                                        </div>
                                                    </p:dataScroller>
                                                </div> 
                                            </p:dataScroller>
                                        </p:tab>
                                    </p:tabView>
                                </h:form>
                            </div>
                            <div id="inspection-inspectedelementscol" class="object-column">
                                <h2>Inspected items</h2>

                                <h:form id="form-inspection-messages-inspecteditems">

                                    <h:messages id="messages-inspection-inspecteditems" globalOnly="true" showDetail="true" showSummary="true"
                                                warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                    </h:messages>

                                    <p:dataScroller
                                        id="scroller-inspectedspacelist"
                                        widgetVar="var-scroller-inspectedspacelist"
                                        var="inspace"
                                        value="#{occInspectionBB.currentInspection.inspectedSpaceList}"
                                        rowIndexVar="#{inspace.spaceID}">

                                        <div class="outlinedBox">
                                            <h3>Location :<h:outputText styleClass="data-text" value="#{inspace.name}" /></h3>
                                            <p:dataScroller
                                                id="scroller-inspectedspacelist-elementlist"
                                                widgetVar="var-scroller-inspectedspacelist-elementlist"
                                                var="inelement"
                                                value="#{inspace.inspectedElementList}"
                                                rowIndexVar="#{inelement.inspectedElementID}">
                                                <div class="datum">
                                                    <h:outputText styleClass="ui-label-inline" value="Code element: " />
                                                    <h:outputText styleClass="data-text"   value="&#167;#{inelement.ordSecNum}:" />
                                                    <h:outputText  styleClass="data-text" value="#{inelement.ordSecTitle}; " />
                                                    <h:outputText  styleClass="data-text" value="&#167;&#167;#{inelement.ordSubSecNum} " />
                                                    <h:outputText  styleClass="data-text" value="#{inelement.ordSubSecTitle}" />

                                                    <p:spacer height="5px" />

                                                    <h:outputText styleClass="ui-label-inline" value="Last inspected by: " />
                                                    <h:outputText  styleClass="data-text" value="#{inelement.lastInspectedBy.person.firstName} #{inelement.lastInspectedBy.person.firstName}" />
                                                    <h:outputText styleClass="ui-label-inline" value=" on " />
                                                    <h:outputText  styleClass="data-text" value="#{occInspectionBB.getPrettyDate(inelement.lastInspectedTS)}" />
                                                </div>

                                                <div class="datum">

                                                    <h:outputText styleClass="ui-label-inline" value="Compliance granted by: " />
                                                    <h:outputText  styleClass="data-text" value="#{inelement.complianceGrantedBy.person.firstName} #{inelement.complianceGrantedBy.person.firstName}" />
                                                    <h:outputText styleClass="ui-label-inline" value=" on " />
                                                    <h:outputText  styleClass="data-text" value="#{occInspectionBB.getPrettyDate(inelement.complianceGrantedTS)}" />

                                                    <p:spacer height="5px" />

                                                    <h:outputText styleClass="ui-label-inline" value="Notes: " />
                                                    <h:outputText  styleClass="data-text" value="#{inelement.notes}" />
                                                </div>


                                            </p:dataScroller>
                                        </div>

                                    </p:dataScroller>

                                </h:form>

                            </div>
                        </div>
                    </div>
                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

