<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns="http://www.w3.org/1999/xhtml">
    
    <h:form id="inspections-growl-form">
        <p:growl id="inspection-growl" />
    </h:form>
    
    <p:panel id="inspections-panel"
             toggleable="true"
             widgetVar="inspections-panel-var"
             collapsed="false"
             header="Inspections">
        <h:form id="inspections-form">


            <!-- Should be "Start new inspection" -->

            <!--
            
            Dialog TODO 1: (or series)
            
            
            You'll need an intermediate box to provide a list of 
            OccChecklistTemplate objects that you'll get from 
            
            public List<OccChecklistTemplate> getOccChecklistTemplatelist() throws IntegrationException {
            
            Need a drop down of User objects to select "Inspector" (imagine a 
            secretary filling out the inspection for an officer" so it's not 
            the UserAuthorized from the BackingBean
            
            You'll get a list of User objects from
            
            this is on the UserCoordinator
            public List<User> user_assembleUserListForSearch(User usr) if you need one
            
            Your occ period is your current period
            
            WHen this dialog is done, you can make the call to 
            public OccInspection inspectionAction_commenceOccupancyInspection
            
            
            ** THEN build a new dialog with these displayed in UI:repeats
            Dialog todo 2:
            
            Two different lists:
            List 1 (possibly left side) Has a list of 
            OccSpaceTypeInspectionDirective
            objects that live in an 
            OccChecklistTemplate
            That lives inside the OccInspection
            
            
            BUTTON IN THE MIDDLE between these lists called
            "Inspect selected space type"
            
            That passes the chosen item from List 1 to 
            the method 
            public OccInspection inspectionAction_commenceSpaceInspection(
            
            On the OccupancyCoordinator
            WHICH WILL Give you back a properly configured
            OccInspectedSpace inside your OccInspection
            ANd now shows up in list 2
            

            List 2: List of OccInspectedSpace on the OccInspection
            you got from the previous call
            Clicking on items from this list gives you the lovely UI you already built
            
            
            
            
            

            Button called "configure property's spaces"
            that brings up the Space Details
            
            -->
            <p:commandButton id="inspections-newbutton"
                             value="New inspection"
                             disabled="#{!empty occPeriodSearchWorkflowBB.currentOccPeriod.authorizedTS}"
                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                             icon="fa fa-plus"
                             oncomplete="PF('inspections-selectchecklist-var').show()"
                             actionListener="#{occInspectionsBB.clearSelections}"
                             update="inspections-selectchecklist-form inspections-selectinspector-form"/>

            <p:spacer height="5px"/>

            <p:dataTable id="inspections-table"
                         var="inspection"
                         value="#{sessionBean.sessOccPeriod.inspectionList}"
                         rowKey="#{inspection.inspectionID}"
                         reflow="true">
                <p:column style="width:2rem">
                    <p:rowToggler/>
                </p:column>
                <p:column headerText="ID">
                    <h:outputText value="#{inspection.inspectionID}"/>
                </p:column>
                <p:column headerText="Inspector">
                    <h:outputText value="#{inspection.inspector.username}"/>
                    <h:panelGroup id="inspections-table-inspecterinfoicon">
                        <i class="p-ml-1 pi pi-info-circle"/>
                    </h:panelGroup>
                    <p:tooltip for="inspections-table-inspecterinfoicon"
                               value="#{inspection.inspector.human.firstName} #{inspection.inspector.human.lastName}" position="right"/>
                </p:column>
                <p:column headerText="Spaces">
                    <h:outputText value="#{inspection.inspectedSpaceListSize} space(s)"/>
                </p:column>
                <p:column headerText="Actions">
                    <p:commandLink ajax="true"
                                   style="color:blue;"
                                   actionListener="#{occInspectionsBB.onAddSpaceLinkClick(inspection)}"
                                   oncomplete="PF('inspections-selecttype-var').show()"
                                   rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                   update="inspections-selecttype-form"
                                   value="Add space"> |
                        <f:actionListener binding="#{occInspectionsBB.setSelectedInspection(inspection)}"/>
                    </p:commandLink>
                    <p:commandLink ajax="true"
                                   style="color:blue;"
                                   oncomplete="PF('inspections-inspectiondetails-var').show()"
                                   rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                   update="inspections-inspectiondetails-form"
                                   value="Details">
                        <f:actionListener binding="#{occInspectionsBB.setSelectedInspection(inspection)}"/>
                    </p:commandLink>
                </p:column>
                <p:rowExpansion>

                    <p:dataTable var="inspectedSpace"
                                 value="#{inspection.inspectedSpaceList}"
                                 rowKey="#{inspectedSpace.inspectedSpaceID}"
                                 reflow="true">
                        <p:column headerText="ID">
                            <h:outputText value="#{inspectedSpace.inspectedSpaceID}"/>
                        </p:column>
                        <p:column headerText="Type">
                            <h:outputText value="#{inspectedSpace.type.spaceTypeTitle}"/>
                            <h:panelGroup id="inspections-selectspace-dt-spacetypeinfoicon">
                                <i class="p-ml-1 pi pi-info-circle"/>
                            </h:panelGroup>
                            <p:tooltip for="inspections-selectspace-dt-spacetypeinfoicon"
                                       value="#{inspectedSpace.type.spaceTypeDescription}" position="right"/>
                        </p:column>
                        <p:column headerText="Actions">
                            <p:commandLink ajax="true"
                                           style="color:blue;"
                                           oncomplete="PF('inspections-entryscreen-var').show()"
                                           rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                           update="inspections-entryscreen-form"
                                           value="Edit">
                                <f:actionListener binding="#{occInspectionsBB.onViewInspectedSpaceLinkClick(inspectedSpace, inspection)}"/>
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                </p:rowExpansion>
            </p:dataTable>

        </h:form>
    </p:panel>

    <!-- Dialogs -->

    <!-- Inspection Creation Flow -->

    <!-- Checklist selection dialog used in inspection creation flow -->
        <p:dialog id="inspections-selectchecklist"
                  width="1000"
                  widgetVar="inspections-selectchecklist-var"
                  header="Choose Checklist"
                  modal="true"
                  resizable="true">
            <h:form id="inspections-selectchecklist-form">
                <p:dataTable id="inspections-selectchecklist-dt"
                             scrollHeight="600"
                             var="checklist" value="#{occInspectionsBB.checklistTemplateList}"
                             rowKey="#{checklist.inspectionChecklistID}"
                             selection="#{occInspectionsBB.selectedChecklistTemplate}"
                             stripedRows="true">
                    <p:ajax event="rowSelect"
                            update=":inspections-selectchecklist-form:inspections-selectchecklist-continuebutton"/>
                    <p:column selectionMode="single" style="width:16px;text-align:center"/>
                    <p:column headerText="Title">
                        <h:outputText value="#{checklist.title}"/>
                    </p:column>

                    <p:column headerText="Description">
                        <h:outputText value="#{checklist.description}"/>
                    </p:column>

                    <p:column headerText="Municipality">
                        <h:outputText value="#{checklist.muni.muniName}"/>
                    </p:column>

                    <p:column headerText="Code Source">
                        <h:outputText
                                value="#{checklist.governingCodeSource.sourceName} (#{checklist.governingCodeSource.sourceYear})"/>
                    </p:column>
                </p:dataTable>

                    <p:commandButton value="Cancel"
                                     icon="pi pi-times"
                                     class="ui-button-outlined p-mr-1"
                                     oncomplete="PF('inspections-selectchecklist-var').hide()"/>
                    <p:commandButton id="inspections-selectchecklist-continuebutton"
                                     value="Continue"
                                     disabled="#{occInspectionsBB.selectedChecklistTemplate.inspectionChecklistID == 0}"
                                     icon="pi pi-arrow-right"
                                     actionListener="#{occInspectionsBB.onChecklistSelectionCompleteButtonActuation}"
                                     update="@form:@parent:inspections-selectinspector-form"
                                     oncomplete="PF('inspections-selectchecklist-var').hide(); PF('inspections-selectinspector-var').show()"/>
            </h:form>
        </p:dialog>


    <!-- Inspector selection dialog used in inspection creation flow -->
        <p:dialog id="inspections-selectinspector"
                  width="600" height="800"
                  widgetVar="inspections-selectinspector-var"
                  header="Select Inspector"
                  modal="true"
                  closeOnEscape="true"
                  closable="true"
                  resizable="true">
            
            <h:form id="inspections-selectinspector-form">
                <h2>Current inspector</h2>

                <h:outputText value="#{occInspectionsBB.selectedInspector.human.name}" />
                
                 <p:spacer height="5px" />
                    <p:commandButton value="Back"
                                     icon="pi pi-arrow-left"
                                     class="ui-button-outlined p-mr-1"
                                     oncomplete="PF('inspections-selectinspector-var').hide(); PF('inspections-selectchecklist-var').show();"/>
                    <p:commandButton id="inspections-selectinspector-continuebutton"
                                     value="Create"
                                     disabled="#{occInspectionsBB.selectedInspector.userID == 0}"
                                     icon="pi pi-plus"
                                     actionListener="#{occInspectionsBB.createInspection}"
                                     update="inspections-form:inspections-table"
                                     oncomplete="PF('inspections-selectinspector-var').hide()"/>
                
                <h2>Change inspector</h2>
                <p:selectOneListbox id="inspections-selectinspector-listbox"
                                    scrollHeight="300"
                                    value="#{occInspectionsBB.selectedInspector}"
                                    var="u" filter="true" filterMatchMode="contains"
                                    converter="userConverter">
                    <p:ajax update="inspections-selectinspector-continuebutton"/>
                    <f:selectItems value="#{occInspectionsBB.userList}" var="user"
                                   itemLabel="#{user.human.name} (#{user.username})"
                                   itemValue="#{user}"/>
                </p:selectOneListbox>
               
            </h:form>
        </p:dialog>


    <!-- Space add flow -->
    <!-- (Currently a bit defunct) -->

    <!-- Type selection used in space add flow -->
        <p:dialog id="inspections-selecttype"
                  width="800"
                  closeOnEscape="true"
                  widgetVar="inspections-selecttype-var"
                  header="Select Space Type"
                  modal="true"
                  resizable="true">
            <h:form id="inspections-selecttype-form">

                <p:dataTable id="inspections-selecttype-dt"
                             scrollHeight="600"
                             var="ost" value="#{occInspectionsBB.selectedInspection.checklistTemplate.occSpaceTypeList}"
                             rowKey="#{ost.checklistSpaceTypeID}"
                             selection="#{occInspectionsBB.selectedSpaceType}"
                             stripedRows="true"
                             rowExpandMode="multiple">
                    <p:ajax event="rowSelect"
                            update=":inspections-selecttype-form:inspections-selecttype-continuebutton"/>
                    <p:column selectionMode="single" style="width:16px;text-align:center"/>
                    <p:column style="width:2rem">
                        <p:rowToggler/>
                    </p:column>
                    <p:column headerText="CSTID">
                        <h:outputText value="#{ost.checklistSpaceTypeID}"/>
                    </p:column>
                    <p:column headerText="Type ID">
                        <h:outputText value="#{ost.spaceTypeID}"/>
                    </p:column>
                    <p:column headerText="Chklst ID">
                        <h:outputText value="#{ost.checklistParentID}"/>
                    </p:column>
                    <p:column headerText="Name">
                        <h:outputText value="#{ost.spaceTypeTitle}"/>
                    </p:column>
                    <p:column headerText="Description">
                        <h:outputText value="#{ost.spaceTypeDescription}"/>
                    </p:column>
                    <p:column headerText="Required">
                        <i class="#{ost.required ? 'pi pi-star' : ''}"/>
                    </p:column>
                    <p:rowExpansion>
                        <p:dataTable id="ordbytype-table"
                                     var="ord"
                                     value="#{ost.codeElementList}"
                                     rowKey="#{ord.elementID}"
                                     stripedRows="true">

                            <p:column headerText="EleID">
                                <h:outputText value="#{ord.elementID}"/>
                            </p:column>
                            <p:column headerText="subsec">
                                <h:outputText value="#{ord.ordSubSecTitle}"/>
                            </p:column>

                        </p:dataTable>

                    </p:rowExpansion>


                </p:dataTable>
                <p:spacer height="3px" />

                    <p:commandButton value="Cancel"
                                     icon="pi pi-times"
                                     class="ui-button-outlined p-mr-1"
                                     oncomplete="PF('inspections-selecttype-var').hide()"/>
                    <p:commandButton id="inspections-selecttype-continuebutton"
                                     value="Continue"
                                     disabled="!{occInspectionsBB.selectedType.spaceTypeID == 0}"
                                     icon="pi pi-arrow-right"
                                     update="inspections-selectspace-form"
                                     oncomplete="PF('inspections-selecttype-var').hide(); PF('inspections-selectspace-var').show()"/>
            </h:form>
        </p:dialog>

    <!-- Actual space(?) selection used in space add flow -->
        <p:dialog id="inspections-selectspace"
                  width="800"
                  widgetVar="inspections-selectspace-var"
                  header="Identify location"
                  modal="true"
                  resizable="true">
            <h:form id="inspections-selectspace-form">
                <p:spacer height="5px"/>
                    <div class="p-col-12 p-md-6">
                        <p:commandButton value="New location descriptor"
                                         actionListener="#{occInspectionsBB.initSkeletonLocDescriptor}"
                                         update="inspections-addlocdesc-form"
                                         oncomplete="PF('inspections-addlocdesc-var').show()"
                                         icon="pi pi-plus"/>
                    </div>
                <p:outputLabel styleClass="p-d-block">OR Choose a Location descriptor:</p:outputLabel>
                <div class="p-grid">
                    <div class="p-col-12 p-md-6">
                        <p:selectOneMenu value="#{occInspectionsBB.selectedLocDescriptor}"
                                         converter="occLocationDescriptorConverter"
                                         var="ld" filter="true" filterMatchMode="contains">
                            <p:ajax update="inspections-selectspace-continuebutton
                                            @form"/>
                            <f:selectItems value="#{occInspectionsBB.selectedInspection.allUniqueLocationDescriptors}" var="locdep"
                                           itemLabel="#{locdep.locationDescription}" itemValue="#{locdep}"/>
                            <p:column>
                                <h:outputText value="#{ld.locationDescription}"/>
                            </p:column>
                        </p:selectOneMenu>
                    </div>

                </div>
                
                <h3>Selected location</h3>
                
                <h:outputText value="#{occInspectionsBB.selectedLocDescriptor.locationDescription}"/>
                <p:spacer height="3px" />
                <h:outputText value="Floor: #{occInspectionsBB.selectedLocDescriptor.buildingFloorNo}"/>
                <p:spacer height="3px" />
                <h:outputText value="#{occInspectionsBB.selectedLocDescriptor.locationID}"/>
                <p:spacer height="5px" />
                    <p:commandButton value="Back"
                                     icon="pi pi-arrow-left"
                                     class="ui-button-outlined p-mr-1"
                                     oncomplete="PF('inspections-selectspace-var').hide(); PF('inspections-selecttype-var').show()"/>

                    <p:commandButton id="inspections-selectspace-continuebutton"
                                     value="Add to inspection"
                                     icon="pi pi-plus"
                                     actionListener="#{occInspectionsBB.addSelectedSpaceToSelectedInspection}"
                                     update="inspections-form:inspections-table
                                            inspections-growl-form"
                                     oncomplete="PF('inspections-selectspace-var').hide()"/>
            </h:form>
        </p:dialog>

    <!-- Independent dialogs that are not necessarily used in a flow -->

    <!-- Dialog to view details of an OccInspection -->
        <p:dialog id="inspections-inspectiondetails"
                  width="800"
                  height="600"
                  widgetVar="inspections-inspectiondetails-var"
                  header="Inspection Details"
                  modal="true"
                  resizable="true">
            <h:form id="inspections-inspectiondetails-form">
                <p:commandButton id="inspections-inspectiondetails-editbutton"
                                 value="#{occInspectionsBB.editMode ? 'Done' : 'Edit'}"
                                 disabled="#{!empty occInspectionsBB.selectedInspection.deactivatedBy}"
                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                 icon="fa #{occInspectionsBB.editMode ? 'fa-check' : 'fa-pencil'}"
                                 actionListener="#{occInspectionsBB.toggleEditMode}"
                                 oncomplete="PF('inspections-inspectiondetails-var').show()"
                                 update="inspections-inspectiondetails-form"/>

                <p:spacer height="5px"/>

                <p:panel id="inspections-inspectiondetails-generalpanel"
                         toggleable="true"
                         collapsed="false"
                         header="General">

                    <div class="p-grid">
                        <div class="p-col-6">ID</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.inspectionID}</div>
                        <div class="p-col-6">Follow up to inspection ID</div>
                        <div class="p-col-6">
                            <h:outputText rendered="#{!occInspectionsBB.editMode}" value="#{occInspectionsBB.selectedInspection.followUpToInspectionID}"/>
                            <p:inputText rendered="#{occInspectionsBB.editMode}"  value="#{occInspectionsBB.selectedInspection.followUpToInspectionID}"/>
                        </div>
                        <div class="p-col-6">Inspector</div>
                        <div class="p-col-6">
                            <h:outputText rendered="#{!occInspectionsBB.editMode}" value="#{occInspectionsBB.selectedInspection.inspector.human.firstName}
                            #{occInspectionsBB.selectedInspection.inspector.human.lastName}
                            (#{occInspectionsBB.selectedInspection.inspector.username})"/>
                            <p:selectOneMenu rendered="#{occInspectionsBB.editMode}"
                                             value="#{occInspectionsBB.selectedInspection.inspector}"
                                             filter="true"
                                             filterMatchMode="contains"
                                             converter="userConverter">
                                <f:selectItems value="#{occInspectionsBB.userList}" var="user"
                                               itemLabel="#{user.human.firstName} #{user.human.lastName} #{user.username}"
                                               itemValue="#{user}"/>
                            </p:selectOneMenu>
                        </div>
                        <p:divider/>
                        <div class="p-col-6">Created by</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.createdBy.human.firstName}
                            #{occInspectionsBB.selectedInspection.createdBy.human.lastName}
                            (#{occInspectionsBB.selectedInspection.createdBy.username}) at
                            #{occInspectionsBB.getPrettyDate(occInspectionsBB.selectedInspection.creationTS)}</div>
                        <div class="p-col-6">Last updated by</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.lastUpdatedBy.human.firstName}
                            #{occInspectionsBB.selectedInspection.lastUpdatedBy.human.lastName}
                            (#{occInspectionsBB.selectedInspection.lastUpdatedBy.username}) at
                            #{occInspectionsBB.getPrettyDate(occInspectionsBB.selectedInspection.lastUpdatedTS)}</div>
                        <div class="p-col-6">Deactivated by</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.deactivatedBy.human.firstName}
                            #{occInspectionsBB.selectedInspection.deactivatedBy.human.lastName}
                            (#{occInspectionsBB.selectedInspection.deactivatedBy.username}) at
                            #{occInspectionsBB.getPrettyDate(occInspectionsBB.selectedInspection.deactivatedTS)}</div>
                    </div>
                </p:panel>

                <p:panel id="inspections-inspectiondetails-inspectionpanel"
                         toggleable="true"
                         collapsed="false"
                         header="Inspection">
                    <div class="p-grid">
                        <div class="p-col-6">Start time</div>
                        <div class="p-col-6">
                            <h:outputText rendered="#{!occInspectionsBB.editMode}" value="#{occInspectionsBB.getPrettyDate(occInspectionsBB.selectedInspection.timeStart)}"/>
                            <p:calendar rendered="#{occInspectionsBB.editMode}" value="#{occInspectionsBB.selectedInspection.timeStart}" pattern="MM/dd/yyyy HH:mm" mask="true"/>
                        </div>
                        <div class="p-col-6">End time</div>
                        <div class="p-col-6">
                            <h:outputText rendered="#{!occInspectionsBB.editMode}" value="#{occInspectionsBB.getPrettyDate(occInspectionsBB.selectedInspection.timeEnd)}"/>
                            <p:calendar rendered="#{occInspectionsBB.editMode}" value="#{occInspectionsBB.selectedInspection.timeEnd}" pattern="MM/dd/yyyy HH:mm" mask="true"/>
                        </div>
                        <p:divider/>
                        <div class="p-col-6">Max occupants allowed</div>
                        <div class="p-col-6">
                            <h:outputText rendered="#{!occInspectionsBB.editMode}" value="#{occInspectionsBB.selectedInspection.maxOccupantsAllowed}"/>
                            <p:inputText rendered="#{occInspectionsBB.editMode}"  value="#{occInspectionsBB.selectedInspection.maxOccupantsAllowed}"/>
                        </div>
                        <div class="p-col-6">Number of bedrooms</div>
                        <div class="p-col-6">
                            <h:outputText rendered="#{!occInspectionsBB.editMode}" value="#{occInspectionsBB.selectedInspection.numBedrooms}"/>
                            <p:inputText rendered="#{occInspectionsBB.editMode}"  value="#{occInspectionsBB.selectedInspection.numBedrooms}"/>
                        </div>
                        <div class="p-col-6">Number of bathrooms</div>
                        <div class="p-col-6">
                            <h:outputText rendered="#{!occInspectionsBB.editMode}" value="#{occInspectionsBB.selectedInspection.numBathrooms}"/>
                            <p:inputText rendered="#{occInspectionsBB.editMode}"  value="#{occInspectionsBB.selectedInspection.numBathrooms}"/>
                        </div>
                        <p:divider/>
                        <div class="p-col-6">Third party inspector</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.thirdPartyInspector.name}
                            #{occInspectionsBB.selectedInspection.thirdPartyInspector.name}
                            (#{occInspectionsBB.selectedInspection.thirdPartyInspector.name})</div>
                        <div class="p-col-6">Third party inspector approval</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.thirdPartyApprovalBy.human.firstName}
                            #{occInspectionsBB.selectedInspection.thirdPartyApprovalBy.human.lastName}
                            (#{occInspectionsBB.selectedInspection.thirdPartyApprovalBy.username}) at
                            #{occInspectionsBB.getPrettyDate(occInspectionsBB.selectedInspection.thirdPartyInspectorApprovalTS)}</div>
                    </div>
                </p:panel>
                <p:panel id="inspections-inspectiondetails-causepanel"
                         toggleable="true"
                         collapsed="false"
                         header="Cause">
                    <div class="p-grid">
                        <div class="p-col-6">Cause ID</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.cause.causeID}</div>
                        <div class="p-col-6">Title</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.cause.title}</div>
                        <div class="p-col-6">Description</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.cause.description}</div>
                        <div class="p-col-6">Notes</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.cause.notes}</div>
                        <div class="p-col-6">Active</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.cause.active ? "Yes" : "No"}</div>
                    </div>
                </p:panel>

                <p:panel id="inspections-inspectiondetails-determinationpanel"
                         toggleable="true"
                         collapsed="false"
                         header="Determination">
                    <div class="p-grid">
                        <div class="p-col-6">Determination ID</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.determination.determinationID}</div>
                        <div class="p-col-6">Title</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.determination.title}</div>
                        <div class="p-col-6">Description</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.determination.description}</div>
                        <div class="p-col-6">Notes</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.determination.notes}</div>
                        <div class="p-col-6">Event Category</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.determination.eventCategory.eventCategoryTitle}<br/>
                                             #{occInspectionsBB.selectedInspection.determination.eventCategory.eventCategoryDesc}</div>
                        <div class="p-col-6">Active</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.determination.active ? "Yes" : "No"}</div>
                    </div>
                </p:panel>
                <p:panel id="inspections-inspectiondetails-notespanel"
                         toggleable="true"
                         collapsed="false"
                         header="Notes">
                    <div class="p-grid">
                        <div class="p-col-6">Pre-inspection notes</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.notesPreInspection}</div>
                        <div class="p-col-6">Remarks</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.remarks}</div>
                        <div class="p-col-6">General Comments</div>
                        <div class="p-col-6">#{occInspectionsBB.selectedInspection.generalComments}</div>
                    </div>
                </p:panel>
                <f:facet name="footer">
                    <p:commandButton value="Cancel"
                                     icon="pi pi-times"
                                     oncomplete="PF('inspections-inspectiondetails-var').hide()"/>
                    <p:commandButton id="inspections-inspectiondetails-savebutton"
                                     value="Save"
                                     icon="pi pi-save"
                                     oncomplete="PF('inspections-inspectiondetails-var').hide()"/>
                </f:facet>
            </h:form>
        </p:dialog>

    <!-- Currently not working and not realized dialog for editing of an OccInspectedSpace's basic info -->
        <p:dialog id="inspections-editspace"
                  widgetVar="inspections-editspace-var"
                  header="Edit Space"
                  modal="true"
                  closable="false"
                  resizable="true">
            <h:form id="inspections-editspace-form">
                <p:outputLabel styleClass="p-d-block">Space name:</p:outputLabel>
    <!--            <p:inputText styleClass="p-d-block" value="!{occInspectionsBB.selectedSpace.name}"/>-->

                <p:outputLabel styleClass="p-d-block">Space description:</p:outputLabel>
    <!--            <p:inputTextarea rows="6" cols="33" value="!{occInspectionsBB.selectedSpace.description}"/>-->

                <!--                                 update="inspections-selectspace-form:inspections-selectspace-dt
                                             inspections-selectspace-form:inspections-selectspace-continuebutton" -->
                <f:facet name="footer">
                    <p:commandButton id="inspections-editspace-continuebutton"
                                     value="Ok"
                                     icon="pi pi-check"
                                     oncomplete="PF('inspections-editspace-var').hide()"/>
                </f:facet>
            </h:form>
        </p:dialog>

    <!-- Dialog used for adding new location descriptors. Yep, it's pretty defunct. -->
        <p:dialog id="inspections-addlocdesc"
                  widgetVar="inspections-addlocdesc-var"
                  header="Add Location Descriptor"
                  modal="true"
                  closable="true"
                  closeOnEscape="true"
                  resizable="true">
            <h:form id="inspections-addlocdesc-form">

                <p:outputLabel for="inspections-locdesc-input" styleClass="p-d-block">Location description:</p:outputLabel>
                <p:inputTextarea id="inspections-locdesc-input"
                        rows="6" cols="33" value="#{occInspectionsBB.skeletonLocationDescriptor.locationDescription}">
                    <p:ajax update="inspections-addlocdesc-continuebutton"/>
                </p:inputTextarea>

                <p:outputLabel for="inspections-floornumber-input" styleClass="p-d-block">Building floor number:</p:outputLabel>
                <p:inputNumber id="inspections-floornumber-input"
                               value="#{occInspectionsBB.skeletonLocationDescriptor.buildingFloorNo}"/>

                <p:spacer height="3px" />
                    <p:commandButton value="Cancel"
                                     icon="pi pi-times"
                                     oncomplete="PF('inspections-addlocdesc-var').hide()"/>
                    <p:commandButton id="inspections-addlocdesc-continuebutton"
                                     value="Add"
                                     disabled="#{empty occInspectionsBB.skeletonLocationDescriptor.locationDescription}"
                                     icon="pi pi-plus"
                                     update="@form:@parent:inspections-selectspace-form"
                                     actionListener="#{occInspectionsBB.createLocDescriptor}"
                                     oncomplete="PF('inspections-addlocdesc-var').hide()"/>
            </h:form>
        </p:dialog>

    <!-- Barely realized form that should show stats for one OccInspectedSpace(?) and all of its ordinances -->
    
        <p:dialog id="inspections-entryscreen"
                  height="600" width="1000"
                  widgetVar="inspections-entryscreen-var"
                  header="Inspect ordiances in #{occInspectionsBB.selectedInspectedSpace.type.spaceTypeTitle} (ID: #{occInspectionsBB.selectedInspectedSpace.inspectedSpaceID})"
                  modal="true"
                  resizable="true">
                
                <div class="p-d-flex p-jc-between">

                        <div>
                            <h:form id="inspections-entryscreen-controls-form">
                                <p:selectOneMenu    id="inspections-entryscreen-statussel" 
                                                    value="#{occInspectionsBB.selectedElementStatusForBatch}" 
                                                    >
                                                <!-- Strangely this element needs to update itself to call the setter -->
                                                <f:selectItem noSelectionOption="true"
                                                              itemDisabled="true"
                                                              itemLabel="choose a batch status" />
                                                <f:selectItems value="#{occInspectionsBB.statuses}" 
                                                               var="status" 
                                                               itemLabel="#{status.label}"/>
                                </p:selectOneMenu>
                                
                                <p:commandLink     id="applybatch-cl"
                                                    ajax="true"
                                                    style="color:blue;"
                                                    update="@form:@parent:inspections-entryscreen-form:element-accordion
                                                            @form:@parent:inspections-growl-form"
                                                    value="Batch apply to all ords"
                                                    actionListener="#{occInspectionsBB.onBatchProcessElementLinkClick}" />
                            </h:form>
                        </div>
                        <div>
                            <h:form id="stinspection-tools-form">
                                
                                <p:selectBooleanCheckbox id="stinspection-usedefaultfindings-cb"
                                                         value="#{occInspectionsBB.useDefaultFindingsOnCurrentOISE}"
                                                         label="use default findings"
                                                         title="when an element fails, populate findings with default findings on the ordinance"/>
                                
                                <h:outputText value=" | " />
                                
                                <p:commandLink     id="stinspection-editspace"
                                                    ajax="true"
                                                    style="color:blue;"
                                                    update=""
                                                    value="edit space"
                                                    actionListener="#{occInspectionsBB.onSpaceTypeEditLinkClick}" />
                                
                                <h:outputText value=" | " />
                                
                                <p:commandLink     id="stinspection-removespace"
                                                    ajax="true"
                                                    style="color:blue;"
                                                    update=""
                                                    value="remove space from inspection"
                                                    actionListener="#{occInspectionsBB.onSpaceTypeRemoveLinkClick}" >
                                      <p:confirm header="Confirmation" message="Do you want to delete this inspected space?" icon="pi pi-info-circle"/>
                                </p:commandLink>
                           
                            </h:form>
                            
                            
                        </div>
                    </div>
              
                <p:separator />
                
            <h:form id="inspections-entryscreen-form">
                
                  <p:commandButton id="inspections-newbutton"
                             value="Save space data and close"
                             disabled="false"
                             rendered="true"
                             icon="fa fa-save"
                             actionListener="#{occInspectionsBB.onSavCurrentSpaceChanges}"
                             oncomplete="PF('inspections-entryscreen-var').hide()"
                             update="@form:@parent:inspections-form
                                    @form:@parent:inspections-growl-form"/>

                  <p:spacer height="5px" />
                <p:accordionPanel id="element-accordion"
                                  value="#{occInspectionsBB.selectedInspectedSpace.inspectedElementGroupList}" 
                                    var="elegrp"
                                    >
                    <p:ajax/>
                    <p:tab title="#{elegrp.groupTitle}">
                        <p:repeat   value="#{elegrp.elementList}" 
                                    var="spaceElement">
                            <div class="p-grid">
                                <div class="p-col-12 p-md-4">
                                    <h2>
                                        <h:outputText value="ch. #{spaceElement.ordchapterNo}: #{spaceElement.ordchapterTitle}" />
                                    </h2>
                                    <h3>
                                        <h:outputText value="§#{spaceElement.ordSecNum}:#{spaceElement.ordSecTitle}" />
                                    </h3>
                                    <h3>
                                        <h:outputText value="§§#{spaceElement.ordSubSecNum} #{spaceElement.ordSubSecTitle}" 
                                                      rendered="#{!empty spaceElement.ordSubSecNum}"/>
                                    
                                        <h:outputText value=" | " />

                                        <h:outputText value="§§#{spaceElement.ordSubSubSecNum} #{spaceElement.ordSubSubSecTitle}" 
                                                      rendered="#{!empty spaceElement.ordSubSubSecNum}"/>
                                    </h3> 
                                    <p:spacer height="5px" />
                                    <p>
                                        <h:outputText id="oiseinfo"
                                                      value="OISEleID: #{spaceElement.inspectedSpaceElementID} | OCSTEleID #{spaceElement.occChecklistSpaceTypeElementID}" />
                                    </p>
                                    
                                    
                                <p:commandLink     id="spaceelement-vieword-cl"
                                                    ajax="true"
                                                    type="button"
                                                    style="color:blue;"
                                                    actionListener="#{occInspectionsBB.onSpaceElementViewLinkClick(spaceElement)}"
                                                    update="codeelement-fulltext-dialog"
                                                    oncomplete="PF('codeelement-fulltext-dialog-var').show();"
                                                    value="ordinance text"/>
                                
                                <h:outputText value=" | " />
                                    
                                <p:commandLink     id="spaceelement-viewmeta"
                                                    ajax="true"
                                                    type="button"
                                                    style="color:blue;"
                                                    actionListener="#{occInspectionsBB.onSpaceElementViewLinkClick(spaceElement)}"
                                                    update="codeelement-metadata-dialog"
                                                    oncomplete="PF('codeelement-metadata-dialog-var').show();"
                                                    value="element info"/>
                                
                                
                                
                                </div>
                                <div class="p-col-12 p-md-4 p-mt-5">
                                    <p:selectOneButton id="inspections-entryscreen-statussel" 
                                                       value="#{spaceElement.statusEnum}" 
                                                       unselectable="false">
                                        <!-- Strangely this element needs to update itself to call the setter -->
                                        <p:ajax listener="#{occInspectionsBB.onElementInspectionStatusButtonChange(spaceElement)}" />
                                        <p:ajax update="inspections-entryscreen-statussel"/>
                                        <!--<p:ajax update="@form:element-accordion"/>-->
                                        <p:ajax update="@form:@parent:inspections-growl-form"/>
                                        <p:ajax update="@form"/>
                                        <f:selectItems value="#{occInspectionsBB.statuses}" 
                                                       var="status" 
                                                       itemLabel="#{status.label}"/>
                                    </p:selectOneButton>
                                    <div class="p-d-flex p-mt-2 p-jc-end">
                                        <p:selectBooleanCheckbox    id="insp-ele-excludefromnov-cb"
                                                                    itemLabel="Include fail in Code Enf Case"
                                                                    rendered="#{(!empty spaceElement.lastInspectedTS) and (empty spaceElement.complianceGrantedTS)}"
                                                                    value="#{spaceElement.migrateToCaseOnFail}"/>
                                        <p:spacer height="5px" />
                                        
                                        <p>
                                            <h:outputText id="inspectedby-user"
                                                          value="Inspected by: #{spaceElement.lastInspectedBy.human.name}" 
                                                          rendered="#{!empty spaceElement.lastInspectedBy}"/>
                                            <p:spacer height="2px" />
                                            <h:outputText id="inspectedby-ts"
                                                          value="on #{occInspectionsBB.getPrettyDate(spaceElement.lastInspectedTS)}" 
                                                          rendered="#{!empty spaceElement.lastInspectedTS}"/>
                                            <p:spacer height="2px" />
                                            <h:outputText id="inspectedby-failed"
                                                          value="Failed! (no compliance)" 
                                                          rendered="#{!empty spaceElement.lastInspectedTS and empty spaceElement.complianceGrantedTS}"/>
                                            <p:spacer height="2px" />
                                            <h:outputText id="inspectedby-comp-user"
                                                          value="Compliance granted by: #{spaceElement.complianceGrantedBy.human.name}" 
                                                          rendered="#{!empty spaceElement.complianceGrantedBy}"/>
                                            <p:spacer height="2px" />
                                            <h:outputText id="inspectedby-comp-ts"
                                                          value="on #{occInspectionsBB.getPrettyDate(spaceElement.complianceGrantedTS)}" 
                                                          rendered="#{!empty spaceElement.complianceGrantedTS}"/>
                                            
                                        </p>
                                    </div>
                                </div>
                                <div class="p-col-12 p-md-4">
                                    <div class="p-d-flex">
                                        <div>
                                            <p class="p-mb-0">Findings:</p>
                                            <p:inputTextarea    id="element-findings"
                                                                value="#{spaceElement.inspectionNotes}"
                                                                rows="6" cols="33"/>
                                            
                                        </div>
                                        <div class="p-mx-3 p-mt-5">
                                            <p:button icon="pi pi-plus" 
                                                      styleClass="rounded-button"/>
                                            <p>Add Photo</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </p:repeat>
                    </p:tab>
                </p:accordionPanel>

                <p:separator />
                
                <p:commandButton value="Add Ordinance" icon="pi pi-plus"/>
                
            </h:form>
        </p:dialog>
    
    <p:dialog id="codeelement-fulltext-dialog"
              widgetVar="codeelement-fulltext-dialog-var"
              header="Full ordinance text"
              closable="true"
              closeOnEscape="true"
              modal="true"
              height="400"
              width="500"
              resizable="true"
              responsive="true">
        
        <h:form id="codeelement-fulltext-form">

            <h2>
                <h:outputText value="ch. #{occInspectionsBB.selectedSpaceElement.ordchapterNo}: #{occInspectionsBB.selectedSpaceElement.ordchapterTitle}" />
            </h2>
            <h3>
                <h:outputText value="§#{occInspectionsBB.selectedSpaceElement.ordSecNum}:#{occInspectionsBB.selectedSpaceElement.ordSecTitle}" />
            </h3>
            <h3>
                <h:outputText value="§§#{occInspectionsBB.selectedSpaceElement.ordSubSecNum} #{occInspectionsBB.selectedSpaceElement.ordSubSecTitle}" 
                              rendered="#{!empty occInspectionsBB.selectedSpaceElement.ordSubSecNum}"/>

                <h:outputText value=" | " />
                <h:outputText value="§§#{occInspectionsBB.selectedSpaceElement.ordSubSubSecNum} #{occInspectionsBB.selectedSpaceElement.ordSubSubSecNum}" 
                              rendered="#{!empty occInspectionsBB.selectedSpaceElement.ordSubSubSecNum}"/>
            </h3> 


            <h:outputText id="codeelement-fulltext-ot"
                          value="#{occInspectionsBB.selectedSpaceElement.ordTechnicalText}" 
                          escape="false"/>

            <h3>Inspection tips</h3>
            <h:outputText id="codeelement-inspectiontips-ot"
                          value="#{occInspectionsBB.selectedSpaceElement.guideEntry.inspectionGuidelines}" 
                          escape="false"/>

        </h:form>
        
        
        
        
    </p:dialog>
    
     <p:dialog id="codeelement-metadata-dialog"
               header="Occ Inspected Space Element Metadata"
              widgetVar="codeelement-metadata-dialog-var"
              closable="true"
              closeOnEscape="true"
              modal="true"
              height="400"
              width="500"
              resizable="true"
              responsive="true">
         
           <h2>
                <h:outputText value="ch. #{occInspectionsBB.selectedSpaceElement.ordchapterNo}: #{occInspectionsBB.selectedSpaceElement.ordchapterTitle}" />
            </h2>
            <h3>
                <h:outputText value="§#{occInspectionsBB.selectedSpaceElement.ordSecNum}:#{occInspectionsBB.selectedSpaceElement.ordSecTitle}" />
            </h3>
            <h3>
                <h:outputText value="§§#{occInspectionsBB.selectedSpaceElement.ordSubSecNum} #{occInspectionsBB.selectedSpaceElement.ordSubSecTitle}" 
                              rendered="#{!empty occInspectionsBB.selectedSpaceElement.ordSubSecNum}"/>

                <h:outputText value=" | " />
                <h:outputText value="§§#{occInspectionsBB.selectedSpaceElement.ordSubSubSecNum} #{occInspectionsBB.selectedSpaceElement.ordSubSubSecNum}" 
                              rendered="#{!empty occInspectionsBB.selectedSpaceElement.ordSubSubSecNum}"/>
            </h3> 

         
         <h:outputText value="Inspected space element ID: #{occInspectionsBB.selectedSpaceElement.inspectedSpaceElementID}" />
         <p:spacer height="3px" />
         
         <h:outputText value="Inspected space ID: #{occInspectionsBB.selectedSpaceElement.inspectedSpaceID}" />
         <p:spacer height="3px" />
         
         <h:outputText value="occChecklist Space Type Element ID: #{occInspectionsBB.selectedSpaceElement.occChecklistSpaceTypeElementID}" />
         <p:spacer height="3px" />
        
         <h:outputText value="Code set element ID: #{occInspectionsBB.selectedSpaceElement.codeSetElementID}" />
         <p:spacer height="3px" />
         
         <h:outputText value="Code Element ID: #{occInspectionsBB.selectedSpaceElement.elementID}" />
         <p:spacer height="3px" />
         
         
         
     </p:dialog>
    
</ui:composition>