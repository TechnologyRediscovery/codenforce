<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns="http://www.w3.org/1999/xhtml">
    <p:panel id="inspections-panel"
             toggleable="true"
             widgetVar="inspections-panel-var"
             collapsed="false"
             header="Inspections">
        <h:form id="inspections-form">


            <!-- Should be "Start new inspection" -->

            <!--
            
            Dialog TODO 1: (or series)
            
            
            You'll need an intermediate box to provide a list of 
            OccChecklistTemplate objects that you'll get from 
            
            public List<OccChecklistTemplate> getOccChecklistTemplatelist() throws IntegrationException {
            
            Need a drop down of User objects to select "Inspector" (imagine a 
            secretary filling out the inspection for an officer" so it's not 
            the UserAuthorized from the BackingBean
            
            You'll get a list of User objects from
            
            this is on the UserCoordinator
            public List<User> user_assembleUserListForSearch(User usr) if you need one
            
            Your occ period is your current period
            
            WHen this dialog is done, you can make the call to 
            public OccInspection inspectionAction_commenceOccupancyInspection
            
            
            ** THEN build a new dialog with these displayed in UI:repeats
            Dialog todo 2:
            
            Two different lists:
            List 1 (possibly left side) Has a list of 
            OccSpaceTypeInspectionDirective
            objects that live in an 
            OccChecklistTemplate
            That lives inside the OccInspection
            
            
            BUTTON IN THE MIDDLE between these lists called
            "Inspect selected space type"
            
            That passes the chosen item from List 1 to 
            the method 
            public OccInspection inspectionAction_commenceSpaceInspection(
            
            On the OccupancyCoordinator
            WHICH WILL Give you back a properly configured
            OccInspectedSpace inside your OccInspection
            ANd now shows up in list 2
            

            List 2: List of OccInspectedSpace on the OccInspection
            you got from the previous call
            Clicking on items from this list gives you the lovely UI you already built
            
            
            
            
            

            Button called "configure property's spaces"
            that brings up the Space Details
            
            -->
            <p:commandButton id="inspections-newbutton"
                             value="New inspection"
                             disabled="#{!empty occPeriodSearchWorkflowBB.currentOccPeriod.authorizedTS}"
                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                             icon="fa fa-plus"
                             oncomplete="PF('inspections-selectchecklist-var').show()"
                             actionListener="#{occInspectionsBB.clearSelections}"
                             update="inspections-selectchecklist-form inspections-selectinspector-form"/>

            <p:spacer height="5px"/>

            <p:dataTable id="inspections-table"
                         var="inspection"
                         value="#{sessionBean.sessOccPeriod.inspectionList}"
                         rowKey="#{inspection.inspectionID}"
                         reflow="true">
                <p:column style="width:2rem">
                    <p:rowToggler/>
                </p:column>
                <p:column headerText="ID">
                    <h:outputText value="#{inspection.inspectionID}"/>
                </p:column>
                <p:column headerText="Spaces">
                    <h:outputText value="#{inspection.inspectedSpaceListSize} spaces"/>
                </p:column>
                <p:column headerText="Action">
                    <p:commandLink ajax="true"
                                   style="color:blue;"
                                   actionListener="#{occInspectionsBB.clearSelections}"
                                   oncomplete="PF('inspections-selecttype-var').show()"
                                   rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                   update="inspections-selecttype-form"
                                   value="Add space">
                        <f:actionListener binding="#{occInspectionsBB.setSelectedInspection(inspection)}"/>
                    </p:commandLink>
                </p:column>
                <p:rowExpansion>
                    <p:dataTable var="inspectedSpace"
                                 value="#{inspection.inspectedSpaceList}"
                                 rowKey="#{inspectedSpace.inspectedSpaceID}"
                                 reflow="true">
                        <p:column headerText="ID">
                            <h:outputText value="#{inspectedSpace.inspectedSpaceID}"/>
                        </p:column>
                        <p:column headerText="Type">
                            <h:outputText value="#{inspectedSpace.type.spaceTypeTitle}"/>
                            <h:panelGroup id="inspections-selectspace-dt-spacetypeinfoicon">
                                <i class="p-ml-1 pi pi-info-circle"/>
                            </h:panelGroup>
                            <p:tooltip for="inspections-selectspace-dt-spacetypeinfoicon"
                                       value="#{inspectedSpace.type.spaceTypeDescription}" position="right"/>
                        </p:column>
                        <p:column headerText="Name">
                            <h:outputText value="#{inspectedSpace.name}"/>
                        </p:column>
                    </p:dataTable>
                </p:rowExpansion>
            </p:dataTable>

        </h:form>
    </p:panel>

    <h:form id="inspections-selectchecklist-form">
        <p:dialog id="inspections-selectchecklist"
                  width="1000"
                  widgetVar="inspections-selectchecklist-var"
                  header="Choose Checklist"
                  modal="true"
                  resizable="true">
            <p:dataTable id="inspections-selectchecklist-dt"
                         scrollHeight="600"
                         var="checklist" value="#{occInspectionsBB.checklistTemplateList}"
                         rowKey="#{checklist.inspectionChecklistID}"
                         selection="#{occInspectionsBB.selectedChecklistTemplate}"
                         stripedRows="true">
                <p:ajax event="rowSelect"
                        update=":inspections-selectchecklist-form:inspections-selectchecklist-continuebutton"/>
                <p:column selectionMode="single" style="width:16px;text-align:center"/>
                <p:column headerText="Title">
                    <h:outputText value="#{checklist.title}"/>
                </p:column>

                <p:column headerText="Description">
                    <h:outputText value="#{checklist.description}"/>
                </p:column>

                <p:column headerText="Municipality">
                    <h:outputText value="#{checklist.muni.muniName}"/>
                </p:column>

                <p:column headerText="Code Source">
                    <h:outputText
                            value="#{checklist.governingCodeSource.sourceName} (#{checklist.governingCodeSource.sourceYear})"/>
                </p:column>
            </p:dataTable>

            <f:facet name="footer">
                <p:commandButton value="Cancel"
                                 icon="pi pi-times"
                                 class="ui-button-outlined p-mr-1"
                                 oncomplete="PF('inspections-selectchecklist-var').hide()"/>
                <p:commandButton id="inspections-selectchecklist-continuebutton"
                                 value="Continue"
                                 disabled="#{occInspectionsBB.selectedChecklistTemplate.inspectionChecklistID == 0}"
                                 icon="pi pi-arrow-right"
                                 oncomplete="PF('inspections-selectchecklist-var').hide(); PF('inspections-selectinspector-var').show()"/>
            </f:facet>
        </p:dialog>
    </h:form>

    <h:form id="inspections-selectinspector-form">
        <p:dialog id="inspections-selectinspector"
                  width="600"
                  widgetVar="inspections-selectinspector-var"
                  header="Select Inspector"
                  modal="true"
                  resizable="true">
            <p:selectOneListbox id="inspections-selectinspector-listbox"
                                scrollHeight="600"
                                value="#{occInspectionsBB.selectedInspector}"
                                var="u" filter="true" filterMatchMode="contains"
                                converter="userConverter">
                <p:ajax update="inspections-selectinspector-continuebutton"/>
                <f:selectItems value="#{occInspectionsBB.userList}" var="user"
                               itemLabel="#{user.person.firstName} #{user.person.lastName} #{user.username}"
                               itemValue="#{user}"/>
                <p:column>
                    <h:outputText value="#{u.person.firstName} #{u.person.lastName} (#{u.username})"/>
                </p:column>
            </p:selectOneListbox>

            <f:facet name="footer">
                <p:commandButton value="Back"
                                 icon="pi pi-arrow-left"
                                 class="ui-button-outlined p-mr-1"
                                 oncomplete="PF('inspections-selectinspector-var').hide(); PF('inspections-selectchecklist-var').show();"/>
                <p:commandButton id="inspections-selectinspector-continuebutton"
                                 value="Finish"
                                 disabled="#{occInspectionsBB.selectedInspector.userID == 0}"
                                 icon="pi pi-check"
                                 actionListener="#{occInspectionsBB.createInspection}"
                                 update="inspections-form:inspections-table"
                                 oncomplete="PF('inspections-selectinspector-var').hide()"/>
            </f:facet>
        </p:dialog>
    </h:form>

    <h:form id="inspections-selecttype-form">
        <p:dialog id="inspections-selecttype"
                  width="800"
                  widgetVar="inspections-selecttype-var"
                  header="Select Type"
                  modal="true"
                  resizable="true">

            <p:dataTable id="inspections-selecttype-dt"
                         scrollHeight="600"
                         var="type" value="#{occInspectionsBB.selectedInspection.checklistTemplate.occSpaceTypeTemplateList}"
                         rowKey="#{type.spaceTypeID}"
                         selection="#{occInspectionsBB.selectedType}"
                         stripedRows="true">
                <p:ajax event="rowSelect"
                        update=":inspections-selecttype-form:inspections-selecttype-continuebutton"/>
                <p:column selectionMode="single" style="width:16px;text-align:center"/>
                <p:column headerText="Name">
                    <h:outputText value="#{type.spaceTypeTitle}"/>
                </p:column>
                <p:column headerText="Description">
                    <h:outputText value="#{type.spaceTypeDescription}"/>
                </p:column>
                <p:column headerText="Required">
                    <i class="#{space.required ? 'pi pi-star' : ''}"/>
                </p:column>
            </p:dataTable>

            <f:facet name="footer">
                <p:commandButton value="Cancel"
                                 icon="pi pi-times"
                                 class="ui-button-outlined p-mr-1"
                                 oncomplete="PF('inspections-selecttype-var').hide()"/>
                <p:commandButton id="inspections-selecttype-continuebutton"
                                 value="Continue"
                                 disabled="#{occInspectionsBB.selectedType.spaceTypeID == 0}"
                                 icon="pi pi-arrow-right"
                                 update="inspections-selectspace-form"
                                 oncomplete="PF('inspections-selecttype-var').hide(); PF('inspections-selectspace-var').show()"/>
            </f:facet>
        </p:dialog>
    </h:form>

    <h:form id="inspections-selectspace-form">
        <p:dialog id="inspections-selectspace"
                  width="800"
                  widgetVar="inspections-selectspace-var"
                  header="Select Space"
                  modal="true"
                  resizable="true">

            <p:dataTable id="inspections-selectspace-dt"
                         scrollHeight="600"
                         var="space" value="#{occInspectionsBB.selectedType.spaceList}"
                         rowKey="#{space.spaceID}"
                         selection="#{occInspectionsBB.selectedSpace}"
                         stripedRows="true">
                <p:ajax event="rowSelect"
                        update=":inspections-selectspace-form:inspections-selectspace-continuebutton"/>
                <p:column selectionMode="single" style="width:16px;text-align:center"/>
                <p:column headerText="Name">
                    <h:outputText value="#{space.name}"/>
                </p:column>
                <p:column headerText="Description">
                    <h:outputText value="#{space.description}"/>
                </p:column>
                <p:column headerText="Required">
                    <i class="#{space.required ? 'pi pi-star' : ''}"/>
                </p:column>
            </p:dataTable>

            <f:facet name="footer">
                <p:commandButton value="Back"
                                 icon="pi pi-arrow-left"
                                 class="ui-button-outlined p-mr-1"
                                 oncomplete="PF('inspections-selectspace-var').hide(); PF('inspections-selecttype-var').show();"/>
                <p:commandButton id="inspections-selectspace-continuebutton"
                                 value="Continue"
                                 disabled="#{occInspectionsBB.selectedSpace.spaceID == 0}"
                                 icon="pi pi-arrow-right"
                                 update="inspections-spacedetails-form"
                                 oncomplete="PF('inspections-selectspace-var').hide(); PF('inspections-spacedetails-var').show();"/>
            </f:facet>
        </p:dialog>
    </h:form>

    <h:form id="inspections-spacedetails-form">
        <p:dialog id="inspections-spacedetails"
                  widgetVar="inspections-spacedetails-var"
                  header="Space Details"
                  modal="true"
                  resizable="true">
            <p:outputLabel styleClass="p-d-block">Space name:</p:outputLabel>
            <p:inputText styleClass="p-d-block" value="#{occInspectionsBB.selectedSpace.name}">
                <p:ajax update="inspections-spacedetails-continuebutton"/>
            </p:inputText>

            <p:outputLabel styleClass="p-d-block">Location descriptor:</p:outputLabel>
            <p:selectOneMenu selected="#{occInspectionsBB.selectedLocDescriptor}"
                             converter="occLocationDescriptorConverter"
                             var="ld" filter="true" filterMatchMode="contains">
                <p:ajax update="inspections-spacedetails-continuebutton"/>
                <f:selectItems value="#{occInspectionsBB.selectedInspection.allUniqueLocationDescriptors}" var="locdep"
                               itemLabel="#{locdep.locationDescription}" itemValue="#{locdep}"/>
                <p:column>
                    <h:outputText value="#{ld.locationDescription}"/>
                </p:column>
            </p:selectOneMenu>

            <p:outputLabel styleClass="p-d-block">Space details:</p:outputLabel>
            <p:inputTextarea rows="6" cols="33" value="#{occInspectionsBB.selectedSpace.description}"/>

            <f:facet name="footer">
                <p:commandButton value="Back"
                                 icon="pi pi-arrow-left"
                                 class="ui-button-outlined p-mr-1"
                                 oncomplete="PF('inspections-spacedetails-var').hide(); PF('inspections-selectspace-var').show();"/>
                <p:commandButton id="inspections-spacedetails-continuebutton"
                                 value="Continue"
                                 icon="pi pi-arrow-right"
                                 update="inspections-entryscreen-form"
                                 oncomplete="PF('inspections-spacedetails-var').hide(); PF('inspections-entryscreen-var').show()"/>
            </f:facet>
        </p:dialog>
    </h:form>

    <h:form id="inspections-entryscreen-form">
        <p:dialog id="inspections-entryscreen"
                  height="600" width="1000"
                  widgetVar="inspections-entryscreen-var"
                  header="Placeholder Dialog Title"
                  modal="true"
                  resizable="true">
            <div class="p-d-flex p-jc-between">
                <h1>SPACE NAME</h1>
                <div>
                    <p:commandButton value="Pass All"/>
                </div>
                <div>
                    <p:commandButton value="Edit Space" class="p-mr-1"/>
                    <p:commandButton value="Remove Space"/>
                </div>
            </div>
            <h2>Category Name</h2>
            <div class="p-grid">
                <div class="p-col-12 p-md-4">
                    <h3>Ordinance</h3>
                    <ul>
                        <li>accordion/collapsable box with ordinance description and tips of what to look for</li>
                    </ul>
                </div>
                <div class="p-col-12 p-md-4 p-mt-5">
                    <p:selectOneButton>
                        <f:selectItem itemLabel="Not Inspected"/>
                        <f:selectItem itemLabel="Pass"/>
                        <f:selectItem itemLabel="Fail"/>
                    </p:selectOneButton>
                    <div class="p-d-flex p-mt-2 p-jc-end">
                        <p:selectBooleanCheckbox itemLabel="Exclude from NOV"/>
                    </div>
                </div>
                <div class="p-col-12 p-md-4">
                    <div class="p-d-flex">
                        <div>
                            <p class="p-mb-0">Comments:</p>
                            <p:inputTextarea rows="6" cols="33"/>
                        </div>
                        <div class="p-mx-3 p-mt-5">
                            <p:button icon="pi pi-plus" styleClass="rounded-button"/>
                            <p>Add Photo</p>
                        </div>
                    </div>
                </div>
            </div>
            <p:commandButton value="Add Ordinance" icon="pi pi-plus"/>
        </p:dialog>
    </h:form>
</ui:composition>