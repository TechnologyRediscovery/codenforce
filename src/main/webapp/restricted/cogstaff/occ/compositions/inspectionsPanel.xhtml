<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns="http://www.w3.org/1999/xhtml">

    <h:form id="inspections-growl-form">
        <p:growl id="inspection-growl" />
    </h:form>



    <p:panel id="inspections-panel"
             toggleable="true"
             widgetVar="inspections-panel-var"
             collapsed="false"
             header="Inspections">
        <h:form id="inspections-form">


            <p:commandButton id="inspections-newbutton"
                             value="New inspection"
                             disabled="#{!empty occPeriodSearchWorkflowBB.currentOccPeriod.authorizedTS}"
                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                             icon="fa fa-plus"
                             oncomplete="PF('inspections-selectchecklist-var').show()"
                             actionListener="#{occInspectionsBB.startNewInspectionButtonClick}"
                             update="inspections-selectchecklist-form"/>

            <p:spacer height="5px"/>

            <ui:repeat id="inspections-uir"
                       var="ins"
                       value="#{sessionBean.sessOccPeriod.inspectionList}">
                <h2>
                    <h:outputText value="Inspection ID: #{ins.inspectionID} - "/>
                    <h:outputText value="#{occInspectionsBB.getPrettyDate(ins.timeStart)}"/>
                    <h:outputText value=" | "/>
                    <h:outputText value="#{ins.cause.title}"/>
                    <h:outputText value=" (Inspector: #{ins.inspector.human.name})"/>
                </h2>

                <p:commandLink ajax="true"
                               style="color:blue;"
                               actionListener="#{occInspectionsBB.onAddSpaceLinkClick(ins)}"
                               oncomplete="PF('inspections-selecttype-var').show()"
                               rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                               update="inspections-selecttype-form"
                               value="Add space"> |
                    <f:actionListener binding="#{occInspectionsBB.setSelectedInspection(ins)}"/>
                </p:commandLink>

                <h:outputText value=" | " />

                <p:commandLink  id="inspection-details-cl"
                                ajax="true"
                                style="color:blue;"
                                oncomplete="PF('inspections-inspectiondetails-var').show()"
                                rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                update="inspections-inspectiondetails-form
                                inspection-deactivation-form
                                inspection-occperiodxfer-form"
                                value="Details">
                    <f:actionListener binding="#{occInspectionsBB.setSelectedInspection(ins)}"/>
                </p:commandLink>

                <h:outputText value=" | " />

                <p:commandLink  id="inspection-uploadphotos-cl"
                                ajax="true"
                                style="color:blue;"
                                oncomplete="PF('blob-upload-dialog-var').show()"
                                rendered="true"
                                update="@form:@parent:@parent:blob-upload-dialog
                                "
                                value="Add Photos"
                                actionListener="#{occInspectionsBB.onUploadImagesToInspectionInitButtonClick(ins)}">

                </p:commandLink>

                <h:outputText value=" | " />

                <p:commandLink  id="inspection-viewphotos-cl"
                                ajax="true"
                                style="color:blue;"
                                oncomplete="PF('blobs-gallery-dialog-var').show()"
                                rendered="true"
                                update="@form:@parent:@parent:blobs-gallery-dialog
                                "
                                value="View photo pool"
                                actionListener="#{occInspectionsBB.onViewPhotoPoolLinkClick(ins)}">

                </p:commandLink>

                <h:outputText value=" | " />

                <p:commandLink  id="inspection-generatereport-cl"
                                ajax="true"
                                style="color:blue;"
                                oncomplete="PF('inspection-reportconfig-dialog-var').show()"
                                rendered="true"
                                update="inspection-reportconfig-dialog
                                inspection-reportconfig-form"
                                value="Generate inspection report"
                                actionListener="#{occInspectionsBB.onFieldInspectionReportInitLinkClick(ins)}">

                </p:commandLink>

                <p:dataTable var="inspectedSpace"
                             value="#{ins.inspectedSpaceList}"
                             rowKey="#{inspectedSpace.inspectedSpaceID}"
                             reflow="true">
                    <p:column style="width:2rem">
                        <p:rowToggler/>
                    </p:column>
                    <p:column headerText="Type">
                        <h:outputText value="#{inspectedSpace.type.spaceTypeTitle} (ID:#{inspectedSpace.inspectedSpaceID})"/>
                        <h:panelGroup id="inspections-selectspace-dt-spacetypeinfoicon">
                            <i class="p-ml-1 pi pi-info-circle"/>
                        </h:panelGroup>
                        <p:tooltip for="inspections-selectspace-dt-spacetypeinfoicon"
                                   value="#{inspectedSpace.type.spaceTypeDescription}" position="right"/>
                    </p:column>
                    <p:column headerText="Uninsp"
                              style="width:10%;">
                        <h:outputText value="#{inspectedSpace.elementListNotIns.size()}" />
                    </p:column>
                    <p:column headerText="Pass"
                              style="width:10%;">
                        <h:outputText value="#{inspectedSpace.elementListPass.size()}" />
                    </p:column>
                    <p:column headerText="Violation"
                              style="width:10%;">
                        <h:outputText value="#{inspectedSpace.elementListFail.size()}" />
                    </p:column>

                    <p:column headerText="Actions">
                        <p:commandLink ajax="true"
                                       style="color:blue;"
                                       oncomplete="PF('inspections-entryscreen-var').show()"
                                       rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                       update="inspections-entryscreen-form
                                       inspections-entryscreen"
                                       value="Edit">
                            <f:actionListener binding="#{occInspectionsBB.onViewInspectedSpaceLinkClick(inspectedSpace, ins)}"/>
                        </p:commandLink>
                    </p:column>
                    <p:rowExpansion>

                        <h4>Violated</h4>
                        <ul>
                            <ui:repeat id="spaceele-uir-fail"
                                       value="#{inspectedSpace.elementListFail}"
                                       var="ele_fail">
                                <li>
                                    <h:outputText value="#{ele_fail.headerString}" 
                                                  escape="false"/>

                                    <h:outputText value=" [#{ele_fail.inspectionNotes}]" 
                                                  escape="true"
                                                  rendered="#{!empty ele_fail.inspectionNotes}"/>
                                </li>
                            </ui:repeat>
                        </ul>

                        <h4>Not Inspected</h4>
                        <ul>

                            <ui:repeat id="spaceele-uir-notins"
                                       value="#{inspectedSpace.elementListNotIns}"
                                       var="ele_notins">
                                <li>
                                    <h:outputText value="#{ele_notins.headerString}"
                                                  escape="false"/>
                                    <h:outputText value=" [#{ele_notins.inspectionNotes}]" 
                                                  escape="true"
                                                  rendered="#{!empty ele_notins.inspectionNotes}"/>
                                </li>

                            </ui:repeat>
                        </ul>

                        <h4>Pass</h4>
                        <ul>
                            <ui:repeat id="spaceele-uir-pass"
                                       value="#{inspectedSpace.elementListPass}"
                                       var="ele_pass">
                                <li>

                                    <h:outputText value="#{ele_pass.headerString}" 
                                                  escape="false"/>
                                    <h:outputText value=" [#{ele_pass.inspectionNotes}]" 
                                                  escape="true"
                                                  rendered="#{!empty ele_pass.inspectionNotes}"/>
                                </li>

                            </ui:repeat>
                        </ul>
                    </p:rowExpansion>
                </p:dataTable>

                <h3>Determination</h3>
                <h:outputText  value="#{empty occInspectionsBB.selectedInspection.determination ? 'No determination assigned' : ''}" />
                <h:outputText  value="#{not empty occInspectionsBB.selectedInspection.determinationTS ? 'Inspection finalized with determination: ' : '' }" />
                <h:outputText  value="#{not empty occInspectionsBB.selectedInspection.determinationTS ? occInspectionsBB.selectedInspection.determination.title : '' }" />

                <p:spacer height="5px" />

                <p:commandButton   id="inspections-selectchecklist-continuebutton"
                                   value="Finalzie and lock inspection ID:#{ins.inspectionID}"
                                   rendered="#{((systemServicesBB.bbSessionUser.userID eq ins.inspector.userID) or systemServicesBB.bbSessionUser.keyCard.hasSysAdminPermissions) and empty ins.determinationTS}"
                                   icon="fa fa-check-square "
                                   actionListener="#{occInspectionsBB.onCertifyInspectionInitButtonChange(ins)}"
                                   update="@form:@parent:inspection-finalize-form"
                                   oncomplete="PF('inspection-finalize-dialog-var').show();"/>

                <p:spacer height="5px" />
                <hr />
                <p:spacer height="5px" />
            </ui:repeat>


        </h:form>
    </p:panel>

    <!-- Dialogs -->

    <!-- Inspection Creation Flow -->

    <!-- Checklist selection dialog used in inspection creation flow -->
    <p:dialog id="inspections-selectchecklist"
              width="1000"
              widgetVar="inspections-selectchecklist-var"
              header="Choose Checklist"
              modal="true"
              dynamic="true"
              resizable="true">
        <h:form id="inspections-selectchecklist-form">
            <p:dataTable id="inspections-selectchecklist-dt"
                         scrollHeight="600"
                         var="checklist" value="#{occInspectionsBB.checklistTemplateList}"
                         rowKey="#{checklist.inspectionChecklistID}"
                         selection="#{occInspectionsBB.selectedChecklistTemplate}"
                         stripedRows="true">
                <p:ajax event="rowSelect"
                        update=":inspections-selectchecklist-form:inspections-selectchecklist-continuebutton"/>
                <p:column selectionMode="single" style="width:16px;text-align:center"/>
                <p:column headerText="Title">
                    <h:outputText value="#{checklist.title} (ID:#{checklist.inspectionChecklistID})"/>
                </p:column>

                <p:column headerText="Description">
                    <h:outputText value="#{checklist.description}"/>
                </p:column>

                <p:column headerText="Municipality">
                    <h:outputText value="#{checklist.muni.muniName}"/>
                </p:column>

                <p:column headerText="Code Source">
                    <h:outputText
                        value="#{checklist.governingCodeSource.sourceName} (#{checklist.governingCodeSource.sourceYear})"/>
                </p:column>
            </p:dataTable>

            <p:commandButton value="Cancel"
                             icon="pi pi-times"
                             class="ui-button-outlined p-mr-1"
                             oncomplete="PF('inspections-selectchecklist-var').hide()"/>
            <p:commandButton id="inspections-selectchecklist-continuebutton"
                             value="Create"
                             disabled="#{occInspectionsBB.selectedChecklistTemplate.inspectionChecklistID == 0}"
                             icon="pi pi-arrow-right"
                             actionListener="#{occInspectionsBB.onChecklistSelectionCompleteButtonClick}"
                             update="   @form:@parent:inspections-inspectiondetails
                             @form:@parent:inspections-inspectiondetails-form
                             @form:@parent:inspection-occperiodxfer-form
                             @form:@parent:inspection-deactivation-form"
                             oncomplete="PF('inspections-selectchecklist-var').hide(); PF('inspections-inspectiondetails-var').show()"/>
        </h:form>
    </p:dialog>



    <!-- Space add flow -->
    <!-- (Currently a bit defunct) -->

    <!-- Type selection used in space add flow -->
    <p:dialog id="inspections-selecttype"
              width="800"
              closeOnEscape="true"
              widgetVar="inspections-selecttype-var"
              header="Select Space Type"
              modal="true"
              dynamic="true"
              resizable="true">
        <h:form id="inspections-selecttype-form">

            <p:dataTable id="inspections-selecttype-dt"
                         scrollHeight="600"
                         var="ost" value="#{occInspectionsBB.selectedInspection.checklistTemplate.occSpaceTypeList}"
                         rowKey="#{ost.checklistSpaceTypeID}"
                         selection="#{occInspectionsBB.selectedSpaceType}"
                         stripedRows="true"
                         rowExpandMode="multiple">
                <p:ajax event="rowSelect"
                        update=":inspections-selecttype-form:inspections-selecttype-continuebutton"/>
                <p:column selectionMode="single" style="width:16px;text-align:center"/>
                <p:column style="width:2rem">
                    <p:rowToggler/>
                </p:column>
                <p:column headerText="CSTID">
                    <h:outputText value="#{ost.checklistSpaceTypeID}"/>
                </p:column>
                <p:column headerText="Type ID">
                    <h:outputText value="#{ost.spaceTypeID}"/>
                </p:column>
                <p:column headerText="Chklst ID">
                    <h:outputText value="#{ost.checklistParentID}"/>
                </p:column>
                <p:column headerText="Name">
                    <h:outputText value="#{ost.spaceTypeTitle}"/>
                </p:column>
                <p:column headerText="Description">
                    <h:outputText value="#{ost.spaceTypeDescription}"/>
                </p:column>
                <p:column headerText="Required">
                    <i class="#{ost.required ? 'pi pi-star' : ''}"/>
                </p:column>
                <p:rowExpansion>
                    <p:dataTable id="ordbytype-table"
                                 var="ord"
                                 value="#{ost.codeElementList}"
                                 rowKey="#{ord.elementID}"
                                 stripedRows="true">

                        <p:column headerText="EleID">
                            <h:outputText value="#{ord.elementID}"/>
                        </p:column>
                        <p:column headerText="subsec">
                            <h:outputText value="#{ord.ordSubSecTitle}"/>
                        </p:column>

                    </p:dataTable>

                </p:rowExpansion>


            </p:dataTable>
            <p:spacer height="3px" />

            <p:commandButton value="Cancel"
                             icon="pi pi-times"
                             process="@none"
                             immediate="true"
                             class="ui-button-outlined p-mr-1"
                             oncomplete="PF('inspections-selecttype-var').hide()"/>
            <p:commandButton id="inspections-selecttype-continuebutton"
                             value="Continue"
                             disabled="!{occInspectionsBB.selectedType.spaceTypeID == 0}"
                             icon="pi pi-arrow-right"
                             update="inspections-selectspace-form"

                             oncomplete="PF('inspections-selecttype-var').hide(); 
                             PF('inspections-selectspace-var').show()"/>
        </h:form>
    </p:dialog>

    <!-- Actual space(?) selection used in space add flow -->
    <p:dialog id="inspections-selectspace"
              width="800"
              widgetVar="inspections-selectspace-var"
              header="Identify location of space type: #{occInspectionsBB.selectedSpaceType.spaceTypeTitle}"
              dynamic="true"
              modal="true"
              resizable="true">
        <h:form id="inspections-selectspace-form">
            <p:spacer height="5px"/>
            <div class="p-col-12 p-md-6">
                <p:commandButton value="New location descriptor"
                                 actionListener="#{occInspectionsBB.initSkeletonLocDescriptor}"
                                 update="inspections-addlocdesc-form"
                                 oncomplete="PF('inspections-addlocdesc-var').show()"
                                 icon="pi pi-plus"/>
            </div>
            <p:outputLabel styleClass="p-d-block">OR Choose a Location descriptor:</p:outputLabel>
            <div class="p-grid">
                <div class="p-col-12 p-md-6">
                    <p:selectOneMenu value="#{occInspectionsBB.selectedLocDescriptor}"
                                     converter="occLocationDescriptorConverter"
                                     var="ld" filter="true" filterMatchMode="contains">
                        <p:ajax update="inspections-selectspace-continuebutton
                                @form"/>
                        <f:selectItems value="#{occInspectionsBB.selectedInspection.allUniqueLocationDescriptors}" var="locdep"
                                       itemLabel="#{locdep.locationDescription}" itemValue="#{locdep}"/>
                        <p:column>
                            <h:outputText value="#{ld.locationDescription}"/>
                        </p:column>
                    </p:selectOneMenu>
                </div>

            </div>

            <h3>Selected location</h3>

            <h:outputText value="#{occInspectionsBB.selectedLocDescriptor.locationDescription}"/>
            <p:spacer height="3px" />
            <h:outputText value="Floor: #{occInspectionsBB.selectedLocDescriptor.buildingFloorNo}"/>
            <p:spacer height="3px" />
            <h:outputText value="#{occInspectionsBB.selectedLocDescriptor.locationID}"/>
            <p:spacer height="5px" />
            <p:commandButton value="Back"
                             icon="pi pi-arrow-left"
                             class="ui-button-outlined p-mr-1"
                             oncomplete="PF('inspections-selectspace-var').hide(); PF('inspections-selecttype-var').show()"
                             style="margin-right: 5px;"/>

            <p:commandButton id="inspections-selectspace-continuebutton"
                             value="Add to inspection and close"
                             icon="pi pi-plus"
                             actionListener="#{occInspectionsBB.addSelectedSpaceToSelectedInspection}"
                             update="inspections-form
                             inspections-growl-form"
                             oncomplete="PF('inspections-selectspace-var').hide()"
                             style="margin-right: 5px;"/>

            <p:commandButton id="inspections-selectspace-inspectnow"
                             value="Inspect space now!"
                             icon="pi pi-check-square "
                             actionListener="#{occInspectionsBB.addSelectedSpaceToSelectedInspection}"
                             update="inspections-form
                             inspections-growl-form
                             inspections-entryscreen
                             inspections-entryscreen-controls-form
                             inspections-inspectiondetails"
                             oncomplete="PF('inspections-selectspace-var').hide();
                             PF('inspections-entryscreen-var').show();"/>
        </h:form>
    </p:dialog>

    <!-- Independent dialogs that are not necessarily used in a flow -->

    <!-- Dialog to view details of an OccInspection -->
    <p:dialog id="inspections-inspectiondetails"
              width="800"
              height="600"
              widgetVar="inspections-inspectiondetails-var"
              header="Inspection Details #{occInspectionsBB.selectedInspection.inspectionID}"
              dynamic="true"
              modal="true"
              resizable="true">
        <h:form id="inspections-inspectiondetails-form">
            <p:commandButton id="inspections-inspectiondetails-editbutton"
                             value="#{occInspectionsBB.editModeInspectionMetadata ? 'Save Changes' : 'Edit'}"
                             disabled="#{!empty occInspectionsBB.selectedInspection.deactivatedBy}"
                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                             icon="fa #{occInspectionsBB.editModeInspectionMetadata ? 'fa-check' : 'fa-pencil'}"
                             actionListener="#{occInspectionsBB.onToggleEditModeInspectionMetadata}"
                             oncomplete="PF('inspections-inspectiondetails-var').show()"
                             update="@form
                             @form:@parent:inspections-growl-form
                             @form:@parent:inspections-form"/>

            <div class="gray_button">

                <p:commandButton id="inspections-inspectiondetails-abort"
                                 value="Cancel"
                                 styleClass="gray-button"
                                 rendered="#{occInspectionsBB.editModeInspectionMetadata}"
                                 icon="fa fa-stop"
                                 actionListener="#{occInspectionsBB.abortEditsOccInspectionMetadata}"
                                 oncomplete="PF('inspections-inspectiondetails-var').show()"
                                 update="@form
                                 @form:@parent:inspections-growl-form"/>
            </div>



            <p:spacer height="5px"/>

            <p:panel id="inspections-inspectiondetails-generalpanel"
                     toggleable="true"
                     collapsed="false"
                     header="General">

                <div class="p-grid">
                    <div class="p-col-6">ID</div>
                    <div class="p-col-6">
                        <h:outputText value="#{occInspectionsBB.selectedInspection.inspectionID}" />
                    </div>
                    <div class="p-col-6">
                        Re-inspection?
                    </div>
                    <div class="p-col-6">

                        <h:outputText rendered="#{occInspectionsBB.selectedInspection.followUpToInspectionID eq 0 and !occInspectionsBB.editModeInspectionMetadata}" 
                                      value="No; first inspection"/>

                        <h:outputText rendered="#{occInspectionsBB.selectedInspection.followUpToInspectionID ne 0 and !occInspectionsBB.editModeInspectionMetadata}" 
                                      value="Yes: To inspection ID: #{occInspectionsBB.selectedInspection.followUpToInspectionID}"/>

                        <p:selectOneMenu rendered="#{occInspectionsBB.editModeInspectionMetadata}"
                                         value="#{occInspectionsBB.formFollowUpInspection}"
                                         filter="false"
                                         required="false"
                                         converter="occInspectionConverter">
                            <f:selectItems value="#{occPeriodSearchWorkflowBB.currentOccPeriod.inspectionList}" 
                                           var="ins"
                                           itemLabel="#{ins.inspectionID} (#{occInspectionsBB.getPrettyDate(ins.effectiveDateOfRecord)})"
                                           itemValue="#{ins}"/>
                        </p:selectOneMenu>
                        <p:spacer rendered="#{occInspectionsBB.editModeInspectionMetadata}"
                                  height="3px" />
                        <h:outputText rendered="#{occInspectionsBB.editModeInspectionMetadata}"
                                      value="Showing all inspections on the current occupancy period" />

                    </div>
                    <div class="p-col-6">
                        Inspector
                    </div>
                    <div class="p-col-6">
                        <h:outputText rendered="#{!occInspectionsBB.editModeInspectionMetadata}" 
                                      value="#{occInspectionsBB.selectedInspection.inspector.human.name}" />
                        <h:outputText rendered="#{!occInspectionsBB.editModeInspectionMetadata}" 
                                      value=" (#{occInspectionsBB.selectedInspection.inspector.username})" />

                        <p:selectOneMenu rendered="#{occInspectionsBB.editModeInspectionMetadata}"
                                         value="#{occInspectionsBB.selectedInspection.inspector}"
                                         filter="true"
                                         filterMatchMode="contains"
                                         converter="userConverter">
                            <f:selectItems value="#{systemServicesBB.bbSessionMuni.swornOfficerList}" 
                                           var="user"
                                           itemLabel="#{user.human.name} (#{user.username})"
                                           itemValue="#{user}"/>
                        </p:selectOneMenu>
                    </div>

                    <p:divider/>

                    <div class="p-col-6">
                        Created
                    </div>

                    <div class="p-col-6">
                        <h:outputText value="#{occInspectionsBB.selectedInspection.createdBy.human.name} 
                                      (#{occInspectionsBB.selectedInspection.createdBy.username})" 
                                      rendered="#{!empty occInspectionsBB.selectedInspection.createdBy}"/>
                        <p:spacer height="3px" />

                        <h:outputText value="at "
                                      rendered="#{!empty occInspectionsBB.selectedInspection.creationTS}" />

                        <h:outputText value="#{occInspectionsBB.getPrettyDate(occInspectionsBB.selectedInspection.creationTS)}" 
                                      rendered="#{!empty occInspectionsBB.selectedInspection.creationTS}"/>
                    </div>

                    <div class="p-col-6">
                        Last updated
                    </div>

                    <div class="p-col-6">
                        <h:outputText value="#{occInspectionsBB.selectedInspection.lastUpdatedBy.human.name} 
                                      (#{occInspectionsBB.selectedInspection.lastUpdatedBy.username})" 
                                      rendered="#{!empty occInspectionsBB.selectedInspection.lastUpdatedBy}"/>

                        <p:spacer height="3px" />
                        <h:outputText value="at "
                                      rendered="#{!empty occInspectionsBB.selectedInspection.lastUpdatedTS}" />

                        <h:outputText value="#{occInspectionsBB.getPrettyDate(occInspectionsBB.selectedInspection.lastUpdatedTS)}" 
                                      rendered="#{!empty occInspectionsBB.selectedInspection.lastUpdatedTS}"/>
                    </div>
                    <div class="p-col-6">
                        Deactivated
                    </div>
                    <div class="p-col-6">

                        <h:outputText value="Active Record" 
                                      rendered="#{empty occInspectionsBB.selectedInspection.deactivatedBy}"/>

                        <h:outputText value="#{occInspectionsBB.selectedInspection.deactivatedBy.human.name} 
                                      (#{occInspectionsBB.selectedInspection.deactivatedBy.username})" 
                                      rendered="#{!empty occInspectionsBB.selectedInspection.deactivatedBy}"/>
                        <p:spacer height="3px" />

                        <h:outputText value="at "
                                      rendered="#{!empty occInspectionsBB.selectedInspection.deactivatedTS}" />

                        <h:outputText value="#{occInspectionsBB.getPrettyDate(occInspectionsBB.selectedInspection.deactivatedTS)}" 
                                      rendered="#{!empty occInspectionsBB.selectedInspection.deactivatedBy}"/>
                    </div>
                </div>
            </p:panel>

            <p:panel id="inspections-inspectiondetails-inspectionpanel"
                     toggleable="true"
                     collapsed="false"
                     header="Inspection">
                <div class="p-grid">

                    <div class="p-col-6">
                        Cause
                    </div>
                    <div class="p-col-6">
                        <h:outputText rendered="#{!occInspectionsBB.editModeInspectionMetadata}" 
                                      value="#{occInspectionsBB.selectedInspection.cause.title}"
                                      title="#{occInspectionsBB.selectedInspection.cause.description}" />

                        <p:selectOneMenu rendered="#{occInspectionsBB.editModeInspectionMetadata}"
                                         value="#{occInspectionsBB.selectedInspection.cause}"
                                         converter="occInspectionCauseConverter">
                            <f:selectItems value="#{occInspectionsBB.causeList}" 
                                           var="cause"
                                           itemLabel="#{cause.title}"
                                           itemValue="#{cause}"/>
                        </p:selectOneMenu>

                    </div>

                    <div class="p-col-6">
                        Checklist
                    </div>
                    <div class="p-col-6">

                        <h:outputText rendered="#{!occInspectionsBB.editModeInspectionMetadata}" 
                                      value="#{occInspectionsBB.selectedInspection.checklistTemplate.title}"/>

                        <p:selectOneMenu rendered="#{occInspectionsBB.editModeInspectionMetadata}"
                                         value="#{occInspectionsBB.selectedInspection.checklistTemplate}"
                                         converter="checklistTitleConverter">
                            <f:selectItems value="#{occInspectionsBB.checklistTemplateList}" 
                                           var="temp"
                                           itemLabel="#{temp.title}"
                                           itemValue="#{temp}"/>
                        </p:selectOneMenu>
                        <h:outputText rendered="#{occInspectionsBB.editModeInspectionMetadata}" 
                                      value="Warning: changing templates after an inspection has begun is a recipe for disaster!"/>
                    </div>

                    <div class="p-col-6">
                        Start time
                    </div>

                    <div class="p-col-6">
                        <h:outputText rendered="#{!occInspectionsBB.editModeInspectionMetadata}" 
                                      value="#{occInspectionsBB.getPrettyDate(occInspectionsBB.selectedInspection.timeStart)}"/>

                        <p:calendar rendered="#{occInspectionsBB.editModeInspectionMetadata}"
                                    value="#{occInspectionsBB.selectedInspection.timeStart}" 
                                    pattern="MM/dd/yyyy HH:mm" 
                                    mask="true"/>
                    </div>

                    <div class="p-col-6">
                        End time
                    </div>

                    <div class="p-col-6">
                        <h:outputText rendered="#{!occInspectionsBB.editModeInspectionMetadata}" 
                                      value="#{occInspectionsBB.getPrettyDate(occInspectionsBB.selectedInspection.timeEnd)}"/>
                        <p:calendar rendered="#{occInspectionsBB.editModeInspectionMetadata}" 
                                    value="#{occInspectionsBB.selectedInspection.timeEnd}" 
                                    pattern="MM/dd/yyyy HH:mm" 
                                    mask="true"/>
                    </div>

                    <p:divider/>

                    <div class="p-col-6">
                        Max occupants allowed
                    </div>
                    <div class="p-col-6">
                        <h:outputText rendered="#{!occInspectionsBB.editModeInspectionMetadata}" 
                                      value="#{occInspectionsBB.selectedInspection.maxOccupantsAllowed}"/>

                        <p:inputText rendered="#{occInspectionsBB.editModeInspectionMetadata}"  
                                     value="#{occInspectionsBB.selectedInspection.maxOccupantsAllowed}"/>
                    </div>
                    <div class="p-col-6">
                        Number of bedrooms
                    </div>
                    <div class="p-col-6">
                        <h:outputText rendered="#{!occInspectionsBB.editModeInspectionMetadata}" 
                                      value="#{occInspectionsBB.selectedInspection.numBedrooms}"/>
                        <p:inputText rendered="#{occInspectionsBB.editModeInspectionMetadata}"  
                                     value="#{occInspectionsBB.selectedInspection.numBedrooms}"/>
                    </div>

                    <div class="p-col-6">
                        Number of bathrooms
                    </div>
                    <div class="p-col-6">
                        <h:outputText rendered="#{!occInspectionsBB.editModeInspectionMetadata}" 
                                      value="#{occInspectionsBB.selectedInspection.numBathrooms}"/>
                        <p:inputText rendered="#{occInspectionsBB.editModeInspectionMetadata}"  
                                     value="#{occInspectionsBB.selectedInspection.numBathrooms}"/>
                    </div>




                </div>
            </p:panel>

            <p:panel id="inspections-inspectiondetails-notespanel"
                     toggleable="true"
                     collapsed="false"
                     header="Notes">
                <div class="p-grid">
                    <div class="p-col-6">
                        Pre-inspection notes
                    </div>
                    <div class="p-col-6">
                        <h:outputText   rendered="#{!occInspectionsBB.editModeInspectionMetadata}" 
                                        value="#{occInspectionsBB.selectedInspection.notesPreInspection}"/>

                        <p:inputTextarea    rendered="#{occInspectionsBB.editModeInspectionMetadata}" 
                                            value="#{occInspectionsBB.selectedInspection.notesPreInspection}"
                                            rows="8"
                                            cols="30" />
                    </div>

                    <div class="p-col-6">
                        Remarks
                    </div>

                    <div class="p-col-6">
                        <h:outputText   rendered="#{!occInspectionsBB.editModeInspectionMetadata}" 
                                        value="#{occInspectionsBB.selectedInspection.remarks}"/>

                        <p:inputTextarea    rendered="#{occInspectionsBB.editModeInspectionMetadata}" 
                                            value="#{occInspectionsBB.selectedInspection.remarks}"
                                            rows="8"
                                            cols="30" />
                    </div>

                    <div class="p-col-6">
                        General Comments
                    </div>
                    <div class="p-col-6">
                        <h:outputText   rendered="#{!occInspectionsBB.editModeInspectionMetadata}" 
                                        value="#{occInspectionsBB.selectedInspection.generalComments}"/>

                        <p:inputTextarea    rendered="#{occInspectionsBB.editModeInspectionMetadata}" 
                                            value="#{occInspectionsBB.selectedInspection.generalComments}"
                                            rows="8"
                                            cols="30" />
                    </div>
                </div>
            </p:panel>

        </h:form>
        <p:panel id="inspections-inspectiondetails-occperiod-panel"
                 toggleable="true"
                 collapsed="true"
                 header="Transfer or Deactivation">
            <h:form id="inspection-occperiodxfer-form">
                <h3>Transfer inspection to new period</h3>
                <h:outputText     value="Current Occupancy period ID: #{occInspectionsBB.selectedInspection.occPeriodID}"/>
                <p:spacer height="4px" />
                <h:outputText  value="Enter the ID of the Occupancy Period to which this inspection should be transferred. On successful transfer, you'll be sent to the dashboard." />
                <p:inputNumber value="#{occInspectionsBB.occPeriodIDFortransferFormField}"
                               required="true" />
                <p:commandButton id="inspection-occperiodxfer-button"
                                 action="#{occInspectionsBB.onOccPeriodXferButtonClick}"
                                 ajax="false"
                                 value="Transfer this inspection!" />
            </h:form> 

            <h:form id="inspection-deactivation-form">

                <h3>Deactivate inspection</h3>

                <p:commandButton  id="inspection-deacinspection-button"
                                  action="#{occInspectionsBB.onDeactivateInspectionButtonClick}"
                                  ajax="false"
                                  value="Deactivate inspection ID #{occInspectionsBB.selectedInspection.inspectionID}" 
                                  >
                </p:commandButton>


            </h:form>  


            <h:form id="inspection-definalize-form">

                <h3>Remove finalization of inspection</h3>

                <p:commandButton  id="inspection-removefinalization-button"
                                  actionListener="#{occInspectionsBB.onRemoveFinalizationOfInspection}"
                                  disabled="#{!empty occInspectionsBB.selectedInspection.determinationTS}"
                                  ajax="True"
                                  value="Remove finalization of inspection ID #{occInspectionsBB.selectedInspection.inspectionID}" 
                                  update="@form:@parent:inspections-growl-form
                                  @form
                                  @form:@parent:inspections-form"

                                  >
                </p:commandButton>


            </h:form>  

        </p:panel>
    </p:dialog>

    <!-- Currently not working and not realized dialog for editing of an OccInspectedSpace's basic info -->
    <p:dialog id="inspections-editspace"
              widgetVar="inspections-editspace-var"
              header="Edit Space"
              dynamic="true"
              modal="true"
              closable="false"
              resizable="true">
        <h:form id="inspections-editspace-form">
            <p:outputLabel styleClass="p-d-block">Space name:</p:outputLabel>
            <!--            <p:inputText styleClass="p-d-block" value="!{occInspectionsBB.selectedSpace.name}"/>-->

            <p:outputLabel styleClass="p-d-block">Space description:</p:outputLabel>
            <!--            <p:inputTextarea rows="6" cols="33" value="!{occInspectionsBB.selectedSpace.description}"/>-->

            <!--                                 update="inspections-selectspace-form:inspections-selectspace-dt
                                         inspections-selectspace-form:inspections-selectspace-continuebutton" -->
            <f:facet name="footer">
                <p:commandButton id="inspections-editspace-continuebutton"
                                 value="Ok"
                                 icon="pi pi-check"
                                 oncomplete="PF('inspections-editspace-var').hide()"/>
            </f:facet>
        </h:form>
    </p:dialog>

    <!-- Dialog used for adding new location descriptors. Yep, it's pretty defunct. -->
    <p:dialog id="inspections-addlocdesc"
              widgetVar="inspections-addlocdesc-var"
              header="Add Location Descriptor"
              dynamic="true"
              modal="true"
              closable="true"
              closeOnEscape="true"
              resizable="true">
        <h:form id="inspections-addlocdesc-form">

            <p:outputLabel for="inspections-locdesc-input" styleClass="p-d-block">Location description:</p:outputLabel>
            <p:inputTextarea id="inspections-locdesc-input"
                             rows="6" 
                             cols="33" 
                             value="#{occInspectionsBB.skeletonLocationDescriptor.locationDescription}"
                             required="true">
                <p:ajax update="inspections-addlocdesc-continuebutton"/>
            </p:inputTextarea>

            <p:outputLabel for="inspections-floornumber-input" styleClass="p-d-block">Building floor number:</p:outputLabel>
            <p:inputNumber id="inspections-floornumber-input"
                           value="#{occInspectionsBB.skeletonLocationDescriptor.buildingFloorNo}"/>

            <p:spacer height="3px" />
            <p:commandButton value="Cancel"
                             icon="pi pi-times"
                             oncomplete="PF('inspections-addlocdesc-var').hide()"/>
            <p:commandButton id="inspections-addlocdesc-continuebutton"
                             value="Add"
                             disabled="false"
                             icon="pi pi-plus"
                             update="@form:@parent:inspections-selectspace-form"
                             actionListener="#{occInspectionsBB.createLocDescriptor}"
                             oncomplete="PF('inspections-addlocdesc-var').hide()"/>
        </h:form>
    </p:dialog>

    <!-- Barely realized form that should show stats for one OccInspectedSpace(?) and all of its ordinances -->

    <p:dialog id="inspections-entryscreen"
              height="600" width="1000"
              widgetVar="inspections-entryscreen-var"
              header="Inspect ordiances in #{occInspectionsBB.selectedInspectedSpace.type.spaceTypeTitle} (ID: #{occInspectionsBB.selectedInspectedSpace.inspectedSpaceID})"
              dynamic="true"
              modal="true"
              resizable="true"
              closable="true"
              closeOnEscape="true">

        <div class="p-d-flex p-jc-between">

            <div>
                <h:form id="inspections-entryscreen-controls-form">
                    <p:selectOneMenu    id="inspections-entryscreen-statussel" 
                                        value="#{occInspectionsBB.selectedElementStatusForBatch}" 
                                        >
                        <!-- Strangely this element needs to update itself to call the setter -->
                        <f:selectItem noSelectionOption="true"
                                      itemDisabled="true"
                                      itemLabel="choose a batch status" />
                        <f:selectItems value="#{occInspectionsBB.statuses}" 
                                       var="status" 
                                       itemLabel="#{status.label}"/>
                    </p:selectOneMenu>
                    <p:spacer height="3px" />

                    <p:commandLink     id="applybatch-cl"
                                       ajax="true"
                                       style="color:blue;"
                                       update="@form:@parent:space-element-accordion-form:element-accordion
                                       @form:@parent:inspections-growl-form"
                                       value="Batch apply to all ords"
                                       actionListener="#{occInspectionsBB.onBatchProcessElementLinkClick}" />
                </h:form>
            </div>
            <div>
                <h:form id="stinspection-tools-form">
                    <p>use default findings on violation: </p>

                    <p:selectBooleanCheckbox id="stinspection-usedefaultfindings-cb"
                                             value="#{occInspectionsBB.useDefaultFindingsOnCurrentOISE}"
                                             label="use default findings"
                                             title="when an element is violated, populate findings with default findings on the ordinance">
                        <p:ajax />
                    </p:selectBooleanCheckbox>

                    <h:outputText value=" | " />

                    <p:commandLink     id="stinspection-editspace"
                                       ajax="true"
                                       style="color:blue;"
                                       update=""
                                       value="edit space"
                                       actionListener="#{occInspectionsBB.onSpaceTypeEditLinkClick}" />

                    <h:outputText value=" | " />

                    <p:commandLink     id="stinspection-removespace"
                                       ajax="true"
                                       style="color:blue;"
                                       update=""
                                       value="remove space from inspection"
                                       actionListener="#{occInspectionsBB.onSpaceTypeRemoveLinkClick}" >
                        <p:confirm header="Confirm remove space from inspection?"
                                   message="Are you sure?"
                                   icon="ui-icon-alert" />
                    </p:commandLink>

                    <p>Filter elements (See mobile specs) </p>
                    <p:inputText id="ordsearch" />
                </h:form>


            </div>
        </div>


        <p:separator />

        <h:form id="inspections-entryscreen-form">

            <p:commandButton id="inspections-newbutton"
                             value="Save space data and close"
                             disabled="false"
                             rendered="true"
                             icon="fa fa-save"
                             actionListener="#{occInspectionsBB.onSavCurrentSpaceChanges}"
                             oncomplete="PF('inspections-entryscreen-var').hide()"
                             update="@form:@parent:inspections-form
                             @form:@parent:inspections-growl-form"/>
        </h:form>
        <p:spacer height="5px" />

        <h:form id="space-element-accordion-form">
            <p:accordionPanel id="element-accordion"
                              value="#{occInspectionsBB.selectedInspectedSpace.inspectedElementGroupList}" 
                              var="elegrp" multiple="true"
                              >
                <p:ajax/>
                <p:tab title="#{elegrp.groupTitle}"
                       >
                    <p:repeat   id="elements-repeat"
                                value="#{elegrp.elementList}" 
                                var="spaceElement"
                                varStatus="eleStatus">
                        <div class="p-grid nested-grid">
                            <div class="p-col-8">
                                <div class="p-grid">
                                    <div class="p-col-12">
                                        <h2>
                                            <h:outputText value="#{spaceElement.headerString}"
                                                          escape="false" />
                                        </h2>
                                    </div>

                                    <div class="p-col-4">
                                        <p:commandLink     id="spaceelement-vieword-cl"
                                                           ajax="true"
                                                           type="button"
                                                           style="color:blue;"
                                                           actionListener="#{occInspectionsBB.onSpaceElementViewLinkClick(spaceElement)}"
                                                           update="codeelement-fulltext-dialog"
                                                           oncomplete="PF('codeelement-fulltext-dialog-var').show();"
                                                           value="ordinance text"/>

                                        <h:outputText value=" | " />

                                        <p:commandLink     id="spaceelement-viewmeta"
                                                           ajax="true"
                                                           type="button"
                                                           style="color:blue;"
                                                           actionListener="#{occInspectionsBB.onSpaceElementViewLinkClick(spaceElement)}"
                                                           update="codeelement-metadata-dialog"
                                                           oncomplete="PF('codeelement-metadata-dialog-var').show();"
                                                           value="element info"/>

                                    </div>
                                    <div class="p-col-8">
                                        <div class="p-grid">
                                            <div class="p-col-12>">

                                                <p:selectOneButton id="inspections-entryscreen-statussel" 
                                                                   value="#{spaceElement.statusEnum}" 
                                                                   unselectable="false"
                                                                   >
                                                    <!-- Strangely this element needs to update itself to call the setter -->
                                                    <p:ajax listener="#{occInspectionsBB.onElementInspectionStatusButtonChange(spaceElement)}" />
                                                    <p:ajax update="inspections-entryscreen-statussel"/>
                                                    <!--<p:ajax update="@form:element-accordion"/>-->
                                                    <p:ajax update="@form:@parent:inspections-growl-form"/>
                                                    <p:ajax update="@form"/>
                                                    <f:selectItems value="#{occInspectionsBB.statuses}" 
                                                                   var="status" 
                                                                   itemLabel="#{status.label}"/>
                                                </p:selectOneButton>
                                            </div>
                                            <div class="p-col-12>">
                                                <p:selectBooleanCheckbox    id="insp-ele-excludefromnov-cb"
                                                                            itemLabel="Include in code enf. case"
                                                                            rendered="#{(!empty spaceElement.lastInspectedTS) and (empty spaceElement.complianceGrantedTS)}"
                                                                            value="#{spaceElement.migrateToCaseOnFail}"/>
                                                <p:spacer height="5px" />
                                                <p>
                                                    <h:outputText id="inspectedby-user"
                                                                  value="Inspected by: #{spaceElement.lastInspectedBy.human.name}" 
                                                                  rendered="#{!empty spaceElement.lastInspectedBy}"/>
                                                    <p:spacer height="2px" />
                                                    <h:outputText id="inspectedby-ts"
                                                                  value="on #{occInspectionsBB.getPrettyDate(spaceElement.lastInspectedTS)}" 
                                                                  rendered="#{!empty spaceElement.lastInspectedTS}"/>
                                                    <p:spacer height="2px" />
                                                    <h:outputText id="inspectedby-failed"
                                                                  value="Violated" 
                                                                  rendered="#{!empty spaceElement.lastInspectedTS and empty spaceElement.complianceGrantedTS}"/>
                                                    <p:spacer height="2px" />
                                                    <h:outputText id="inspectedby-comp-user"
                                                                  value="Compliance granted by: #{spaceElement.complianceGrantedBy.human.name}" 
                                                                  rendered="#{!empty spaceElement.complianceGrantedBy}"/>
                                                    <p:spacer height="2px" />
                                                    <h:outputText id="inspectedby-comp-ts"
                                                                  value="on #{occInspectionsBB.getPrettyDate(spaceElement.complianceGrantedTS)}" 
                                                                  rendered="#{!empty spaceElement.complianceGrantedTS}"/>

                                                </p>
                                            </div>
                                            <div class="p-col-12">

                                                <p:outputLabel  for="fail-severity-som"
                                                                rendered="#{!empty spaceElement.lastInspectedTS and empty spaceElement.complianceGrantedTS}">
                                                    <h:outputText value="Violation severity" />
                                                </p:outputLabel>

                                                <h:selectOneMenu id="fail-severity-som"
                                                                 value="#{spaceElement.faillureSeverity}" 
                                                                 rendered="#{!empty spaceElement.lastInspectedTS and empty spaceElement.complianceGrantedTS}">
                                                    <f:converter converterId="intensityClassConverter"/>

                                                    <f:selectItem itemLabel="select a severity" 
                                                                  noSelectionOption="true" />

                                                    <f:selectItems id="fail-severity-selitems"
                                                                   value="#{occInspectionsBB.failSeverityList}"
                                                                   var="ic" itemValue="#{ic}" 
                                                                   itemLabel="#{ic.numericRating}: #{ic.title}"/>

                                                </h:selectOneMenu>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-col-4">
                                <div class="p-grid">
                                    <div class="p-col-12">
                                        <p class="p-mb-0">Findings:</p>
                                        <p:inputTextarea    id="element-findings"
                                                            value="#{spaceElement.inspectionNotes}"
                                                            rows="6" cols="33"/>

                                    </div>
                                    <div class="p-col-12">

                                        <p:commandLink  id="oise-uploadphotos-cl"
                                                        ajax="true"
                                                        style="color:blue;"
                                                        oncomplete="PF('blob-upload-dialog-var').show()"
                                                        rendered="true"
                                                        update="@form:@parent:@parent:blob-upload-dialog
                                                        "
                                                        value="Add Photos"
                                                        actionListener="#{occInspectionsBB.onManageBlobsOnInspectedElement(spaceElement)}">

                                        </p:commandLink>

                                        <h:outputText value=" | " />

                                        <p:commandLink  id="oise-viewphotos-cl"
                                                        ajax="true"
                                                        style="color:blue;"
                                                        oncomplete="PF('blobs-gallery-dialog-var').show()"
                                                        rendered="true"
                                                        update="@form:@parent:@parent:blobs-gallery-dialog
                                                        "
                                                        value="View photos (#{spaceElement.blobList.size()})"
                                                        actionListener="#{occInspectionsBB.onManageBlobsOnInspectedElement(spaceElement)}">

                                        </p:commandLink>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <p:separator />
                    </p:repeat>
                </p:tab>
            </p:accordionPanel>
        </h:form>

    </p:dialog>


    <p:confirmDialog    id="confirmdialog-global"
                        global="true">
        <h:form id="confirm-global-form">
            
            <p:commandButton value="Yes"
                             type="button"
                             styleClass="ui-confirmdialog-yes"
                             icon="ui-icon-check" />
            <p:commandButton value="No"
                             type="button"
                             styleClass="ui-confirmdialog-no"
                             icon="ui-icon-check" />
        </h:form>
    </p:confirmDialog>


    <p:dialog id="codeelement-fulltext-dialog"
              widgetVar="codeelement-fulltext-dialog-var"
              header="Full ordinance text"
              closable="true"
              closeOnEscape="true"
              dynamic="true"
              modal="true"
              height="400"
              width="500"
              resizable="true"
              responsive="true">

        <h:form id="codeelement-fulltext-form">

            <h2>
                <h:outputText value="ch. #{occInspectionsBB.selectedSpaceElement.ordchapterNo}: #{occInspectionsBB.selectedSpaceElement.ordchapterTitle}" />
            </h2>
            <h3>
                <h:outputText value="#{occInspectionsBB.selectedSpaceElement.ordSecNum}:#{occInspectionsBB.selectedSpaceElement.ordSecTitle}" />
            </h3>
            <h3>
                <h:outputText value="#{occInspectionsBB.selectedSpaceElement.ordSubSecNum} #{occInspectionsBB.selectedSpaceElement.ordSubSecTitle}" 
                              rendered="#{!empty occInspectionsBB.selectedSpaceElement.ordSubSecNum}"/>

                <h:outputText value=" | " />
                <h:outputText value="#{occInspectionsBB.selectedSpaceElement.ordSubSubSecNum} #{occInspectionsBB.selectedSpaceElement.ordSubSubSecNum}" 
                              rendered="#{!empty occInspectionsBB.selectedSpaceElement.ordSubSubSecNum}"/>
            </h3> 


            <h:outputText id="codeelement-fulltext-ot"
                          value="#{occInspectionsBB.selectedSpaceElement.ordTechnicalText}" 
                          escape="false"/>

            <h3>Inspection tips</h3>
            <h:outputText id="codeelement-inspectiontips-ot"
                          value="#{occInspectionsBB.selectedSpaceElement.guideEntry.inspectionGuidelines}" 
                          escape="false"/>

        </h:form>




    </p:dialog>

    <p:dialog id="codeelement-metadata-dialog"
              header="Occ Inspected Space Element Metadata"
              widgetVar="codeelement-metadata-dialog-var"
              closable="true"
              closeOnEscape="true"
              dynamic="true"
              modal="true"
              height="400"
              width="500"
              resizable="true"
              responsive="true">

        <h2>
            <h:outputText value="ch. #{occInspectionsBB.selectedSpaceElement.ordchapterNo}: #{occInspectionsBB.selectedSpaceElement.ordchapterTitle}" />
        </h2>
        <h3>
            <h:outputText value="#{occInspectionsBB.selectedSpaceElement.ordSecNum}:#{occInspectionsBB.selectedSpaceElement.ordSecTitle}" />
        </h3>
        <h3>
            <h:outputText value="#{occInspectionsBB.selectedSpaceElement.ordSubSecNum} #{occInspectionsBB.selectedSpaceElement.ordSubSecTitle}" 
                          rendered="#{!empty occInspectionsBB.selectedSpaceElement.ordSubSecNum}"/>

            <h:outputText value=" | " />
            <h:outputText value="#{occInspectionsBB.selectedSpaceElement.ordSubSubSecNum} #{occInspectionsBB.selectedSpaceElement.ordSubSubSecNum}" 
                          rendered="#{!empty occInspectionsBB.selectedSpaceElement.ordSubSubSecNum}"/>
        </h3> 


        <h:outputText value="Inspected space element ID: #{occInspectionsBB.selectedSpaceElement.inspectedSpaceElementID}" />
        <p:spacer height="3px" />

        <h:outputText value="Inspected space ID: #{occInspectionsBB.selectedSpaceElement.inspectedSpaceID}" />
        <p:spacer height="3px" />

        <h:outputText value="occChecklist Space Type Element ID: #{occInspectionsBB.selectedSpaceElement.occChecklistSpaceTypeElementID}" />
        <p:spacer height="3px" />

        <h:outputText value="Code set element ID: #{occInspectionsBB.selectedSpaceElement.codeSetElementID}" />
        <p:spacer height="3px" />

        <h:outputText value="Code Element ID: #{occInspectionsBB.selectedSpaceElement.elementID}" />
        <p:spacer height="3px" />



    </p:dialog>


    <p:dialog id="inspection-finalize-dialog"
              widgetVar="inspection-finalize-dialog-var"
              header="Finalize inspection ID: #{occInspectionsBB.selectedInspection.inspectionID}"
              closable="true"
              closeOnEscape="true"
              dynamic="true"
              modal="true"
              height="400"
              width="500"
              resizable="true"
              responsive="true">

        <h:form id="inspection-finalize-form">

            <p:spacer height="5px" />

            <p:selectOneMenu rendered="true"
                             value="#{occInspectionsBB.selectedDetermination}"
                             converter="occInspectionDeterminationConverter">
                <f:selectItem noSelectionOption="true"
                              itemDisabled="true"
                              itemLabel="choose a determination" />
                <f:selectItems value="#{occInspectionsBB.determinationList}" 
                               var="det"
                               itemLabel="#{det.title}"
                               itemValue="#{det}"/>
                <p:ajax update="inspection-finalize-commit-cb" />
            </p:selectOneMenu>

            <p:spacer height="5px" />

            <p:commandButton   id="inspection-finalize-commit-cb"
                               value="Finalzie and lock inspection ID:#{ins.inspectionID} with selected determination"
                               rendered="#{(systemServicesBB.bbSessionUser.userID eq ins.inspector.userID) or systemServicesBB.bbSessionUser.keyCard.hasSysAdminPermissions}"
                               icon="fa fa-check-square "
                               disabled="false"
                               actionListener="#{occInspectionsBB.onCertifyInspectionCommitButtonChange}"
                               update="@form:@parent:inspections-form
                               @form:@parent:inspections-growl-form" 
                               oncomplete="PF('inspection-finalize-dialog-var').hide();"
                               style="margin-right: 5px;"/>

            <p:commandButton value="Cancel"
                             icon="pi pi-times"
                             process="@none"
                             immediate="true"
                             class="ui-button-outlined p-mr-1"
                             oncomplete="PF('inspection-finalize-dialog-var').hide();"/>

        </h:form>

    </p:dialog>



    <p:dialog id="inspection-reportconfig-dialog"
              widgetVar="inspection-reportconfig-dialog-var"
              header="Configure report of field inspection ID: #{occInspectionsBB.selectedInspection.inspectionID}"
              closable="true"
              closeOnEscape="true"
              dynamic="true"
              modal="true"
              height="600"
              width="600"
              resizable="true"
              responsive="true">

        <h:form id="inspection-reportconfig-form">


            <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">
                <div class="restrict-main-contents-io-link">

                    <p:commandLink  ajax="false" 
                                    action="#{occInspectionsBB.onFieldInspectionReportCommitLinkClick}"
                                    value="Click to generate inspection report in new tab" 
                                    target="_blank"
                                    style="font-size:5em;"
                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                    />
                </div>
                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">
                    <div class="ui-button gray_button">

                        <p:commandButton ajax="true" 
                                         value="Cancel" icon="fa fa-stop" immediate="true"
                                         onclick="PF('inspection-reportconfig-dialog-var').hide()"/>

                    </div>
                </div>
            </div>



            <h2>Report Settings: Include...</h2>
            <div class="p-grid">

                <div class="p-col-6">
                    Parent Object info (Occ Period or CECase)
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{occInspectionsBB.inspectionReportConfig.includeOccPeriodInfoHeader}" />
                </div>
                <div class="p-col-6">
                    Photos on passed items
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{occInspectionsBB.inspectionReportConfig.includePhotos_pass}" />
                </div>
                <div class="p-col-6">
                    Photos on violated items
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{occInspectionsBB.inspectionReportConfig.includePhotos_fail}" />
                </div>
                <div class="p-col-6">
                    Full ordinance text
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{occInspectionsBB.inspectionReportConfig.includeFullOrdText}" />
                </div>
                <div class="p-col-6">
                    Item notes 
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{occInspectionsBB.inspectionReportConfig.includeElementNotes}" />
                </div>
                <div class="p-col-6">
                    Inspection timestamp by item
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{occInspectionsBB.inspectionReportConfig.includeElementLastInspectedInfo}" />
                </div>
                <div class="p-col-6">
                    Compliance granted timestamp by item
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{occInspectionsBB.inspectionReportConfig.includeElementComplianceInfo}" />
                </div>
                <div class="p-col-6">
                    Inspector signature
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{occInspectionsBB.inspectionReportConfig.includeSignature}" 
                                             disabled="true"/>
                </div>
                <div class="p-col-6">
                    Remedy info
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{occInspectionsBB.inspectionReportConfig.includeRemedyInfo}" 
                                             disabled="true"/>
                </div>
            </div>



            <p:spacer height="5px" />


        </h:form>

    </p:dialog>

</ui:composition>