<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns="http://www.w3.org/1999/xhtml">

    <ui:include src="/restricted/cogstaff/compositions/textBlockTools.xhtml" />

    <!--growl-->
    <h:form id="permits-growl-form">
        <p:growl id="permits-growl" />
    </h:form>



    <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()"/>

    <p:dialog widgetVar="statusDialog" 
              modal="true"
              height="100px"
              width="250px"
              draggable="false" 
              closable="false" 
              resizable="false" 
              showHeader="false">
        <div class="p-text-center">
            <h:outputText value="Stand by...crunching....crunching" />
        </div>
    </p:dialog>


    <!--panel:root permit list table-->
    <p:panel id="occperiod-permits-panel"
             toggleable="true"
             widgetVar="occperiod-permits-panel-var"
             collapsed="false"
             header="Permits">


        <h:form id="occperiod-permits-form">
            <p:commandButton id="occperiod-permits-button-newpermit"
                             value="Configure new permit"
                             ajax="true"
                             actionListener="#{occPeriodBB.onOccPermitInitButtonChange}"
                             oncomplete="PF('permit-add-choosetype-dialog-var').show();"
                             disabled="false"
                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                             icon="fa fa-plus"
                             update="permit-add-choosetype-form
                             @form"/>

            <p:commandLink  id="permits-manage-blocks-cl" 
                            ajax="true"
                            actionListener="#{textBlockBB.onManageBlocksInit}"
                            value="manage text block templates"
                            style="color:blue; font-weight: bold; margin-left: 10px;"
                            oncomplete="PF('nov-templatemanage-dialog-var').show();"
                            update="nov-template-select-form"
                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"/>

            <p:spacer height="5px"/>

            <p:dataTable id="occperiod-permits-datatable"
                         var="permit"
                         rowKey="#{permit.permitID}"
                         value="#{occPeriodBB.currentOccPeriod.permitList}"
                         tableStyleClass="primeDataTable"
                         draggableColumns="true"
                         resizableColumns="true">

                <p:column width="15%">
                    <f:facet name="header">
                        <h:outputText value="Type"/>
                    </f:facet>

                    <h:outputText value="#{permit.permitType.title}"/>
                    <p:spacer height="3px" />
                    <h:outputText value="Expires: #{permit.permitType.expires ? 'Yes' : 'No'}" />
                </p:column>

                <p:column width="20%">
                    <f:facet name="header">
                        <h:outputText value="Reference no. and Internal ID"/>
                    </f:facet>

                    <h:outputText value="#{permit.referenceNo}"
                                  rendered="#{!empty permit.referenceNo}"
                                  styleClass="occpermit-referencenointable"
                                  />
                    <p:spacer height="2px" />
                    <h:outputText value="#{permit.permitID}"/>

                </p:column>

                <p:column width="30%">
                    <f:facet name="header">
                        <h:outputText value="Status"/>
                    </f:facet>
                    <h:outputText value="#{empty permit.finalizedts ? 'draft only (not issued)':'Finalized at ' }"/>
                    <h:outputText value="#{empty permit.finalizedts ? '': occPeriodBB.getPrettyDateNoTime(permit.finalizedts) }"
                                  styleClass="occpermit-finalizedintable" />
                    <h:outputText value="#{empty permit.finalizedBy ? '':' by ' }"
                                  styleClass="occpermit-finalizedintable" />
                    <h:outputText value="#{empty permit.finalizedBy ? '': permit.finalizedBy.human.name }"
                                  styleClass="occpermit-finalizedintable" />
                    <p:spacer height="3px" />
                    <h:outputText value="#{empty permit.finalizedts ? '': 'Date of Issuance:' }"/>
                    <h:outputText value="#{empty permit.finalizedts ? '': occPeriodBB.getPrettyDateNoTime(permit.staticdateofissue) }"/>
                    <p:spacer height="3px" />
                    <h:outputText value="Nullified at "
                                  rendered="#{!empty permit.nullifiedTS}"
                                  style="color:darkred;"/>

                    <h:outputText value="#{occPeriodBB.getPrettyDateNoTime(permit.nullifiedTS)}"
                                  rendered="#{!empty permit.nullifiedTS}"
                                  style="color:darkred;"/>

                    <h:outputText value=" by "
                                  rendered="#{!empty permit.nullifiedTS}"
                                  style="color:darkred;"/>

                    <h:outputText value="#{permit.nullifiedBy.human.name}"
                                  rendered="#{!empty permit.nullifiedTS}"
                                  style="color:darkred;"/>
                </p:column>

                <p:column width="20%">
                    <f:facet name="header">
                        <h:outputText value="Actions"/>
                    </f:facet>


                    <p:commandLink  id="permit-config-init-cl" 
                                    ajax="true"
                                    actionListener="#{occPeriodBB.onOccpermitViewConfigLinkClick(permit)}"
                                    value="configure"
                                    disabled="#{(!empty permit.nullifiedTS) or (!empty permit.deactivatedTS) or(!empty permit.finalizedts)}"
                                    style="color:blue; font-weight: bold;"
                                    oncomplete="PF('occperiod-createpermit-occpermit-var').show();"
                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"/>

                    <p:spacer height="5px" />

                    <p:commandLink  id="permit-viewdraft-cl" 
                                    ajax="true"
                                    actionListener="#{occPeriodBB.onOccpermitViewConfigLinkClick(permit)}"
                                    value="#{empty permit.finalizedts ? 'view draft and finalize':'permit values'}"
                                    style="color:blue; font-weight: bold;"
                                    oncomplete="PF('permit-draft-dialog-var').show();"
                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"/>

                    <p:spacer height="5px" />

                    <p:commandLink  id="permit-print-cl" 
                                    ajax="false"
                                    action="#{occPeriodBB.onOccPermitPrintLinkClick(permit)}"
                                    value="print official permit"
                                    target="_blank"
                                    style="color:blue; font-weight: bold;"
                                    disabled="#{(!empty permit.nullifiedTS) or (!empty permit.deactivatedTS) or(empty permit.finalizedts)}"
                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"/>

                    <p:spacer height="5px" />

                    <p:commandLink  id="permit-nullify-init-cl" 
                                    ajax="true"
                                    action="#{occPeriodBB.onOccPermitNullifyInitLinkClick(permit)}"
                                    value="#{empty permit.nullifiedTS ? 'nullify permit':'already nullified'}"
                                    style="color:blue; font-weight: bold;"
                                    disabled="#{!empty permit.nullifiedTS}"
                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions and (!empty permit.finalizedts)}"
                                    update="permits-growl-form
                                    permit-nullify-form"
                                    oncomplete="PF('permit-nullify-confirm-dialog-var').show();"/>

                    <p:spacer height="5px" />
                    <h:outputText value="(ID: #{permit.permitID})" />
                </p:column>
            </p:dataTable>
        </h:form>
    </p:panel>

    <p:dialog id="permit-add-choosetype-dialog"
              widgetVar="permit-add-choosetype-dialog-var"
              header="Choose permit type"
              closable="true"
              closeOnEscape="true">

        <h:form id="permit-add-choosetype-form">

            <p:commandButton id="permit-add-commit-button"
                             ajax="true"
                             actionListener="#{occPeriodBB.onOccPermitInitCommitButtonChange}"
                             value="Initialize permit of selected type" 
                             icon="fa fa-plus"
                             oncomplete="   PF('permit-add-choosetype-dialog-var').hide();
                             PF('occperiod-createpermit-occpermit-var').show();"
                             update="occperiod-createpermit-occpermit-form"/>

            <p:spacer height="3px" />

            <div class="p-grid" >
                <div class="p-col-4">
                    <h:outputLabel styleClass="ui-label" 
                                   for="som-occperiodtype" 
                                   value="Permit type" />
                </div>
                <div class="p-col-8">


                    <p:selectOneMenu
                        id="som-occperiodtype" 
                        tabindex="1" 
                        required="true"
                        style="width: 100%;"
                        validatorMessage="An occ permit type is required to start the permit process."
                        value="#{occPeriodBB.currentOccPermit.permitType}" >

                        <f:converter converterId="occPeriodTypeConverter"/>
                        <f:selectItem itemLabel="Select a permit type..." itemDisabled="true" noSelectionOption="true"/>
                        <f:selectItems id="si-typelist"
                                       value="#{occPeriodBB.permitTypeCandidateList}"
                                       var ="opt"
                                       itemValue="#{opt}"
                                       itemLabel="#{opt.title} (Temporary:#{opt.expires ? 'Yes':'No'})" />
                    </p:selectOneMenu>
                </div>
            </div>
        </h:form>
    </p:dialog>

    <!--p:dialog|permit-nullify-confirm-dialog-->
    <p:dialog id="permit-nullify-confirm-dialog"
              widgetVar="permit-nullify-confirm-dialog-var"
              header="Confirm Permit Nullification"
              closable="true"
              closeOnEscape="true">

        <h:form id="permit-nullify-form">

            <p>Nullification occurs AFTER permit finalization but BEFORE distribution <br /> and marks that a
                permit was inaccurate and SHALL NEVER be distributed to a property owner. <br /> This 
                action will be logged with an automatically generated event in this file's log.</p>
            <p:spacer height="3px" />
            <p:commandButton  id="permit-nullify-commit-cl" 
                              ajax="true"
                              actionListener="#{occPeriodBB.onOccPermitNullifyCommitLinkClick}"
                              value="Commit nullification of permit #{occPeriodBB.currentOccPermit.permitID}"
                              icon="fa fa-trash"
                              disabled="#{!empty permit.finalizedts}"
                              rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                              update="permits-growl-form
                              occperiod-permits-form"
                              oncomplete="PF('permit-nullify-confirm-dialog-var').hide();"/>

        </h:form>
    </p:dialog>

    <!-- p:dialog|dynamic configuration -->
    <p:dialog id="occperiod-createpermit-occpermit-dialog"
              height="750" width="1200"
              widgetVar="occperiod-createpermit-occpermit-var"
              closable="true"
              closeOnEscape="true"
              modal="true"
              dynamic="true"
              header="Configure occupancy permit"
              rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}">

        <h:form id="occperiod-createpermit-occpermit-form">
            <div class="p-grid">
                <div class="p-col-6 nested-grid">
                    <p:panel id="permit-tools-panel"
                             header="Permit Toolbox">

                        <p:commandButton id="occperiod-createpermit-occpermit-button-generate"
                                         ajax="true"
                                         actionListener="#{occPeriodBB.onOccPermitGenerateStaticFields}"
                                         value="Generate draft permit" icon="fa fa-plus"
                                         disabled="false"
                                         oncomplete="PF('occperiod-createpermit-occpermit-var').hide; PF('permit-draft-dialog-var').show();"
                                         update="permits-growl-form
                                         permit-draft-dialog
                                         permit-draft-form"
                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"/>


                        <p:commandLink  id="permit-deactivate-init-cl" 
                                        ajax="true"
                                        actionListener="#{occPeriodBB.onOccPermitDeactivateInit}"
                                        value="deactivate permit draft"
                                        style="color:blue; font-weight: bold; display: inline-block; margin-left:15px;"
                                        disabled="#{(!empty permit.finalizedts) or (!empty permit.nullifiedTS)}"
                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                        update="permits-growl-form
                                        @form:@parent:permit-deactivate-form"
                                        oncomplete="PF('permit-deactivate-confirm-dialog-var').show();"/>
                    </p:panel>

                    <p:panel id="permit-metadata-panel"
                             header="Permit Settings: Metadata">
                        <div class="p-grid">
                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Internal ID" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <h:outputText value="#{occPeriodBB.currentOccPermit.permitID}" />
                            </div>
                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Period ID" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <h:outputText value="#{occPeriodBB.currentOccPermit.periodID}" />
                            </div>
                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Permit type" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <h:outputText value="#{occPeriodBB.currentOccPermit.permitType.title}"
                                              rendered="#{!empty occPeriodBB.currentOccPermit.permitType}" />
                            </div>
                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Issuing officer" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <p:selectOneMenu rendered="true"
                                                 value="#{occPeriodBB.currentOccPermit.issuingOfficer}"
                                                 filter="true"
                                                 filterMatchMode="contains"
                                                 required="true"
                                                 converter="userConverter">
                                    <f:selectItems value="#{systemServicesBB.bbSessionMuni.swornOfficerList}" 
                                                   var="user"
                                                   itemLabel="#{user.human.name} (#{user.username})"
                                                   itemValue="#{user}"/>
                                </p:selectOneMenu>
                            </div>

                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Issuing code source(s)" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <p:selectManyMenu 
                                    id="occpermit-codesource-som" 
                                    style="width: 100%"
                                    showCheckbox="true"
                                    scrollHeight="120"
                                    metaKeySelection="false"
                                    required="false"
                                    validatorMessage="At least one code source is required for permit issuance"
                                    value="#{occPeriodBB.currentOccPermit.issuingCodeSourceList}">
                                    <f:selectItems value="#{codeSetBB.codeSourceList}" 
                                                   var="source" itemLabel="#{source.sourceName} (#{source.sourceYear})"/>
                                    <f:converter converterId="codeSourceConverter" />
                                </p:selectManyMenu>
                            </div>
                        </div>
                    </p:panel>

                    <p:panel id="permit-dates-panel"
                             header="Permit Settings: Dates">
                        <div class="p-grid">
                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Date of application" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <p:datePicker 	id="occpermit-dynamic-date-application"
                                               rendered="true"
                                               value="#{occPeriodBB.currentOccPermit.dynamicDateOfApplication}" 
                                               style="width: 100%;"
                                               pattern="MM/dd/yyyy HH:mm"
                                               disabled="false"
                                               showButtonBar="true"
                                               hideOnDateTimeSelect="true"
                                               showOnFocus="false"
                                               showIcon="true"
                                               mask="true"
                                               timeInput="true" 
                                               required="false" />    

                                <p:spacer height="3px" />

                                <h:outputText value="#{!empty occPeriodBB.currentOccPermit.dynamicsDateOfApplicationAppRef ? 'pre-populated based on most recent permit':'cNf found 0 permit applications'}" />

                                <p:spacer height="3px" />

                                <h:outputText value="Application ID:#{occPeriodBB.currentOccPermit.dynamicsDateOfApplicationAppRef.id}"
                                              rendered="#{!empty occPeriodBB.currentOccPermit.dynamicsDateOfApplicationAppRef}" />
                            </div>

                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Date of initial inspection" />

                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <p:datePicker 	id="occpermit-dynamic-date-initial"
                                               rendered="true"
                                               value="#{occPeriodBB.currentOccPermit.dynamicInitialInspection}" 
                                               style="width: 100%;"
                                               pattern="MM/dd/yyyy HH:mm"
                                               disabled="false"
                                               showButtonBar="true"
                                               hideOnDateTimeSelect="true"
                                               showOnFocus="false"
                                               showIcon="true"
                                               mask="true"
                                               timeInput="true" 
                                               required="false" />    

                                <p:spacer height="3px" />

                                <h:outputText value="#{!empty occPeriodBB.currentOccPermit.dynamicInitialInspection ? 'pre-populated':'cNf unable to allocate field inspection'}" />

                                <p:spacer height="3px" />

                                <h:outputText value="Inspection ID:#{occPeriodBB.currentOccPermit.dynamicInitialInspectionFINRef.inspectionID}"
                                              rendered="#{!empty occPeriodBB.currentOccPermit.dynamicInitialInspectionFINRef}" />


                                <h:outputText value=" by inspector: #{occPeriodBB.currentOccPermit.dynamicInitialInspectionFINRef.inspector.human.name}"
                                              rendered="#{!empty occPeriodBB.currentOccPermit.dynamicInitialInspectionFINRef.inspector}" />

                            </div>


                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Date of reinspection" />

                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <p:datePicker 	id="occpermit-dynamic-date-reinspection"
                                               rendered="true"
                                               value="#{occPeriodBB.currentOccPermit.dynamicreinspectiondate}" 
                                               style="width: 100%;"
                                               pattern="MM/dd/yyyy HH:mm"
                                               disabled="false"
                                               showButtonBar="true"
                                               hideOnDateTimeSelect="true"
                                               showOnFocus="false"
                                               showIcon="true"
                                               mask="true"
                                               timeInput="true" 
                                               required="false" />    

                                <p:spacer height="3px" />

                                <h:outputText value="#{!empty occPeriodBB.currentOccPermit.dynamicReInspectionFINRef ? 'pre-populated':'cNf unable to allocate field inspection'}" />

                                <p:spacer height="3px" />

                                <h:outputText value="Inspection ID:#{occPeriodBB.currentOccPermit.dynamicReInspectionFINRef.inspectionID}"
                                              rendered="#{!empty occPeriodBB.currentOccPermit.dynamicReInspectionFINRef}" />

                                <h:outputText value=" by inspector: #{occPeriodBB.currentOccPermit.dynamicReInspectionFINRef.inspector.human.name}"
                                              rendered="#{!empty occPeriodBB.currentOccPermit.dynamicReInspectionFINRef.inspector}" />

                            </div>

                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Date of final inspection" />

                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <p:datePicker 	id="occpermit-dynamic-date-final"
                                               rendered="true"
                                               value="#{occPeriodBB.currentOccPermit.dynamicfinalinspection}" 
                                               style="width: 100%;"
                                               pattern="MM/dd/yyyy HH:mm"
                                               disabled="false"
                                               showButtonBar="true"
                                               hideOnDateTimeSelect="true"
                                               showOnFocus="false"
                                               showIcon="true"
                                               mask="true"
                                               timeInput="true" 
                                               required="false" />    

                                <p:spacer height="3px" />

                                <h:outputText value="#{!empty occPeriodBB.currentOccPermit.dynamicfinalinspection ? 'pre-populated':'cNf unable to allocate field inspection'}" />

                                <p:spacer height="3px" />

                                <h:outputText value="Inspection ID:#{occPeriodBB.currentOccPermit.dynamicFinalInspectionFINRef.inspectionID}"
                                              rendered="#{!empty occPeriodBB.currentOccPermit.dynamicFinalInspectionFINRef}" />

                                <h:outputText value="by inspector: #{occPeriodBB.currentOccPermit.dynamicFinalInspectionFINRef.inspector.human.name}"
                                              rendered="#{!empty occPeriodBB.currentOccPermit.dynamicFinalInspectionFINRef}" />
                            </div>

                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Date of issuance" />

                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <p:datePicker 	id="occpermit-dynamic-date-issuance"
                                               rendered="true"
                                               value="#{occPeriodBB.currentOccPermit.dynamicdateofissue}" 
                                               style="width: 100%;"
                                               pattern="MM/dd/yyyy HH:mm"
                                               disabled="false"
                                               showButtonBar="true"
                                               hideOnDateTimeSelect="true"
                                               showOnFocus="false"
                                               showIcon="true"
                                               mask="true"
                                               timeInput="true" 
                                               required="false" />    
                            </div>
                            <f:subview id="permit-config-expirydate-subiew"
                                       rendered="#{occPeriodBB.currentOccPermit.permitType.expires}">

                                <div class="p-col-4 restrict-data-field-label-inline">
                                    <h:outputText value="Date of Expiry" />

                                </div>
                                <div class="p-col-8 restrict-data-field-value-inline">
                                    <p:datePicker 	id="occpermit-dynamic-date-expiry"
                                                   rendered="true"
                                                   value="#{occPeriodBB.currentOccPermit.dynamicDateExpiry}" 
                                                   style="width: 100%;"
                                                   pattern="MM/dd/yyyy HH:mm"
                                                   disabled="false"
                                                   showButtonBar="true"
                                                   hideOnDateTimeSelect="true"
                                                   showOnFocus="false"
                                                   showIcon="true"
                                                   mask="true"
                                                   timeInput="true" 
                                                   required="false" />    
                                </div>
                            </f:subview>
                        </div>
                    </p:panel>

                    <p:panel id="permit-log-dynamicpopulation"
                             header="Automatic value injection log">
                        <h2>
                            <h:outputText id="permit-auditresult-ot"
                                          value="Audit results: #{!empty occPeriodBB.currentOccPermit.dynamicPopulationReadyForFinalizationTS ? 'Study log below and check all fields for accuracy':'Automated audit failed - cNf recommends NOT to issue permit '}" />
                        </h2>
                        <p:accordionPanel id="permit-log-dp-accpanel">
                            <p:tab id="tab-log"
                                   title="Dynamic generation log">
                                <h:outputText value="#{occPeriodBB.currentOccPermit.dynamicPopulationLog}"
                                              escape="false" />
                            </p:tab>
                        </p:accordionPanel>

                    </p:panel>
                </div>

                <div class="p-col-6 nested-grid">
                    <p:panel id="permit-property-panel"
                             header="Permit Settings: Property">
                        <div class="p-grid">
                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Parcel Info" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <h:outputText value="Info Bundle ID: #{occPeriodBB.currentOccPermit.parcelInfo.parcelInfoID}" />
                                <p:spacer height="3px" />
                                <h:outputText value="Attached to property: #{occPeriodBB.currentPropertyDH.address.addressPretty2LineEscapeFalse}"
                                              escape="false"/>
                                <h:outputText value="(ID: #{occPeriodBB.currentPropertyDH.parcelKey}" />
                                <p:spacer height="3px" />
                                <h:outputText value="Parcel ID: #{occPeriodBB.currentPropertyDH.countyParcelID}" />
                            </div>
                        </div>
                    </p:panel>

                    <p:panel id="permit-persons-panel"
                             header="Permit Settings: Persons">

                        <div class="p-grid">
                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Owner(s)/Seller(s)" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">

                                <p:commandLink id="permit-choosepersons-seller-init-cl"
                                               value="configure persons"
                                               actionListener="#{occPeriodBB.onOccPermitPersonLinkingInitButtonChange}"
                                               style="color:blue; font-weight: bold;"
                                               oncomplete="PF('permit-choosepersons-dialog-var').show()"
                                               update="permit-choosepersons-dialog
                                               permit-choosepersons-form
                                               permit-chosenpersons-form" >
                                    <f:param name="permit-person-list" value="CURRENT_OWNER" />
                                </p:commandLink>
                                <p:spacer height="3px" />
                                <ui:repeat id="permit-queuedpersons-sellers-uir"
                                           value="#{occPeriodBB.currentOccPermit.ownerSellerLinkList}"
                                           var="qp">

                                    <h:outputText value="#{qp.name}" />
                                    <p:spacer height="3px" />
                                </ui:repeat>
                            </div>

                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Buyer(s)/Tenant(s)" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">

                                <p:commandLink id="permit-choosepersons-buyer-init-cl"
                                               value="configure persons"
                                               actionListener="#{occPeriodBB.onOccPermitPersonLinkingInitButtonChange}"
                                               oncomplete="PF('permit-choosepersons-dialog-var').show()"
                                               style="color:blue; font-weight: bold;"
                                               update="permit-choosepersons-dialog
                                               permit-choosepersons-form
                                               permit-chosenpersons-form" >
                                    <f:param name="permit-person-list" value="NEW_OWNER" />
                                </p:commandLink>
                                <p:spacer height="3px" />
                                <ui:repeat id="permit-queuedpersons-buyers-uir"
                                           value="#{occPeriodBB.currentOccPermit.buyerTenantLinkList}"
                                           var="qp">

                                    <h:outputText value="#{qp.name}" />
                                    <p:spacer height="3px" />
                                </ui:repeat>
                            </div>

                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Manager(s)" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <p:commandLink id="permit-choosepersons-manager-init-cl"
                                               value="configure persons"
                                               actionListener="#{occPeriodBB.onOccPermitPersonLinkingInitButtonChange}"
                                               style="color:blue; font-weight: bold;"
                                               oncomplete="PF('permit-choosepersons-dialog-var').show()"
                                               update="permit-choosepersons-dialog
                                               permit-choosepersons-form
                                               permit-chosenpersons-form" >
                                    <f:param name="permit-person-list" value="MANAGERS" />
                                </p:commandLink>
                                <p:spacer height="3px" />
                                <ui:repeat id="permit-queuedpersons-managers-uir"
                                           value="#{occPeriodBB.currentOccPermit.managerLinkList}"
                                           var="qp">
                                    <h:outputText value="#{qp.name}" />
                                    <p:spacer height="3px" />
                                </ui:repeat>

                            </div>
                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Tenant(s)" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">

                                <p:commandLink id="permit-choosepersons-tenants-init-cl"
                                               value="configure persons"
                                               actionListener="#{occPeriodBB.onOccPermitPersonLinkingInitButtonChange}"
                                               style="color:blue; font-weight: bold;"
                                               oncomplete="PF('permit-choosepersons-dialog-var').show()"
                                               update="permit-choosepersons-dialog
                                               permit-choosepersons-form
                                               permit-chosenpersons-form" >
                                    <f:param name="permit-person-list" value="TENANTS" />
                                </p:commandLink>
                                <p:spacer height="3px" />
                                <ui:repeat id="permit-queuedpersons-tenants-uir"
                                           value="#{occPeriodBB.currentOccPermit.tenantLinkList}"
                                           var="qp">
                                    <h:outputText value="#{qp.name}" />
                                    <p:spacer height="3px" />
                                </ui:repeat>
                            </div>
                        </div>
                    </p:panel>

                    <p:panel id="permit-textblocks-panel"
                             header="Permit Settings: Text Blocks and Custom Comments">

                        <!--grid-->
                        <div class="p-grid">
                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Prefabricated stipulations" />
                            </div>
                            <!--stip-->
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <p:commandLink id="permit-block-choose-stipulations-cl"
                                               actionListener="#{occPeriodBB.onOccPermitExtractBlockListEnumAndConfigureCandidatesLinkClick}"
                                               value="choose text blocks"
                                               style="color:blue; font-weight: bold;"
                                               update="permit-chooseblock-form
                                               permit-chooseblock-dialog"
                                               oncomplete="PF('permit-chooseblock-dialog-var').show();">
                                    <f:param name="permit-block-cat" value="STIPULATIONS" />
                                </p:commandLink>

                                <p:spacer height="5px" />

                                <h4>Selected Stipulation blocks</h4>
                                <ui:repeat  id="permit-selectedblocks-stipulations" 
                                            value="#{occPeriodBB.currentOccPermit.textBlocks_stipulations}"
                                            var="block">
                                    <h:outputText value="#{block.textBlockCategoryTitle}" />
                                    <h:outputText value=" | " />
                                    <h:outputText value="#{block.textBlockName}" />
                                    <h:outputText value=" | " />
                                    <p:commandLink id="permit-block-view-cl"
                                                   actionListener="#{occPeriodBB.onOccPermitViewTextBlock(block)}"
                                                   value="view"
                                                   style="color:blue; font-weight: bold;"
                                                   update="permit-viewblock-dialog
                                                   permit-viewblock-form"
                                                   oncomplete="PF('permit-viewblock-dialog-var').show()" />

                                    <h:outputText value=" | " />

                                    <p:commandLink id="permit-block-remove-cl"
                                                   actionListener="#{occPeriodBB.onOccPermitRemoveTextBlockFromQueue(block)}"
                                                   value="remove"
                                                   style="color:blue; font-weight: bold;"
                                                   update="@form" >
                                        <f:param name="permit-block-cat" value="STIPULATIONS" />
                                    </p:commandLink>
                                    <p:spacer height="3px" />
                                </ui:repeat>
                            </div>

                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Prefabricated notices" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <p:commandLink id="permit-block-choose-notices-cl"
                                               actionListener="#{occPeriodBB.onOccPermitExtractBlockListEnumAndConfigureCandidatesLinkClick}"
                                               value="choose text blocks"
                                               style="color:blue; font-weight: bold;"
                                               update="permit-chooseblock-form
                                               permit-chooseblock-dialog"
                                               oncomplete="PF('permit-chooseblock-dialog-var').show();">
                                    <f:param name="permit-block-cat" value="NOTICES" />
                                </p:commandLink>
                                <p:spacer height="5px" />
                                <h4>Selected Notice blocks</h4>
                                <ui:repeat  id="permit-selectedblocks-notices" 
                                            value="#{occPeriodBB.currentOccPermit.textBlocks_notice}"
                                            var="block">
                                    <h:outputText value="#{block.textBlockCategoryTitle}" />
                                    <h:outputText value=" | " />
                                    <h:outputText value="#{block.textBlockName}" />
                                    <h:outputText value=" | " />

                                    <p:commandLink id="permit-block-view-notices-cl"
                                                   actionListener="#{occPeriodBB.onOccPermitViewTextBlock(block)}"
                                                   value="view"
                                                   style="color:blue; font-weight: bold;"
                                                   update="permit-viewblock-dialog
                                                   permit-viewblock-form"
                                                   oncomplete="PF('permit-viewblock-dialog-var').show()" />

                                    <h:outputText value=" | " />

                                    <p:commandLink id="permit-block-remove-notices-cl"
                                                   actionListener="#{occPeriodBB.onOccPermitRemoveTextBlockFromQueue(block)}"
                                                   value="remove"
                                                   style="color:blue; font-weight: bold;"
                                                   update="@form" >
                                        <f:param name="permit-block-cat" value="NOTICES" />
                                    </p:commandLink>
                                    <p:spacer height="3px" />
                                </ui:repeat>
                            </div>

                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Prefabricated comments" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">

                                <p:commandLink id="permit-block-choose-comments-cl"
                                               actionListener="#{occPeriodBB.onOccPermitExtractBlockListEnumAndConfigureCandidatesLinkClick}"
                                               value="choose text blocks"
                                               style="color:blue; font-weight: bold;"
                                               update="permit-chooseblock-form
                                               permit-chooseblock-dialog" 
                                               oncomplete="PF('permit-chooseblock-dialog-var').show();">
                                    <f:param name="permit-block-cat" value="COMMENTS" />
                                </p:commandLink>
                                <p:spacer height="5px" />

                                <h4>Selected comment blocks</h4>

                                <ui:repeat  id="permit-selectedblocks-comments" 
                                            value="#{occPeriodBB.currentOccPermit.textBlocks_comments}"
                                            var="block">
                                    <h:outputText value="#{block.textBlockCategoryTitle}" />
                                    <h:outputText value=" | " />
                                    <h:outputText value="#{block.textBlockName}" />
                                    <h:outputText value=" | " />
                                    <p:commandLink id="permit-block-view-comments-cl"
                                                   actionListener="#{occPeriodBB.onOccPermitViewTextBlock(block)}"
                                                   value="view"
                                                   style="color:blue; font-weight: bold;"
                                                   update="permit-viewblock-dialog
                                                   permit-viewblock-form"
                                                   oncomplete="PF('permit-viewblock-dialog-var').show()" />

                                    <h:outputText value=" | " />

                                    <p:commandLink id="permit-block-remove-comments-cl"
                                                   actionListener="#{occPeriodBB.onOccPermitRemoveTextBlockFromQueue(block)}"
                                                   value="remove"
                                                   style="color:blue; font-weight: bold;"
                                                   update="@form" >
                                        <f:param name="permit-block-cat" value="COMMENTS" />
                                    </p:commandLink>
                                    <p:spacer height="3px" />
                                </ui:repeat>

                            </div>

                            <div class="p-col-4 restrict-data-field-label-inline">
                                <h:outputText value="Custom comments" />
                            </div>
                            <div class="p-col-8 restrict-data-field-value-inline">
                                <p:inputTextarea id="permit-customcomments-ita"
                                                 value="#{occPeriodBB.currentOccPermit.text_comments}"
                                                 rows="5"
                                                 cols="45" />
                            </div>


                        </div>
                    </p:panel>
                </div>
            </div>
        </h:form>
    </p:dialog>


    <!--p:dialog|permit-deactivate-->
    <p:confirmDialog id="permit-deactivate-confirm-dialog"
                     widgetVar="permit-deactivate-confirm-dialog-var"
                     header="Confirm permit deactivation"
                     closable="true"
                     closeOnEscape="true">

        <h:form id="permit-deactivate-form">

            <p>Deactivation occurs BEFORE permit finalization and therefore pertains 
                <br />only to non-numbered permit objects,  allowing you to start permit generation over. 
                <br />Also, this event is NOT logged on the permit file's event log. </p>

            <p:spacer height="3px" />

            <p:commandButton  id="permit-deactivate-commit-cl" 
                              ajax="true"
                              actionListener="#{occPeriodBB.onOccpermitDeactivateCommit}"
                              value="Commit deactivation of permit #{occPeriodBB.currentOccPermit.permitID}"
                              icon="fa fa-trash"
                              disabled="#{(!empty permit.finalizedts) or (!empty permit.nullifiedTS)}"
                              rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                              update="permits-growl-form
                              occperiod-permits-form"
                              oncomplete="PF('permit-deactivate-confirm-dialog-var').hide();
                              PF('occperiod-createpermit-occpermit-var').hide();"/>

        </h:form>
    </p:confirmDialog>
    <!--p:dialog|permit-choose text block-->
    <p:dialog id="permit-chooseblock-dialog"
              height="650" width="600"
              widgetVar="permit-chooseblock-dialog-var"
              closable="true"
              closeOnEscape="true"
              resizable="true"
              dynamic="true"
              modal="true"
              header="Choose text blocks for Occ Permit #{occPeriodBB.currentTextBlockPermitFieldEnum.label}"
              rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}">

        <h:form id="permit-chooseblock-form">

            <p:commandButton id="permit-chooseblocks-commit-cb"
                             actionListener="#{occPeriodBB.onOccPermitAddSelectedBlocksToPermit}"
                             update="occperiod-createpermit-occpermit-form
                             permits-growl-form"
                             ajax="true"
                             icon="fa fa-plus"
                             value="Add selected blocks to #{occPeriodBB.currentTextBlockPermitFieldEnum.label}"
                             oncomplete="PF('permit-chooseblock-dialog-var').hide();" />
            <p:spacer height="3px" />
            <div class="italic">
                (note: select multiple text blocks by holding down the Ctrl key and clicking the desired rows.)
            </div>
            <p:spacer height="3px" />


            <p:dataTable id="permit-blockchoice-table"
                         var="block"
                         value="#{occPeriodBB.permitBlocksActiveCandidateList}"
                         rowKey="#{block.blockID}"
                         selectionMode="multiple"
                         rowExpandMode="multiple"
                         scrollable="true"
                         draggableColumns="true"
                         resizableColumns="true"
                         selection="#{occPeriodBB.permitBlocksSelectedList}"
                         filteredValue="#{occPeriodBB.permitBlocksFilteredList}"
                         expandedRow="false"
                         widgetVar="permit-blockchoice-table-var">

                <p:column width="10%"
                          headerText="Expand">
                    <p:rowToggler />
                </p:column>

                <p:column width="30%"
                          filterBy="#{block.textBlockCategoryTitle}"
                          headerText="Category">
                    <h:outputText value="#{block.textBlockCategoryTitle}" />
                </p:column>

                <p:column width="30%"
                          headerText="Name">
                    <h:outputText value="#{block.textBlockName}" />
                </p:column>

                <p:column width="20%"
                          filterBy="#{block.muni.muniName}"
                          sortBy="#{block.muni.muniName}"
                          headerText="Muni">
                    <h:outputText value="#{block.muni.muniName}" />
                </p:column>

                <p:rowExpansion>
                    <div class="wrapText">

                        <h:outputText value="#{block.textBlockText}"
                                      styleClass="monospace" />
                    </div>
                </p:rowExpansion>

            </p:dataTable>
        </h:form>
    </p:dialog>

    <!--p:dialog|permit-view text block-->
    <p:dialog id="permit-viewblock-dialog"
              height="650" width="600"
              widgetVar="permit-viewblock-dialog-var"
              closable="true"
              closeOnEscape="true"
              resizable="true"
              modal="true"
              dynamic="true"
              header="View text block ID: #{occPeriodBB.currentTextBlock.blockID}"
              rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}">

        <h:form id="permit-viewblock-form">
            <h:outputText value="#{occPeriodBB.currentTextBlock.textBlockText}"
                          styleClass="monospace" />


        </h:form>

    </p:dialog>

    <!--p:dialog|chooseperson-->
    <p:dialog id="permit-choosepersons-dialog"
              height="700" width="1000"
              widgetVar="permit-choosepersons-dialog-var"
              closable="true"
              closeOnEscape="true"
              resizable="true"
              modal="true"
              dynamic="true"
              header="Connect persons to Occ Permit"
              rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}">




        <div class="p-grid">
            <div class="p-col-12">
                <h:form id="persons-done-form">

                    <p:commandButton id="permit-donewithpersons-cb"
                                     actionListener="#{occPeriodBB.onOccPermitDoneWithPersonsSelection}"
                                     ajax="true"
                                     update="permits-growl-form"
                                     icon="fa fa-check"
                                     value="Done!"
                                     oncomplete="PF('permit-choosepersons-dialog-var').hide();" />
                </h:form>

            </div>
            <div class="p-col-6">
                <h:form id="permit-choosepersons-form">
                    <p:dataTable    id="permit-personlinks-candidate-table"
                                    value="#{occPeriodBB.occPermitCandidateHumanLinkList}"
                                    var="hl"
                                    rowKey="#{hl.linkID}"
                                    tableStyleClass="primeDataTable"
                                    draggableRows="true" 
                                    tabindex="6"
                                    rowExpandMode="multiple">
                        <p:column width="25%"
                                  sortBy="#{hl.linkedObjectRole.schema.TARGET_OBJECT_FRIENDLY_NAME}">
                            <f:facet name="header">
                                <h:outputText value="Object"/>
                            </f:facet>
                            <h:outputText value="#{hl.linkedObjectRole.schema.TARGET_OBJECT_FRIENDLY_NAME}" />
                        </p:column>
                        <p:column width="50%"
                                  headerText="Person and role">

                            <h:outputText value="#{hl.name}" />
                            <h:outputText value=" (Person ID:#{hl.humanID})" />

                            <p:spacer height="2px" />

                            <h:outputText value="#{hl.linkedObjectRole.title}" />
                            <h:outputText value=" #{hl.linkedObjectRole.schema.TARGET_OBJECT_FRIENDLY_NAME}" />
                            <h:outputText value=" (ID:#{hl.parentObjectID})" />


                        </p:column>
                        <p:column width="25%"
                                  headerText="actions">
                            <p:commandLink      id="permit-chosenpersons-selectperson-cl"
                                                value="add to permit" 
                                                ajax="true"
                                                actionListener="#{occPeriodBB.onOccPermitPersonLinkQueuePerson(hl)}"
                                                style="color:blue; font-weight: bold;"
                                                rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                update= "permit-chosenpersons-form
                                                permits-growl-form
                                                occperiod-createpermit-occpermit-form">
                            </p:commandLink> 

                        </p:column>
                    </p:dataTable>
                </h:form>
            </div>


            <div class="p-col-6">
                <h:form id="permit-chosenpersons-form">

                    <p:commandLink      id="permit-chosenpersons-load-ownerseller-cl"
                                        value="Owner/Seller" 
                                        ajax="true"
                                        actionListener="#{occPeriodBB.onOCcPermitPersonLinkListChooseLinkClick}"
                                        style="color:blue; font-weight: bold;"
                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                        update= "@form
                                        permits-growl-form">
                        <f:param name="permit-person-list" value="CURRENT_OWNER" />
                    </p:commandLink>

                    <h:outputText value=" | " />

                    <p:commandLink      id="permit-chosenpersons-load-buyer-cl"
                                        value="Buyer/Tenants" 
                                        ajax="true"
                                        actionListener="#{occPeriodBB.onOCcPermitPersonLinkListChooseLinkClick}"
                                        style="color:blue; font-weight: bold;"
                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                        update= "@form
                                        permits-growl-form">
                        <f:param name="permit-person-list" value="NEW_OWNER" />
                    </p:commandLink>

                    <h:outputText value=" | " />

                    <p:commandLink      id="permit-chosenpersons-load-managers-cl"
                                        value="Manager(s)" 
                                        ajax="true"
                                        actionListener="#{occPeriodBB.onOCcPermitPersonLinkListChooseLinkClick}"
                                        style="color:blue; font-weight: bold;"
                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                        update= "@form
                                        permits-growl-form">
                        <f:param name="permit-person-list" value="MANAGERS" />
                    </p:commandLink>

                    <h:outputText value=" | " />

                    <p:commandLink      id="permit-chosenpersons-load-tenants-cl"
                                        value="Tenants" 
                                        ajax="true"
                                        actionListener="#{occPeriodBB.onOCcPermitPersonLinkListChooseLinkClick}"
                                        style="color:blue; font-weight: bold;"
                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                        update= "@form
                                        permits-growl-form">
                        <f:param name="permit-person-list" value="TENANTS" />
                    </p:commandLink>

                    <h2>
                        <h:outputText value="Persons currently added to permit category:" />
                        <p:spacer height="5px" />
                        <h:outputText value="#{occPeriodBB.occPermitCurrentPersonLinkEnum.label}" />
                    </h2>

                    <ui:repeat id="permit-chosenpersons-uir"
                               var="chosenPerson"
                               value="#{occPeriodBB.occPermitSelectedHumanLinkList}">
                        <h:outputText value="#{chosenPerson.name} (#{chosenPerson.humanID})" />
                        <p:spacer height="2px" />
                        <h:outputText value="#{chosenPerson.linkedObjectRole.title} #{chosenPerson.linkedObjectRole.schema.TARGET_OBJECT_FRIENDLY_NAME}" />
                        <p:spacer height="2px" />
                        <p:commandLink id="permit-person-remove-cl"
                                       value="remove"
                                       ajax="true"
                                       style="color:blue; font-weight: bold;"
                                       actionListener="#{occPeriodBB.onOccPermitPersonLinkRemove(chosenPerson)}"
                                       update="@form
                                       permits-growl-form
                                       permit-chosenpersons-form
                                       occperiod-createpermit-occpermit-form"
                                       />

                        <p:divider type="solid" />
                    </ui:repeat>
                </h:form> 
            </div>
        </div>
    </p:dialog>
    <!--p:dialog|finalize permit-->
    <p:dialog id="permit-finalize-commit-dialog"
              height="300" width="900"
              widgetVar="permit-finalize-commit-dialog-var"
              closable="true"
              closeOnEscape="true"
              resizable="true"
              modal="true"
              dynamic="true"
              header="Confirm finalization"
              rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}">

        <h:form id="permit-finalize-commit-form">


            <div class="p-grid">
                <div class="p-col-3 restrict-data-field-label-inline">

                    <h:outputText value="Audit results" />
                </div>
                <div class="p-col-12 restrict-data-field-value-inline">

                    <h:outputText value="#{occPeriodBB.currentOccPermit.finalizationAuditLog}"
                                  escape="false" />
                </div>

                <div class="p-col-3 restrict-data-field-label-inline">
                    <h:outputText value="Finalization" />

                    <p:commandButton id="finalization-help-button"
                                     icon="fa fa-question-circle-o"
                                     styleClass="button-help"
                                     type="button" />

                    <p:overlayPanel for="finalization-help-button"
                                    style="width:350px;" 
                                    dismissable="true"
                                    showCloseIcon="true">
                        <h3>About finalization</h3>
                        <p>Finalization of an Occupancy Permit only when all fields appear correct on the draft. 
                            Once finalized, NONE of the fields can be edited and the permit is assigned a formal tracking number. 
                            The only way to recover from an error found on a finalized permit is to nullify that permit 
                            and create a new draft with the corrected values.</p>

                    </p:overlayPanel>
                </div>
                <div class="p-col-9 restrict-data-field-value-inline">
                    <p:commandButton id="permit-finalize-commit-cb"
                                     actionListener="#{occPeriodBB.onOccpermitFinalizeCommitButtonChange}"
                                     update="   permits-growl-form
                                     occperiod-permits-form"
                                     ajax="true"
                                     disabled="#{empty occPeriodBB.currentOccPermit.finalizationAuditPassTS}"
                                     icon="fa fa-plus"
                                     value="#{!empty occPeriodBB.currentOccPermit.finalizationAuditPassTS ? 'Complete finalization' : 'Cannot finalize without a passed audit'}"
                                     oncomplete="PF('permit-finalize-commit-dialog-var').hide();
                                     PF('permit-draft-dialog-var').hide();
                                     PF('occperiod-createpermit-occpermit-var').hide();" />

                </div>


                <div class="p-col-3 restrict-data-field-label-inline">
                    <h:outputText value="Failed audit override" />
                </div>
                <div class="p-col-9 restrict-data-field-value-inline" >
                    <p:commandButton id="permit-finalize-commit-overridecb"
                                     actionListener="#{occPeriodBB.onOccPermitFinalizeOverride}"
                                     update="   permits-growl-form
                                     occperiod-permits-form"
                                     ajax="true"
                                     disabled="false"
                                     icon="fa fa-plus"
                                     rendered="#{empty occPeriodBB.currentOccPermit.finalizationAuditPassTS}"
                                     value="OVERRIDE FAILED AUDIT!!"
                                     oncomplete="PF('permit-finalize-commit-dialog-var').hide();
                                     PF('permit-draft-dialog-var').hide();
                                     PF('occperiod-createpermit-occpermit-var').hide();" />

                </div>

            </div>
            <p:spacer height="3px" />

        </h:form>
    </p:dialog>


    <!--p:dialog|permit-draft-dialog-->
    <p:dialog id="permit-draft-dialog"
              height="800" width="1300"
              widgetVar="permit-draft-dialog-var"
              closable="true"
              closeOnEscape="true"
              resizable="true"
              modal="true"
              dynamic="true"
              header="Draft permit"
              rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}">

        <h:form id="permit-draft-form">

            <p:commandButton id="permit-finalize-init-cb"
                             actionListener="#{occPeriodBB.onOccPermitAuditForFinalization}"
                             update="   permits-growl-form
                             permit-finalize-commit-form
                             permit-finalize-commit-dialog"
                             ajax="true"
                             icon="fa fa-plus"
                             value="#{!empty occPeriodBB.currentOccPermit.finalizedts ? 'Already finalized!' : 'Audit permit for finalization'}"
                             disabled="#{!empty occPeriodBB.currentOccPermit.finalizedts}"
                             oncomplete="PF('permit-finalize-commit-dialog-var').show();" />


            <div class="p-grid">

                <div class="p-col-12 centeredColumnContent">
                    <h:outputText value="#{occPeriodBB.currentOccPermit.statictitle}" 
                                  style="font-weight: bold; font-size:1.4em;"/>
                    <p:spacer height="3px" />
                    <h:outputText value="#{occPeriodBB.currentOccPermit.staticmuniaddress}"
                                  escape="false"
                                  rendered="#{!empty occPeriodBB.currentOccPermit.staticmuniaddress}"/>
                </div>

                <div class="p-col-4 restrict-data-field-label-inline">
                    <h:outputText value="Property:" />
                </div>
                <div class="p-col-8 restrict-data-field-value-inline">
                    <h:outputText value="#{occPeriodBB.currentOccPermit.staticpropertyinfo}" 
                                  escape="false"/>
                </div>
                <div class="p-col-4 restrict-data-field-label-inline">
                    <h:outputText value="Permit Number:" />
                </div>
                <div class="p-col-8 restrict-data-field-value-inline">
                    <h:outputText value="#{occPeriodBB.currentOccPermit.referenceNo}" 
                                  rendered="#{!empty occPeriodBB.currentOccPermit.referenceNo}"/>
                    <h:outputText value="[reference # assigned at finalization]" 
                                  rendered="#{empty occPeriodBB.currentOccPermit.referenceNo}"/>

                </div>
                <div class="p-col-5">
                    <h:outputText value="Property Owner/Seller(s):"
                                  styleClass="bold" />
                    <p:spacer height="2px" />
                    <h:outputText value="#{occPeriodBB.currentOccPermit.staticownerseller}" 
                                  escape="false"/>
                </div>

                <div class="p-col-2">
                    <p:spacer height="15px" />
                    <h:outputText value="#{occPeriodBB.currentOccPermit.staticcolumnlink}" />
                </div>
                <div class="p-col-5">
                    <h:outputText value="Property buyer(s)/tenant(s)"
                                  styleClass="bold" />
                    <p:spacer height="2px" />
                    <h:outputText value="#{occPeriodBB.currentOccPermit.staticbuyertenant}"
                                  escape="false" />
                </div>

                <f:subview id="permit-sv-propuse"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticproposeduse}">

                    <div class="p-col-3 restrict-data-field-label-inline">
                        <h:outputText value="Proposed use:" />
                    </div>
                    <div class="p-col-3">
                        <h:outputText value="#{occPeriodBB.currentOccPermit.staticproposeduse}" />

                    </div>
                </f:subview>

                <f:subview id="permit-sv-usecode"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticusecode}">
                    <div class="p-col-3 restrict-data-field-label-inline">
                        <h:outputText value="Use code:" />
                    </div>
                    <div class="p-col-3">
                        <h:outputText value="#{occPeriodBB.currentOccPermit.staticusecode}" />
                    </div>
                </f:subview>

                <f:subview id="permit-sv-propclass"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticpropclass}">
                    <div class="p-col-3 restrict-data-field-label-inline">
                        <h:outputText value="Property class:" />
                    </div>
                    <div class="p-col-3">
                        <h:outputText value="#{occPeriodBB.currentOccPermit.staticpropclass}" />
                    </div>
                </f:subview>

                <f:subview id="permit-sv-date-application"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticdateofapplication}">
                    <div class="p-col-3 restrict-data-field-label-inline">
                        <h:outputText value="Date of Application:" />
                    </div>
                    <div class="p-col-3 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.getPrettyDateNoTime(occPeriodBB.currentOccPermit.staticdateofapplication)}" />
                    </div>
                </f:subview>

                <f:subview id="permit-sv-date-ins-initial"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticinitialinspection}">
                    <div class="p-col-3 restrict-data-field-label-inline">
                        <h:outputText value="Initial Inspection:" />
                    </div>
                    <div class="p-col-3 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.getPrettyDateNoTime(occPeriodBB.currentOccPermit.staticinitialinspection)}" />
                    </div>
                </f:subview>

                <f:subview id="permit-sv-date-ins-reins"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticreinspectiondate}">
                    <div class="p-col-3 restrict-data-field-label-inline">
                        <h:outputText value="Reinspection Date:" />
                    </div>
                    <div class="p-col-3 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.getPrettyDateNoTime(occPeriodBB.currentOccPermit.staticreinspectiondate)}" />
                    </div>
                </f:subview>

                <f:subview id="permit-sv-date-ins-final"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticfinalinspection}">
                    <div class="p-col-3 restrict-data-field-label-inline">
                        <h:outputText value="Final inspection:" />
                    </div>
                    <div class="p-col-3 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.getPrettyDateNoTime(occPeriodBB.currentOccPermit.staticfinalinspection)}" />
                    </div>
                </f:subview>

                <f:subview id="permit-sv-date-issuance"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticdateofissue}">
                    <div class="p-col-3 restrict-data-field-label-inline">
                        <h:outputText value="Date of Issuance:" />
                    </div>
                    <div class="p-col-3 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.getPrettyDateNoTime(occPeriodBB.currentOccPermit.staticdateofissue)}" />
                    </div>
                </f:subview>

                <f:subview id="permit-sv-date-expiry"
                           rendered="#{(!empty occPeriodBB.currentOccPermit.staticdateofexpiry) and (occPeriodBB.currentOccPermit.permitType.expires)}">

                    <div class="p-col-3 restrict-data-field-label-inline">
                        <h:outputText value="Date of Expiry:" />
                    </div>
                    <div class="p-col-3 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.getPrettyDateNoTime(occPeriodBB.currentOccPermit.staticdateofexpiry)}" />
                    </div>
                </f:subview>




                <f:subview id="permit-sv-issuedunder"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticissuedundercodesourceid}">
                    <div class="p-col-3 restrict-data-field-label-inline">
                        <h:outputText value="Issued Under:" />
                    </div>
                    <div class="p-col-3 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.currentOccPermit.staticissuedundercodesourceid}"
                                      escape="false"/>
                    </div>
                </f:subview>

                <div class="p-col-12">
                    <h:outputText value=" " />
                </div>

                <f:subview id="permit-sv-conditions"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticstipulations}">
                    <div class="p-col-3 restrict-data-field-label-inline">
                        <h:outputText value="Special conditions and stipulations:" />
                    </div>
                    <div class="p-col-9 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.currentOccPermit.staticstipulations}"
                                      escape="false"/>
                    </div>
                </f:subview>

                <f:subview id="permit-sv-comments"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticcomments}">
                    <div class="p-col-3 restrict-data-field-label-inline">
                        <h:outputText value="Comments:" />
                    </div>
                    <div class="p-col-3 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.currentOccPermit.staticcomments}" 
                                      escape="false"/>
                    </div>
                </f:subview>

                <f:subview id="permit-sv-notices"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticnotice}">
                    <div class="p-col-4 restrict-data-field-label-inline">
                        <h:outputText value="Notices: " />
                    </div>
                    <div class="p-col-8 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.currentOccPermit.staticnotice}"
                                      escape="false" />
                    </div>
                </f:subview>

                <f:subview id="permit-sv-consttype"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticconstructiontype}">
                    <div class="p-col-3 restrict-data-field-label-inline">
                        <h:outputText value="Construction type:" />
                    </div>
                    <div class="p-col-9 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.currentOccPermit.staticconstructiontype}" />
                    </div>
                </f:subview>

                <f:subview id="permit-sv-managers"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticmanager}">

                    <div class="p-col-6 restrict-data-field-label-inline">
                        <h:outputText value="Property Manager(s)" />
                    </div>
                    <div class="p-col-6 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.currentOccPermit.staticmanager}"
                                      escape="false"/>
                    </div>
                </f:subview>

                <f:subview id="permit-sv-tenenats"
                           rendered="#{!empty occPeriodBB.currentOccPermit.statictenants}">

                    <div class="p-col-6 restrict-data-field-label-inline">
                        <h:outputText value="Property Tenant(s):" />
                    </div>
                    <div class="p-col-6 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.currentOccPermit.statictenants}"
                                      escape="false"/>
                    </div>
                </f:subview>

                <f:subview id="permit-sv-leaseterm"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticleaseterm}">
                    <div class="p-col-4 restrict-data-field-label-inline">
                        <h:outputText value="Lease Term:" />
                    </div>
                    <div class="p-col-8 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.currentOccPermit.staticleaseterm}" />
                    </div>
                </f:subview>

                <f:subview id="permit-sv-leasestatus"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticleasestatus}">
                    <div class="p-col-4 restrict-data-field-label-inline">
                        <h:outputText value="Lease:" />
                    </div>
                    <div class="p-col-8 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.currentOccPermit.staticleasestatus}" />
                    </div>
                </f:subview>

                <f:subview id="permit-sv-payment"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticpaymentstatus}">
                    <div class="p-col-4 restrict-data-field-label-inline">
                        <h:outputText value="Payment:" />
                    </div>
                    <div class="p-col-8 restrict-data-field-value-inline">
                        <h:outputText value="#{occPeriodBB.currentOccPermit.staticpaymentstatus}" />
                    </div>
                </f:subview>

                <div class="p-col-12">
                    <h:outputText value=" " />
                </div>

                <f:subview id="permit-sv-officer"
                           rendered="#{!empty occPeriodBB.currentOccPermit.staticofficername}">
                    <div class="p-col-4 restrict-data-field-label-inline">
                        <h:outputText value="Issuing official:" />
                    </div>
                    <div class="p-col-8 restrict-data-field-value-inline">

                        <p:graphicImage value="#{blobsterBB.image}"
                                        alt=" " 
                                        styleClass="signature"
                                        cache="false"
                                       rendered="#{reportingBB.reportConfigOccPermit.permit.staticOfficerSignaturePhotoDocID ne 0}">
                            <f:param name="blobid" value="#{occPeriodBB.currentOccPermit.staticOfficerSignaturePhotoDocID}"/>
                        </p:graphicImage>
                        <p:spacer height="3px" />
                        <h:outputText value="#{occPeriodBB.currentOccPermit.staticofficername}" 
                                      escape="false"/>
                    </div>
                </f:subview>
            </div>
        </h:form>
    </p:dialog>
</ui:composition>