<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Inspection checklist builder</title>
    </h:head>
    <h:body>
        <ui:composition template="/restricted/navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view>

                    <div class="mainContainer">

                        <div class="title-container">
                            <h1>Inspection checklist builder</h1>
                        </div>

                        <h:form id="checklists-growl-form">
                            <p:growl id="checklists-growl"
                                     life="12000"
                                     sticky="false"
                                     keepAlive="true"
                                     globalOnly="false"/>
                        </h:form>

                        <div class ="two-column-page-flex-container">

                            <div class="list-column">

                                <p:panel id="checklists-panel"
                                         toggleable="true"
                                         widgetVar="checklists-panel-var"
                                         collapsed="false"
                                         header="Inspection Checklists">
                                    <h:form id="checklists-form">


                                        <p:commandButton id="checklist-create-init-button"
                                                         value="New checklist"
                                                         icon="fa fa-plus"
                                                         oncomplete="PF('checklist-infoedit-dialog-var').show()"
                                                         actionListener="#{checklistsBB.onChecklistCreateInitButtonClick}"
                                                         update="checklist-infoedit-dialog"/>

                                        <p:spacer height="5px"/>

                                        <p:dataTable    id="checklists-table"
                                                        var="chklst"
                                                        value="#{checklistsBB.checklistTemplateList}"
                                                        rowKey="#{chklst.inspectionChecklistID}"
                                                        reflow="true">
                                            <p:column headerText="ID"
                                                      style="width:10%;">
                                                <h:outputText value="#{chklst.inspectionChecklistID}" />
                                            </p:column>
                                            <p:column headerText="Title"
                                                      style="width:20%;">
                                                <h:outputText value="#{chklst.title}" />
                                            </p:column>

                                            <p:column headerText="Active"
                                                      style="width:10%;">
                                                <h:outputText value="#{chklst.active ? 'Active':'Deactivated'}" />
                                            </p:column>

                                            <p:column headerText="Source"
                                                      style="width:25%;">
                                                <h:outputText value="#{chklst.governingCodeSource.sourceName} (#{chklst.governingCodeSource.sourceYear})" />
                                            </p:column>

                                            <p:column headerText="Actions"
                                                      style="width:30%;">
                                                <p:commandLink  id="checklist-loadspacetypelist-commandlink"
                                                                ajax="true"
                                                               style="color:blue;"
                                                               rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                               update="spacetype-list-form"
                                                               value="load checklist"
                                                               actionListener="#{checklistsBB.onChecklistViewEditLinkClick(chklst)}">
                                                </p:commandLink>
                                                <h:outputText value=" | " />
                                                <p:commandLink  id="checklist-infoedit-commandlink"
                                                                ajax="true"
                                                               style="color:blue;"
                                                               oncomplete="PF('checklist-infoedit-dialog-var').show()"
                                                               rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                               update="checklist-infoedit-dialog"
                                                               value="edit"
                                                               actionListener="#{checklistsBB.onChecklistViewEditLinkClick(chklst)}">
                                                </p:commandLink>
                                            </p:column>
                                        </p:dataTable>


                                    </h:form>
                                </p:panel>

                            </div>

                            <div class ="object-column">

                                <h:form id="spacetype-list-form">

                                    <h2>
                                        <h:outputText value="Configure space types and ordinances in checklist '#{checklistsBB.currentChecklistTemplate.title}' (ID:#{checklistsBB.currentChecklistTemplate.inspectionChecklistID})" /> 
                                    </h2>

                                    <p:commandButton id="checklist-create-init-button"
                                                     value="Add space type"
                                                     icon="fa fa-plus"
                                                     disabled="#{empty checklistsBB.currentChecklistTemplate}"
                                                     oncomplete="PF('addspacetype-dialog-var').show()"
                                                     actionListener="#{checklistsBB.onSpaceTypeLinkInitButtonChange}"
                                                     update="addspacetype-dialog
                                                     addspacetype-form"/>
                                    <p:spacer height="5px" />

                                    <p:dataTable id="checklist-spacetypes-dt"
                                                 value="#{checklistsBB.currentChecklistTemplate.occSpaceTypeList}"
                                                 var="ost" 
                                                 rowKey="#{ost.checklistSpaceTypeID}"
                                                 stripedRows="true"
                                                 reflow="true"
                                                 scrollable="true"
                                                 sortBy="#{ost.spaceTypeTitle}"
                                                 rowExpandMode="multiple">


                                        <p:column style="width:5%" 
                                                  headerText="Exp.">
                                            <p:rowToggler/>
                                        </p:column>
                                        <p:column headerText="Name"
                                                  style="width:15%">
                                            <h:outputText value="#{ost.spaceTypeTitle}"/>
                                        </p:column>

                                        <p:column headerText="Description"
                                                  style="width:20%">
                                            <div class="wrapText">
                                                <h:outputText value="#{ost.spaceTypeDescription}"/>
                                            </div>
                                        </p:column>

                                        <p:column headerText="Required"
                                                  style="width:5%"
                                                  sortBy="#{ost.required}">
                                            <i class="#{ost.required ? 'pi pi-star' : ''}"/>
                                        </p:column>

                                        <p:column headerText="CSTID"
                                                  style="width:5%">
                                            <h:outputText value="#{ost.checklistSpaceTypeID}"/>
                                        </p:column>

                                        <p:column headerText="Type ID"
                                                  style="width:5%">
                                            <h:outputText value="#{ost.spaceTypeID}"/>
                                        </p:column>

                                        <p:column headerText="Chklst ID"
                                                  style="width:5%">
                                            <h:outputText value="#{ost.checklistParentID}"/>
                                        </p:column>


                                        <p:column headerText="Actions"
                                                  style="width:30%">

                                            <p:commandLink  id="occspacetype-linkords-link"
                                                            ajax="true"
                                                            style="color:blue;"
                                                            oncomplete="PF('select-ece-dialog-var').show()"
                                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                            update="select-ece-form"
                                                            value="link ordinances"
                                                            actionListener="#{checklistsBB.onChooseOrdinancesToLinkToSpaceTypeLinkCLick(ost)}" />

                                            <h:outputText value=" | " />

                                            <p:commandLink  id="occspacetype-togglerequired-link"
                                                            ajax="true"
                                                            style="color:blue;"
                                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                            update="@form
                                                            @form:@parent:checklists-growl-form"
                                                            value="#{ost.required ? 'mark as optional':'mark as required'}"
                                                            actionListener="#{checklistsBB.onToggleRequiredOccSpaceTypeChecklistified(ost)}" />

                                            <h:outputText value=" | " />
                                            

                                            <p:commandLink  id="occspacetype-remove-init-link"
                                                            ajax="true"
                                                            style="color:blue;"
                                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                            update="remove-ost-confirm-dialog
                                                            remove-ost-confirm-form"
                                                            value="remove"
                                                            oncomplete="PF('remove-ost-confirm-dialog-var').show();"
                                                            actionListener="#{checklistsBB.onRemoveSpaceTypeFromChecklistInit(ost)}" >
                                            </p:commandLink>
                                            


                                        </p:column>
                                        <p:rowExpansion>
                                            <h3>
                                                <h:outputText value="Ordinances to check while inspecting: #{ost.spaceTypeTitle}" />
                                            </h3>
                                            <p:dataTable id="ordbytype-table"
                                                         var="occSpcEle"
                                                         value="#{ost.codeElementList}"
                                                         rowKey="#{occSpcEle.occChecklistSpaceTypeElementID}"
                                                         stripedRows="true">
                                                   <p:column style="width:5%" 
                                                            headerText="Exp.">
                                                      <p:rowToggler/>
                                                  </p:column>
                                                <p:column headerText="OCSTID"
                                                          style="width:7%">
                                                    <h:outputText value="#{occSpcEle.occChecklistSpaceTypeElementID}"/>
                                                </p:column>
                                                <p:column headerText="Ordinance"
                                                          style="width:40%">
                                                    <h:outputText value="#{occSpcEle.headerString}"
                                                                  escape="false"/>
                                                </p:column>
                                                <p:column headerText="Req?"
                                                          style="width:7%">
                                                    <i class="#{occSpcEle.requiredForInspection ? 'pi pi-star' : ''}"/>
                                                </p:column>
                                                <p:column headerText="Category"
                                                          style="width:15%"
                                                          sortBy="#{occSpcEle.guideEntry.category}">
                                                    <h:outputText value="#{occSpcEle.guideEntry.category}" />
                                                </p:column>
                                                <p:column headerText="Subcategory"
                                                          style="width:15%"
                                                          sortBy="#{occSpcEle.guideEntry.subCategory}">
                                                    <h:outputText value="#{occSpcEle.guideEntry.subCategory}" />
                                                </p:column>
                                                
                                                <p:column headerText="Actions"
                                                          style="width:25%">
                                                    
                                                    <p:commandLink  id="occspacetype-vieworddetails-commandlink"
                                                                    ajax="true"
                                                                    style="color:blue;"
                                                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                                    update="eceview-dialog
                                                                            eceview-dialog"
                                                                    value="ord details"
                                                                    oncomplete="PF('eceview-dialog-var').show();"
                                                                    actionListener="#{checklistsBB.onViewOrdinanceDetailsLinkClick(occSpcEle)}" />

                                                    <h:outputText value=" | " />
                                                    
                                                    <p:commandLink  id="occspacetype-togglerequired-link"
                                                                    ajax="true"
                                                                    style="color:blue;"
                                                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                                    update="@form
                                                                    @form:@parent:checklists-growl-form"
                                                                    value="#{occSpcEle.requiredForInspection ? 'mark as optional':'mark as required'}"
                                                                    actionListener="#{checklistsBB.onToggleRequiredOccSpaceElement(occSpcEle)}" />

                                                    <h:outputText value=" | " />

                                                    <p:commandLink  id="occspaceelement-remove-init-link"
                                                                    ajax="true"
                                                                    style="color:blue;"
                                                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                                    update="remove-ose-confirm-dialog
                                                                    remove-ose-confirm-form"
                                                                    oncomplete="PF('remove-ose-confirm-dialog-var').show();"
                                                                    value="remove"
                                                                    actionListener="#{checklistsBB.onRemoveOccSpaceElementFromSpaceTypeInit(occSpcEle)}" >
                                                        
                                                    </p:commandLink>
                                                  
                                                </p:column>
                                                <p:rowExpansion>
                                                    
                                                    <div class="p-grid">
                                                        <div class="p-col-3">
                                                            Technical Text
                                                        </div>
                                                        <div class="p-col-9">
                                                            
                                                            <h:outputText value="#{occSpcEle.headerString}"
                                                                          escape="false"/>
                                                            <p:spacer height="3px" />
                                                            <div class="wrapText">
                                                                <h:outputText value="#{occSpcEle.ordTechnicalText}"
                                                                              escape="false" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </p:rowExpansion>
                                            </p:dataTable>
                                        </p:rowExpansion>
                                    </p:dataTable>
                                </h:form>
                            </div>
                        </div>
                    </div>
                    
                    <ui:include src="/restricted/cogstaff/code/compositions/enforcableCodeElementTools.xhtml" />

                    
                    <p:confirmDialog id="remove-ost-confirm-dialog"
                                     widgetVar="remove-ost-confirm-dialog-var"
                                     header="Confirm removal of Space Type from Checklist?"
                                     closeOnEscape="true"
                                     closable="true"
                                     responsive="true">
                        
                        <h:form id="remove-ost-confirm-form">
                            

                            <p:commandButton  id="occspacetype-remove-link"
                                            ajax="true"
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                            update="@form:@parent:checklists-growl-form
                                                    spacetype-list-form"
                                            value="Confirm removal of space type #{checklistsBB.currentOccSpaceTypeChecklistified.spaceTypeTitle} from checklist ID: #{checklistsBB.currentChecklistTemplate.inspectionChecklistID}"
                                            actionListener="#{checklistsBB.onRemoveSpaceTypeFromChecklist}" 
                                            oncomplete="PF('remove-ost-confirm-dialog-var').hide()">


                            </p:commandButton>
                            
                            <p:spacer height="5px" />
                            
                            <div class="gray_button">

                                <p:commandButton id="remove-ost-abort-button"
                                                 value="Cancel"
                                                 styleClass="gray-button"
                                                 rendered="true"
                                                 icon="fa fa-stop"
                                                 process="@none"
                                                 immediate="true"
                                                 actionListener="#{checklistsBB.onRemoveOperationAbortButtonPress}"
                                                 oncomplete="PF('remove-ost-confirm-dialog-var').hide()" />
                            </div>

                            
                        </h:form>
                        
                        
                        
                    </p:confirmDialog>
                    
                    <p:confirmDialog id="remove-ose-confirm-dialog"
                                     widgetVar="remove-ose-confirm-dialog-var"
                                     header="Confirm removal of ordinance from space type?">
                        <h:form id="remove-ose-confirm-form">
                            
                        
                            <p:commandButton  id="occspaceelement-remove-button"
                                            ajax="true"
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                            update="spacetype-list-form
                                            @form:@parent:checklists-growl-form"
                                            oncomplete="PF('remove-ose-confirm-dialog-var').hide()"
                                            value="Confirm removal of ordinance ECEID: #{checklistsBB.currentOccSpaceElement.codeSetElementID} from current space type?"
                                            actionListener="#{checklistsBB.onRemoveOccSpaceElementFromSpaceType}" >
                                                        
                            </p:commandButton>
                            <p:spacer height="5px" />
                            
                            <div class="gray_button">

                                <p:commandButton id="remove-ose-abort-button"
                                                 value="Cancel"
                                                 styleClass="gray-button"
                                                 rendered="true"
                                                 icon="fa fa-stop"
                                                 process="@none"
                                                 immediate="true"
                                                 actionListener="#{checklistsBB.onRemoveOperationAbortButtonPress}"
                                                 oncomplete="PF('remove-ose-confirm-dialog-var').hide()" />
                            </div>
                            
                        
                        </h:form>
                        
                        
                    </p:confirmDialog>
                    
                    
                    
                    <p:confirmDialog id="remove-checklist-confirm-dialog"
                                     widgetVar="remove-checklist-confirm-dialog-var"
                                     header="Confirm deactivation of checklist?"
                                     closeOnEscape="true"
                                     closable="true"
                                     responsive="true">
                        
                        <h:form id="remove-checklist-confirm-form">
                            

                            <p:commandButton  id="checklist-remove-commit-button"
                                            ajax="true"
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                            update="@form:@parent:checklists-growl-form
                                                    spacetype-list-form
                                                    checklists-form"
                                                    value="Confirm removal of checklist ID: #{checklistsBB.currentChecklistTemplate.inspectionChecklistID} (#{checklistsBB.currentChecklistTemplate.title})"
                                                    actionListener="#{checklistsBB.onDeactivateChecklistButtonPress}" 
                                            oncomplete="PF('remove-checklist-confirm-dialog-var').hide()">


                            </p:commandButton>
                            
                            <p:spacer height="5px" />
                            
                            <div class="gray_button">

                                <p:commandButton id="remove-checklist-abort-button"
                                                 value="Cancel"
                                                 styleClass="gray-button"
                                                 rendered="true"
                                                 icon="fa fa-stop"
                                                 process="@none"
                                                 immediate="true"
                                                 actionListener="#{checklistsBB.onRemoveOperationAbortButtonPress}"
                                                 oncomplete="PF('remove-checklist-confirm-dialog-var').hide()" />
                            </div>

                            
                        </h:form>
                        
                        
                        
                    </p:confirmDialog>
                    
                    
                    <p:dialog id="checklist-infoedit-dialog"
                              width="1000"
                              widgetVar="checklist-infoedit-dialog-var"
                              header="Inspection Checklist #{checklistsBB.currentChecklistTemplate.inspectionChecklistID}"
                              modal="true"
                              closeOnEscape="true"
                              closable="true"
                              resizable="true">
                        <h:form id="checklist-infoedit-form">

                            <p:commandButton id="checklist-edit-button"
                                             value="#{checklistsBB.editModeCurrentChecklistTemplate ? 'Save Changes' : 'Edit'}"
                                             disabled="#{!checklistsBB.currentChecklistTemplate.active}"
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                             icon="fa #{occInspectionsBB.editModeInspectionMetadata ? 'fa-check' : 'fa-pencil'}"
                                             actionListener="#{checklistsBB.onToggleEditModeChecklistTemplateButtonClick}"
                                             oncomplete="PF('checklist-infoedit-dialog-var').show()"
                                             update="@form
                                             @form:@parent:checklists-form
                                             @form:@parent:checklists-growl-form"/>

                            <div class="gray_button">

                                <p:commandButton id="inspections-inspectiondetails-abort"
                                                 value="Cancel"
                                                 styleClass="gray-button"
                                                 rendered="#{checklistsBB.editModeCurrentChecklistTemplate}"
                                                 icon="fa fa-stop"
                                                 process="@none"
                                                 immediate="true"
                                                 actionListener="#{checklistsBB.onEditModeChecklistTemplateAbort}"
                                                 oncomplete="PF('checklist-infoedit-dialog-var').hide()"
                                                 update="@form
                                                 @form:@parent:checklists-growl-form"/>
                            </div>



                            <div class="p-grid">
                                <div class="p-col-6">
                                    ID
                                </div>
                                <div class="p-col-6">
                                    <h:outputText value="#{checklistsBB.currentChecklistTemplate.inspectionChecklistID eq 0 ? '(New template)' :checklistsBB.currentChecklistTemplate.inspectionChecklistID}" />
                                </div>

                                <div class="p-col-6">
                                    Municipality
                                </div>
                                <div class="p-col-6">
                                    <h:outputText value="#{checklistsBB.currentChecklistTemplate.muni.muniName}" 
                                                  rendered="#{!checklistsBB.editModeCurrentChecklistTemplate}"
                                                  />

                                    <p:selectOneMenu 
                                        id="munilist-som" 
                                        tabindex="1"
                                        value="#{checklistsBB.currentChecklistTemplate.muni}"
                                        rendered="#{checklistsBB.editModeCurrentChecklistTemplate}"
                                        required="true">
                                        <f:selectItem itemLabel="select a municipality..." 
                                                      noSelectionOption="true" 
                                                      itemDisabled="true"/>
                                        <f:selectItems value="#{systemServicesBB.municipalityListForSearch}" 
                                                       var="muni" 
                                                       itemLabel="#{muni.muniName}"/>
                                        <f:converter converterId="muniConverter" />
                                    </p:selectOneMenu>



                                </div>
                                <div class="p-col-6">
                                    Title
                                </div>
                                <div class="p-col-6">
                                    <h:outputText value="#{checklistsBB.currentChecklistTemplate.title}" 
                                                  rendered="#{!checklistsBB.editModeCurrentChecklistTemplate}"/>

                                    <p:inputText value="#{checklistsBB.currentChecklistTemplate.title}" 
                                                 rendered="#{checklistsBB.editModeCurrentChecklistTemplate}"/>
                                </div>
                                <div class="p-col-6">
                                    Description
                                </div>
                                <div class="p-col-6">
                                    <h:outputText value="#{checklistsBB.currentChecklistTemplate.description}" 
                                                  rendered="#{!checklistsBB.editModeCurrentChecklistTemplate}"/>
                                    <p:inputText value="#{checklistsBB.currentChecklistTemplate.description}" 
                                                 rendered="#{checklistsBB.editModeCurrentChecklistTemplate}"/>
                                </div>
                                <div class="p-col-6">
                                    Governing Code
                                </div>
                                <div class="p-col-6">
                                    <h:outputText value="#{checklistsBB.currentChecklistTemplate.governingCodeSource.sourceName} (#{checklistsBB.currentChecklistTemplate.governingCodeSource.sourceYear})" 
                                                  rendered="#{!checklistsBB.editModeCurrentChecklistTemplate}"/>


                                    <p:selectOneMenu 
                                        id="codesourcelist-som" 
                                        tabindex="5"
                                        value="#{checklistsBB.currentChecklistTemplate.governingCodeSource}"
                                        rendered="#{checklistsBB.editModeCurrentChecklistTemplate}"
                                        required="true">
                                        <f:selectItem itemLabel="select a code source..." 
                                                      noSelectionOption="true" 
                                                      itemDisabled="true"/>
                                        <f:selectItems value="#{checklistsBB.codeSourceList}" 
                                                       var="source" 
                                                       itemLabel="#{source.sourceName} (#{source.sourceYear})"/>
                                        <f:converter converterId="codeSourceConverter" />
                                    </p:selectOneMenu>

                                </div>

                                <div class="p-col-6">
                                    Created
                                </div>
                                <div class="p-col-6">
                                    <h:outputText value="#{checklistsBB.getPrettyDate(checklistsBB.currentChecklistTemplate.createdTS)}" />

                                </div>
                                <div class="p-col-6">
                                    Active
                                </div>
                                <div class="p-col-6">
                                    <h:outputText value="#{checklistsBB.currentChecklistTemplate.active ? 'Active' : 'Deactivated'}" />


                                    <p:commandLink  id="checkist-deactivate-clink"
                                                    ajax="true"
                                                    style="color:blue;"
                                                    oncomplete="PF('remove-checklist-confirm-dialog-var').show()"
                                                    rendered="#{!checklistsBB.editModeCurrentChecklistTemplate}"
                                                    update="checklists-form
                                                    checklists-growl-form
                                                    remove-checklist-confirm-dialog
                                                    remove-checklist-confirm-form"
                                                    value="Deactivate checklist ID #{checklistsBB.currentChecklistTemplate.inspectionChecklistID}"
                                                    actionListener="#{checklistsBB.onDeactivateChecklistInitLinkClick}">

                                    </p:commandLink>
                                </div>
                            </div>

                        </h:form>
                    </p:dialog>

                    
                    

                    <p:dialog id="select-ece-dialog"
                              widgetVar="select-ece-dialog-var"
                              header="Select code elements to inspect in #{checklistsBB.currentOccSpaceTypeChecklistified.spaceTypeTitle}"
                              modal="true"
                              height="800px"
                              width="1200px"
                              closeOnEscape="true"
                              closable="true"
                              resizable="true">

                        <h:form id="select-ece-form">


                            <p:commandButton id="sets-add-ord-cb" 
                                             ajax="true" 
                                             icon="fa fa-plus"
                                             value="Connect selected ordinances to space type: #{checklistsBB.currentOccSpaceTypeChecklistified.spaceTypeTitle}" 
                                             style="width: 275px"
                                             disabled="#{empty codeSetBB.currentCodeSet}"
                                             oncomplete="PF('select-ece-dialog-var').hide();"
                                             update="   checklists-growl-form
                                                        spacetype-list-form"
                                            actionListener="#{checklistsBB.onLinkSelectedECEsToSpaceType}" />

                            <p:spacer height="5px" />


                            <h:outputText id="sets-ece-list-size-ot"
                                          value="#{!(empty checklistsBB.currentCodeSet.enfCodeElementList) ? checklistsBB.currentCodeSet.enfCodeElementList.size() : ''}"
                                          styleClass="italic" />

                            <h:outputText id="sets-ece-list-size-label-ot"
                                          value="#{!(empty checklistsBB.currentCodeSet.enfCodeElementList) ? ' ordiances contained in this code book' : 'empty code book'}"
                                          styleClass="italic" />

                            <p:dataTable
                                id="elements-table"
                                var="cse"
                                value="#{checklistsBB.occSpaceElementList}"
                                rowKey="#{cse.codeSetElementID}"
                                tableStyleClass="primeDataTable"
                                resizableColumns="true"
                                rowExpandMode="single"
                                expandedRow="false"
                                selection="#{checklistsBB.occSpaceElementListSelected}"
                                filteredValue="#{checklistsBB.occSpaceElementListFiltered}"
                                widgetVar="elements-table-var"
                                scrollable="true"
                                tabindex="1">



                                <p:column width="3%">
                                    <f:facet name="header">
                                        <h:outputText value="Exp"/>
                                    </f:facet>
                                    <p:rowToggler/>
                                </p:column>

                                <p:column selectionMode="multiple" 
                                          style="width:16px;text-align:center"/>

                                <p:column width="5%" 
                                          sortBy="#{cse.codeSetElementID}">
                                    <f:facet name="header">
                                        <h:outputText value="ID" />
                                    </f:facet>
                                    <h:outputText value="#{cse.codeSetElementID}"/>
                                </p:column>

                                <p:column width="10%" sortBy="#{cse.source.sourceName}"
                                          filterBy="#{cse.source.sourceName}">
                                    <f:facet name="header">
                                        <h:outputText value="Source" />
                                    </f:facet>
                                    <h:outputText value="#{cse.source.sourceName}(#{cse.source.sourceYear})"/>
                                </p:column>

                                <p:column width="10%" sortBy="#{cse.guideEntry.category}"
                                          filterBy="#{cse.guideEntry.category}">
                                    <f:facet name="header">
                                        <h:outputText value="Category" />
                                    </f:facet>
                                    <h:outputText value="#{cse.guideEntry.category}"/>
                                </p:column>

                                <p:column width="10%" sortBy="#{cse.guideEntry.subCategory}"
                                          filterBy="#{cse.guideEntry.subCategory}">
                                    <f:facet name="header">
                                        <h:outputText value="Sub Category" />
                                    </f:facet>
                                    <h:outputText value="#{cse.guideEntry.subCategory}"/>
                                </p:column>

                                <p:column width="5%" sortBy="#{cse.ordchapterNo}">
                                    <f:facet name="header">
                                        <h:outputText value="Cha#"/>
                                    </f:facet>
                                    <h:outputText value="#{cse.ordchapterNo}"/>
                                </p:column>

                                <p:column width="15%" sortBy="#{cse.ordchapterTitle}"
                                          filterBy="#{cse.ordchapterTitle}">
                                    <f:facet name="header">
                                        <h:outputText value="Chapter"/>
                                    </f:facet>
                                    <h:outputText value="#{cse.ordchapterTitle}"/>
                                </p:column>

                                <p:column width="5%" sortBy="#{cse.ordSecNum}">
                                    <f:facet name="header">
                                        <h:outputText value="Sec#" />
                                    </f:facet>
                                    <h:outputText value="#{cse.ordSecNum}"/>
                                </p:column>

                                <p:column width="15%" sortBy="#{cse.ordSecTitle}"
                                          filterBy="#{cse.ordSecTitle}">
                                    <f:facet name="header">
                                        <h:outputText value="Section" />
                                    </f:facet>
                                    <h:outputText value="#{cse.ordSecTitle}"/>
                                </p:column>

                                <p:column width="5%" sortBy="#{cse.ordSubSecNum}">
                                    <f:facet name="header">
                                        <h:outputText value="Sub#" />
                                    </f:facet>
                                    <h:outputText value="#{cse.ordSubSecNum}"/>
                                </p:column>

                                <p:column sortBy="#{cse.ordSubSecTitle}" 
                                          filterBy="#{cse.ordSubSecTitle}"
                                          width="15%">
                                    <f:facet name="header">
                                        <h:outputText value="SubSec. Title" />
                                    </f:facet>
                                    <h:outputText value="#{cse.ordSubSecTitle}"/>
                                </p:column>

                                <p:column   width="15%"
                                            headerText="Required?"
                                            styleClass="centeredColumnContent"
                                            >

                                    <p:selectBooleanCheckbox value="#{cse.requiredForInspection}" />


                                </p:column>

                                <p:rowExpansion>

                                    <div class="outlinedBox"
                                         style="text-align:left;">

                                        <h2>Record metadata</h2>
                                        <div class="ui-g data_container_nested_restrict">
                                            <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field" >
                                                <div class="restrict-data-field-label-inline" >
                                                    <h:outputLabel  for="ece-createdby">
                                                        <h:outputText value="Creation" />
                                                    </h:outputLabel>
                                                </div>
                                                <div class="restrict-data-field-value-inline" >
                                                    <h:outputText id="ece-createdby" 
                                                                  value="#{!(empty cse.eceCreatedBy) ? cse.createdBy.human.name: ''}"/>
                                                    <h:outputText id="ece-creationts" 
                                                                  value="#{codeSetBB.getPrettyDate(cse.eceCreatedTS)}"/>
                                                </div>
                                            </div>
                                            <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field" >
                                                <div class="restrict-data-field-label-inline" >
                                                    <h:outputLabel  for="ece-lastupdatedby">
                                                        <h:outputText value="Last updates" />
                                                    </h:outputLabel>
                                                </div>
                                                <div class="restrict-data-field-value-inline" >
                                                    <h:outputText id="ece-lastupdatedby" 
                                                                  value="#{!(empty cse.lastupdatedBy) ? cse.lastupdatedBy.human.name: ''}"/>
                                                    <h:outputText id="ece-lastupdatedts" 
                                                                  value="#{codeSetBB.getPrettyDate(cse.lastUpdatedTS)}"/>
                                                </div>
                                            </div>
                                        </div>


                                        <h2>Enforceability Info</h2>

                                        <h:panelGrid columns="4" 
                                                     cellpadding="10" 
                                                     footerClass="gridFooter"
                                                     columnClasses="gridTd, gridTd"
                                                     >
                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Munimum Penalty"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="$#{cse.minPenalty}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Norm Penalty"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="$#{cse.normPenalty}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Maximum Penalty"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="$#{cse.maxPenalty}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Penalty Notes"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="#{cse.penaltyNotes}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Default days to comply"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="#{cse.normDaysToComply}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Compliance timeframe Notes"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="#{cse.daysToComplyNotes}"/>
                                                </div>
                                            </h:panelGroup>

                                            <f:facet name="footer">
                                                <h:outputLabel styleClass="bold" value="Default violation findings" style="text-align:left;"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{cse.defaultViolationDescription}"/>
                                                </div>
                                                <p:spacer height="15px"/>

                                                <h:outputLabel styleClass="bold" value="Municipality specific notes" style="text-align:left;"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="#{cse.muniSpecificNotes}"/>
                                                </div>
                                            </f:facet>

                                        </h:panelGrid>
                                    </div>

                                    <div class="outlinedBox">
                                        <h2>Code Element Content</h2>

                                        <h:outputLabel styleClass="bold" value="Technical Text"/>
                                        <p:spacer height="15px"/>
                                        <div class="rowExpansion">
                                            <h:outputText escape="false" 
                                                          value="#{cse.ordTechnicalText}"
                                                          styleClass="monospace"/>
                                        </div>

                                        <p:spacer height="15px"/>

                                        <h:outputLabel styleClass="bold" value="Human friendly text"/>
                                        <div class="rowExpansion">
                                            <h:outputText escape="false" value="#{cse.ordHumanFriendlyText}"/>
                                        </div>
                                        <p:spacer height="15px"/>
                                        <h:outputLabel styleClass="bold" value="Code Guide: Enforcement Tips"/>
                                        <div class="rowExpansion">
                                            <h:outputText escape="false" value="#{cse.guideEntry.enforcementGuidelines}"/>
                                        </div>

                                        <p:spacer height="15px"/>

                                        <h:outputLabel styleClass="bold" value="Code guide: Inspection Tips"/>
                                        <div class="rowExpansion">
                                            <h:outputText escape="false" value="#{cse.guideEntry.inspectionGuidelines}"/>
                                        </div>
                                    </div>
                                </p:rowExpansion>
                            </p:dataTable>

                            <p:spacer height="15px"/>



                        </h:form>
                    </p:dialog>



                    <p:dialog id="addspacetype-dialog"
                              widgetVar="addspacetype-dialog-var"
                              header="Add space types to checklist: #{checklistsBB.currentChecklistTemplate.title} (ID: #{checklistsBB.currentChecklistTemplate.inspectionChecklistID})"
                              closable="true"
                              closeOnEscape="true"
                              modal="true"
                              height="600"
                              width="800"
                              resizable="true"
                              responsive="true">

                        <h:form id="addspacetype-form">

                            <p:commandButton id="spacetype-new-init-button"
                                             value="Create new space type"
                                             icon="fa fa-plus"
                                             ajax="true"
                                             oncomplete="PF('createnewspacetype-dialog-var').show()"
                                             actionListener="#{checklistsBB.onCreateNewSpaceTypeInitButtonPush}"
                                             update="createnewspacetype-dialog
                                             createnewspacetype-form"/>

                            <p:spacer height="10px" />
                            <div class="p-grid">
                                <div class="p-col-8">
                                    Choose the space types:
                                    <p:dataTable id="ordbytype-table"
                                                 var="tpe"
                                                 value="#{checklistsBB.spaceTypeList}"
                                                 rowKey="#{tpe.spaceTypeID}"
                                                 stripedRows="true"
                                                 selection="#{checklistsBB.spaceTypeListSelected}">

                                        <p:column selectionMode="multiple" 
                                                  style="width:16px;text-align:center"/>

                                        <p:column headerText="Type ID">
                                            <h:outputText value="#{tpe.spaceTypeID}"/>
                                        </p:column>

                                        <p:column headerText="Title">
                                            <h:outputText value="#{tpe.spaceTypeTitle}"/>
                                        </p:column>

                                        <p:column headerText="Description">
                                            <h:outputText value="#{tpe.spaceTypeDescription}"/>
                                        </p:column>

                                    </p:dataTable>


                                </div>
                                <div class="p-col-4">
                                    <h:outputText value="Add space types as required?" />
                                    <p:spacer height="3px" />
                                    <p:selectBooleanCheckbox value="#{checklistsBB.spaceTypeBatchRequired}" 
                                                             label="Require space type in inspection"
                                                             />
                                </div>
                            </div>
                            <p:spacer height="5px" />

                            <p:commandButton id="addspacetype-addcommit-button"
                                             value="Add selected spaces to checklist"
                                             icon="fa fa-plus"
                                             oncomplete="PF('addspacetype-dialog-var').hide()"
                                             actionListener="#{checklistsBB.onLinkSelectedSpaceTypesToChecklist}"
                                             update="   spacetype-list-form
                                                        checklists-growl-form"/>

                            <p:spacer height="5px" />
                            <div class="ui-button gray_button">

                                <p:commandButton ajax="true" 
                                                 value="Cancel" 
                                                 icon="fa fa-stop" 
                                                 immediate="true"
                                                 process="@none"
                                                 onclick="PF('checklist-addspacetype-dialog-var').hide()"/>
                            </div>
                        </h:form>
                    </p:dialog>





                    <p:dialog id="createnewspacetype-dialog"
                              widgetVar="createnewspacetype-dialog-var"
                              header="Create a new space type (globally viewable)"
                              closable="true"
                              closeOnEscape="true"
                              modal="true"
                              height="400"
                              width="500"
                              resizable="true"
                              responsive="true">

                        <h:form id="createnewspacetype-form">
                            
                            <p>
                                A space type is a general category for a kind of room or area in or on a property, 
                                such as "Bathroom" or "In-ground pool" or "Kitchen". Note that these space types
                                have no instructions for inspections inside of them--they are just labels. Given their 
                                commonality across properties and municipalities, they are shared across all municipalities.
                                Please be thoughtful to not add redundant space types.
                            </p>

                            <p:commandButton id="createnewspacetype-toggleedit-button"
                                             value="#{checklistsBB.editModeCurrentOccSpaceType ? 'Save Changes' : 'Edit'}"
                                             disabled="false"
                                             ajax="true"
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                             icon="fa #{checklistsBB.editModeCurrentOccSpaceType? 'fa-check' : 'fa-pencil'}"
                                             actionListener="#{checklistsBB.onEditModeOccSpaceTypeToggleButtonPush}"
                                             oncomplete="PF('createnewspacetype-dialog-var').hide();
                                             PF('addspacetype-dialog-var').show();"
                                             update="   addspacetype-form
                                                        @form:@parent:checklists-growl-form
                                                        addspacetype-dialog"/>

                            <div class="gray_button">

                                <p:commandButton id="inspections-inspectiondetails-abort"
                                                 value="Cancel"
                                                 styleClass="gray-button"
                                                 rendered="#{checklistsBB.editModeCurrentOccSpaceType}"
                                                 icon="fa fa-stop"
                                                 process="@none"
                                                 immediate="true"
                                                 actionListener="#{checklistsBB.onEditModeOccSpaceTypeAbort(ev)}"
                                                 oncomplete="PF('createnewspacetype-dialog-var').hide()"
                                                 update="@form
                                                 @form:@parent:checklists-growl-form"/>
                            </div>

                            <div class="p-grid">
                                <div class="p-col-6">
                                    ID
                                </div>
                                <div class="p-col-6">
                                    <h:outputText value="#{checklistsBB.currentOccSpaceType.spaceTypeID eq 0 ? '(New space type)' :checklistsBB.currentOccSpaceType.spaceTypeID}" />
                                </div>

                                <div class="p-col-6">
                                    Title
                                </div>
                                <div class="p-col-6">
                                    <h:outputText value="#{checklistsBB.currentOccSpaceType.spaceTypeTitle}" 
                                                  rendered="#{!checklistsBB.editModeCurrentOccSpaceType}"/>
                                    <p:inputText value="#{checklistsBB.currentOccSpaceType.spaceTypeTitle}" 
                                                 rendered="#{checklistsBB.editModeCurrentOccSpaceType}"/>
                                </div>

                                <div class="p-col-6">
                                    Description
                                </div>
                                <div class="p-col-6">
                                    <h:outputText value="#{checklistsBB.currentOccSpaceType.spaceTypeDescription}" 
                                                  rendered="#{!checklistsBB.editModeCurrentOccSpaceType}"/>
                                    <p:inputText value="#{checklistsBB.currentOccSpaceType.spaceTypeDescription}" 
                                                 rendered="#{checklistsBB.editModeCurrentOccSpaceType}"/>
                                </div>
                            </div>
                        </h:form>
                    </p:dialog>
                    
                    
                    
                    
                    
                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>


