<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Person properties</title>
    </h:head>
    <h:body>
        <ui:composition template="/restricted/navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view id="pers-prop-view">

                    <div class="mainContainer">

                        <h:form id="pers-prop-messages-form">
                            <h:messages id="pers-prop-messages"
                                        globalOnly="true" showDetail="true" showSummary="true"
                                        warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                            </h:messages>
                        </h:form>

                            
                        <p:panel    id="pers-prop-list-panel"
                                    toggleable="true"
                                    widgetVar="pers-prop-list-panel-var"
                                    collapsed="false"
                                    header="Properties connected to #{person}">
                       
                            <h2>Person-connected properties</h2>
                            
                            
                            <h:form id="connect-person-to-property-form">
                                

                                <p:selectOneMenu id="property-som" tabindex="3" value="#{personsBB.selectedProperty}">
                                    <f:converter converterId="propertyConverter"/>
                                    <f:selectItem itemLabel="select a property..." noSelectionOption="true" itemDisabled="true"/>
                                    <f:selectItems id="propertylist-selitems" 
                                                   value="#{personsBB.propertyCandidateList}" 
                                                   var="p" 
                                                   itemValue="#{p}" 
                                                   itemLabel="#{p.address} (parid: #{p.parID}, propid: #{p.propertyID}" />
                                </p:selectOneMenu>
                                <p:spacer height="5px" />
                                
                                <p:commandButton value="connect #{personsBB.selectedPerson.firstName} #{personsBB.selectedPerson.lastName} to this property" 
                                        ajax="true"
                                         icon="fa fa-link"
                                         update="table-person-associated-properties"
                                         actionListener="#{personsBB.connectCurrentPersonToProperty}"
                                         />
                                <p:spacer height="5px" />
                                
                                <h3>Properties connected to this person</h3>
                                <p:dataTable
                                    id="table-person-associated-properties"
                                    var="prop"
                                    value="#{personsBB.propertyPersonList}"
                                    rowKey="#{prop.propertyID}"
                                    filteredValue="#{propertyProfileBB.filteredPropList}"
                                    tableStyleClass="primeDataTable"
                                    draggableRows="false" tabindex="6"
                                    >
                                    <p:column width="4%">
                                        <f:facet name="header">
                                            <h:outputText value="ID"/>
                                        </f:facet>
                                        <h:outputText value="#{prop.propertyID}" />
                                    </p:column>
                                    <p:column width="12%">
                                        <f:facet name="header">
                                            <h:outputText value="Address"/>
                                        </f:facet>
                                        <h:outputText value="#{prop.address}" />
                                    </p:column>

                                    <p:column width="8%">
                                        <f:facet name="header">
                                            <h:outputText value="Muni" />
                                        </f:facet>
                                        <h:outputText value="#{prop.muni.muniName}"/>
                                    </p:column>

                                    <p:column width="7%">
                                        <f:facet name="header">
                                            <h:outputText value="Use Type"/>
                                        </f:facet>
                                        <h:outputText value="#{prop.useType}" />
                                    </p:column>

                                    <p:column width="8%">
                                        <f:facet name="header">
                                            <h:outputText value=""/>
                                        </f:facet>
                                        <p:commandButton icon="fa fa-home"
                                                         value="view property"
                                                         action="#{personsBB.viewPersonAssociatedProperty(prop)}" 
                                                         ajax="true"/>
                                    </p:column>
                                </p:dataTable>

                            </h:form>

                        </p:panel>
                        
                      

                    <!--close main container-->
                    </div>
                    


                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

