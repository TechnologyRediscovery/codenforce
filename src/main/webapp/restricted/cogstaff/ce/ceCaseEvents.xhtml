<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>CE case events</title>
    </h:head>
    <h:body>
        <ui:composition template="/restricted/navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view id="cecase-events-view">

                    <div class="mainContainer">

                        <h:form id="cecase-events-messages-form">
                            <h:messages id="cecase-events-messages"
                                        globalOnly="true" showDetail="true" showSummary="true"
                                        warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                            </h:messages>
                        </h:form>

                        <h:form id="cecase-events-form">

                            <h1>Events</h1>


                            <p:panel    id="cecase-events-panel-add"
                                        toggleable="true"
                                        widgetVar="cecase-events-panel-add-var"
                                        collapsed="false"
                                        header="Add a new event to CE case">



                                <h:form id="insp-events-form-addevent">

                                    <h:panelGrid columns="3" border="0" 
                                                 cellpadding="5" columnClasses="gridTd, gridTd, gridTd"
                                                 footerClass="gridFooter" style="vertical-align: top;">

                                        <h:panelGroup>
                                            <h:outputLabel styleClass="bold" for="newEventTypeMenu">
                                                <h:outputText value="Step 1: Choose type"/>
                                            </h:outputLabel>

                                            <p:selectOneListbox id="newEventTypeMenu" required="true" value="#{cECaseEventsBB.selectedEventType}" tabindex="10">
                                                <p:ajax update="categoryList
                                                        event-add-dialog-show-cb" 
                                                        immediate="true"/> 
                                                <f:selectItems value="#{cECaseEventsBB.availableEventTypeList}" var="et" itemLabel="#{et.label}" />
                                            </p:selectOneListbox>

                                            <h:message for="newEventTypeMenu" showDetail="false" showSummary="true" 
                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <h:outputLabel styleClass="bold" for="categoryList">
                                                <h:outputText value="Step 2: Choose category"/>
                                            </h:outputLabel>


                                            <p:dataScroller id="insp-events-datascroller-chooseeventcategory"
                                                            value="#{cECaseEventsBB.eventCategoryList}"
                                                            var="eventCat"
                                                            rowIndexVar="#{eventCat.categoryID}">

                                                <p:commandButton id="insp-events-button-selecteventcat"
                                                                 ajax="true"
                                                                 value="new #{eventCat.eventCategoryTitle} event"
                                                                 actionListener="#{cECaseEventsBB.initiateNewEvent}"
                                                                 icon="fa fa-plus" 
                                                                 oncomplete=""
                                                                 update="insp-form-addeditevent"

                                                                 />

                                            </p:dataScroller>
                                            <p:selectOneListbox style="width: 300px;" id="categoryList" value="#{cECaseEventsBB.selectedEventCategory}" tabindex="10">
                                                <p:ajax update="selectedEventCategoryDescription
                                                        selectedEventCategoryDescription 
                                                        selectedEventCateogryNotifiesCaseMonitors
                                                        event-add-dialog-show-cb
                                                        " 
                                                        immediate="true"/>
                                                <f:converter converterId="eventCategoryConverter"/>
                                                <f:selectItems  id="catItemsList" value="#{cECaseEventsBB.eventCategoryList}" var="ec" itemValue="#{ec}" itemLabel="#{ec.eventCategoryTitle}"/>
                                            </p:selectOneListbox>

                                            <h:message for="categoryList" showDetail="false" showSummary="true"  
                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <h:outputLabel styleClass="bold" for="newEventTypeMenu">
                                                <h:outputText value="Step 3: Create"/>
                                            </h:outputLabel>
                                            <p:spacer height="5px"/>
                                            <p:commandButton    id="event-add-dialog-show-cb"
                                                                ajax="true" 
                                                                process="@form"
                                                                actionListener="#{cECaseEventsBB.initiateUserChosenEventCreation}" 
                                                                oncomplete="PF('add-event-dialog-var').show()"
                                                                disabled="#{empty cECaseEventsBB.selectedEventCategory}"
                                                                rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                                value="Create new event "  
                                                                icon="fa fa-edit"
                                                                update="addNewEventForm"/>
                                            <h3>Event category info:</h3>
                                            <h:outputText value="Event Cateogry Description: #{cECaseEventsBB.selectedEventCategory.eventCategoryDesc}" id="selectedEventCategoryDescription"/>
                                            <p:spacer height="10px"/>
                                            <h:outputText value="Triggers notification of case monitor subscribers: #{cECaseEventsBB.selectedEventCategory.notifycasemonitors}" id="selectedEventCateogryNotifiesCaseMonitors"/>

                                        </h:panelGroup>
                                    </h:panelGrid>
                                </h:form>



                            </p:panel>


                            <p:panel    id="cecase-events-panel-add"
                                        toggleable="true"
                                        widgetVar="cecase-events-panel-add-var"
                                        collapsed="false"
                                        header="Add a new event to CE case">


                                <h:form id="event-messages-form">
                                    <h:messages id="cecases-events-messages"
                                                globalOnly="true" showDetail="true" showSummary="true"
                                                warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                    </h:messages>
                                </h:form>


                                <h2 id="event-history">Event history</h2>

                                <h:form id="event-dt-form">


                                    <p:dataTable
                                        id="caseEventTable"
                                        var="e"
                                        rowKey="#{e.eventID}"
                                        value="#{ceCaseEventsBB.currentCase.visibleEventList}"
                                        tableStyleClass="primeDataTable"
                                        resizableColumns="true"
                                        rowExpandMode="multiple"
                                        expandedRow="false"
                                        scrollHeight="400"
                                        filteredValue="#{ceCaseEventsBB.filteredEventList}"
                                        widgetVar="caseEventTable"
                                        >
                                        <!--<p:ajax event="rowSelect" update="selectedRowLabel"/>-->

                                        <p:column width="3%" exportable="false">
                                            <p:rowToggler/>
                                        </p:column>

                                        <p:column width="4%">
                                            <i class="material-icons"><h:outputText value="#{e.category.icon.materialIcon}"/></i>
                                        </p:column>

                                        <p:column width="9%" sortBy="#{e.dateOfRecord}">
                                            <f:facet name="header">
                                                <h:outputText value="Date" />
                                            </f:facet>
                                            <div class="rowExpansion">
                                                <h:outputText value="#{e.dateOfRecordPretty}"/>
                                            </div>
                                        </p:column>

                                        <p:column width="4%" sortBy="#{e.eventID}">
                                            <f:facet name="header">
                                                <h:outputText value="ID" />
                                            </f:facet>
                                            <h:outputText value="#{e.eventID}"/>
                                        </p:column>
                                        <ui:remove>
                                            <p:column width="8%" sortBy="#{e.category.eventType.label}"
                                                      filterBy="#{e.category.eventType.label}">
                                                <f:facet name="header">
                                                    <h:outputText value="Type" />
                                                </f:facet>
                                                <h:outputText value="#{e.category.eventType.label}"/>
                                            </p:column>
                                        </ui:remove>

                                        <p:column width="12%" sortBy="#{e.category.eventCategoryTitle}"
                                                  filterBy="#{e.category.eventCategoryTitle}">
                                            <f:facet name="header">
                                                <h:outputText value="Category" />
                                            </f:facet>
                                            <div class="rowExpansion">
                                                <h:outputText value="#{e.category.eventCategoryTitle}"/>
                                            </div>
                                        </p:column>
                                        <p:column width="5%" filterBy="#{e.owner.person.lastName}"
                                                  sortBy="#{e.owner.person.lastName}">

                                            <f:facet name="header">
                                                <h:outputText value="Owner" />
                                            </f:facet>
                                            <h:outputText value="#{e.owner.person.lastName}"/>
                                        </p:column>
                                        <p:column width="20%" style="word-wrap: normal;">
                                            <f:facet name="header">
                                                <h:outputText value="Description" />
                                            </f:facet>
                                            <div class="rowExpansion">
                                                <h:outputText value="#{e.description}"/>
                                            </div>
                                        </p:column>

                                        <p:column width="6%" exportable="false">
                                            <f:facet name="header">
                                                <h:outputText value="Hide" />
                                            </f:facet>
                                            <p:commandButton icon="fa fa-moon-o"
                                                             ajax="true"
                                                             disabled="#{e.hidden}"
                                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                             actionListener="#{ceCaseEventsBB.hideEvent(e)}" 
                                                             update="caseEventTable
                                                             event-messages-form"
                                                             />
                                            <p:commandButton icon="fa fa-star"
                                                             ajax="true"
                                                             disabled="#{!e.hidden}"
                                                             actionListener="#{ceCaseEventsBB.unHideEvent(e)}" 
                                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                             update="caseEventTable
                                                             event-messages-form"
                                                             />

                                        </p:column>

                                        <p:column width="4%" exportable="false">
                                            <f:facet name="header">
                                                <h:outputText value="Edit" />
                                            </f:facet>
                                            <p:commandButton icon="fa fa-edit"
                                                             ajax="true"
                                                             actionListener="#{ceCaseEventsBB.editEvent(e)}" 
                                                             oncomplete="PF('add-event-dialog-var').show()"
                                                             update="addNewEventForm
                                                             event-messages-form"
                                                             />

                                        </p:column>

                                        <p:rowExpansion>

                                            <div class="outlinedBox">
                                                <h2><h:outputText value="#{e.category.eventType.label}:#{e.category.eventCategoryTitle}"/>
                                                    ; Event ID: <h:outputText value="#{e.eventID}"/> </h2>
                                                <h:panelGrid columns="4" cellpadding="10" footerClass="gridFooter"
                                                             columnClasses="gridTd, gridTd, gridTd, gridTd">

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Description" />
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.description}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Disclose to Municipality Staff?" />
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.discloseToMunicipality}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Disclose to Public?" />
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.discloseToPublic}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Creation time stamp"/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.timestampPretty}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Active Event?"/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.active}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Requests action?"/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.requestsAction}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Requested event: "/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.requestedEventCat.eventType.label}: #{e.requestedEventCat.eventCategoryTitle}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Action requested by: "/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.actionRequestedBy.person.firstName} #{e.actionRequestedBy.person.lastName}"/>
                                                        </div>
                                                    </h:panelGroup>



                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Intended user/action taker: "/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.responderIntended.person.firstName} #{e.responderIntended.person.lastName}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Action taken by: "/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.responderActual.person.firstName} #{e.responderActual.person.lastName}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Action timestamp: "/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.responseTimePrettyDate}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Request rejected? "/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.requestRejected}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Action response notes:"/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.responderNotes}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <f:facet name="footer" class="leftalign">
                                                        <h:outputLabel styleClass="bold" style="text-align: left" value="Notes"/>
                                                        <p:spacer height="15px"/>
                                                        <div class="rowExpansion" style="text-align: left">
                                                            <h:outputText escape="false" value="#{e.notes}"/>
                                                        </div>
                                                    </f:facet>

                                                </h:panelGrid>
                                            </div>
                                        </p:rowExpansion>

                                    </p:dataTable>
                                    
                                    <p:spacer height="5px" />

                                    <p:inputSwitch id="events-showhidden-sbcb" 
                                                   style="margin-right: 5px;"
                                                   value="#{ceCaseEventsBB.currentCase.showHiddenEvents}" 
                                                   offLabel="view hidden events"
                                                   onLabel="conceal hidden events">
                                        <p:ajax update="caseEventTable" />

                                    </p:inputSwitch>



                                    <p:inputSwitch id="events-inactive-sbcb" 
                                                   value="#{ceCaseEventsBB.currentCase.showInactiveEvents}"
                                                   offLabel="view inactive events"
                                                   onLabel="conceal inactive events">
                                        <p:ajax update="caseEventTable" />
                                    </p:inputSwitch>

                                </h:form>

                           
                        </p:panel>



                        <!--close main container-->
                    </div>
                    
                    
                    <p:dialog    id="add-event-dialog"
                                 height="650" width="900"
                                 widgetVar="add-event-dialog-var"
                                 closable="true" 
                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}">


                      
                            
                    </p:dialog>
                    
                </f:view>
                
            </ui:define>
        </ui:composition>
    </h:body>
</html>

