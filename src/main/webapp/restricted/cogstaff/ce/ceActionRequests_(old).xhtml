<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Code Enforcement Action Requests</title>
    </h:head>
    <h:body>
        <ui:composition template="/restricted/navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view id="CEActionRequestsView">
                    <div class="mainContainer">
                        <h:form id="msgForm">

                            <h:messages id="ceActionRequestsMessages" globalOnly="true" showDetail="true" showSummary="true"
                                        warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                            </h:messages>
                        </h:form>

                        <h1>Code Enforcement Action Requests in <h:outputText value="#{sessionBean.sessMuni.muniName}"/></h1>


                        <h:panelGrid columns="2" cellpadding="10" footerClass="gridFooter" styleClass="split-page-panelgrid"
                                     columnClasses="gridTd-splitPage, gridTd-splitPage">

                            <h:panelGroup styleClass="split-page-list-side">
                                <h:form id="cear-query-selector-form">

                                    <h2>Choose a pre-built query</h2>


                                    <p:selectOneMenu id="eventquery-som" 
                                                     tabindex="1" 
                                                     value="#{cEActionRequestsBB.selectedQueryCEAR}"
                                                     style="margin-right: 10px;">
                                        <f:converter converterId="bOBQueryConverter"/>
                                        <f:selectItem itemLabel="select a query..." noSelectionOption="true" itemDisabled="true"/>
                                        <f:selectItems id="querylist-si" value="#{cEActionRequestsBB.queryList}" var="q" itemValue="#{q}" itemLabel="#{q.queryTitle}" />
                                        <p:ajax 
                                            update="cears-query-desc-ot"
                                            />
                                    </p:selectOneMenu>



                                    <p:commandButton    id="execute-selected-query" 
                                                        ajax="true"
                                                        value="perform selected query" 
                                                        actionListener="#{cEActionRequestsBB.executeQuery}"
                                                        disabled="false"
                                                        icon="fa fa-wheelchair-alt"
                                                        update="
                                                        search-params-form
                                                        actionRequestListForm
                                                        "/>
                                    <p:spacer height="5px" />
                                    <h:outputLabel styleClass="bold" value="Query description: " for="cears-query-desc-ot" />
                                    <p:spacer height="5px" />
                                    <h:outputText id="cears-query-desc-ot" value="#{cEActionRequestsBB.selectedQueryCEAR.queryName.desc}" />

                                </h:form>


                                <h:form id="search-params-form">

                                    <p:fieldset legend="Advanced search options"
                                                toggleable="true" collapsed="true" style="background-color: white; back">

                                        <h:panelGrid columns="2" cellpadding="10" footerClass="gridFooter"
                                                     columnClasses="gridTd-solid-back, gridTd-solid-back">

                                            <h:panelGroup>
                                                <p:outputLabel id="eventDateCalStartOL" for="eventDateCalStart" value="Query start date "/>
                                                <p:calendar id="eventDateCalStart" value="#{cEActionRequestsBB.searchParams.date_start_val_util}" 
                                                            mode="popup"  
                                                            showOn="button" pattern="EEE, dd MMM, yyyy"
                                                            navigator="true" tabindex="16" timeInput="true" showHour="true" showMinute="true" showSecond="false" showMillisec="false"
                                                            showButtonPanel="true" showTodayButton="true"
                                                            required="true"/>
                                                <h:message for="eventDateCalStart" showDetail="false" showSummary="true" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel id="eventDateCalEndOL" for="eventDateCalEnd" value="Query end date "/>
                                                <p:calendar id="eventDateCalEnd" value="#{cEActionRequestsBB.searchParams.date_end_val_util}" 
                                                            mode="popup" 
                                                            showOn="button" pattern="EEE, dd MMM, yyyy"
                                                            navigator="true" tabindex="16" timeInput="true" showHour="true" showMinute="true" showSecond="false" showMillisec="false"
                                                            showButtonPanel="true" showTodayButton="true"
                                                            required="true" />
                                                <h:message for="eventDateCalEnd" showDetail="false" showSummary="true" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                            </h:panelGroup>
                                            <h:panelGroup>
                                                <p:outputLabel id="useAttachedToCaseOL" for="useAttachedToCase" value="Filter by case attachment?"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanCheckbox id="useAttachedToCase" value="#{cEActionRequestsBB.searchParams.caseAttachment_ctl}"/>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel id="attachedToCaseOL" for="attachedToCaseCB" value="Attached to case"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanButton id="attachedToCaseCB" onLabel="Yes" offLabel="No" value="#{cEActionRequestsBB.searchParams.caseAttachment_val}"/>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel id="useMarkedUrgentol" for="useMarkedUrgent" value="Filter by safety hazard?"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanCheckbox id="useMarkedUrgent" value="#{cEActionRequestsBB.searchParams.urgent_ctl}" />
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel id="markedUrgentOL" for="useMarkedUrgentcb" value="Safety hazard"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanButton id="useMarkedUrgentcb" onLabel="Yes" offLabel="No" value="#{cEActionRequestsBB.searchParams.urgent_val}" disabled="false" />
                                            </h:panelGroup>

                                            <ui:remove>


                                                <!--TODO: at the time of writing this comment, there isn't a parameter for searching by request ID. If one is added, please put it here. -->
                                                <h:panelGroup>
                                                    <p:outputLabel id="useRequestIDOL" for="useRequestIDCB" value="Search by Request ID?"/>
                                                    <p:spacer height="5px"/>
                                                    <p:selectBooleanCheckbox id="useRequestIDCB" value="#{cEActionRequestsBB.searchParams}" />
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:outputLabel id="requestIDOL" for="requestIDIT" value="Request ID:"/>
                                                    <p:spacer height="5px"/>
                                                    <p:inputText id="requestIDIT" value="#{cEActionRequestsBB.searchParams}" disabled="false"/>
                                                    <h:message for="requestIDIT" showDetail="false" showSummary="true" 
                                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                                </h:panelGroup>
                                            </ui:remove>

                                            <h:panelGroup>
                                                <p:outputLabel id="useActionRequestStatusOL" for="useActionRequestStatusSB" value="Search by Request status?"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanCheckbox id="useActionRequestStatusSB" value="#{cEActionRequestsBB.searchParams.requestStatus_ctl}" />
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:selectOneMenu id="ceactionrequeststatusmenuSearch" required="false" value="#{cEActionRequestsBB.searchParams.requestStatus_val}">
                                                    <f:converter converterId="ceActionRequestStatusConverter"/>
                                                    <f:selectItems value="#{cEActionRequestsBB.statusList}"
                                                                   var="cearqs" itemValue="#{cearqs}" itemLabel="#{cearqs.statusTitle}"/>
                                                </p:selectOneMenu>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel id="useNotAtAddressOL" for="useNotAtAddressCB" value="Filter by not at address?"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanCheckbox id="useNotAtAddressCB" value="#{cEActionRequestsBB.searchParams.nonaddressable_ctl}" />
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel id="notAtAddressOL" for="notAtAddressCB" value="Not at an address"/>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanButton id="notAtAddressCB" onLabel="Yes" offLabel="No" value="#{cEActionRequestsBB.searchParams.nonaddressable_val}" disabled="false" />
                                            </h:panelGroup>
                                        </h:panelGrid>
                                        <p:spacer height="15px"/>

                                        <p:commandButton    id="custom-query-cb"
                                                            ajax="true" 
                                                            value="Execute custom query" 
                                                            actionListener="#{cEActionRequestsBB.executeCustomQuery}"
                                                            update="search-params-form
                                                            actionRequestListForm"/>

                                    </p:fieldset>

                                </h:form>

                                <h2>Results</h2>


                                <h:form id="actionRequestListForm">
                                    <h:messages id="actionQueryMessages" globalOnly="true" showDetail="true" showSummary="true"
                                                warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                    </h:messages>

                                    <h:outputText id="query-results-ot" value="results from query named #{cEActionRequestsBB.selectedQueryCEAR.queryName.title} 
                                                  | execution timestamp: #{cEActionRequestsBB.selectedQueryCEAR.executionTimestampPretty}" />

                                    <p:dataTable
                                        id="actionRequestTable"
                                        var="r"
                                        rowKey="#{r.requestID}"
                                        value="#{cEActionRequestsBB.requestList}"
                                        tableStyleClass="primeDataTable"
                                        resizableColumns="true"
                                        reflow="true"
                                        expandedRow="false"
                                        >
                                        <p:column width="3%">
                                            <f:facet name="header">
                                                <h:outputText value="ID" />
                                            </f:facet>
                                            <div class="wrapText">
                                                <h:outputText value="#{r.requestID}"/>
                                            </div>
                                        </p:column>

                                        <p:column width="8%">
                                            <f:facet name="header">
                                                <h:outputText value="Issue Type" />
                                            </f:facet>
                                            <div class="wrapText">
                                                <h:outputText value="#{r.issue.name}"/>
                                            </div>
                                        </p:column>

                                        <p:column width="8%">
                                            <f:facet name="header">
                                                <h:outputText value="Address" />
                                            </f:facet>
                                            <div class="rowExpansion">
                                                <h:outputText value="#{r.requestProperty.address}"/>
                                            </div>
                                        </p:column>

                                        <p:column width="10%">
                                            <f:facet name="header">
                                                <h:outputText value="Status" />
                                            </f:facet>
                                            <div class="wrapText"> 
                                                <h:outputText value="#{r.requestStatus.statusTitle}"/>
                                            </div>
                                        </p:column>

                                        <p:column width="3%">
                                            <f:facet name="header">
                                                <h:outputText value="Age" />
                                            </f:facet>
                                            <h:outputText value="#{r.daysSinceDateOfRecord}"/>
                                        </p:column>

                                        <p:column width="8%">
                                            <p:commandButton actionListener="#{cEActionRequestsBB.manageActionRequest(r)}"
                                                             ajax="true" 
                                                             value="manage"
                                                             icon="fa fa-hand-o-right"
                                                             update="
                                                             req-details-form
                                                             attach-to-existing-case-form
                                                             msgForm
                                                             "/>
                                        </p:column>
                                    </p:dataTable>

                                    <p:spacer height="15px"/>

                                    <p:commandButton    id="prep-multi-cear-cb"
                                                        value="Prepare request list report"
                                                        actionListener="#{cEActionRequestsBB.prepareReportMultiCEAR}"
                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                        disabled="false"
                                                        oncomplete="PF('cear-print-dialog-var').show()"
                                                        icon="fa fa-print"
                                                        update="cear-print-form"
                                                        />

                                    <p:spacer height="15px"/>

                                    <p:chart type="donut" 
                                             model="#{cEActionRequestsBB.requestReasonDonut}" 
                                             style="width:600px; height: 600px;"/>



                                </h:form>

                            </h:panelGroup>

                            <h:panelGroup styleClass="split-page-manage-side">
                                <h:form id="req-details-form">

                                    <h1>Code enforcement request</h1>

                                    <h2>
                                        <h:outputText id="header-type-ot" value="#{cEActionRequestsBB.selectedRequest.issue.name}"/>
                                        <h:outputText   id="header-id-ot" value=" (id: #{cEActionRequestsBB.selectedRequest.requestID})"/> 

                                        <br />
                                        <h:outputText id="header-addr-ot" value="#{cEActionRequestsBB.selectedRequest.requestProperty.address} "/>  
                                        <h:outputText id="header-muni-ot" value=", #{cEActionRequestsBB.selectedRequest.requestProperty.muni.muniName}"/>  

                                    </h2>

                                    <h:outputLabel styleClass="bold" value="Status:"/>
                                    <p:spacer height="5px"/>

                                    <h:outputText id="selr-status-ot" value="#{cEActionRequestsBB.selectedRequest.requestStatus.statusTitle}"/>


                                    <p:spacer height="15px"/>

                                    <h:outputLabel styleClass="bold" value="Available actions:"/>

                                    <p:spacer height="5px"/>

                                    <p:commandButton    id="open-new-case-cb"
                                                        ajax="false" value="Open new code enf case at this property" 
                                                        disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                        action="#{cEActionRequestsBB.path1CreateNewCaseAtProperty}"
                                                        update="ceActionRequestsMessages" icon="fa fa-folder" 
                                                        styleClass="cear-actions-button"/>
                                    <p:spacer height="5px"/>

                                    <p:commandButton    id="attach-to-case-cb"
                                                        value="Attach to existing code enf case"
                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                        disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                        onclick="PF('attach-to-case-dialog').show()"
                                                        update="attach-to-existing-case-form:cases-on-selected-request-property-DS"
                                                        icon="fa fa-book" />
                                    <p:spacer height="5px"/>


                                    <p:commandButton    id="no-violation-found-cb"
                                                        value="No violation found on site"
                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                        disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                        onclick="PF('no-violation-found-dialog').show()"
                                                        icon="fa fa-circle-o"/>

                                    <p:commandButton    id="invalid-request-cb"
                                                        value="Invalid request"
                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                        disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                        onclick="PF('invalid-dialog').show()"
                                                        icon="fa fa-exclamation-circle"/>


                                    <p:spacer height="5px" />
                                    <hr />
                                    <p:spacer height="5px" />

                                    <ui:remove>
                                        <!--
                                        
                                        TODO: Figure out why prepareReportSingleCEAR has gone missing
                                        
                                    <p:commandButton    id="print-singleCAR-cb"
                                                        value="Print request"
                                                        actionListener="{cEActionRequestsBB.prepareReportSingleCEAR}"
                                                        rendered="{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                        disabled="false"
                                                        oncomplete="PF('cear-print-dialog-var').show()"
                                                        icon="fa fa-print"
                                                        update="cear-print-form"
                                                        />
                                        -->
                                    </ui:remove>

                                    <p:spacer height="5px"/>

                                    <p:commandButton      
                                        id="attach-internal-note-cb"
                                        onclick="PF('muni-message-dialog').show()" 

                                        value="Attach internal note"
                                        icon="fa fa-pencil-square-o"
                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                        />





                                    <div class="outlinedBox">
                                        <h:panelGrid columns="2" cellpadding="10" footerClass="gridFooter"
                                                     columnClasses="gridTd, gridTd" id="selectedRequestDetails">

                                            <h:panelGroup>
                                                <h:outputLabel class="bold" value="Date Submitted" />
                                                <p:spacer height="5px"/>
                                                <div class="wrapText">
                                                    <h:outputText id="selr-submitted-ts"  value="#{cEActionRequestsBB.selectedRequest.formattedSubmittedTimeStamp}"/>
                                                </div>
                                            </h:panelGroup>
                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="ID"/>
                                                <p:spacer height="5px"/>
                                                <div class="wrapText">
                                                    <h:outputText id="selr-id" value="#{cEActionRequestsBB.selectedRequest.requestID}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel class="bold" value="Issue Type" />
                                                <p:spacer height="5px"/>
                                                <div class="wrapText">
                                                    <h:outputText id="selr-issueType" value="#{cEActionRequestsBB.selectedRequest.issue.name}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel class="bold" value="Attached to CE case?" />
                                                <p:spacer height="5px"/>
                                                <div class="wrapText">
                                                    <h:outputText id="selr-attachedCase" 
                                                                  value="#{cEActionRequestsBB.selectedRequest.caseID == 0 ? null : cEActionRequestsBB.selectedRequest.caseID}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>

                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel class="bold" value="Address" />
                                                <p:spacer height="5px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText id="selr-prop-address" value="#{cEActionRequestsBB.selectedRequest.requestProperty.address}"/><br />
                                                    <h:outputText id="selr-prop-muni" value="#{cEActionRequestsBB.selectedRequest.requestProperty.muni.muniName}"/>
                                                </div>
                                                <p:spacer height="5px"/>

                                                <p:commandButton    id="change-property-cb" 
                                                                    onclick="PF('change-property-dialog').show()" 
                                                                    value="change request property" 
                                                                    styleClass="noFill button-size-small"
                                                                    disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                                    icon="fa fa-home"
                                                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"/>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel class="bold" value="Public access reference num" />
                                                <div class="rowExpansion">
                                                    <h:outputText id="selr-pacc" value="#{cEActionRequestsBB.selectedRequest.requestPublicCC}"/>
                                                </div>
                                                <p:spacer height="5px"/>
                                                <p:selectBooleanCheckbox id="selr-access-sbcb" value="#{cEActionRequestsBB.selectedRequest.paccEnabled}"
                                                                         disabled="#{cEActionRequestsBB.disablePACCControl}">
                                                    <p:ajax listener="#{cEActionRequestsBB.changePACCAccess}" update="msgForm:ceActionRequestsMessages" />
                                                </p:selectBooleanCheckbox>
                                                <h:outputText value=" Allow access using ref num?"/>
                                                <p:spacer height="5px"/>

                                            </h:panelGroup>


                                            <h:panelGroup>
                                                <div class="wrapText">
                                                    <h:outputLabel styleClass="bold" value="Human safety issue?"/>
                                                    <p:spacer height="5px"/>
                                                    <h:outputText id="selr-isurgent"  value="#{cEActionRequestsBB.selectedRequest.isUrgent}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>

                                                <div class="wrapText">
                                                    <h:outputLabel id="selr-persontype" styleClass="bold" value="Requestor ID:#{cEActionRequestsBB.selectedRequest.requestor.personID} 
                                                                   (#{cEActionRequestsBB.selectedRequest.requestor.personType.label}): "/>
                                                    <p:spacer height="5px"/>

                                                    <h:outputText id="selr-pers-fn" value="#{cEActionRequestsBB.selectedRequest.requestor.firstName}" />
                                                    <h:outputText id="selr-pers-ln" value="#{cEActionRequestsBB.selectedRequest.requestor.lastName}"/><br /> 
                                                    <h:outputText id="selr-pers-str" value="#{cEActionRequestsBB.selectedRequest.requestor.addressStreet}"/> <br />
                                                    <h:outputText id="selr-pers-city" value="#{cEActionRequestsBB.selectedRequest.requestor.addressCity}, "/> 
                                                    <h:outputText id="selr-pers-state" value="#{cEActionRequestsBB.selectedRequest.requestor.addressState}"/>                                            
                                                    <h:outputText id="selr-pers-zip" value="#{cEActionRequestsBB.selectedRequest.requestor.addressZip}"/> 

                                                </div>
                                                <p:spacer height="5px"/>
                                                <p:commandButton    id="change-person-cb"
                                                                    onclick="PF('change-person-dialog').show()" 
                                                                    value="change requestor Person" 
                                                                    styleClass="noFill button-size-small" 
                                                                    icon="fa fa-child"
                                                                    disabled="#{empty cEActionRequestsBB.selectedRequest}"
                                                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}" />
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Contact: "/>
                                                <p:spacer height="5px"/>
                                                <div class="wrapText"> 
                                                    <h:outputText value="Phone (cell): "/>
                                                    <h:outputText id="selr-pers-phone-cell" value="#{cEActionRequestsBB.selectedRequest.requestor.phoneCell}"/> <br />
                                                    <h:outputText value="Phone (work): "/>
                                                    <h:outputText id="selr-pers-phone-work" value="#{cEActionRequestsBB.selectedRequest.requestor.phoneWork}"/> 
                                                    <h:outputText value="Phone (home): "/>
                                                    <h:outputText id="selr-pers-phone-home" value="#{cEActionRequestsBB.selectedRequest.requestor.phoneHome}"/> <br />
                                                    <h:outputText value="Email: "/>
                                                    <h:outputText id="selr-pers-email" value="#{cEActionRequestsBB.selectedRequest.requestor.email}"/>
                                                </div>
                                            </h:panelGroup>



                                            <f:facet name="footer" class="leftalign">
                                                <h:outputLabel styleClass="bold" value="Request description:"/>
                                                <div class="rowExpansion" style="leftalign">
                                                    <h:outputText id="selr-descr" escape="false" value="#{cEActionRequestsBB.selectedRequest.requestDescription}"/>
                                                </div>

                                                <p:spacer height="5px"/>
                                                <hr />
                                                <p:spacer height="5px"/>

                                                <h:outputLabel id="selr-photos" styleClass="bold" value="Photos on request: #{cEActionRequestsBB.selectedRequest.blobIDList.size()}"/>
                                                <p:commandButton onclick="PF('photo-dialog').show()" 
                                                                 icon="fa fa-pencil-square-o"
                                                                 value="view photos" 
                                                                 styleClass="noFill button-size-small"
                                                                 update="photo-form:photoTable"
                                                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                                 />


                                                <p:spacer height="5px"/>
                                                <hr />
                                                <p:spacer height="5px"/>

                                                <h:outputLabel styleClass="bold" value="Officer-only notes: "/>
                                                <p:commandButton onclick="PF('internal-message-dialog').show()" 
                                                                 icon="fa fa-pencil-square-o"
                                                                 value="new note" 
                                                                 styleClass="noFill button-size-small" 
                                                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasCOGStaffPermissions}" />
                                                <p:spacer height="5px"/>
                                                <div class="rowExpansion" style="leftalign">
                                                    <h:outputText id="selr-notes-internal" escape="false" value="#{cEActionRequestsBB.selectedRequest.cogInternalNotes}"/>
                                                </div>

                                                <p:spacer height="5px"/>
                                                <hr />
                                                <p:spacer height="5px"/>

                                                <h:outputLabel styleClass="bold" value="System internal only"/>
                                                <p:commandButton onclick="PF('muni-message-dialog').show()" 
                                                                 value="new note"
                                                                 icon="fa fa-pencil-square-o"
                                                                 styleClass="noFill button-size-small" 
                                                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}" />
                                                <p:spacer height="5px"/>
                                                <div class="rowExpansion" style="leftalign">
                                                    <h:outputText id="selr-notes-muni" escape="false" value="#{cEActionRequestsBB.selectedRequest.muniNotes}"/>
                                                </div>

                                                <p:spacer height="5px"/>
                                                <hr />
                                                <p:spacer height="5px"/>

                                                <h:outputLabel styleClass="bold" value="Public notes: "/>
                                                <p:commandButton onclick="PF('public-message-dialog').show()" 
                                                                 value="new note" 
                                                                 icon="fa fa-pencil-square-o"
                                                                 styleClass="noFill button-size-small" 
                                                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}" />
                                                <p:spacer height="5px"/>
                                                <div class="rowExpansion" style="leftalign">
                                                    <h:outputText id="selr-notes-public" escape="false" value="#{cEActionRequestsBB.selectedRequest.publicExternalNotes}"/>
                                                </div>
                                            </f:facet>
                                        </h:panelGrid>
                                    </div>

                                    <p:spacer height="5px"/>


                                    <p:commandButton    id="manually-override-status-cb"
                                                        value="Manually override request status"
                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasSysAdminPermissions}"
                                                        disabled="#{empty cEActionRequestsBB.selectedRequest}"
                                                        onclick="PF('override-request-status-dialog').show()"
                                                        icon="fa fa-gears"/>

                                    <p:spacer height="5px"/>


                                </h:form>
                            </h:panelGroup>
                        </h:panelGrid>

                        <p:dialog widgetVar="attach-to-case-dialog"
                                  header="Attach request to existing case"
                                  height="550px" width="50%"
                                  responsive="true"

                                  closable="true"
                                  rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}">

                            <h:form id="attach-to-existing-case-form">

                                <p>Choose an existing case on <h:outputLabel for="invalidMessageITA" value="#{cEActionRequestsBB.selectedRequest.requestProperty.address}"/>:</p>
                                <p:scrollPanel>
                                    <p:dataScroller
                                        id="cases-on-selected-request-property-DS"
                                        value="#{cEActionRequestsBB.caseListForSelectedProperty}"
                                        var="c">
                                        <p>Case ID: <h:outputText value="#{c.caseID}"/> <br />
                                            Name: <h:outputText value="#{c.caseName}" /> <br />
                                            Phase: <h:outputText value="#{c.casePhase.label}"/> <br />
                                            Opening date: <h:outputText value="#{c.originiationDatePretty}"/> <br />
                                            Closing date: <h:outputText value="#{c.closingDatePretty}"/> <br />
                                        </p>
                                        <p:commandButton value="Assign request to this case"
                                                         actionListener="#{cEActionRequestsBB.path2UseSelectedCaseForAttachment(c)}"
                                                         update="msgForm:ceActionRequestsMessages
                                                         req-details-form
                                                         actionRequestListForm:actionRequestTable"
                                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                         oncomplete="PF('attach-to-case-dialog').hide()"/>
                                        <p:commandButton ajax="true" 
                                                         value="Cancel" icon="fa fa-stop" 
                                                         onclick="PF('attach-to-case-dialog').hide()"/>
                                        <hr/>

                                    </p:dataScroller>
                                </p:scrollPanel>
                            </h:form>
                        </p:dialog>

                        <p:confirmDialog message="Mark request as invalid" 
                                         severity="alert" widgetVar="invalid-dialog"
                                         closable="true"
                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}">

                            <h:form id="invalid-form">
                                <h:outputLabel for="invalidMessageITA" value="What makes this an invalid request?"/>
                                <p:spacer height="15px"/>
                                <p:inputTextarea id="invalidMessageITA" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.invalidMessage}"/>
                                <p:spacer height="15px"/>
                                <p>This message, your name, and a timestamp will be appended <br />to the public note section of request ID 
                                    <h:outputText escape="false" value="#{cEActionRequestsBB.selectedRequest.requestID}"/> </p>

                                <p:spacer height="15px "/>
                                <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.path3AttachInvalidMessage}"
                                                 value="Submit" icon="fa fa-link" oncomplete="PF('invalid-dialog').hide()"
                                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                 update="req-details-form
                                                 msgForm:ceActionRequestsMessages
                                                 actionRequestListForm:actionRequestTable"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('invalid-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>



                        <p:confirmDialog message="Mark request: No Violation Found" 
                                         severity="alert" widgetVar="no-violation-found-dialog"
                                         closable="true"
                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}">

                            <h:form id="no-violation-form">
                                <h:outputLabel for="noViolationMessageITA" value="Describe the results of your request investigation:"/>
                                <p:spacer height="15px"/>
                                <p:inputTextarea id="noViolationMessageITA" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.noViolationFoundMessage}"/>
                                <p:spacer height="15px"/>
                                <p>This message, your name, and a timestamp will be appended <br />to the public note section of request ID 
                                    <h:outputText escape="false" value="#{cEActionRequestsBB.selectedRequest.requestID}"/> </p>

                                <p:spacer height="15px"/>
                                <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.path4AttachNoViolationFoundMessage}"
                                                 value="Submit" icon="fa fa-link" oncomplete="PF('no-violation-found-dialog').hide()"
                                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                 update="req-details-form
                                                 msgForm:ceActionRequestsMessages
                                                 actionRequestListForm:actionRequestTable"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('no-violation-found-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>

                        <p:confirmDialog message="Override request status" 
                                         severity="alert" widgetVar="override-request-status-dialog"
                                         closable="true"
                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}">

                            <h:form id="override-request-status-form">

                                <h:outputLabel styleClass="bold" for="ceactionrequeststatusmenu" value="Change status to:"/>

                                <p:selectOneMenu id="ceactionrequeststatusmenu" required="false" value="#{cEActionRequestsBB.selectedChangeToStatus}">
                                    <f:converter converterId="ceActionRequestStatusConverter"/>
                                    <f:selectItem itemLabel="select one..." noSelectionOption="true" itemDisabled="true"/>
                                    <f:selectItems value="#{cEActionRequestsBB.statusList}"
                                                   var="cearqs" itemValue="#{cearqs}" itemLabel="#{cearqs.statusTitle}"/>
                                </p:selectOneMenu>

                                <p:commandButton    id="change-request-status-cb"
                                                    ajax="true" value="Change request status" 
                                                    actionListener="#{cEActionRequestsBB.updateActionRequestStatus}"
                                                    update="actionRequestListForm:actionRequestTable
                                                    req-details-form"
                                                    oncomplete="PF('override-request-status-dialog').hide()"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('manage-public-access-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>


                        <ui:remove>


                            <p:confirmDialog message="Manage public access" 
                                             severity="alert" widgetVar="manage-public-access-dialog"
                                             closable="true"
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}">

                                <h:form id="manage-public-access-form">


                                    <p:spacer height="15px"/>
                                    <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.changePACCAccess}"
                                                     value="Save" icon="fa fa-link" oncomplete="PF('manage-public-access-dialog').hide()"
                                                     rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                     update="req-details-form:selr-notes-public
                                                     msgForm:ceActionRequestsMessages"/>
                                    <p:commandButton ajax="true" 
                                                     value="Cancel" icon="fa fa-stop" 
                                                     onclick="PF('manage-public-access-dialog').hide()"/>
                                </h:form>
                            </p:confirmDialog>

                        </ui:remove>

                        <p:dialog header="Change property"
                                  widgetVar="change-property-dialog"
                                  closable="true" rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}">

                            <h:form id="change-property-form">

                                <h:messages id="propertyChangeMessages" globalOnly="false" showDetail="true" showSummary="true"
                                            warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                </h:messages>

                                <p:selectOneMenu id="muniSelectMenu" 
                                                 tabindex="1" 
                                                 value="#{cEActionRequestsBB.muniForPropSwitchSearch}">
                                    <f:converter converterId="muniConverter"/>
                                    <f:selectItem itemLabel="select one..." noSelectionOption="true"  itemDisabled="true"/>
                                    <f:selectItems id="muniNameList" value="#{systemServicesBB.bbSessionUser.authMuniList}" var="m" itemValue="#{m}" itemLabel="#{m.muniName}" />
                                </p:selectOneMenu>

                                <p:panelGrid columns="3" layout="grid">

                                    <h:panelGroup>
                                        <p:outputLabel for="propSearchHouseNumIT">
                                            <h:outputText value="House number"/>
                                        </p:outputLabel>
                                        <p:inputText id="propSearchHouseNumIT" value="#{cEActionRequestsBB.houseNumSearch}" 
                                                     style="width: 100px;" tabindex="3" required="false" styleClass="inputText">
                                        </p:inputText>
                                        <h:message for="propSearchHouseNumIT" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <p:outputLabel for="propSearchStreetIT">
                                            <h:outputText value="Street name"/>
                                        </p:outputLabel>
                                        <p:inputText id="propSearchStreetIT" value="#{cEActionRequestsBB.streetNameSearch}" 
                                                     style="width: 200px;" tabindex="4" required="false" styleClass="inputText">
                                        </p:inputText>
                                        <h:message for="propSearchStreetIT" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <p:commandButton
                                            value="Search in Selected Municipality" tabindex="4" ajax="true" icon="fa fa-search"
                                            actionListener="#{cEActionRequestsBB.searchForProperties}" 
                                            update=    "change-property-form"/>
                                    </h:panelGroup>

                                </p:panelGrid> 

                                <h3>Search Results:</h3>
                                <p>Click to select the desired property or try your search again</p>

                                <p:dataTable
                                    id="propertyResultTable"
                                    var="prop" 
                                    value="#{cEActionRequestsBB.propertyList}"
                                    selectionMode="single" tabindex="5"
                                    scrollable="true" scrollHeight="150" 
                                    selection="#{cEActionRequestsBB.propertyForPropSwitch}"
                                    rowKey="#{prop.propertyID}">
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Address" />
                                        </f:facet>
                                        <h:outputText value="#{prop.address}"/>
                                    </p:column>
                                    <p:column>

                                        <f:facet name="header">
                                            <h:outputText value="Municipality" />
                                        </f:facet>
                                        <h:outputText value="#{prop.muni.muniName}"/>

                                    </p:column>

                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Type" />
                                        </f:facet>
                                        <h:outputText value="#{prop.useType.name}"/>
                                    </p:column>
                                </p:dataTable>

                                <p:spacer height="10px"/>

                                <p:commandButton value="Assign request to selected property"
                                                 actionListener="#{cEActionRequestsBB.updateRequestProperty}"
                                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                 update="   msgForm:ceActionRequestsMessages
                                                 req-details-form
                                                 actionRequestListForm:actionRequestTable"
                                                 oncomplete="PF('change-property-dialog').hide()"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('change-property-dialog').hide()"/>
                                <hr/>

                            </h:form>
                        </p:dialog>


                        <p:dialog       header="Search for a different person"
                                        width="900"
                                        widgetVar="change-person-dialog"
                                        closable="true" 
                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                        
                                        >
                            
                            <h:form id="change-person-form">

                                <h:messages id="person-search-messages" globalOnly="true" showDetail="true" showSummary="true"
                                            warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                </h:messages>


                                <h:panelGrid columns="4" cellpadding="5" footerClass="gridFooter"
                                             columnClasses="gridTd-solid-back, gridTd-solid-back, gridTd-solid-back, gridTd-solid-back">

                                    <h:panelGroup>
                                        <p:outputLabel id="filter-by-muni-ol" for="filter-by-muni-cb" value="Filter by muni? "/>
                                        <p:selectBooleanButton onLabel="Yes" offLabel="No" id="filter-by-muni-cb" value="#{personSearchBB.paramsSelected.muni_ctl}" />
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <p:outputLabel for="muniSelectMenu-person">
                                            <h:outputText value="Municipality:"/>
                                        </p:outputLabel>

                                        <p:selectOneMenu id="muniSelectMenu-person" 
                                                         tabindex="1" 
                                                         value="#{personSearchBB.paramsSelected.muni_val}">
                                            <f:converter converterId="muniConverter"/>
                                            <f:selectItem itemLabel="select muni..." noSelectionOption="true"  itemDisabled="true"/>
                                            <f:selectItems id="muniNameList" value="#{systemServicesBB.bbSessionUser.authMuniList}" var="m" itemValue="#{m}" itemLabel="#{m.muniName}" />
                                        </p:selectOneMenu>
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <p:outputLabel id="filter-by-fname-ol" for="filter-by-fname-cb" value="Filter by first name? "/>
                                        <p:selectBooleanButton onLabel="Yes" offLabel="No" id="filter-by-fname-cb" value="#{personSearchBB.paramsSelected.name_first_ctl}" />
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <p:outputLabel for="formFirstName-person">
                                            <h:outputText value="First Name"/>
                                        </p:outputLabel>
                                        <p:inputText id="formFirstName-person" value="#{personSearchBB.paramsSelected.name_first_val}" 
                                                     style="width: 200px;" tabindex="1" required="false" styleClass="inputText"/>
                                        <h:message for="formFirstName-person" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <p:outputLabel id="filter-by-lname-ol" for="filter-by-lname-cb" value="Filter by last name? "/>
                                        <p:selectBooleanButton onLabel="Yes" offLabel="No" id="filter-by-lname-cb" value="#{personSearchBB.paramsSelected.name_last_ctl}" />
                                    </h:panelGroup>

                                    <h:panelGroup id="lname-person-person">
                                        <p:outputLabel for="formLastName-person">
                                            <h:outputText value="Last Name"/>
                                        </p:outputLabel>
                                        <p:inputText id="formLastName-person" value="#{personSearchBB.paramsSelected.name_last_val}" 
                                                     style="width: 200px;" tabindex="4" required="false" styleClass="inputText"/>
                                        <h:message for="formLastName-person" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </h:panelGroup>


                                    <h:panelGroup>
                                        <p:outputLabel id="filter-by-personid-ol" for="filter-by-personid-cb" value="Filter by person ID? "/>
                                        <p:selectBooleanButton onLabel="Yes" offLabel="No" id="filter-by-personid-cb" value="#{personSearchBB.paramsSelected.bobID_ctl}" />
                                    </h:panelGroup>



                                    <h:panelGroup id="personID">
                                        <p:outputLabel for="formPersonID">
                                            <h:outputText value="Person ID number"/>
                                        </p:outputLabel>
                                        <p:inputText id="formPersonID" value="#{personSearchBB.paramsSelected.bobID_val}"
                                                     tabindex="3" required="true" styleClass="inputText"/>
                                        <h:message for="formPersonID" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    </h:panelGroup>
                                </h:panelGrid>

                                <p:commandButton
                                    value="Search for Persons" tabindex="4" ajax="true" icon="fa fa-search"
                                    actionListener="#{personSearchBB.executeQuery}" 
                                    update="change-person-form"/>
                                <p:commandButton   id="pers-search-clearquery-cb" 
                                                           ajax="true" 
                                                           actionListener="#{personSearchBB.resetCurrentQuery}"
                                                           disabled="#{!personSearchBB.querySelected.queryExecuted}"
                                                           icon="fa fa-eraser" 
                                                           styleClass="button"
                                                           value="Reset query" 
                                                           update="change-person-form"/>
                                <h3>Chosen Person:</h3>
                                <h:outputText id="confirm-person-ot" value="ID #{cEActionRequestsBB.selectedPersonForAttachment.personID}: 
                                              #{cEActionRequestsBB.selectedPersonForAttachment.firstName} #{cEActionRequestsBB.selectedPersonForAttachment.lastName} "/>



                                <p:commandButton value="Assign request to selected person"
                                                 actionListener="#{cEActionRequestsBB.updateRequestor}"
                                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasCOGStaffPermissions}"
                                                 update="   msgForm:ceActionRequestsMessages
                                                 req-details-form"
                                                 oncomplete="PF('change-person-dialog').hide()"/>

                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('change-person-dialog').hide()"/>
                                <hr/>


                                <h2>Search Results</h2>

                                <p:dataTable
                                    id="personTable"
                                    var="p"
                                    value="#{personSearchBB.personList}"
                                    rowKey="#{p.personID}"
                                    tableStyleClass="primeDataTable"
                                    scrollable="true"
                                    scrollHeight="200"
                                    rowExpandMode="single"
                                    expandedRow="false"
                                    filteredValue="#{personSearchBB.filteredPersonList}"
                                    widgetVar="personSelectListTable">
                                    <!--<p:ajax event="rowSelect" update="selectedRowLabel"/>-->

                                    <p:column width="3%">
                                        <f:facet name="header">
                                            <h:outputText value="Exp"/>
                                        </f:facet>
                                        <p:rowToggler/>
                                    </p:column>
                                    <p:column width="8%">
                                        <f:facet name="header">
                                            <h:outputText value="ID" />
                                        </f:facet>
                                        <h:outputText value="#{p.personID}"/>
                                    </p:column>

                                    <p:column width="10%" sortBy="#{p.personType.label}"
                                              filterBy="#{p.personType.label}">
                                        <f:facet name="header">
                                            <h:outputText value="Type" />
                                        </f:facet>
                                        <h:outputText value="#{p.personType.label}"/>
                                    </p:column>


                                    <p:column width="10%" sortBy="#{p.firstName}"
                                              filterBy="#{p.firstName}">
                                        <f:facet name="header">
                                            <h:outputText value="First" />
                                        </f:facet>
                                        <h:outputText value="#{p.firstName}"/>
                                    </p:column>

                                    <p:column width="15%" filterBy="#{p.lastName}"
                                              sortBy="#{p.lastName}">
                                        <f:facet name="header">
                                            <h:outputText value="Last" />
                                        </f:facet>
                                        <h:outputText value="#{p.lastName}"/>
                                    </p:column>

                                    <p:column sortBy="#{p.addressStreet}"
                                              filterBy="#{p.addressStreet}">
                                        <f:facet name="header">
                                            <h:outputText value="Address" />
                                        </f:facet>
                                        <h:outputText escape="false" value="#{p.addressStreet}"/>
                                        <p:spacer height="5px"/>
                                        <h:outputText value="#{p.addressCity}, #{p.addressState} #{p.addressZip}"/>
                                    </p:column>

                                    <p:column width="10%" >
                                        <f:facet name="header">
                                            <h:outputText value="Select" />
                                        </f:facet>
                                        <p:commandButton actionListener="#{cEActionRequestsBB.selectNewRequestPerson(p)}"
                                                         ajax="true"
                                                         value="select"
                                                         update="change-person-form:confirm-person-ot"/>
                                    </p:column>


                                    <p:rowExpansion>
                                        <div class="outlinedBox">

                                            <h2>Full person listing for <h:outputText value="#{p.firstName} #{p.lastName}"/> </h2>
                                            <h:panelGrid columns="4" cellpadding="10" footerClass="gridFooter"
                                                         columnClasses="gridTd, gridTd, gridTd, gridTd">

                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="First Name"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{p.firstName}"/>
                                                    </div>
                                                </h:panelGroup>


                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="Last Name"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{p.lastName}"/>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="Muni"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{p.muniName}"/>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="Type"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{p.personType.label}"/>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="Job Title"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{p.jobTitle}"/>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="Email"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{p.email}"/>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="Address"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText escape="false" value="#{p.addressStreet}"/>
                                                        <p:spacer height="5px"/>
                                                        <h:outputText value="#{p.addressCity}, #{p.addressState} #{p.addressZip}"/>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="Under 19"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{p.under18}"/>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="Active?"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{p.active}"/>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="Last Updated"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{p.lastUpdated}"/>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="Expires"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{p.expiryDate.toString}"/>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="Phone home"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{p.phoneHome}"/>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="Phone work"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{p.phoneWork}"/>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel styleClass="bold" value="Phone cell"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{p.phoneCell}"/>
                                                    </div>
                                                </h:panelGroup>

                                                <f:facet name="footer">
                                                    <h:outputLabel styleClass="bold" value="Person notes"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText escape="false" value="#{p.notes}"/>
                                                    </div>
                                                </f:facet>
                                            </h:panelGrid>
                                        </div>
                                    </p:rowExpansion>
                                </p:dataTable>

                            </h:form>
                        </p:dialog>


                        <p:confirmDialog message="Attach internal message" 
                                         severity="alert" widgetVar="internal-message-dialog"
                                         closable="true" responsive="true"
                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasCOGStaffPermissions}">

                            <h:form id="internal-message-form">
                                <h:outputLabel for="internal-message-ita" value="Message text"/>
                                <p:spacer height="15px"/>
                                <p:inputTextarea id="internal-message-ita" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.internalMessageText}"/>
                                <p:spacer height="15px"/>
                                <h:outputText escape="false" value="Your name and a timestamp will be bundled with this message 
                                              and attached to #{cEActionRequestsBB.selectedRequest.requestID}"/>

                                <p:spacer height="15px"/>
                                <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.attachInternalMessage}"
                                                 value="Submit" icon="fa fa-link" oncomplete="PF('internal-message-dialog').hide()"
                                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasCOGStaffPermissions}"
                                                 update="req-details-form:selr-notes-internal
                                                 msgForm:ceActionRequestsMessages"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('internal-message-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>


                        <p:confirmDialog message="Attach municipality message" 
                                         severity="alert" widgetVar="muni-message-dialog"
                                         closable="true" responsive="true"
                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}">

                            <h:form id="muni-message-form">
                                <h:outputLabel for="muni-message-ita" value="Message text"/>
                                <p:spacer height="15px"/>
                                <p:inputTextarea id="muni-message-ita" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.muniMessageText}"/>
                                <p:spacer height="15px"/>
                                <h:outputText escape="false" value="Your name and a timestamp will be bundled with this message 
                                              and attached to #{cEActionRequestsBB.selectedRequest.requestID}"/>
                                <p:spacer height="15px"/>
                                <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.attachMuniMessage}"
                                                 value="Submit" icon="fa fa-link" oncomplete="PF('muni-message-dialog').hide()"
                                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                 update="req-details-form:selr-notes-muni"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('muni-message-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>


                        <p:confirmDialog message="Attach public message" 
                                         severity="alert" widgetVar="public-message-dialog"
                                         closable="true"
                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}">

                            <h:form id="public-message-form">
                                <h:outputLabel for="public-message-ita" value="Message text"/>
                                <p:spacer height="15px"/>
                                <p:inputTextarea id="public-message-ita" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.publicMessageText}"/>
                                <p:spacer height="15px"/>
                                <h:outputText escape="false" value="Your name and a timestamp will be bundled with this message 
                                              and attached to #{cEActionRequestsBB.selectedRequest.requestID}"/> 

                                <p:spacer height="15px"/>
                                <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.attachPublicMessage}"
                                                 value="Submit" icon="fa fa-link" oncomplete="PF('public-message-dialog').hide()"
                                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                 update="req-details-form:selr-notes-public"/>
                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('public-message-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>

                        <p:confirmDialog message="Photos attached to action request" 
                                         severity="alert" widgetVar="photo-dialog"
                                         closable="true"
                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}">

                            <h:form id="photo-form">
                                <p:scrollPanel style="width:1000px; height:400px" mode="native">
                                    <p:dataTable
                                        id="photoTable"
                                        var="photoid"
                                        value="#{cEActionRequestsBB.selectedRequest.blobIDList}"
                                        rowKey="#{photoid.intValue()}"
                                        tableStyleClass="primeDataTable"
                                        draggableRows="false" tabindex="6">
                                        <p:column width="10%">
                                            <f:facet name="header">
                                                <h:outputText value="Manage"/>
                                            </f:facet>
                                            <p:commandButton ajax="true" 
                                                             actionListener="#{cEActionRequestsBB.deletePhoto(photoid)}"
                                                             value="Delete" 
                                                             icon="fa fa-bomb"
                                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasSysAdminPermissions}"
                                                             update=":photo-form"/>
                                        </p:column>
                                        <p:column>
                                            <f:facet name="header">
                                                <h:outputText value="Photo"/>
                                            </f:facet>
                                            <p:graphicImage width="100%" value="#{blobCoordinator.image}">
                                                <f:param name="blobID" value="#{photoid.intValue()}"/>
                                            </p:graphicImage>
                                        </p:column>
                                        <p:column width="20%">
                                            <f:facet name="header">
                                                <h:outputText value="Description"/>
                                            </f:facet>
                                            <h:outputText escape="false" value="#{blobCoordinator.getBlob(photoid).description}"/>
                                        </p:column>
                                    </p:dataTable>
                                </p:scrollPanel>
                                <p:spacer height="15px"/>
                                <p:commandButton ajax="true" 
                                                 value="Continue" 
                                                 update="req-details-form:selr-photos"
                                                 onclick="PF('photo-dialog').hide()"/>
                            </h:form>
                        </p:confirmDialog>




                    </div>

                    <p:dialog  id="cear-print-dialog"
                               widgetVar="cear-print-dialog-var"
                               closable="true" responsive="true"
                               rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}">

                        <h:form id="cear-print-form">

                            <h2>Print code enforcement requests</h2>

                            <h:outputLabel for="report-cear-title-it" value="Report title"/>

                            <p:spacer height="5px"/>

                            <p:inputText id="report-cear-title-it" style="width: 300px;" value="#{cEActionRequestsBB.reportConfig.title}"/>
                            <p:spacer height="2px"/>
                            <h:outputText styleClass="italic" value="note: your name and the current date and time will be automatically inserted" />

                            <p:spacer height="10px"/>

                            <h:outputLabel for="report-cear-notes-ita" value="Notes"/>
                            <p:spacer height="5px"/>
                            <p:inputText id="report-cear-notes-ita" style="width: 300px; height: 100px;" value="#{cEActionRequestsBB.reportConfig.notes}"/>
                            <p:spacer height="5px"/>

                            <h2>Display options</h2>

                            <h:outputLabel class="bold" value="Single request or full list?" for="cear-print-singleorlist-is" />
                            <p:spacer height="1px"/>
                            <p:inputSwitch  id="cear-print-singleorlist-is"
                                            value="#{cEActionRequestsBB.reportConfig.printFullCEARQueue}" 
                                            onLabel="Print all requests in list" offLabel="Only print active request" />

                            <p:spacer height="5px"/>

                            <h:outputLabel class="bold" value="Include photographs with requests?" for="cear-print-includephotos-is" />
                            <p:spacer height="1px"/>
                            <p:inputSwitch  id="cear-print-includephotos-is"
                                            value="#{cEActionRequestsBB.reportConfig.includePhotos}" 
                                            onLabel="Print photos" offLabel="Hide photos" />

                            <p:spacer height="5px"/>

                            <p:commandButton ajax="true" id="cear-print-cancel"
                                             value="Cancel" icon="fa fa-stop" 
                                             onclick="PF('cear-print-dialog-var').hide()"/>

                            <p:commandButton ajax="false" action="#{cEActionRequestsBB.generateReportSingleCEAR}"
                                             value="Print code enforcement request" icon="fa fa-print" 
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions and !cEActionRequestsBB.reportConfig.printFullCEARQueue}"
                                             />
                            <p:commandButton ajax="false" action="#{cEActionRequestsBB.generateReportMultiCEAR}"
                                             value="Generate report" icon="fa fa-print" 
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions and cEActionRequestsBB.reportConfig.printFullCEARQueue}"
                                             />
                        </h:form>


                    </p:dialog>

                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

