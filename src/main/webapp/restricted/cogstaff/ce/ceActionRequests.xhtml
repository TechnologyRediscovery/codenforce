<?xml version='1.0' encoding='UTF-8' ?>
<!--
Copyright (C) 2020 Turtle Creek Valley

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Code Enforcement Action Requests</title>
    </h:head>

    <!--TODO: NOT TAB-INDEXED-->
    <!--PLEASE READ:
        In the panels you will see a lot of spacers without a size attribute or anything. These are to take up columns in the grid.
        If you can come up with a better arrangement for the panels, feel free to get rid of them or rearrange them to your hearts' content.
    -->

    <h:body id="cearManageBody">

        <ui:composition template="../../navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view id="CEActionRequestsView">

                    <p:outputPanel id="body-panel">
                        <h1>Code Enforcement Action Requests in <h:outputText value="#{sessionBean.sessMuni.muniName}"/></h1>

                        <h:form id="form-messages-global">
                            <p:messages id="messages-global" globalOnly="true" showDetail="true" showSummary="true" />
                        </h:form>

                        <div class="mainContainer">

                            <div class ="two-column-page-flex-container">

                                <div class="list-column" >

                                    <h:form id="mode-form">

                                        <p:selectOneButton style="width: 100%; margin-top: 10px ; height: 20px;"
                                                           value="#{cEActionRequestsBB.currentMode}" 
                                                           >
                                            <f:selectItem itemLabel="SEARCH" itemValue="Search"  />
                                            <f:selectItem itemLabel="ACTIONS" itemValue="Actions"  />
                                            <f:selectItem itemLabel="CONNECTIONS" itemValue="Objects"  />
                                            <f:selectItem itemLabel="NOTES" itemValue="Notes"  />

                                            <f:ajax render="@all"/>

                                        </p:selectOneButton> 

                                    </h:form>

                                    <p:spacer height="30px"/>

                                    <p:scrollPanel style="height: 550px;" >

                                        <h:form id="cearManage-form-side">

                                            <p:dataTable id="requestTable"
                                                         var="r"
                                                         rowKey="#{r.requestID}"
                                                         value="#{cEActionRequestsBB.requestList}"
                                                         tableStyleClass="primeDataTable"
                                                         >

                                                <p:column headerText="ID"
                                                          styleClass="centeredColumnContent">

                                                    <h:outputText value="#{r.requestID}"/>

                                                </p:column>

                                                <p:column headerText="Issue Type"
                                                          styleClass="centeredColumnContent">

                                                    <h:outputText value="#{r.issue.name}"/>

                                                </p:column>

                                                <p:column headerText="Status"
                                                          styleClass="centeredColumnContent">

                                                    <h:outputText value="#{r.requestStatus.statusTitle}"/>

                                                </p:column>

                                                <p:column headerText="Age"
                                                          styleClass="centeredColumnContent">

                                                    <h:outputText value="#{r.daysSinceDateOfRecord}"/>

                                                </p:column>

                                                <p:column headerText="Option"
                                                          styleClass="centeredColumnContent"
                                                          style="width: 80px"
                                                          >

                                                    <p:selectBooleanButton onLabel="Deselect" 
                                                                           offLabel="Select"
                                                                           styleClass="selectButton" 
                                                                           value="#{cEActionRequestsBB.currentCEARSelected}"
                                                                           disabled="#{cEActionRequestsBB.getSelectedButtonActive()}"
                                                                           >

                                                        <p:ajax update="
                                                                form-messages-global
                                                                cearManage-form-side
                                                                cearManage-panel"
                                                                listener="#{cEActionRequestsBB.manageActionRequest(r)}"/>

                                                    </p:selectBooleanButton>

                                                </p:column>

                                            </p:dataTable>

                                            <p:spacer height="15px"/>

                                            <p:chart type="donut" 
                                                     model="#{cEActionRequestsBB.requestReasonDonut}" 
                                                     style="width:600px; height: 600px;"/>

                                            <p:spacer height="10px"/>

                                        </h:form>

                                    </p:scrollPanel>

                                </div>



                                <div class ="object-column">

                                    <p:outputPanel id = "cearManage-panel" >

                                        <!--Search Table-->
                                        <p:panel id="cearManage-panel-search"
                                                 toggleable="true"
                                                 collapsed="false"
                                                 header="Search Panel"
                                                 rendered="#{cEActionRequestsBB.getActiveSearchMode()}"
                                                 >

                                            <p:spacer height="10px"/>

                                            <h:form id="cearManage-form-lookup">

                                                <p:panelGrid columns="4" 
                                                             layout="grid"
                                                             columnClasses="gridTd, gridTd, gridTd, gridTd" 
                                                             >
                                                    <h:panelGroup>
                                                        <p:selectOneMenu id="eventquery-som" 
                                                                         tabindex="1" 
                                                                         value="#{cEActionRequestsBB.selectedQueryCEAR}"
                                                                         style="margin-right: 10px;">
                                                            <f:converter converterId="bOBQueryConverter"/>
                                                            <f:selectItem itemLabel="select a query..." noSelectionOption="true" itemDisabled="true"/>
                                                            <f:selectItems id="querylist-si" value="#{cEActionRequestsBB.queryList}" var="q" itemValue="#{q}" itemLabel="#{q.queryTitle}" />
                                                            <p:ajax update="cears-query-desc-ot"/>
                                                        </p:selectOneMenu>

                                                        <p:commandButton    id="execute-selected-query" 
                                                                            ajax="true"
                                                                            value="perform selected query" 
                                                                            actionListener="#{cEActionRequestsBB.executeQuery}"
                                                                            disabled="false"
                                                                            icon="fa fa-wheelchair-alt"
                                                                            update="
                                                                            cearManage-panel-search
                                                                            cearManage-form-side
                                                                            form-messages-global"/>
                                                        <p:spacer height="5px" />
                                                    </h:panelGroup>
                                                    
                                                    <h:panelGroup>
                                                        <h:outputLabel styleClass="bold" value="Query description: " for="cears-query-desc-ot" />
                                                        <p:spacer height="5px" />
                                                        <h:outputText id="cears-query-desc-ot" value="#{cEActionRequestsBB.selectedQueryCEAR.queryName.desc}" />
                                                    </h:panelGroup>

                                                    <p:spacer/>
                                                    <p:spacer/>
                                                    <h3>Advanced search options</h3>

                                                    <p:spacer/>
                                                    <p:spacer/>
                                                    <p:spacer/>
                                                    <h:panelGroup>
                                                        <p:outputLabel value="Query start date"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearSearchTermsLabel">
                                                            <p:calendar id="eventDateCalStart" value="#{cEActionRequestsBB.searchParams.date_start_val_util}" 
                                                                        mode="popup"  
                                                                        showOn="button" pattern="EEE, dd MMM, yyyy"
                                                                        navigator="true" tabindex="16"
                                                                        showButtonPanel="true" showTodayButton="true"/>
                                                            <h:message for="eventDateCalStart" showDetail="false" showSummary="true" 
                                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Query end date"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearSearchTermsLabel">
                                                            <p:calendar id="eventDateCalEnd" value="#{cEActionRequestsBB.searchParams.date_end_val_util}" 
                                                                        mode="popup" 
                                                                        showOn="button" pattern="EEE, dd MMM, yyyy"
                                                                        navigator="true" tabindex="16"
                                                                        showButtonPanel="true" showTodayButton="true"/>
                                                            <h:message for="eventDateCalEnd" showDetail="false" showSummary="true" 
                                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <p:spacer/>
                                                    <p:spacer/>


                                                    <h:panelGroup>
                                                        <p:outputLabel value="Filter by case attachment?"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearSearchTermsLabel">
                                                            <p:selectBooleanCheckbox id="useAttachedToCase" value="#{cEActionRequestsBB.searchParams.caseAttachment_ctl}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                        <p:outputLabel value="Attached to case"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearSearchTermsLabel">
                                                            <p:selectBooleanButton id="attachedToCaseCB" onLabel="Yes" offLabel="No" value="#{cEActionRequestsBB.searchParams.caseAttachment_val}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Filter by safety hazard?"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearSearchTermsLabel">
                                                            <p:selectBooleanCheckbox id="useMarkedUrgent" value="#{cEActionRequestsBB.searchParams.urgent_ctl}" />
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                        <p:outputLabel value="Safety hazard"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearSearchTermsLabel">
                                                            <p:selectBooleanButton id="useMarkedUrgentcb" onLabel="Yes" offLabel="No" value="#{cEActionRequestsBB.searchParams.urgent_val}" disabled="false" />
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <!--TODO: at the time of writing this comment, there isn't a parameter for searching by request ID. If one is added, please put it here. -->

                                                    <p:spacer/>
                                                    
                                                    <h:panelGroup>
                                                        <p:outputLabel value="Filter by not at address?"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearSearchTermsLabel">
                                                            <p:selectBooleanCheckbox id="useNotAtAddressCB" value="#{cEActionRequestsBB.searchParams.nonaddressable_ctl}" />
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                        <p:outputLabel value="Not at an address"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearSearchTermsLabel">
                                                            <p:selectBooleanButton id="notAtAddressCB" onLabel="Yes" offLabel="No" value="#{cEActionRequestsBB.searchParams.nonaddressable_val}" disabled="false" />
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>
                                                    
                                                    <h:panelGroup>
                                                        <p:outputLabel value="Search by Request status?"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearSearchTermsLabel">
                                                            <p:selectBooleanCheckbox id="useActionRequestStatusSB" value="#{cEActionRequestsBB.searchParams.requestStatus_ctl}" />
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                        <p:selectOneMenu id="ceactionrequeststatusmenuSearch" required="false" value="#{cEActionRequestsBB.searchParams.requestStatus_val}">
                                                            <f:converter converterId="ceActionRequestStatusConverter"/>
                                                            <f:selectItems value="#{cEActionRequestsBB.statusList}"
                                                                           var="cearqs" itemValue="#{cearqs}" itemLabel="#{cearqs.statusTitle}"/>
                                                        </p:selectOneMenu>
                                                    </h:panelGroup>
                                                    
                                                    <p:spacer/>
                                                    
                                                    <p:spacer/>

                                                    <p:commandButton id="custom-query-cb"
                                                                     ajax="true" 
                                                                     value="Execute custom query" 
                                                                     actionListener="#{cEActionRequestsBB.executeCustomQuery}"
                                                                     update="cearManage-form-side
                                                                     cearManage-panel-search
                                                                     form-messages-global"/>


                                                </p:panelGrid>

                                            </h:form>

                                        </p:panel>


                                        <!--Actions Table-->
                                        <p:panel id="cearManage-panel-actions"
                                                 toggleable="true"
                                                 collapsed="false"
                                                 header="Actions Panel"
                                                 rendered="#{cEActionRequestsBB.getActiveActionsMode()}"
                                                 >

                                            <p:spacer height="10px"/>

                                            <h:form id="cearManage-form-actions">

                                                <p:panelGrid columns="4" 
                                                             layout="grid"
                                                             columnClasses="gridTd, gridTd, gridTd, gridTd" 
                                                             >

                                                    <h:panelGroup>
                                                        <p:outputLabel value="ID:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearActionsTableOutputLabel">
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestID}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Issue:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearActionsTableOutputLabel">
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.issue.name}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Date Submitted:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearActionsTableOutputLabel">
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.formattedSubmittedTimeStamp}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Address:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearActionsTableOutputLabel">
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestProperty.address}"/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestProperty.muni.muniName}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>


                                                    <h:panelGroup>
                                                        <p:outputLabel value="Status:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearActionsTableOutputLabel">
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestStatus.statusTitle}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Human safety issue?"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearActionsTableOutputLabel">
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.isUrgent}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Attached to CE case?"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearActionsTableOutputLabel">
                                                            <h:outputText id="selr-attachedCase" 
                                                                          value="#{cEActionRequestsBB.selectedRequest.caseID == 0 ? null : cEActionRequestsBB.selectedRequest.caseID}"/>
                                                            <p:commandButton value="Go to CECase" icon="fa fa-folder" action="#{cEActionRequestsBB.goToCase()}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Contact:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearActionsTableOutputLabel">
                                                            <h:outputText value="Phone (cell): "/>
                                                            <h:outputText id="selr-pers-phone-cell" value="#{cEActionRequestsBB.selectedRequest.requestor.phoneCell}"/> <br />
                                                            <h:outputText value="Phone (work): "/>
                                                            <h:outputText id="selr-pers-phone-work" value="#{cEActionRequestsBB.selectedRequest.requestor.phoneWork}"/> <br />
                                                            <h:outputText value="Phone (home): "/>
                                                            <h:outputText id="selr-pers-phone-home" value="#{cEActionRequestsBB.selectedRequest.requestor.phoneHome}"/> <br />
                                                            <h:outputText value="Email: "/>
                                                            <h:outputText id="selr-pers-email" value="#{cEActionRequestsBB.selectedRequest.requestor.email}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Human safety issue?"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearActionsTableOutputLabel">
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.isUrgent}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>
                                                    
                                                    <h:panelGroup>
                                                        <p:outputLabel value="Description:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearActionsTableOutputLabel">
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestDescription}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Public access reference num (PACC):"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearActionsTableOutputLabel">
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestPublicCC}"/>
                                                        </div>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearActionsTableOutputLabel">
                                                            <h:outputText value=" Allow access using ref num?"/>
                                                            <p:selectBooleanCheckbox id="selr-access-sbcb" value="#{cEActionRequestsBB.selectedRequest.paccEnabled}"
                                                                                     disabled="#{cEActionRequestsBB.disablePACCControl}">
                                                                <p:ajax listener="#{cEActionRequestsBB.changePACCAccess}" update="form-messages-global" />
                                                            </p:selectBooleanCheckbox>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>
                                                    
                                                    <p:spacer/>
                                                    
                                                    <h3>Available actions:</h3>

                                                    <p:spacer height="5px"/>
                                                    
                                                    <p:spacer/>
                                                    
                                                    <p:spacer/>

                                                    <p:commandButton    id="open-new-case-cb"
                                                                        ajax="false" value="Open new code enf case at this property" 
                                                                        disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                                        action="#{cEActionRequestsBB.path1CreateNewCaseAtProperty}"
                                                                        icon="fa fa-folder" styleClass="cear-actions-button"/>

                                                    <p:commandButton    id="attach-to-case-cb"
                                                                        value="Attach to existing code enf case"
                                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                                        disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                                        onclick="PF('attach-to-case-dialog').show()"
                                                                        update="attach-to-existing-case-form"
                                                                        icon="fa fa-book" />


                                                    <p:commandButton    id="no-violation-found-cb"
                                                                        value="No violation found on site"
                                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                                        disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                                        onclick="PF('no-violation-found-dialog').show()"
                                                                        icon="fa fa-circle-o"/>

                                                    <p:commandButton    id="invalid-request-cb"
                                                                        value="Invalid request"
                                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                                        disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                                        onclick="PF('invalid-dialog').show()"
                                                                        icon="fa fa-exclamation-circle"/>

                                                    <p:commandButton    id="manually-override-status-cb"
                                                                        value="Manually override request status"
                                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasSysAdminPermissions}"
                                                                        disabled="#{empty cEActionRequestsBB.selectedRequest}"
                                                                        onclick="PF('override-request-status-dialog').show()"
                                                                        icon="fa fa-gears"/>
                                                    <p:commandButton    id="prep-multi-cear-cb"
                                                                        value="Prepare request list report"
                                                                        actionListener="#{cEActionRequestsBB.prepareReportMultiCEAR}"
                                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                                        disabled="false"
                                                                        oncomplete="PF('cear-print-dialog-var').show()"
                                                                        icon="fa fa-print"
                                                                        update="cear-print-form"
                                                                        />

                                                    <!--
                                        
                                        TODO: Figure out why prepareReportSingleCEAR has gone missing
                                        
                                    <p:commandButton    id="print-singleCAR-cb"
                                                        value="Print request"
                                                        actionListener="{cEActionRequestsBB.prepareReportSingleCEAR}"
                                                        rendered="{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                        disabled="false"
                                                        oncomplete="PF('cear-print-dialog-var').show()"
                                                        icon="fa fa-print"
                                                        update="cear-print-form"
                                                        />
                                                    -->

                                                </p:panelGrid>

                                                <p:spacer height="10px" />


                                            </h:form>

                                        </p:panel>


                                        <!--Connections Table-->
                                        <p:panel id="cearManage-panel-objects"
                                                 toggleable="true"
                                                 collapsed="false"
                                                 header="Connections Panel"
                                                 rendered="#{cEActionRequestsBB.getActiveObjectsMode()}"
                                                 >

                                            <p:spacer height="10px"/>

                                            <h:form id="cearManage-form-objects">

                                                <p:panelGrid columns="4" 
                                                             layout="grid"
                                                             columnClasses="gridTd, gridTd, gridTd, gridTd" 
                                                             >

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Property:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearObjectsTableOutputLabel">
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestProperty.address}"/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestProperty.muni.muniName}"/>
                                                        </div>
                                                        <p:spacer height="5px"/>
                                                        <p:commandButton    id="change-property-cb" 
                                                                            onclick="PF('change-property-dialog').show()" 
                                                                            value="change request property" 
                                                                            styleClass="noFill button-size-small"
                                                                            disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                                            icon="fa fa-home"
                                                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"/>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Requestor:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearObjectsTableOutputLabel">
                                                            <p:outputLabel value="&#160;Requestor ID:#{cEActionRequestsBB.selectedRequest.requestor.personID} 
                                                                           (#{cEActionRequestsBB.selectedRequest.requestor.personType.label}): "/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestor.firstName}"/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestor.lastName}"/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestor.addressStreet}"/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestor.addressCity}, "/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestor.addressState}"/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestor.addressZip}"/>
                                                        </div>
                                                        <p:spacer height="5px"/>
                                                        <p:commandButton    id="change-person-cb"
                                                                            onclick="PF('change-person-dialog').show()" 
                                                                            value="change requestor Person" 
                                                                            styleClass="noFill button-size-small" 
                                                                            icon="fa fa-child"
                                                                            disabled="#{empty cEActionRequestsBB.selectedRequest}"
                                                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}" />
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                </p:panelGrid>

                                                <h3>Attached photos:</h3>

                                                    <p:dataTable
                                                        id="photoTable"
                                                        var="photoid"
                                                        value="#{cEActionRequestsBB.selectedRequest.blobIDList}"
                                                        rowKey="#{photoid.intValue()}"
                                                        tableStyleClass="primeDataTable"
                                                        draggableRows="false" tabindex="6">
                                                        <p:column width="10%" headerText="Manage">
                                                            <p:commandButton ajax="true" 
                                                                             actionListener="#{cEActionRequestsBB.deletePhoto(photoid)}"
                                                                             value="Delete" 
                                                                             icon="fa fa-bomb"
                                                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasSysAdminPermissions}"
                                                                             update="photoTable"/>
                                                        </p:column>
                                                        <p:column headerText="Photo">
                                                            <p:graphicImage width="100%" value="#{blobCoordinator.image}">
                                                                <f:param name="blobID" value="#{photoid.intValue()}"/>
                                                            </p:graphicImage>
                                                        </p:column>
                                                        <p:column width="20%" headerText="Description">
                                                            <h:outputText escape="false" value="#{blobCoordinator.getBlob(photoid).description}"/>
                                                        </p:column>
                                                    </p:dataTable>
                                                
                                            </h:form>

                                        </p:panel>


                                        <!--Notes Table-->
                                        <p:panel id="cearManage-panel-notes"
                                                 toggleable="true"
                                                 collapsed="false"
                                                 header="Notes Panel"
                                                 rendered="#{cEActionRequestsBB.getActiveNotesMode()}"
                                                 >

                                            <p:spacer height="10px"/>

                                            <h:form id="cearManage-form-notes">

                                                <p:panelGrid columns="4" 
                                                             layout="grid"
                                                             columnClasses="gridTd, gridTd, gridTd, gridTd" 
                                                             >

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Officer-only notes:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearNotesTableOutputLabel">
                                                            <p:outputLabel escape="false" value="&#160;#{cEActionRequestsBB.selectedRequest.cogInternalNotes}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                        <p:commandButton onclick="PF('internal-message-dialog').show()" 
                                                                         icon="fa fa-pencil-square-o"
                                                                         value="new note" 
                                                                         styleClass="noFill button-size-small" 
                                                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasCOGStaffPermissions}" />
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="System internal only notes:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearNotesTableOutputLabel">
                                                            <p:outputLabel escape="false" value="&#160;#{cEActionRequestsBB.selectedRequest.muniNotes}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                        <p:commandButton onclick="PF('muni-message-dialog').show()" 
                                                                         value="new note"
                                                                         icon="fa fa-pencil-square-o"
                                                                         styleClass="noFill button-size-small" 
                                                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}" />
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Public notes:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearNotesTableOutputLabel">
                                                            <p:outputLabel escape="false" value="&#160;#{cEActionRequestsBB.selectedRequest.publicExternalNotes}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                        <p:commandButton onclick="PF('public-message-dialog').show()" 
                                                                         value="new note" 
                                                                         icon="fa fa-pencil-square-o"
                                                                         styleClass="noFill button-size-small" 
                                                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}" />
                                                    </h:panelGroup>

                                                </p:panelGrid>

                                                <p:spacer height="10px" />

                                            </h:form>

                                        </p:panel>


                                    </p:outputPanel>
                                </div>
                            </div>
                        </div>
                    </p:outputPanel>

                    <p:dialog widgetVar="attach-to-case-dialog"
                              header="Attach request to existing case"
                              height="550px" width="50%"
                              responsive="true"

                              closable="true"
                              rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}">

                        <h:form id="attach-to-existing-case-form">

                            <p>Choose an existing case on <h:outputLabel for="invalidMessageITA" value="#{cEActionRequestsBB.selectedRequest.requestProperty.address}"/>:</p>
                            <p:scrollPanel>
                                <p:dataScroller
                                    id="cases-on-selected-request-property-DS"
                                    value="#{cEActionRequestsBB.caseListForSelectedProperty}"
                                    var="c">
                                    <p>Case ID: <h:outputText value="#{c.caseID}"/> <br />
                                        Name: <h:outputText value="#{c.caseName}" /> <br />
                                        Phase: <h:outputText value="#{c.statusBundle.phase.label}"/> <br />
                                        Opening date: <h:outputText value="#{c.originiationDatePretty}"/> <br />
                                        Closing date: <h:outputText value="#{c.closingDatePretty}"/> <br />
                                    </p>
                                    <p:commandButton value="Assign request to this case"
                                                     actionListener="#{cEActionRequestsBB.path2UseSelectedCaseForAttachment(c)}"
                                                     update="form-messages-global
                                                     cearManage-panel-actions
                                                     cearManage-form-side"
                                                     rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                     oncomplete="PF('attach-to-case-dialog').hide()"/>
                                    <p:commandButton ajax="true" 
                                                     value="Cancel" icon="fa fa-stop" 
                                                     onclick="PF('attach-to-case-dialog').hide()"/>
                                    <hr/>

                                </p:dataScroller>
                            </p:scrollPanel>
                        </h:form>
                    </p:dialog>

                    <p:confirmDialog message="Mark request as invalid" 
                                     severity="alert" widgetVar="invalid-dialog"
                                     closable="true"
                                     rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}">

                        <h:form id="invalid-form">
                            <h:outputLabel for="invalidMessageITA" value="What makes this an invalid request?"/>
                            <p:spacer height="15px"/>
                            <p:inputTextarea id="invalidMessageITA" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.invalidMessage}"/>
                            <p:spacer height="15px"/>
                            <p>This message, your name, and a timestamp will be appended <br />to the public note section of request ID 
                                <h:outputText escape="false" value="#{cEActionRequestsBB.selectedRequest.requestID}"/> </p>

                            <p:spacer height="15px "/>
                            <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.path3AttachInvalidMessage}"
                                             value="Submit" icon="fa fa-link" oncomplete="PF('invalid-dialog').hide()"
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                             update="cearManage-panel-actions
                                             form-messages-global
                                             cearManage-form-side"/>
                            <p:commandButton ajax="true" 
                                             value="Cancel" icon="fa fa-stop" 
                                             onclick="PF('invalid-dialog').hide()"/>
                        </h:form>
                    </p:confirmDialog>

                    <p:confirmDialog message="Mark request: No Violation Found" 
                                     severity="alert" widgetVar="no-violation-found-dialog"
                                     closable="true"
                                     rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}">

                        <h:form id="no-violation-form">
                            <h:outputLabel for="noViolationMessageITA" value="Describe the results of your request investigation:"/>
                            <p:spacer height="15px"/>
                            <p:inputTextarea id="noViolationMessageITA" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.noViolationFoundMessage}"/>
                            <p:spacer height="15px"/>
                            <p>This message, your name, and a timestamp will be appended <br />to the public note section of request ID 
                                <h:outputText escape="false" value="#{cEActionRequestsBB.selectedRequest.requestID}"/> </p>

                            <p:spacer height="15px"/>
                            <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.path4AttachNoViolationFoundMessage}"
                                             value="Submit" icon="fa fa-link" oncomplete="PF('no-violation-found-dialog').hide()"
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                             update="cearManage-panel-actions
                                             form-messages-global
                                             cearManage-form-side"/>
                            <p:commandButton ajax="true" 
                                             value="Cancel" icon="fa fa-stop" 
                                             onclick="PF('no-violation-found-dialog').hide()"/>
                        </h:form>
                    </p:confirmDialog>

                    <p:confirmDialog message="Override request status" 
                                     severity="alert" widgetVar="override-request-status-dialog"
                                     closable="true"
                                     rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}">
                        <h:form id="override-request-status-form">

                            <h:outputLabel styleClass="bold" for="ceactionrequeststatusmenu" value="Change status to:"/>

                            <p:selectOneMenu id="ceactionrequeststatusmenu" required="false" value="#{cEActionRequestsBB.selectedChangeToStatus}">
                                <f:converter converterId="ceActionRequestStatusConverter"/>
                                <f:selectItem itemLabel="select one..." noSelectionOption="true" itemDisabled="true"/>
                                <f:selectItems value="#{cEActionRequestsBB.statusList}"
                                               var="cearqs" itemValue="#{cearqs}" itemLabel="#{cearqs.statusTitle}"/>
                            </p:selectOneMenu>

                            <p:commandButton    id="change-request-status-cb"
                                                ajax="true" value="Change request status" 
                                                actionListener="#{cEActionRequestsBB.updateActionRequestStatus}"
                                                update="cearManage-form-side
                                                cearManage-panel-actions"
                                                oncomplete="PF('override-request-status-dialog').hide()"/>
                            <p:commandButton ajax="true" 
                                             value="Cancel" icon="fa fa-stop" 
                                             onclick="PF('override-request-status-dialog').hide()"/>
                        </h:form>
                    </p:confirmDialog>

                    <p:dialog header="Change property"
                              widgetVar="change-property-dialog"
                              closable="true" rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}">

                        <h:form id="change-property-form">

                            <h:messages id="propertyChangeMessages" globalOnly="false" showDetail="true" showSummary="true"
                                        warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                            </h:messages>

                            <p:selectOneMenu id="muniSelectMenu" 
                                             tabindex="1" 
                                             value="#{cEActionRequestsBB.muniForPropSwitchSearch}">
                                <f:converter converterId="muniConverter"/>
                                <f:selectItem itemLabel="select one..." noSelectionOption="true"  itemDisabled="true"/>
                                <f:selectItems id="muniNameList" value="#{systemServicesBB.bbSessionUser.authMuniList}" var="m" itemValue="#{m}" itemLabel="#{m.muniName}" />
                            </p:selectOneMenu>

                            <p:panelGrid columns="3" layout="grid">

                                <h:panelGroup>
                                    <p:outputLabel for="propSearchHouseNumIT">
                                        <h:outputText value="House number"/>
                                    </p:outputLabel>
                                    <p:inputText id="propSearchHouseNumIT" value="#{cEActionRequestsBB.houseNumSearch}" 
                                                 style="width: 100px;" tabindex="3" required="false" styleClass="inputText">
                                    </p:inputText>
                                    <h:message for="propSearchHouseNumIT" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>

                                <h:panelGroup>
                                    <p:outputLabel for="propSearchStreetIT">
                                        <h:outputText value="Street name"/>
                                    </p:outputLabel>
                                    <p:inputText id="propSearchStreetIT" value="#{cEActionRequestsBB.streetNameSearch}" 
                                                 style="width: 200px;" tabindex="4" required="false" styleClass="inputText">
                                    </p:inputText>
                                    <h:message for="propSearchStreetIT" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>

                                <h:panelGroup>
                                    <p:commandButton
                                        value="Search in Selected Municipality" tabindex="4" ajax="true" icon="fa fa-search"
                                        actionListener="#{cEActionRequestsBB.searchForProperties}" 
                                        update=    "change-property-form"/>
                                </h:panelGroup>

                            </p:panelGrid> 

                            <h3>Search Results:</h3>
                            <p>Click to select the desired property or try your search again</p>

                            <p:dataTable
                                id="propertyResultTable"
                                var="prop" 
                                value="#{cEActionRequestsBB.propertyList}"
                                selectionMode="single" tabindex="5"
                                scrollable="true" scrollHeight="150" 
                                selection="#{cEActionRequestsBB.propertyForPropSwitch}"
                                rowKey="#{prop.propertyID}">
                                <p:column headerText="Address">
                                    <h:outputText value="#{prop.address}"/>
                                </p:column>
                                <p:column headerText="Municipality">
                                    <h:outputText value="#{prop.muni.muniName}"/>

                                </p:column>

                                <p:column headerText="Type">
                                    <h:outputText value="#{prop.useType.name}"/>
                                </p:column>
                            </p:dataTable>

                            <p:spacer height="10px"/>

                            <p:commandButton value="Assign request to selected property"
                                             actionListener="#{cEActionRequestsBB.updateRequestProperty}"
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                             update="form-messages-global
                                             cearManage-panel-objects
                                             cearManage-form-side"
                                             oncomplete="PF('change-property-dialog').hide()"/>
                            <p:commandButton ajax="true" 
                                             value="Cancel" icon="fa fa-stop" 
                                             onclick="PF('change-property-dialog').hide()"/>
                            <hr/>

                        </h:form>
                    </p:dialog>


                    <p:dialog       header="Search for a different person"
                                    width="900"
                                    widgetVar="change-person-dialog"
                                    closable="true" 
                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"

                                    >

                        <h:form id="change-person-form">

                            <h:messages id="person-search-messages" globalOnly="true" showDetail="true" showSummary="true"
                                        warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                            </h:messages>


                            <h:panelGrid columns="4" cellpadding="5" footerClass="gridFooter"
                                         columnClasses="gridTd-solid-back, gridTd-solid-back, gridTd-solid-back, gridTd-solid-back">

                                <h:panelGroup>
                                    <p:outputLabel id="filter-by-muni-ol" for="filter-by-muni-cb" value="Filter by muni? "/>
                                    <p:selectBooleanButton onLabel="Yes" offLabel="No" id="filter-by-muni-cb" value="#{personSearchBB.paramsSelected.muni_ctl}" />
                                </h:panelGroup>

                                <h:panelGroup>
                                    <p:outputLabel for="muniSelectMenu-person">
                                        <h:outputText value="Municipality:"/>
                                    </p:outputLabel>

                                    <p:selectOneMenu id="muniSelectMenu-person" 
                                                     tabindex="1" 
                                                     value="#{personSearchBB.paramsSelected.muni_val}">
                                        <f:converter converterId="muniConverter"/>
                                        <f:selectItem itemLabel="select muni..." noSelectionOption="true"  itemDisabled="true"/>
                                        <f:selectItems id="muniNameList" value="#{systemServicesBB.bbSessionUser.authMuniList}" var="m" itemValue="#{m}" itemLabel="#{m.muniName}" />
                                    </p:selectOneMenu>
                                </h:panelGroup>

                                <h:panelGroup>
                                    <p:outputLabel id="filter-by-fname-ol" for="filter-by-fname-cb" value="Filter by first name? "/>
                                    <p:selectBooleanButton onLabel="Yes" offLabel="No" id="filter-by-fname-cb" value="#{personSearchBB.paramsSelected.name_first_ctl}" />
                                </h:panelGroup>

                                <h:panelGroup>
                                    <p:outputLabel for="formFirstName-person">
                                        <h:outputText value="First Name"/>
                                    </p:outputLabel>
                                    <p:inputText id="formFirstName-person" value="#{personSearchBB.paramsSelected.name_first_val}" 
                                                 style="width: 200px;" tabindex="1" required="false" styleClass="inputText"/>
                                    <h:message for="formFirstName-person" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>

                                <h:panelGroup>
                                    <p:outputLabel id="filter-by-lname-ol" for="filter-by-lname-cb" value="Filter by last name? "/>
                                    <p:selectBooleanButton onLabel="Yes" offLabel="No" id="filter-by-lname-cb" value="#{personSearchBB.paramsSelected.name_last_ctl}" />
                                </h:panelGroup>

                                <h:panelGroup id="lname-person-person">
                                    <p:outputLabel for="formLastName-person">
                                        <h:outputText value="Last Name"/>
                                    </p:outputLabel>
                                    <p:inputText id="formLastName-person" value="#{personSearchBB.paramsSelected.name_last_val}" 
                                                 style="width: 200px;" tabindex="4" required="false" styleClass="inputText"/>
                                    <h:message for="formLastName-person" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>


                                <h:panelGroup>
                                    <p:outputLabel id="filter-by-personid-ol" for="filter-by-personid-cb" value="Filter by person ID? "/>
                                    <p:selectBooleanButton onLabel="Yes" offLabel="No" id="filter-by-personid-cb" value="#{personSearchBB.paramsSelected.bobID_ctl}" />
                                </h:panelGroup>



                                <h:panelGroup id="personID">
                                    <p:outputLabel for="formPersonID">
                                        <h:outputText value="Person ID number"/>
                                    </p:outputLabel>
                                    <p:inputText id="formPersonID" value="#{personSearchBB.paramsSelected.bobID_val}"
                                                 tabindex="3" required="true" styleClass="inputText"/>
                                    <h:message for="formPersonID" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                </h:panelGroup>
                            </h:panelGrid>

                            <p:commandButton
                                value="Search for Persons" tabindex="4" ajax="true" icon="fa fa-search"
                                actionListener="#{personSearchBB.executeQuery}" 
                                update="change-person-form"/>
                            <p:commandButton   id="pers-search-clearquery-cb" 
                                               ajax="true" 
                                               actionListener="#{personSearchBB.resetCurrentQuery}"
                                               disabled="#{!personSearchBB.querySelected.queryExecuted}"
                                               icon="fa fa-eraser" 
                                               styleClass="button"
                                               value="Reset query" 
                                               update="change-person-form"/>
                            <h3>Chosen Person:</h3>
                            <h:outputText id="confirm-person-ot" value="ID #{cEActionRequestsBB.selectedPersonForAttachment.personID}: 
                                          #{cEActionRequestsBB.selectedPersonForAttachment.firstName} #{cEActionRequestsBB.selectedPersonForAttachment.lastName} "/>



                            <p:commandButton value="Assign request to selected person"
                                             actionListener="#{cEActionRequestsBB.updateRequestor}"
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasCOGStaffPermissions}"
                                             update="form-messages-global
                                             cearManage-panel-objects"
                                             oncomplete="PF('change-person-dialog').hide()"/>

                            <p:commandButton ajax="true" 
                                             value="Cancel" icon="fa fa-stop" 
                                             onclick="PF('change-person-dialog').hide()"/>
                            <hr/>


                            <h2>Search Results</h2>

                            <p:dataTable
                                id="personTable"
                                var="p"
                                value="#{personSearchBB.personList}"
                                rowKey="#{p.personID}"
                                tableStyleClass="primeDataTable"
                                scrollable="true"
                                scrollHeight="200"
                                rowExpandMode="single"
                                expandedRow="false"
                                filteredValue="#{personSearchBB.filteredPersonList}"
                                widgetVar="personSelectListTable">

                                <p:column width="3%" headerText="Exp">
                                    <p:rowToggler/>
                                </p:column>
                                <p:column width="8%" headerText="ID">
                                    <h:outputText value="#{p.personID}"/>
                                </p:column>
                                <p:column width="10%" sortBy="#{p.personType.label}"
                                          filterBy="#{p.personType.label}"
                                          headerText="Type">
                                    <h:outputText value="#{p.personType.label}"/>
                                </p:column>


                                <p:column width="10%" sortBy="#{p.firstName}"
                                          filterBy="#{p.firstName}"
                                          headerText="First">
                                    <h:outputText value="#{p.firstName}"/>
                                </p:column>

                                <p:column width="15%" filterBy="#{p.lastName}"
                                          sortBy="#{p.lastName}"
                                          headerText="Last">
                                    <h:outputText value="#{p.lastName}"/>
                                </p:column>

                                <p:column sortBy="#{p.addressStreet}"
                                          filterBy="#{p.addressStreet}"
                                          headerText="Address">
                                    <h:outputText escape="false" value="#{p.addressStreet}"/>
                                    <p:spacer height="5px"/>
                                    <h:outputText value="#{p.addressCity}, #{p.addressState} #{p.addressZip}"/>
                                </p:column>

                                <p:column width="10%" headerText="Select">
                                    <p:commandButton actionListener="#{cEActionRequestsBB.selectNewRequestPerson(p)}"
                                                     ajax="true"
                                                     value="select"
                                                     update="change-person-form:confirm-person-ot"/>
                                </p:column>


                                <p:rowExpansion>
                                    <div class="outlinedBox">

                                        <h2>Full person listing for <h:outputText value="#{p.firstName} #{p.lastName}"/> </h2>
                                        <h:panelGrid columns="4" cellpadding="10" footerClass="gridFooter"
                                                     columnClasses="gridTd, gridTd, gridTd, gridTd">

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="First Name"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.firstName}"/>
                                                </div>
                                            </h:panelGroup>


                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Last Name"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.lastName}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Muni"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.muniName}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Type"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.personType.label}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Job Title"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.jobTitle}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Email"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.email}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Address"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="#{p.addressStreet}"/>
                                                    <p:spacer height="5px"/>
                                                    <h:outputText value="#{p.addressCity}, #{p.addressState} #{p.addressZip}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Under 19"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.under18}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Active?"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.active}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Last Updated"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.lastUpdated}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Expires"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.expiryDate.toString}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Phone home"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.phoneHome}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Phone work"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.phoneWork}"/>
                                                </div>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <h:outputLabel styleClass="bold" value="Phone cell"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{p.phoneCell}"/>
                                                </div>
                                            </h:panelGroup>

                                            <f:facet name="footer">
                                                <h:outputLabel styleClass="bold" value="Person notes"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="#{p.notes}"/>
                                                </div>
                                            </f:facet>
                                        </h:panelGrid>
                                    </div>
                                </p:rowExpansion>
                            </p:dataTable>

                        </h:form>
                    </p:dialog>

                    <p:confirmDialog message="Attach internal message" 
                                     severity="alert" widgetVar="internal-message-dialog"
                                     closable="true" responsive="true"
                                     rendered="#{systemServicesBB.bbSessionUser.keyCard.hasCOGStaffPermissions}">

                        <h:form id="internal-message-form">
                            <h:outputLabel for="internal-message-ita" value="Message text"/>
                            <p:spacer height="15px"/>
                            <p:inputTextarea id="internal-message-ita" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.internalMessageText}"/>
                            <p:spacer height="15px"/>
                            <h:outputText escape="false" value="Your name and a timestamp will be bundled with this message 
                                          and attached to #{cEActionRequestsBB.selectedRequest.requestID}"/>

                            <p:spacer height="15px"/>
                            <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.attachInternalMessage}"
                                             value="Submit" icon="fa fa-link" oncomplete="PF('internal-message-dialog').hide()"
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasCOGStaffPermissions}"
                                             update="cearManage-panel-notes
                                             form-messages-global"/>
                            <p:commandButton ajax="true" 
                                             value="Cancel" icon="fa fa-stop" 
                                             onclick="PF('internal-message-dialog').hide()"/>
                        </h:form>
                    </p:confirmDialog>

                    <p:confirmDialog message="Attach municipality message" 
                                     severity="alert" widgetVar="muni-message-dialog"
                                     closable="true" responsive="true"
                                     rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}">

                        <h:form id="muni-message-form">
                            <h:outputLabel for="muni-message-ita" value="Message text"/>
                            <p:spacer height="15px"/>
                            <p:inputTextarea id="muni-message-ita" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.muniMessageText}"/>
                            <p:spacer height="15px"/>
                            <h:outputText escape="false" value="Your name and a timestamp will be bundled with this message 
                                          and attached to #{cEActionRequestsBB.selectedRequest.requestID}"/>
                            <p:spacer height="15px"/>
                            <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.attachMuniMessage}"
                                             value="Submit" icon="fa fa-link" oncomplete="PF('muni-message-dialog').hide()"
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                             update="cearManage-panel-notes"/>
                            <p:commandButton ajax="true" 
                                             value="Cancel" icon="fa fa-stop" 
                                             onclick="PF('muni-message-dialog').hide()"/>
                        </h:form>
                    </p:confirmDialog>


                    <p:confirmDialog message="Attach public message" 
                                     severity="alert" widgetVar="public-message-dialog"
                                     closable="true"
                                     rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}">

                        <h:form id="public-message-form">
                            <h:outputLabel for="public-message-ita" value="Message text"/>
                            <p:spacer height="15px"/>
                            <p:inputTextarea id="public-message-ita" style="width: 300px; height: 200px;" value="#{cEActionRequestsBB.publicMessageText}"/>
                            <p:spacer height="15px"/>
                            <h:outputText escape="false" value="Your name and a timestamp will be bundled with this message 
                                          and attached to #{cEActionRequestsBB.selectedRequest.requestID}"/> 

                            <p:spacer height="15px"/>
                            <p:commandButton ajax="true" actionListener="#{cEActionRequestsBB.attachPublicMessage}"
                                             value="Submit" icon="fa fa-link" oncomplete="PF('public-message-dialog').hide()"
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                             update="cearManage-panel-notes
                                             form-messages-global"/>
                            <p:commandButton ajax="true" 
                                             value="Cancel" icon="fa fa-stop" 
                                             onclick="PF('public-message-dialog').hide()"/>
                        </h:form>
                    </p:confirmDialog>

                    <p:dialog  id="cear-print-dialog"
                               widgetVar="cear-print-dialog-var"
                               closable="true" responsive="true"
                               rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}">

                        <h:form id="cear-print-form">

                            <h2>Print code enforcement requests</h2>

                            <h:outputLabel for="report-cear-title-it" value="Report title"/>

                            <p:spacer height="5px"/>

                            <p:inputText id="report-cear-title-it" style="width: 300px;" value="#{cEActionRequestsBB.reportConfig.title}"/>
                            <p:spacer height="2px"/>
                            <h:outputText styleClass="italic" value="note: your name and the current date and time will be automatically inserted" />

                            <p:spacer height="10px"/>

                            <h:outputLabel for="report-cear-notes-ita" value="Notes"/>
                            <p:spacer height="5px"/>
                            <p:inputText id="report-cear-notes-ita" style="width: 300px; height: 100px;" value="#{cEActionRequestsBB.reportConfig.notes}"/>
                            <p:spacer height="5px"/>

                            <h2>Display options</h2>

                            <h:outputLabel class="bold" value="Single request or full list?" for="cear-print-singleorlist-is" />
                            <p:spacer height="1px"/>
                            <p:inputSwitch  id="cear-print-singleorlist-is"
                                            value="#{cEActionRequestsBB.reportConfig.printFullCEARQueue}" 
                                            onLabel="Print all requests in list" offLabel="Only print active request" />

                            <p:spacer height="5px"/>

                            <h:outputLabel class="bold" value="Include photographs with requests?" for="cear-print-includephotos-is" />
                            <p:spacer height="1px"/>
                            <p:inputSwitch  id="cear-print-includephotos-is"
                                            value="#{cEActionRequestsBB.reportConfig.includePhotos}" 
                                            onLabel="Print photos" offLabel="Hide photos" />

                            <p:spacer height="5px"/>

                            <p:commandButton ajax="true" id="cear-print-cancel"
                                             value="Cancel" icon="fa fa-stop" 
                                             onclick="PF('cear-print-dialog-var').hide()"/>

                            <p:commandButton ajax="false" action="#{cEActionRequestsBB.generateReportSingleCEAR}"
                                             value="Print code enforcement request" icon="fa fa-print" 
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions and !cEActionRequestsBB.reportConfig.printFullCEARQueue}"
                                             />
                            <p:commandButton ajax="false" action="#{cEActionRequestsBB.generateReportMultiCEAR}"
                                             value="Generate report" icon="fa fa-print" 
                                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions and cEActionRequestsBB.reportConfig.printFullCEARQueue}"
                                             />
                        </h:form>

                    </p:dialog>

                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

