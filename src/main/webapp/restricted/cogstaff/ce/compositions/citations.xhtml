<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns="http://www.w3.org/1999/xhtml">


    <p:growl id="citations-growl"
             globalOnly="false" 
             />

    <p:panel id="cecase-citations-panel"
             toggleable="true"
             collapsed="false"
             header="Citations (#{ceCaseSearchProfileBB.currentCase.citationList.size()})"
             rendered="true"
             >

        <h:form id="cecase-citations-form">

            <p:commandButton    id="cecase-citation-add-button"
                                ajax="true"
                                styleClass="noFill button-size-small"
                                actionListener="#{citationBB.onCitationAddInitButtonChange}"
                                oncomplete="PF('citation-add-dialog-var').show()"
                                value="Add Citation"
                                icon="fa fa-gavel"
                                update="citation-add-dialog
                                citation-add-form"

                                />

            <p:spacer height="5px" />

            <p:dataTable
                id="cecase-citations-table"
                var="citation"
                rowKey="#{citation.citationID}"
                value="#{ceCaseSearchProfileBB.currentCase.citationList}"
                tableStyleClass="primeDataTable"
                draggableColumns="true"
                reflow="true">

                <p:column width="10%">
                    <f:facet name="header">
                        <h:outputText value="Issuance / ID" />
                    </f:facet>
                    <h:outputText value="#{citationBB.getPrettyDateNoTime(citation.dateOfRecord)}"/>
                    <p:spacer height="2px"/>
                    <h:outputText value="#{citation.citationNo}"/>

                </p:column>

                <p:column width="80%">

                    <f:facet name="header">
                        <h:outputText value="Status / Date" />
                    </f:facet>

                    <h:outputText value="#{citation.status.status.statusTitle}"/>

                    <p:spacer height="2px"/>

                    <h:outputText value="as of #{citationBB.getPrettyDateNoTime(citation.status.dateOfRecord)}"/>

                </p:column>


                <p:column width="10%">
                    <f:facet name="edit">
                        <h:outputText value="Actions" />
                    </f:facet>

                    <div class="restrict-main-contents-io-link">
                        <p:commandLink      id="citation-profile-init-cb"
                                            ajax="true"
                                            actionListener="#{citationBB.onCitationViewButtonChange(citation)}"
                                            oncomplete="PF('citation-profile-dialog-var').show()"
                                            style="color:blue;"
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                            update="citation-profile-dialog"
                                            value="view/edit" />
                    </div>

                </p:column>
            </p:dataTable>
        </h:form>
    </p:panel>

    <p:dialog   id="citation-profile-dialog"
                height="700" width="600"
                widgetVar="citation-profile-dialog-var"
                responsive="true"
                resizable="true"
                closable="true"
                closeOnEscape="true"
                dynamic="true"
                modal="true"
                header="Citation ID: #{citationBB.currentCitation.citationID} Profile"
                rendered="true"
                >

        <p:panel id="citation-profile-info-panel"
                 toggleable="true"
                 collapsed="false"
                 header="Basic Info">

            <h:form id="citation-info-form">

                <p:commandButton id="citation-profile-info-edit-button"
                                 value="#{citationBB.citationInfoEditMode ? 'Save changes' : 'Edit'}"
                                 rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                 icon="fa #{citationBB.citationInfoEditMode ? 'fa-check' : 'fa-pencil'}"
                                 actionListener="#{citationBB.onCitationEditModeToggle}"
                                 oncomplete="PF('citation-profile-dialog-var').show()"
                                 update="citation-info-form"/>


                <div class="restrict-main-contents-io-button gray_button">

                    <p:commandButton    id="citation-profile-info-edit-abort-button"
                                        ajax="true"
                                        rendered="#{citationBB.citationInfoEditMode}"
                                        value="Abort edit"
                                        process="@none"
                                        immediate="true"
                                        actionListener="#{citationBB.onOperationCancelButtonChange}"
                                        oncomplete="PF('citation-profile-dialog-var').show()"
                                        update="citation-info-form"
                                        icon="fa fa-stop" />

                </div>

                <p:spacer height="5px"/>    

                <div class="p-grid">
                    <div class="p-col-6">Internal ID</div>

                    <div class="p-col-6">
                        <h:outputText rendered="#{!citationBB.citationInfoEditMode}" 
                                      value="#{citationBB.currentCitation.citationNo}"/>
                        <p:inputText rendered="#{citationBB.citationInfoEditMode}" 
                                     value="#{citationBB.currentCitation.citationNo}"
                                     size=""/>
                    </div>
                    <div class="p-col-6">Filing type</div>
                    <div class="p-col-6">
                        <h:outputText rendered="#{!citationBB.citationInfoEditMode}" 
                                      value="#{citationBB.currentCitation.filingType.title}"/>

                        <p:selectOneMenu id="citation-filingtype-som"
                                         required="true"
                                         rendered="#{citationBB.citationInfoEditMode}" 
                                         value="#{citationBB.currentCitation.filingType}">
                            <f:converter converterId="citationFilingTypeConverter"/>
                            <f:selectItems value="#{citationBB.citationFilingTypeList}"
                                           var="cft" itemValue="#{cft}" itemLabel="#{cft.title}"/>
                        </p:selectOneMenu>

                    </div>
                    <div class="p-col-6">Date of Record</div>
                    <div class="p-col-6">

                        <h:outputText rendered="#{!citationBB.citationInfoEditMode}" 
                                      value="#{citationBB.getPrettyDateNoTime(citationBB.currentCitation.dateOfRecord)}"/>

                        <p:calendar id="citation-dor-it"
                                    rendered="#{citationBB.citationInfoEditMode}" 
                                    value="#{citationBB.currentCitation.dateOfRecord}"
                                    mode="popup" tabindex="3"
                                    showOn="button"
                                    pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                    navigator="true" timeInput="true" showHour="true" showMinute="true" showSecond="false" showMillisec="false"
                                    showButtonPanel="true"
                                    showTodayButton="true"
                                    required="true"/>

                        <h:message for="citation-dor-it" showDetail="false" showSummary="true"
                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                    </div>
                    <div class="p-col-6">Court Entity of Origin</div>
                    <div class="p-col-6">
                        <h:outputText rendered="#{!citationBB.citationInfoEditMode}" 
                                      value="#{!empty citationBB.currentCitation.origin_courtentity ? citationBB.currentCitation.origin_courtentity.courtEntityName : ''}"/>

                        <p:selectOneMenu id="citation-court-som"
                                         rendered="#{citationBB.citationInfoEditMode}" 
                                         required="false"
                                         value="#{citationBB.currentCitation.origin_courtentity}">
                            <f:converter converterId="courtEntityConverter"/>
                            <f:selectItems value="#{citationBB.courtEntityList}"
                                           var="ce" itemValue="#{ce}" itemLabel="#{ce.courtEntityName}"/>
                        </p:selectOneMenu>

                        <h:message for="citation-court-som" showDetail="false" showSummary="true"
                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                    </div>
                    <div class="p-col-6">Official Text</div>
                    <div class="p-col-6" >

                        <h:outputText rendered="#{!citationBB.citationInfoEditMode}" 
                                      value="#{citationBB.currentCitation.officialText}"/>

                        <p:inputTextarea id="citation-text-it"
                                         value="#{citationBB.currentCitation.officialText}"
                                         rendered="#{citationBB.citationInfoEditMode}"
                                         tabindex="15"
                                         required="true"
                                         styleClass="data_field_value"/>
                        <h:message for="citation-text-it"
                                   showDetail="false"
                                   showSummary="true"
                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                    </div>

                    <div class="p-col-6">Issuing Officer</div>
                    <div class="p-col-6">
                        <h:outputText rendered="#{!citationBB.citationInfoEditMode}" 
                                      value="#{citationBB.currentCitation.filingOfficer.username}"/>


                        <p:selectOneMenu id="citation-issuingofficer-som"
                                         rendered="#{citationBB.citationInfoEditMode}" 
                                         required="true"
                                         value="#{citationBB.currentCitation.filingOfficer}">
                            <f:converter converterId="userConverter"/>
                            <f:selectItems value="#{citationBB.filingOfficerCandidateList}"
                                           var="iouser" itemValue="#{iouser}" itemLabel="#{iouser.human.name}"/>
                        </p:selectOneMenu>
                    </div>
                </div>

                <f:facet name="footer">

                    <div class="restrict-main-contents-io-button">
                        <p:commandButton    id="citation-update-status-commit-button"
                                            rendered="#{citationBB.citationStatusEditMode}"
                                            ajax="true"
                                            value="Save updates"
                                            actionListener="#{citationBB.onCitationUpdateCommitButtonChange}"
                                            icon="fa fa-edit"
                                            update="citation-info-form"/>
                    </div>
                </f:facet>



            </h:form>
        </p:panel>


        <p:panel id="citation-profile-dockets-panel"
                 toggleable="true"
                 collapsed="false"
                 header="Dockets">

            <h:form id="citation-dockets-form">


                <p:commandButton    id="ctiation-dockets-adddocket-cb"
                                    ajax="true"
                                    value="Add docket"
                                    immediate="true"
                                    oncomplete="PF('citation-docket-dialog-var').show()"
                                    actionListener="#{citationBB.onDocketAddInitButtonChange}"
                                    update="citation-docket-dialog
                                    citation-docket-form"
                                    icon="fa fa-plus" />
                
                <p:spacer height="5px" />

                <p:dataTable    id="citation-dockets-table"
                                value="#{citationBB.currentCitation.docketNos}"
                                var="cdno"  
                                rowKey="#{cdno.docketID}"
                                tableStyleClass="primeDataTable"
                                draggableRows="true" 
                                tabindex="1">



                    <p:column width="50">
                        <f:facet name="header">
                            <h:outputText value="Docket Number"/>
                        </f:facet>
                        <h:outputText value="#{cdno.docketNumber}" />
                       
                    </p:column>
                   
                    <p:column width="15%">
                        <f:facet name="header">
                            <h:outputText value="Filing Date"/>
                        </f:facet>
                        <h:outputText value="#{citationBB.getPrettyDateNoTime(cdno.dateOfRecord)}" />

                    </p:column>

                    <p:column width="25%">
                        <f:facet name="header">
                            <h:outputText value="Court"/>
                        </f:facet>
                        <h:outputText value="#{cdno.courtEntity.courtEntityName}" />

                    </p:column>

                    <p:column width="10%">
                        <f:facet name="header">
                            <h:outputText value="Actions"/>
                        </f:facet>
                        <p:commandLink      id="citation-docket-edit-cb"
                                            ajax="true"
                                            actionListener="#{citationBB.onDocketViewButtonChange(cdno)}"
                                            oncomplete="PF('citation-docket-dialog-var').show()"
                                            style="color:blue;"
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                            update="citation-docket-dialog
                                            citation-docket-form"
                                            value="view/edit" />
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:panel>

        <p:panel id="citation-profile-status-log-panel"
                 toggleable="true"
                 collapsed="false"
                 header="Status Log">

            <h:form id="citation-status-log-form">

                <p:commandButton    id="citation-status-log-add-cb"
                                    ajax="true"
                                    value="Add status log"
                                    immediate="true"
                                    oncomplete="PF('citation-status-log-entry-dialog-var').show()"
                                    actionListener="#{citationBB.onStatusLogEntryAddInitButtonChange}"
                                    icon="fa fa-plus" />

                <p:spacer height="5px" />

                <p:dataTable    id="citation-status-log-table"
                                value="#{citationBB.currentCitation.statusLog}"
                                var="csle"
                                rowKey="#{csle.logEntryID}"
                                tableStyleClass="primeDataTable"
                                draggableRows="true" 
                                tabindex="6">


                    <p:column width="10%">
                        <f:facet name="header">
                            <h:outputText value="EntryID"/>
                        </f:facet>
                        <h:outputText value="#{csle.logEntryID}" />
                    </p:column>

                    <p:column width="30%" sortBy="#{csle.dateOfRecord}">
                        <f:facet name="header">
                            <h:outputText value="Date"/>
                        </f:facet>
                        <h:outputText value="#{citationBB.getPrettyDateNoTime(csle.dateOfRecord)}" />
                    </p:column>

                    <p:column width="45%">
                        <f:facet name="header">
                            <h:outputText value="Status"/>
                        </f:facet>
                        <h:outputText value="#{csle.status.statusTitle}" />
                    </p:column>

                    <p:column width="10%">
                        <f:facet name="header">
                            <h:outputText value="Actions"/>
                        </f:facet>
                        <p:commandLink      id="citation-update-status-cb"
                                            ajax="true"
                                            actionListener="#{citationBB.onCitationStatusLogEntryViewButtonChange(csle)}"
                                            oncomplete="PF('citation-status-log-entry-dialog-var').show()"
                                            style="color:blue;"
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                            update="@form:@parent:citation-status-log-entry-form"
                                            value="edit" />


                    </p:column>
                </p:dataTable>
            </h:form>
        </p:panel>
        
        <p:panel    id="citation-violations-panel"
                    toggleable="true"
                    collapsed="false"
                    header="Violations">


            <div    id="citation-violations-div"
                    class="ui-g-12 ui-md-12 ui-lg-12 data_field"
                    style="width: 100%; clear: both;">

                <p:outputLabel for="citation-violations-datascroller"
                               styleClass="data_field_label">
                    <h:outputText value="Linked Violations"/>
                </p:outputLabel>
                <p:dataScroller
                    id="citation-violations-datascroller"
                    value="#{citationBB.currentCitation.violationList}"
                    var="citvv"
                    widgetVar="citation-violation-compactlist-widgetvar">

                    <h:outputText  value="Ch. #{citvv.violatedEnfElement.ordchapterNo}:" />
                    <h:outputText  value="#{citvv.violatedEnfElement.ordchapterTitle} | " />
                    <h:outputText  value="&#167;#{citvv.violatedEnfElement.ordSecNum}:" />
                    <h:outputText  value="#{citvv.violatedEnfElement.ordSecTitle} |  " />
                    <h:outputText  value="&#167;&#167;#{citvv.violatedEnfElement.ordSubSecNum} " />
                    <h:outputText  value="#{citvv.violatedEnfElement.ordSubSecTitle} " />
                    <h:outputText id="v-source-name-compactlist-ot" value="(#{citvv.violatedEnfElement.source.sourceName}" />
                    <h:outputText id="v-source-sep-compactlist-ot" value=" "/>
                    <h:outputText id="v-source-year-compactlist-ot" value="#{citvv.violatedEnfElement.source.sourceYear}) | "/>
                    <h:outputText id="status-compactlist-line-ot" value="Status: #{citvv.status.label}"/>

                </p:dataScroller>
            </div>

        </p:panel>
        
        <p:panel    id="citation-notes-panel"
                    toggleable="true"
                    collapsed="false"
                    header="Notes">
              <h:form id="citations-notes-panel-form">
                  
                <p:commandButton    id="citation-note-add-cb"
                                    ajax="true"
                                    value="Create new note"
                                    process="@none"
                                    immediate="true"
                                    oncomplete="PF('citation-notes-dialog-var').show()"
                                    actionListener="#{citationBB.onCitationNoteInitButtonChange}"
                                    icon="fa fa-plus" />

                <p:spacer height="2px" />
                
                <h:outputText value="#{citationBB.currentCitation.notes}"
                              escape="false" 
                              class="wrapText"/>

              </h:form>
              
        </p:panel>
        
        
        <p:panel    id="citation-persons-panel"
                    toggleable="true"
                    collapsed="false"
                    header="Persons">
            <h:form id="citation-persons-form">

                    <div class="restrict-main-contents-io-link">
                        <p:commandLink      id="citation-persons-add-cl"
                                            ajax="true"
                                            actionListener="#{citationBB.onDocketNoteInitButtonChange}"
                                            oncomplete="PF('citation-status-log-note-dialog').show()"
                                            style="color:blue;"
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                            update="citation-status-log-note-form"
                                            value="Connect person" />
                    </div>
                
                
                    <p:spacer height="5px"/>
                    
                    
                <p:dataTable    id="citation-docket-persons-table"
                                value="#{citationBB.currentCitation.humanLinkList}"
                                var="chl"
                                rowKey="#{chl.humanID}"
                                tableStyleClass="primeDataTable"
                                draggableRows="true" 
                                tabindex="6">


                    <p:column width="50%">
                        <f:facet name="header">
                            <h:outputText value="Name"/>
                        </f:facet>
                        <h:outputText value="#{chl.name}" />
                    </p:column>

                    <p:column width="25%">
                        <f:facet name="header">
                            <h:outputText value="Role"/>
                        </f:facet>
                        <h:outputText value="#{chl.linkedObjectRole.title}" />
                    </p:column>

                    <p:column width="25%">
                        <f:facet name="header">
                            <h:outputText value="Actions"/>
                        </f:facet>
                        
                         <p:commandLink      id="citation-persons-link-remove"
                                            ajax="true"
                                            actionListener="#{citationBB.onDocketPersonRemoveButtonChange(dhl)}"
                                            style="color:blue;"
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                            update="docket-persons-form"
                                            value="remove link" />
                        
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:panel>

    </p:dialog>

    <p:dialog   id="citation-add-dialog"
                height="600" width="900"
                widgetVar="citation-add-dialog-var"
                responsive="true"
                resizable="true"
                closable="true"
                closeOnEscape="true"
                dynamic="true"
                modal="true"
                header="Add new citation"
                rendered="true"
                >

        <h:form id="citation-add-form">


            <p:spacer height="15px"/>

            <h2>Outstanding code violations on Case ID <h:outputText value="#{sessionBean.sessCECase.caseID}" />
                at <h:outputText value="#{sessionBean.sessCECase.property.address.addressPretty1Line}" /></h2>

            <p:dataTable
                id="citation-violations-table"
                selectionMode="none"
                value="#{citationBB.currentCitation.violationList}"
                tableStyleClass="primeDataTable"
                expandedRow="false"
                rowExpandMode="multiple"
                draggableColumns="true"
                reflow="true"
                var="citv"
                rowKey="#{citv.violationID}">
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Code Element" />
                    </f:facet>
                    <div class="rowExpansion">
                        <h:outputLabel value="#{citv.codeViolated.headerString}"
                                       escape="false"/>
                    </div>
                </p:column>

                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Stipulated Comp. Date" />
                    </f:facet>
                    <h:outputText value="#{citv.stipulatedComplianceDate}"/>
                </p:column>

                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Remove" />
                    </f:facet>
                    <p:commandButton id="remove-violation-from-violationtable-cb"
                                     ajax="true"
                                     actionListener="#{citationBB.onCitationViolationRemoveButtonChange(citv)}"
                                     icon="fa fa-trash"
                                     value="Remove"
                                     immediate="true"
                                     update="citation-violations-table">
                    </p:commandButton>

                </p:column>
            </p:dataTable>


            <h2>Citation form fields</h2>


            <div class="p-grid">
                <div class="p-col-6">Filing type</div>
                <div class="p-col-6">

                    <p:selectOneMenu id="citation-filingstatus-som"
                                     required="true"
                                     value="#{citationBB.currentCitation.filingType}">
                        <f:converter converterId="citationFilingTypeConverter"/>
                        <f:selectItems value="#{citationBB.citationFilingTypeList}"
                                       var="cft" itemValue="#{cft}" itemLabel="#{cft.title}"/>
                    </p:selectOneMenu>

                </div>
                <div class="p-col-6">Citation Number (internal only)</div>
                <div class="p-col-6">

                    <p:inputText id="citation-no-it"
                                 value="#{citationBB.currentCitation.citationNo}"
                                 tabindex="1"
                                 required="false"
                                 styleClass="data_field_value"/>

                    <h:message for="citation-no-it" showDetail="false" showSummary="true"
                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                </div>
                <div class="p-col-6">Date of Record</div>
                <div class="p-col-6">

                    <p:calendar id="citation-dor-it"
                                value="#{citationBB.currentCitation.dateOfRecord}"
                                mode="popup" tabindex="3"
                                showOn="button"
                                pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                navigator="true" timeInput="true" showHour="true" showMinute="true" showSecond="false" showMillisec="false"
                                showButtonPanel="true"
                                showTodayButton="true"
                                required="true"/>

                    <h:message for="citation-dor-it" showDetail="false" showSummary="true"
                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                </div>
                <div class="p-col-6">Court Entity of Origin</div>
                <div class="p-col-6">

                    <p:selectOneMenu id="citation-court-som"
                                     required="false"
                                     value="#{citationBB.currentCitation.origin_courtentity}">
                        <f:converter converterId="courtEntityConverter"/>
                        <f:selectItems value="#{citationBB.courtEntityList}"
                                       var="ce" itemValue="#{ce}" itemLabel="#{ce.courtEntityName}"/>
                    </p:selectOneMenu>

                    <h:message for="citation-court-som" showDetail="false" showSummary="true"
                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                </div>
                <div class="p-col-6">Official Text</div>
                <div class="p-col-6">

                    <p:inputTextarea id="citation-text-it"
                                     value="#{citationBB.currentCitation.officialText}"
                                     tabindex="15"
                                     required="true"
                                     styleClass="data_field_value"/>
                    <h:message for="citation-text-it"
                               showDetail="false"
                               showSummary="true"
                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                </div>

                <div class="p-col-6">Issuing Officer</div>
                <div class="p-col-6">
                    <p:selectOneMenu id="citation-add-issuingofficer-som"
                                     rendered="true" 
                                     required="true"
                                     value="#{citationBB.currentCitation.filingOfficer}">
                        <f:converter converterId="userConverter"/>
                        <f:selectItems value="#{systemServicesBB.bbSessionMuni.swornOfficerList}"
                                       var="iouser" itemValue="#{iouser}" itemLabel="#{iouser.human.name}"/>
                    </p:selectOneMenu>
                </div>
            </div>



                <div class="restrict-main-contents-io-button gray_button">

                    <p:commandButton    id="citation-insert-abort-button"
                                        ajax="true"
                                        value="Cancel Issue Citation"
                                        process="@none"
                                        immediate="true"
                                        actionListener="#{citationBB.onOperationCancelButtonChange}"
                                        icon="fa fa-stop" />

                </div>
                <div class="restrict-main-contents-io-button">

                    <p:commandButton    id="citation-insert-button"
                                        ajax="false"
                                        value="Issue Citation"
                                        action="#{citationBB.onCitationAddCommitButtonChange}"
                                        icon="fa fa-gavel" />

                </div>

        </h:form>
    </p:dialog>



    <p:dialog   id="citation-status-log-entry-dialog"
                height="300" width="600"
                widgetVar="citation-status-log-entry-dialog-var"
                responsive="true"
                resizable="true"
                closable="true"
                closeOnEscape="true"
                dynamic="true"
                modal="true"
                header="Status Log Entry for ID: #{citationBB.currentCitationStatusLogEntry.logEntryID}"
                rendered="true"
                >

        <h:form id="citation-status-log-entry-form">

            <p:commandButton id="citation-status-edit-button"
                             value="#{citationBB.citationStatusEditMode ? 'Save edits' : 'Edit'}"
                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                             icon="fa #{citationBB.citationStatusEditMode ? 'fa-check' : 'fa-pencil'}"
                             actionListener="#{citationBB.onCitationStatusLogEditModeToggle}"
                             oncomplete="PF('citation-status-log-entry-dialog-var').show()"
                             update="citation-status-log-entry-form
                             citation-profile-dockets-panel
                             citation-dockets-form
                             citations-growl
                             "/>
            <div class="restrict-main-contents-io-button gray_button">


                <p:commandButton id="citation-status-edit-abort-button"
                                 value="Discard Edits"
                                 rendered="#{citationBB.citationStatusEditMode}"
                                 icon="fa fa-stop"
                                 actionListener="#{citationBB.onCitationStatusLogEditAbortListener}"
                                 oncomplete="PF('citation-status-log-entry-dialog-var').show()"
                                 update="citation-status-log-entry-form
                                 citations-growl"/>

            </div>

            <p:spacer height="5px"/>

            <div class="p-grid">
                <div class="p-col-6">Log Entry ID</div>
                <div class="p-col-6">
                    <h:outputText value="#{citationBB.currentCitationStatusLogEntry.logEntryID}" />
                </div>

                <div class="p-col-6">Status</div>
                <div class="p-col-6">
                    <h:outputText rendered="#{!citationBB.citationStatusEditMode}"
                                  value="#{citationBB.currentCitationStatusLogEntry.status.statusTitle}" />

                    <p:selectOneMenu        id="citation-update-status-som"
                                            required="false"
                                            rendered="#{citationBB.citationStatusEditMode}"
                                            value="#{citationBB.currentCitation.status}">
                        <f:converter converterId="citationStatusConverter"/>
                        <f:selectItems value="#{citationBB.citationStatusList}"
                                       var="cs" itemValue="#{cs}" itemLabel="#{cs.statusTitle}"/>
                    </p:selectOneMenu>
                </div>

                <div class="p-col-6">Date of Record</div>
                <div class="p-col-6">
                    <h:outputText rendered="#{!citationBB.citationStatusEditMode}"
                                  value="#{citationBB.currentCitationStatusLogEntry.status.statusTitle}" />

                    <p:calendar id="citation-statuslog-dor-it"
                                rendered="#{citationBB.citationStatusEditMode}"
                                value="#{citationBB.currentCitationStatusLogEntry.dateOfRecord}"
                                mode="popup" tabindex="3"
                                showOn="button"
                                pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                navigator="true" timeInput="false" 
                                showButtonPanel="true"
                                showTodayButton="true"
                                required="true"/>
                </div>

                <div class="p-col-6">Notes

                    <div class="restrict-main-contents-io-link">
                        <p:commandLink      id="citation-status-log-note-add-cl"
                                            ajax="true"
                                            actionListener="#{citationBB.onStatusLogNoteInitButtonChange}"
                                            oncomplete="PF('citation-status-log-note-dialog').show()"
                                            style="color:blue;"
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                            update="citation-status-log-note-form"
                                            value="add note" />
                    </div>
                </div>
                <div class="p-col-6">
                    <h:outputText styleClass="wrapText" 
                                  value="#{citationBB.currentCitationStatusLogEntry.notes}"/>
                </div>
            </div>
           
        </h:form>
    </p:dialog>

    <p:dialog   id="citation-status-log-note-dialog"
                height="800" width="800"
                widgetVar="citation-status-log-note-dialog"
                responsive="true"
                resizable="true"
                closable="true"
                closeOnEscape="true"
                dynamic="true"
                modal="true"
                header="Add note to Status log #{citationBB.currentCitationStatusLogEntry.logEntryID}"
                rendered="true"
                >
        <h:form id="citation-status-log-note-form">

            <p:inputTextarea value="#{citationBB.statusNotesFormText}" />

            <f:facet name="footer">

                <div class="restrict-main-contents-io-button gray_button">

                    <p:commandButton    id="citation-update-status-abort-button"
                                        ajax="true"
                                        value="Done"
                                        process="@none"
                                        immediate="true"
                                        actionListener="#{citationBB.onOperationCancelButtonChange}"
                                        oncomplete="PF('citation-status-log-note-dialog').hide()"
                                        icon="fa fa-stop" 
                                        update="citations-growl"/>

                </div>
                <div class="restrict-main-contents-io-button">
                    <p:commandButton    id="citation-update-status-commit-button"
                                        rendered="#{citationBB.citationStatusEditMode}"
                                        ajax="true"
                                        value="Save Note"
                                        actionListener="#{citationBB.onStatusLogNoteCommitButtonChange}"
                                        icon="fa fa-save"
                                        oncomplete="PF('citation-status-log-note-dialog').hide()"
                                        update="citation-status-dialog-form
                                        citations-growl"/>
                </div>
            </f:facet>
        </h:form>
    </p:dialog>
    

    <p:dialog   id="citation-docket-dialog"
                height="550" width="600"
                widgetVar="citation-docket-dialog-var"
                responsive="true"
                resizable="true"
                closable="true"
                closeOnEscape="true"
                dynamic="true"
                modal="true"
                header="#{citationBB.currentCitationDocket.docketNumber eq 0 ? 'Add new docket': 'View/edit docket'}"
                rendered="true"
                >

        <h:form id="citation-docket-form">

            <p:commandButton id="citation-docket-edit-button"
                             value="#{citationBB.citationDocketEditMode ? 'Save edits' : 'Edit'}"
                             rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                             icon="fa #{citationBB.citationDocketEditMode ? 'fa-check' : 'fa-pencil'}"
                             actionListener="#{citationBB.onCitationDocketEditModeToggle}"
                             oncomplete="PF('citation-docket-dialog-var').show()"
                             update="citation-docket-form
                             citations-growl"/>
            
            <div class="restrict-main-contents-io-button gray_button">


                <p:commandButton id="citation-docket-edit-abort-button"
                                 value="Discard Edits"
                                 rendered="#{citationBB.citationDocketEditMode}"
                                 icon="fa fa-stop"
                                 actionListener="#{citationBB.onDocketAddEditOperationAbortButtonChange}"
                                 oncomplete="PF('citation-docket-dialog-var').show()"
                                 update="citation-docket-form
                                 citations-growl"/>

            </div>

            <p:spacer height="5px"/>

            <div class="p-grid">
                <div class="p-col-6">Docket record ID (Internal)</div>
                <div class="p-col-6">
                    <h:outputText value="#{citationBB.currentCitationDocket.docketID}" />
                </div>
                
                <div class="p-col-6">Docket Number</div>
                <div class="p-col-6">
                    <h:outputText   rendered="#{!citationBB.citationDocketEditMode}"
                                    value="#{citationBB.currentCitationDocket.docketNumber}" />
                    
                    <p:inputText    rendered="#{citationBB.citationDocketEditMode}"
                                    value="#{citationBB.currentCitationDocket.docketNumber}" />
                </div>
                
                <div class="p-col-6">Court entity </div>
                
                <div class="p-col-6">

                    <h:outputText   rendered="#{!citationBB.citationDocketEditMode}"
                                    value="#{!empty citationBB.currentCitationDocket.courtEntity ? citationBB.currentCitationDocket.courtEntity.courtEntityName : ''}" />
                    
                    <p:selectOneMenu id="citation-docket-court-som"
                                     rendered="#{citationBB.citationDocketEditMode}"
                                     required="false"
                                     value="#{citationBB.currentCitationDocket.courtEntity}">
                        <f:converter converterId="courtEntityConverter"/>
                        <f:selectItems value="#{citationBB.courtEntityList}"
                                       var="ce" itemValue="#{ce}" itemLabel="#{ce.courtEntityName}"/>
                    </p:selectOneMenu>

                </div>
                <div class="p-col-6">Date of Record</div>
                <div class="p-col-6">
                    <h:outputText   rendered="#{!citationBB.citationDocketEditMode}"
                                    value="#{citationBB.getPrettyDate(citationBB.currentCitationDocket.dateOfRecord)}" />

                    <p:calendar id="citation-dor-it"
                                rendered="#{citationBB.citationDocketEditMode}"
                                value="#{citationBB.currentCitationDocket.dateOfRecord}"
                                mode="popup" tabindex="3"
                                showOn="button"
                                pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                navigator="true" timeInput="false" 
                                showButtonPanel="true"
                                showTodayButton="true"
                                required="true"/>

                </div>
                <div class="p-col-6">Creation</div>
                <div class="p-col-6">
                    <h:outputText value="#{citationBB.getPrettyDate(citationBB.currentCitationDocket.createdTS)}" />
                    <p:spacer height="2px" />
                    <h:outputText value="#{citationBB.currentCitationDocket.createdBy.username}" />
                </div>
                
                <div class="p-col-6">Last update</div>
                <div class="p-col-6">
                    <h:outputText value="#{citationBB.getPrettyDate(citationBB.currentCitationDocket.lastUpdatedTS)}" />
                    <p:spacer height="2px" />
                    <h:outputText value="#{citationBB.currentCitationDocket.lastUpdatedBy.username}" />
                </div>
                
                <div class="p-col-6">Record status</div>
                <div class="p-col-6">
                    <h:outputText value="#{empty citationBB.currentCitationDocket.deactivatedTS ? 'active' : 'deactivated on'}" />
                    <p:spacer height="2px" />
                    <h:outputText value="#{empty citationBB.currentCitationDocket.deactivatedTS ? '' : citationBB.getPrettyDate(citationBB.currentCitationDocket.deactivatedTS) }" />
                </div>
            </div>
        </h:form>
        
        <p:panel    id="docket-persons-panel"
                    toggleable="true"
                    collapsed="false"
                    header="Persons">
            <h:form id="docket-persons-form">

                    <div class="restrict-main-contents-io-link">
                        <p:commandLink      id="citation-docket-person-add-cl"
                                            ajax="true"
                                            actionListener="#{citationBB.onDocketNoteInitButtonChange}"
                                            oncomplete="PF('citation-status-log-note-dialog').show()"
                                            style="color:blue;"
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                            update="citation-status-log-note-form"
                                            value="Connect person" />
                    </div>
                
                
                    <p:spacer height="5px"/>
                    
                    
                <p:dataTable    id="citation-docket-persons-table"
                                value="#{citationBB.currentCitationDocket.humanLinkList}"
                                var="dhl"
                                rowKey="#{dhl.humanID}"
                                tableStyleClass="primeDataTable"
                                draggableRows="true" 
                                tabindex="6">


                    <p:column width="50%">
                        <f:facet name="header">
                            <h:outputText value="Name"/>
                        </f:facet>
                        <h:outputText value="#{dhl.name}" />
                    </p:column>

                    <p:column width="25%">
                        <f:facet name="header">
                            <h:outputText value="Role"/>
                        </f:facet>
                        <h:outputText value="#{dhl.linkedObjectRole.title}" />
                    </p:column>

                    <p:column width="25%">
                        <f:facet name="header">
                            <h:outputText value="Actions"/>
                        </f:facet>
                        
                         <p:commandLink      id="citation-docket-person-link-remove"
                                            ajax="true"
                                            actionListener="#{citationBB.onDocketPersonRemoveButtonChange(dhl)}"
                                            style="color:blue;"
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                            update="docket-persons-form"
                                            value="remove link" />
                        
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:panel>
        
        
        <p:panel    id="docket-notes-panel"
                    toggleable="true"
                    collapsed="false"
                    header="Docket notes">
            <h:form id="docket-notes-form">
                
                        

                    <div class="restrict-main-contents-io-link">
                        <p:commandLink      id="citation-docket-note-add-cl"
                                            ajax="true"
                                            actionListener="#{citationBB.onDocketNoteInitButtonChange}"
                                            oncomplete="PF('citation-status-log-note-dialog').show()"
                                            style="color:blue;"
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                            update="citation-status-log-note-form"
                                            value="add note" />
                    </div>
                    <p:spacer height="5px"/>
            
                    <h:outputText styleClass="wrapText" 
                                  value="#{!empty citationBB.currentCitationStatusLogEntry.notes ? citationBB.currentCitationStatusLogEntry.notes : 'no notes' }"/>
            
            </h:form>
        </p:panel>
        
    </p:dialog>

    <p:dialog   id="citation-docket-note-dialog"
                height="800" width="800"
                widgetVar="citation-docket-note-dialog-var"
                responsive="true"
                resizable="true"
                closable="true"
                closeOnEscape="true"
                dynamic="true"
                modal="true"
                header="Add note to docket #{citationBB.currentCitationDocket.docketNumber}"
                rendered="true"
                >


        <h:form id="citation-docket-note-form">


            <p:inputTextarea value="#{citationBB.docketNotesFormText}" />
            <p:spacer height="5px" />
            <h:outputText value="date, time, and your name is automatically included in the note" />
            <f:facet name="footer">

                <div class="restrict-main-contents-io-button gray_button">

                    <p:commandButton    id="citation-docket-notes-abort-button"
                                        ajax="true"
                                        value="Done"
                                        process="@none"
                                        immediate="true"
                                        actionListener="#{citationBB.onOperationCancelButtonChange}"
                                        oncomplete="PF('citation-docket-note-dialog').hide()"
                                        icon="fa fa-stop" />

                </div>
                <div class="restrict-main-contents-io-button">
                    <p:commandButton    id="citation-update-status-commit-button"
                                        rendered="#{citationBB.citationStatusEditMode}"
                                        ajax="true"
                                        value="Save Note"
                                        actionListener="#{citationBB.onStatusLogNoteCommitButtonChange}"
                                        icon="fa fa-save"
                                        oncomplete="PF('citation-docket-note-dialog').hide()"
                                        update="citation-status-dialog-form"/>
                </div>
            </f:facet>
        </h:form>
    </p:dialog>

    <p:dialog   id="citation-remove-dialog"
                height="400" width="600"
                widgetVar="citation-remove-dialog-var"
                responsive="true"
                resizable="true"
                closable="true"
                closeOnEscape="true"
                dynamic="true"
                modal="true"
                header="Remove citation ID: #{citationBB.currentCitation.citationID}"
                rendered="true"
                >

        <h:form id="citation-remove-form">
            <div class="ui-g data_container_nested_restrict">

                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field" >
                    <p>Removing a citation will deactivate the record. Removed citations can only be resurrected by a system admin.</p>


                </div>
                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field" >

                    <div class="restrict-main-contents-io-button gray_button">

                        <p:commandButton    id="citation-remove-cancel-button"
                                            ajax="true"
                                            value="Cancel"
                                            process="@none"
                                            immediate="true"
                                            actionListener="#{citationBB.onOperationCancelButtonChange}"
                                            oncomplete="PF('citation-remove-dialog-var').hide()"
                                            icon="fa fa-stop" />
                    </div>
                </div>
                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field" >
                    <div class="restrict-main-contents-io-button red_button">

                        <p:commandButton
                            icon="fa fa-trash"
                            ajax="false"
                            action="#{citationBB.onCitationRemoveCommitButtonChange}"
                            value="Remove Citation ID:#{citationBB.currentCitation.citationNo}"
                            />

                    </div>
                </div>

            </div>

        </h:form>
    </p:dialog>


    <p:dialog   id="citation-notes-dialog"
                height="800" width="800"
                widgetVar="citation-notes-dialog-var"
                responsive="true"
                resizable="true"
                closable="true"
                closeOnEscape="true"
                dynamic="true"
                modal="true"
                header="Add note to citation ID: #{citationBB.currentCitation.citationID}"
                rendered="true"
                >

        <h:form id="citation-note-form">
            <h:panelGrid columns="1"
                         columnClasses="gridTd, gridTd">
                <h:panelGroup>
                    <h:outputText styleClass="ui-label" value="Note text: "/>
                    <p:inputTextarea   id="citation-notes-editor"
                                       value="#{citationBB.formNoteText}"
                                       required="true"/>


                    <p:spacer height="5px" />
                    <p:commandButton    id="citation-updatemetadata-button-cancel"
                                        ajax="true"  tabindex="27"
                                        value="Cancel"
                                        icon="fa fa-stop"
                                        immediate="true"
                                        onclick="PF('citation-note-dialog-var').hide()"
                                        />

                    <p:commandButton   id="citation-dialog-notes-button-addnote"
                                       ajax="false"
                                       actionListener="#{citationBB.onCitationNoteCommitButtonChange}"
                                       oncomplete="PF('citation-note-dialog-var').hide()"
                                       rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                       value="Attach Note"
                                       styleClass="inline-button"
                                       icon="fa fa-sticky-note-o"
                                       update="citation-notes-form"/>
                </h:panelGroup>
            </h:panelGrid>
        </h:form>
    </p:dialog>
</ui:composition>