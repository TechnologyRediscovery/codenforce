<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <h:head>
        <title>Code Source Management</title>
    </h:head>

    <h:body>

        <ui:composition template="../../navContainer_restricted.xhtml">

            <ui:define name="content">

                <f:view id="codeSourceManageView">

                    <div class="mainContainer">

                        <h1>Manage Municipal Code Sources</h1>

                        <h:form id="form-messages-global">

                            <h:messages id="messages-global" globalOnly="true" showDetail="true" showSummary="true"
                                        warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                        </h:form>




                        <div class ="two-column-page-flex-container">

                            <div class="list-column">

                                <p:panel id = "codesourcemanage-panel-selectcodesource"
                                         toggleable = "true"
                                         collapsed ="false"
                                         header = "Municipal Code Sources"
                                         >

                                    <p:spacer height="10px"/>

                                    <h:form id="codesourcemanage-form-selectcodesource">

                                        <p:dataTable id="codeSourceTable"
                                                     var="source"
                                                     value="#{codeSourceBB.codeSourceList}"
                                                     tableStyleClass="primeDataTable"
                                                     >

                                            <p:column style="width:30px" >
                                                <p:rowToggler/>
                                            </p:column>

                                            <p:column headerText="Source Name"
                                                      styleClass="centeredColumnContent">

                                                <h:outputText value="#{source.sourceName}"/>

                                            </p:column>

                                            <p:column headerText="Edit"
                                                      styleClass="centeredColumnContent"
                                                      style="width: 80px"
                                                      >

                                                <p:commandButton id="button-editcodesource" 
                                                                 ajax="true"
                                                                 value="Edit" 
                                                                 icon="fa fa-pencil" 
                                                                 oncomplete="PF('codesourcemanage-dialog-updatesource-var').show();"
                                                                 update="codesourcemanage-dialog-updatesource"
                                                                 disabled="#{codeSourceBB.activeCodeSourceEdit()}"
                                                                 />

                                            </p:column>

                                            <p:column headerText="Option"
                                                      styleClass="centeredColumnContent"
                                                      style="width: 80px"
                                                      >

                                                <p:selectBooleanButton onLabel="Deselect" 
                                                                       offLabel="Select"
                                                                       value="#{codeSourceBB.codeSourceSelected}"
                                                                       >
                                                    <p:ajax update="
                                                            form-messages-global
                                                            codesourcemanage-panel-selectcodesource
                                                            codesourcemanage-panel-listcodesource
                                                            codesourcemanage-dialog-updatesource
                                                            "
                                                            listener="#{codeSourceBB.onselectedCodeSourceChange(source)}"/>

                                                </p:selectBooleanButton>

                                            </p:column>

                                            <p:rowExpansion>

                                                <p:panelGrid id="codesourcemanage-expansion-sourcedetail"
                                                             >

                                                    <p:row>
                                                        <p:column colspan="1">
                                                            <h:outputText value="ID"/>
                                                        </p:column>
                                                        <p:column colspan="4">
                                                            <h:outputText value="#{source.sourceID}"/>
                                                        </p:column>
                                                    </p:row>

                                                    <p:row>
                                                        <p:column colspan="1">
                                                            <h:outputText value="Name"/>
                                                        </p:column>
                                                        <p:column colspan="4">
                                                            <h:outputText value="#{source.sourceName}"/>
                                                        </p:column>
                                                    </p:row>

                                                    <p:row>
                                                        <p:column colspan="1">
                                                            <h:outputText value="Year"/>
                                                        </p:column>
                                                        <p:column colspan="4">
                                                            <h:outputText value="#{source.sourceYear}"/>
                                                        </p:column>
                                                    </p:row>

                                                    <p:row>
                                                        <p:column colspan="1">
                                                            <h:outputText value="Active"/>
                                                        </p:column>
                                                        <p:column colspan="4">
                                                            <h:outputText value="#{source.isActive}"/>
                                                        </p:column>
                                                    </p:row>

                                                    <p:row>
                                                        <p:column colspan="1">
                                                            <h:outputText value="Link"/>
                                                        </p:column>
                                                        <p:column colspan="4">
                                                            <h:outputText value="#{source.URL}"/>
                                                        </p:column>
                                                    </p:row>

                                                    <p:row>
                                                        <p:column colspan="1">
                                                            <h:outputText value="Notes"/>
                                                        </p:column>
                                                        <p:column colspan="4">
                                                            <h:outputText value="#{source.sourceNotes}"/>
                                                        </p:column>
                                                    </p:row>

                                                    <p:row>
                                                        <p:column colspan="1"
                                                                  rowspan="2">
                                                            <h:outputText value="Description"/>
                                                        </p:column>
                                                        <p:column colspan="4"
                                                                  rowspan="2">
                                                            <h:outputText value="#{source.sourceDescription}"/>
                                                        </p:column>
                                                    </p:row>

                                                </p:panelGrid>

                                            </p:rowExpansion>

                                        </p:dataTable>

                                        <p:spacer height="20px"/>

                                        <p class="note">Updating or viewing elements by source 
                                            will make the selected source your active source, 
                                            enabling the "list elements by source" option.</p>

                                        <p:commandButton id="newCodeSourceButton"
                                                         ajax="true" 
                                                         value="Add a new code source" 
                                                         icon="fa fa-plus" 
                                                         actionListener="#{codeSourceAddUpdateBB.initCodeSourceForm()}"
                                                         oncomplete="PF('codesourcemanage-dialog-updatesource-var').show();"
                                                         update="codesourcemanage-dialog-updatesource"
                                                         disabled="#{codeSourceBB.activeCodeSourceAddSource()}"
                                                         style="width: 49.5%"
                                                         />

                                        <p:commandButton id="addElementToSourceButton"
                                                         ajax="true" 
                                                         value="Add element to source" 
                                                         icon="fa fa-plus" 
                                                         actionListener="#{codeSourceBB.addElementToSource}"
                                                         oncomplete="PF('codesourcemanage-dialog-addelementtosource-var').show();"
                                                         update="codesourcemanage-dialog-addelementtosource
                                                         "
                                                         style="width: 49.5%"
                                                         disabled="#{codeSourceBB.activeCodeSourceEdit()}"

                                                         />
                                        <p:spacer height="20px"/>

                                        <p:commandButton id="linkElementsToGuideEntries"
                                                         ajax="true" 
                                                         value="Link elements in source to Code Guide" 
                                                         icon="fa fa-link" 
                                                         actionListener="#{codeElementGuideBB.onLinkElementButtonChange()}"
                                                         oncomplete="PF('codesourcemanage-dialog-linkElementsToGuideEntries-var').show();"
                                                         update="codesourcemanage-dialog-linkElementsToGuideEntries"
                                                         style="width: 99%"
                                                         disabled="#{codeSourceBB.activeCodeSourceEdit()}"

                                                         />

                                    </h:form>


                                </p:panel>


                            </div>

                            <div class ="object-column">

                                <p:panel id="codesourcemanage-panel-listcodesource"
                                         toggleable="true"
                                         collapsed="false"
                                         header="Code Elements in #{sessionBean.activeCodeSource.sourceName} (#{sessionBean.activeCodeSource.sourceYear})"
                                         >

                                    <p:spacer height="10px"/>

                                    <h:form id="codeElementsBySource">

                                        <p:spacer height="5px"/>

                                        <p:dataTable
                                            id="codeElementTable"
                                            var="element"
                                            value="#{codeElementListBB.codeElementList}"
                                            tableStyleClass="primeDataTable"
                                            scrollable="true"
                                            resizableColumns="true"
                                            rowExpandMode="multiple"
                                            expandedRow="false"
                                            filteredValue="#{codeElementListBB.filteredCodeElementList}"
                                            widgetVar="codeElementListTable"

                                            scrollHeight="400">

                                            <p:column width="3%">
                                                <f:facet name="header">
                                                    <h:outputText value="Expand"/>
                                                </f:facet>
                                                <p:rowToggler/>
                                            </p:column>

                                            <p:column width="5%" sortBy="#{element.elementID}">
                                                <f:facet name="header">
                                                    <h:outputText value="ID#" />
                                                </f:facet>
                                                <h:outputText value="#{element.elementID}"/>
                                            </p:column>

                                            <p:column width="10%" sortBy="#{element.guideEntry.category}"
                                                      filterBy="#{element.guideEntry.category}">
                                                <f:facet name="header">
                                                    <h:outputText value="Category" />
                                                </f:facet>
                                                <h:outputText value="#{element.guideEntry.category}"/>
                                            </p:column>

                                            <p:column width="10%" sortBy="#{element.guideEntry.subCategory}"
                                                      filterBy="#{element.guideEntry.subCategory}">
                                                <f:facet name="header">
                                                    <h:outputText value="Sub Category" />
                                                </f:facet>
                                                <h:outputText value="#{element.guideEntry.subCategory}"/>
                                            </p:column>

                                            <p:column width="5%" sortBy="#{element.ordchapterNo}">
                                                <f:facet name="header">
                                                    <h:outputText value="Chap"/>
                                                </f:facet>
                                                <h:outputText value="#{element.ordchapterNo}"/>
                                            </p:column>

                                            <p:column width="15%" sortBy="#{element.ordchapterTitle}"
                                                      filterBy="#{element.ordchapterTitle}">
                                                <f:facet name="header">
                                                    <h:outputText value="Chapter"/>
                                                </f:facet>
                                                <h:outputText value="#{element.ordchapterTitle}"/>
                                            </p:column>

                                            <p:column width="5%" sortBy="#{element.ordSecNum}">
                                                <f:facet name="header">
                                                    <h:outputText value="Sec" />
                                                </f:facet>
                                                <h:outputText value="#{element.ordSecNum}"/>
                                            </p:column>

                                            <p:column width="15%" sortBy="#{element.ordSecTitle}"
                                                      filterBy="#{element.ordSecTitle}">
                                                <f:facet name="header">
                                                    <h:outputText value="Sec. Title" />
                                                </f:facet>
                                                <h:outputText value="#{element.ordSecTitle}"/>
                                            </p:column>

                                            <p:column width="5%" sortBy="#{element.ordSubSecNum}">
                                                <f:facet name="header">
                                                    <h:outputText value="SubSec" />
                                                </f:facet>
                                                <h:outputText value="#{element.ordSubSecNum}"/>
                                            </p:column>

                                            <p:column sortBy="#{element.ordSubSecTitle}" 
                                                      filterBy="#{element.ordSubSecTitle}">
                                                <f:facet name="header">
                                                    <h:outputText value="SubSec. Title" />
                                                </f:facet>
                                                <h:outputText value="#{element.ordSubSecTitle}"/>
                                            </p:column>

                                            <p:column headerText="Edit"
                                                      styleClass="centeredColumnContent"
                                                      style="width: 80px"
                                                      >

                                                <p:commandButton id="button-editcodesourceelement" ajax="true"
                                                                 value="Edit" 
                                                                 actionListener="#{codeElementListBB.onEditCodeElementButtonChange(element)}"
                                                                 icon="fa fa-pencil" 
                                                                 oncomplete="PF('codesourcemanage-dialog-editcodeelement-var').show();"
                                                                 update="codesourcemanage-dialog-editcodeelement"

                                                                 />

                                            </p:column>

                                            <p:rowExpansion>
                                                <div class="outlinedBox">
                                                    <h3>Code element detail:</h3>

                                                    <h:outputLabel styleClass="bold" value="Technical Text"/>
                                                    <p:spacer height="15px"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText escape="false" value="#{element.ordTechnicalText}"/>
                                                    </div>
                                                    <p:spacer height="15px"/>
                                                    <h:outputLabel styleClass="bold" value="Human friendly text"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText escape="false" value="#{element.ordHumanFriendlyText}"/>
                                                    </div>
                                                    <p:spacer height="15px"/>
                                                    <h:outputLabel styleClass="bold" value="Code Guide: Enforcement Tips"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText escape="false" value="#{element.guideEntry.enforcementGuidelines}"/>
                                                    </div>
                                                    <p:spacer height="15px"/>
                                                    <h:outputLabel styleClass="bold" value="Code guide: Inspection Tips"/>
                                                    <div class="rowExpansion">
                                                        <h:outputText escape="false" value="#{element.guideEntry.inspectionGuidelines}"/>
                                                    </div>
                                                </div>
                                            </p:rowExpansion>

                                        </p:dataTable>

                                        <p:spacer height="15px"/>

                                    </h:form>
                                </p:panel>

                            </div>

                            <p:dialog  id="codesourcemanage-dialog-updatesource"
                                       width="1100"
                                       widgetVar="codesourcemanage-dialog-updatesource-var"
                                       closable="true" 
                                       header="Update &amp; Add Code Source"
                                       >

                                <p>Current code source: <h:outputText value="#{codeSourceAddUpdateBB.currentCodeSource.sourceName} (#{codeSourceAddUpdateBB.currentCodeSource.sourceYear})(Blank means Add New Source)"/></p>

                                <h:form id="addUpdateSourceForm">

                                    <div style="font-size: inherit;">Source ID Number: 
                                        <h:outputText value="#{codeSourceAddUpdateBB.formSourceID}"/>
                                    </div>

                                    <p:spacer height="15"/>

                                    <p:outputLabel for="selectedSourceName">
                                        <h:outputText value="Code Source Name"/>
                                    </p:outputLabel>

                                    <p:inputText id="selectedSourceName" 
                                                 value="#{codeSourceAddUpdateBB.formSourceName}" 
                                                 style="width: 20%;" 
                                                 required="true" 
                                                 styleClass="inputText"/>

                                    <h:message for="selectedSourceName" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    <p:spacer height="15"/>

                                    <p:outputLabel for="selectedSourceYear">
                                        <h:outputText value="Year"/>
                                    </p:outputLabel>

                                    <p:inputText id="selectedSourceYear" 
                                                 value="#{codeSourceAddUpdateBB.formSourceYear}" 
                                                 style="width: 20%;" 
                                                 required="true" 
                                                 styleClass="inputText"/>

                                    <h:message for="selectedSourceYear" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    <p:spacer height="15"/>

                                    <p:outputLabel for="selectedSourceIsActive">
                                        <h:outputText value="Active Source?"/>
                                    </p:outputLabel>

                                    <p:selectBooleanButton id="selectedSourceIsActive"
                                                           value="#{codeSourceAddUpdateBB.formSourceIsActive}"
                                                           required="true"
                                                           onLabel="Yes"
                                                           offLabel="No"/> 

                                    <h:message for="selectedSourceIsActive" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    <p:spacer height="15"/>

                                    <p:outputLabel for="selectedSourceDescription">
                                        <h:outputText value="Description of Code Source"/>
                                    </p:outputLabel>

                                    <p:inputTextarea id="selectedSourceDescription" 
                                                     value="#{codeSourceAddUpdateBB.formSourceDescription}" 
                                                     style="width: 100%;"
                                                     required="true"
                                                     styleClass="inputTextarea" />

                                    <h:message for="selectedSourceDescription" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    <p:spacer height="15"/>

                                    <p:outputLabel for="selectedSourceURL">
                                        <h:outputText value="Web link to source specification"/>
                                    </p:outputLabel>

                                    <p:inputText id="selectedSourceURL" 
                                                 value="#{codeSourceAddUpdateBB.formSourceURL}" 
                                                 style="width: 100%;" 
                                                 required="true"
                                                 styleClass="inputText"/>

                                    <h:message for="selectedSourceURL" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    <p:spacer height="15"/>

                                    <p:outputLabel for="selectedSourceNotes">
                                        <h:outputText value="Notes on Source (i.e. Who approved it? When does it expire?)"/>
                                    </p:outputLabel>

                                    <p:inputTextarea id="selectedSourceNotes" 
                                                     value="#{codeSourceAddUpdateBB.formSourceNotes}" 
                                                     style="width: 100%;" 
                                                     required="true" 
                                                     styleClass="inputText"/>

                                    <h:message for="selectedSourceNotes" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    <p:commandButton 
                                        id="commitButton" 
                                        ajax="true"
                                        value="Commit updates" 
                                        icon="fa fa-edit"
                                        styleClass="buttonOwnLine" 
                                        disabled="#{codeSourceBB.activeCodeSourceEdit()}"
                                        actionListener="#{codeSourceAddUpdateBB.commitCodeSourceUpdates}"
                                        update="codesourcemanage-panel-selectcodesource
                                        codesourcemanage-panel-listcodesource
                                        addUpdateSourceForm
                                        "
                                        oncomplete="DialogRequest(args,'codesourcemanage-dialog-updatesource-var')"/>


                                    <p:commandButton 
                                        id="addNewButton" 
                                        ajax="false"
                                        value="Add new source"
                                        icon="fa fa-plus"
                                        styleClass="buttonOwnLine" 
                                        disabled="#{codeSourceBB.activeCodeSourceAddSource()}"
                                        action="#{codeSourceAddUpdateBB.addNewSource}"
                                        />

                                </h:form>

                            </p:dialog> 

                            <p:dialog  id="codesourcemanage-dialog-addelementtosource"
                                       width="1100"
                                       widgetVar="codesourcemanage-dialog-addelementtosource-var"
                                       closable="true" 
                                       header="Add Element to Source"
                                       height="80vh"

                                       >
                                <p:panel header="New Element Form"
                                         toggleable="true"
                                         collapsed="false">

                                    <h:form id="addCodeElement">

                                        <p class='note'>Populate the following fields to add an element to the above code source</p>

                                        <h:panelGrid columns="4" border="0" 
                                                     cellspacing="5" 
                                                     cellpadding="5" 
                                                     columnClasses="gridTd-fixedcolumn, gridTd-fixedcolumn, gridTd-fixedcolumn, gridTd-fixedcolumn" 

                                                     footerClass="gridFooter">

                                            <p:outputLabel value="Ordiance chapter number (numbers only):"/>

                                            <h:panelGroup>  

                                                <p:inputText id="cdelOrdChapterNo" 
                                                             value="#{codeElementBB.newElement.ordchapterNo}"
                                                             style="width: 100%;" 
                                                             required="true"
                                                             label="Ordiance Chapter Number"
                                                             styleClass="inputText"/>

                                                <h:message for="cdelOrdChapterNo" showDetail="true" showSummary="false" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                            </h:panelGroup>

                                            <p:outputLabel value="Chapter title:"/>

                                            <h:panelGroup>

                                                <p:inputText id="cdelOrdChapterTitle" 
                                                             value="#{codeElementBB.newElement.ordchapterTitle}"
                                                             style="width: 100%;" 
                                                             label="Chapter Title"
                                                             required="true"
                                                             styleClass="inputText"/>

                                                <h:message for="cdelOrdChapterTitle" showDetail="true" showSummary="false" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                            </h:panelGroup>

                                            <p:outputLabel value="Section number (may contain letters):"/>

                                            <h:panelGroup>

                                                <p:inputText id="cdelOrdSecNum" 
                                                             value="#{codeElementBB.newElement.ordSecNum}"
                                                             style="width: 100%;" 
                                                             label="Section Number"
                                                             required="true"
                                                             styleClass="inputText"/>

                                                <h:message for="cdelOrdSecNum" showDetail="true" showSummary="false" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError"/>

                                            </h:panelGroup>

                                            <p:outputLabel value="Section title:"/>

                                            <h:panelGroup>

                                                <p:inputText id="ccdelOrdSecTitle" 
                                                             value="#{codeElementBB.newElement.ordSecTitle}"
                                                             style="width: 100%;" 
                                                             label="Section Title"
                                                             required="true" 
                                                             styleClass="inputText"/>

                                                <h:message for="ccdelOrdSecTitle" showDetail="true" showSummary="false" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                            </h:panelGroup>

                                            <p:outputLabel value="Subsection number (may contain letters):"/>

                                            <h:panelGroup>

                                                <p:inputText id="cdelordSubSecNum" 
                                                             value="#{codeElementBB.newElement.ordSubSecNum}"
                                                             style="width: 100%;" 
                                                             label="Subsection Number"
                                                             required="false" 
                                                             styleClass="inputText"/>

                                                <h:message for="cdelordSubSecNum" showDetail="true" showSummary="false" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                            </h:panelGroup>

                                            <p:outputLabel value="Subsection title:"/>

                                            <h:panelGroup>

                                                <p:inputText id="cdelOrdSubSecTitle" 
                                                             value="#{codeElementBB.newElement.ordSubSecTitle}"
                                                             style="width: 100%;" 
                                                             label="Subsection Title"
                                                             required="false" 
                                                             styleClass="inputText"/>

                                                <h:message for="cdelOrdSubSecTitle" showDetail="true" showSummary="false" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                            </h:panelGroup>    

                                            <p:outputLabel value="Toggle active element:"/>

                                            <h:panelGroup>

                                                <p:selectBooleanButton id="cdelIsActive"
                                                                       value="#{codeElementBB.newElement.isActive}" 
                                                                       onLabel="Yes" 
                                                                       offLabel="No"
                                                                       style="width:50px"
                                                                       label="Active Element"
                                                                       />

                                                <h:message for="cdelIsActive" showDetail="true" showSummary="false" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                            </h:panelGroup>

                                            <f:facet name="footer">

                                                <p:outputLabel value="Web address of element resource:"/>

                                                <h:panelGroup>

                                                    <p:inputText id="cdelUrl" 
                                                                 value="#{codeElementBB.newElement.resourceURL}" 
                                                                 style="width: 100%;" 
                                                                 required="false" 
                                                                 styleClass="inputText"
                                                                 label="Resource URL"/>

                                                    <h:message for="cdelUrl" showDetail="true" showSummary="false" 
                                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                                </h:panelGroup>

                                                <p:spacer height="15px"/>

                                                <p:outputLabel value="Enter the technical text of this ordinance:" /> 

                                                <h:panelGroup >

                                                    <p:editor id="cdelOrdTechnicalText"  
                                                              value="#{codeElementBB.newElement.ordTechnicalText}" 
                                                              controls="bold italic underline strikethrough font size style color 
                                                              bullets numbering center undo redo rule link removeformat outdent 
                                                              indent link unlink copy cut paste rule alignleft center alignright"
                                                              width="1000" 
                                                              required="true"
                                                              height="150"
                                                              requiredMessage="Technical Text: Validation Error: Value is required."
                                                              />
                                                    <h:message for="cdelOrdTechnicalText" showDetail="true" showSummary="false" 
                                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />


                                                </h:panelGroup>  

                                                <p:spacer height="15px"/>

                                                <h:outputLabel value="Human-friendly text:"/>

                                                <h:panelGroup>   

                                                    <p:editor   id="cdelOrdHumanFriendlyText"  
                                                                value="#{codeElementBB.newElement.ordHumanFriendlyText}" 
                                                                controls="bold italic underline strikethrough font size style color 
                                                                bullets numbering center undo redo rule link removeformat outdent 
                                                                indent link unlink copy cut paste rule alignleft center alignright"
                                                                width="1000" 
                                                                required="false"
                                                                height="150"/>

                                                </h:panelGroup> 

                                            </f:facet>    

                                        </h:panelGrid>

                                        <p:spacer height="15px"/>

                                        <p:commandButton 
                                            id="insertCodeElement" 
                                            value="Add New Code Element" 
                                            ajax="true" 
                                            icon="fa fa-plus" 
                                            actionListener="#{codeElementBB.onAddElementToSourceButtonChange()}"
                                            oncomplete="DialogRequest(args,'codesourcemanage-dialog-addelementtosource-var')"
                                            update="codesourcemanage-panel-listcodesource
                                            addCodeElement
                                            "
                                            />

                                    </h:form>

                                </p:panel>

                            </p:dialog>





                            <p:dialog  id="codesourcemanage-dialog-linkElementsToGuideEntries"
                                       width="1400"
                                       widgetVar="codesourcemanage-dialog-linkElementsToGuideEntries-var"
                                       closable="true" 
                                       header="Link code guide entries to code elements"
                                       height="80vh"
                                       >


                                <p>Each row in this table contains data about a single code element in 
                                    <h:outputText value="#{codeElementGuideBB.currentSource.sourceName} 
                                                  (#{codeElementGuideBB.currentSource.sourceYear})"/>
                                    Click the little pencil icon in the rightmost column to edit that 
                                    particular element's code guide ID, which must correspond to the 
                                    ID number of a guide entry in our Code Guide. Best to open that page in
                                    its own browser window and split your screen so you can see both at the same time.</p>

                                <h:form id="guideBuilderForm">

                                    <p:dataTable
                                        id="codeElementTable"
                                        var="element"
                                        value="#{codeElementGuideBB.elementList}"
                                        selectionMode="single"
                                        selection="#{codeElementGuideBB.selectedElement}"
                                        rowKey="#{element.elementID}"
                                        tableStyleClass="primeDataTable"
                                        scrollable="true"
                                        scrollHeight="300"
                                        resizableColumns="true"
                                        rowExpandMode="multiple"
                                        expandedRow="false"
                                        filteredValue="#{codeElementGuideBB.filteredElementList}"
                                        widgetVar="codeElementListTable"
                                        editable="true">

                                        <p:column width="5%">
                                            <f:facet name="header">
                                                <h:outputText value="Expand"/>
                                            </f:facet>
                                            <p:rowToggler/>
                                        </p:column>

                                        <p:column width="5%">
                                            <f:facet name="header">
                                                <h:outputText value="ID#" />
                                            </f:facet>
                                            <h:outputText value="#{element.elementID}"/>
                                        </p:column>

                                        <p:column width="10%" sortBy="#{element.guideEntry.category}"
                                                  filterBy="#{element.guideEntry.category}">
                                            <f:facet name="header">
                                                <h:outputText value="Category" />
                                            </f:facet>
                                            <h:outputText value="#{element.guideEntry.category}"/>
                                        </p:column>

                                        <p:column width="10%" sortBy="#{element.guideEntry.subCategory}"
                                                  filterBy="#{element.guideEntry.subCategory}">
                                            <f:facet name="header">
                                                <h:outputText value="Sub Category" />
                                            </f:facet>
                                            <h:outputText value="#{element.guideEntry.subCategory}"/>
                                        </p:column>

                                        <p:column width="5%" sortBy="#{element.ordchapterNo}">
                                            <f:facet name="header">
                                                <h:outputText value="Chap"/>
                                            </f:facet>
                                            <h:outputText value="#{element.ordchapterNo}"/>
                                        </p:column>

                                        <p:column width="15%" sortBy="#{element.ordchapterTitle}"
                                                  filterBy="#{element.ordchapterTitle}">
                                            <f:facet name="header">
                                                <h:outputText value="Chapter"/>
                                            </f:facet>
                                            <h:outputText value="#{element.ordchapterTitle}"/>
                                        </p:column>

                                        <p:column width="5%" sortBy="#{element.ordSecNum}">
                                            <f:facet name="header">
                                                <h:outputText value="Sec" />
                                            </f:facet>
                                            <h:outputText value="#{element.ordSecNum}"/>
                                        </p:column>

                                        <p:column width="15%" sortBy="#{element.ordSecTitle}"
                                                  filterBy="#{element.ordSecTitle}">
                                            <f:facet name="header">
                                                <h:outputText value="Sec. Title" />
                                            </f:facet>
                                            <h:outputText value="#{element.ordSecTitle}"/>
                                        </p:column>

                                        <p:column width="5%" sortBy="#{element.ordSubSecNum}">
                                            <f:facet name="header">
                                                <h:outputText value="SubSec" />
                                            </f:facet>
                                            <h:outputText value="#{element.ordSubSecNum}"/>
                                        </p:column>

                                        <p:column sortBy="#{element.ordSubSecTitle}" 
                                                  filterBy="#{element.ordSubSecTitle}"
                                                  width="15%">
                                            <f:facet name="header">
                                                <h:outputText value="SubSec. Title" />
                                            </f:facet>
                                            <h:outputText value="#{element.ordSubSecTitle}"/>
                                        </p:column>

                                        <p:column width="5%">
                                            <f:facet name="header">
                                                <h:outputText value="GuideID" />
                                            </f:facet>
                                            <p:cellEditor>
                                                <f:facet name="output">
                                                    <h:outputText value="#{element.guideEntryID}"/>
                                                </f:facet>
                                                <f:facet name="input" >
                                                    <h:inputText value="#{element.guideEntryID}" />
                                                </f:facet>
                                            </p:cellEditor>
                                        </p:column>
                                        <p:column>
                                            <p:rowEditor/>
                                        </p:column>

                                        <p:rowExpansion>
                                            <div class="outlinedBox">

                                                <h:outputLabel styleClass="bold" value="Technical Text"/>
                                                <p:spacer height="15px"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="#{element.ordTechnicalText}"/>
                                                </div>
                                                <p:spacer height="15px"/>
                                                <h:outputLabel styleClass="bold" value="Human friendly text"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="#{element.ordHumanFriendlyText}"/>
                                                </div>
                                                <p:spacer height="15px"/>
                                                <h:outputLabel styleClass="bold" value="Code Guide: Enforcement Tips"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="#{element.guideEntry.enforcementGuidelines}"/>
                                                </div>
                                                <p:spacer height="15px"/>
                                                <h:outputLabel styleClass="bold" value="Code guide: Inspection Tips"/>
                                                <div class="rowExpansion">
                                                    <h:outputText escape="false" value="#{element.guideEntry.inspectionGuidelines}"/>
                                                </div>
                                            </div>
                                        </p:rowExpansion>

                                    </p:dataTable>

                                    <p:spacer height="15px"/>

                                    <p:commandButton ajax="false" value="Update all code element - guide links" icon="fa fa-plus" tabindex="5"
                                                     action="#{codeElementGuideBB.updateCodeGuideLinks}"/>
                                    <p class="note">To view the updated element list with their linked code guide entries, reload the element list through the "Manage Source" list at left.</p>

                                </h:form>

                                <hr/>


                                <p:fieldset 
                                    legend="Show Code Guide"
                                    toggleable="true"
                                    collapsed="true"
                                    style="border:1px solid black">

                                    <h:form id="codeGuideViewForm">

                                        <p:dataTable
                                            id="violationTable"
                                            value="#{codeElementGuideBB.entryList}"
                                            tableStyleClass="primeDataTable"
                                            draggableColumns="true"
                                            rowKey="#{cege.guideEntryID}"
                                            reflow="true"
                                            var="cege"
                                            rowExpandMode="multiple"
                                            expandedRow="false">

                                            <p:column width="3%">
                                                <f:facet name="header">
                                                    <h:outputText value="Expand" />
                                                </f:facet>
                                                <p:rowToggler />
                                            </p:column>

                                            <p:column width="3%">
                                                <f:facet name="header">
                                                    <h:outputText value="no." />
                                                </f:facet>
                                                <h:outputText value="#{cege.guideEntryID}"/>
                                            </p:column>

                                            <p:column width="15%">
                                                <f:facet name="header">
                                                    <h:outputText value="Category" />
                                                </f:facet>
                                                <h:outputText value="#{cege.category}"/>
                                            </p:column>

                                            <p:column width="15%">
                                                <f:facet name="header">
                                                    <h:outputText value="Sub Category" />
                                                </f:facet>
                                                <h:outputText value="#{cege.subCategory}"/>
                                            </p:column>

                                            <p:column width="20%">
                                                <f:facet name="header">
                                                    <h:outputText value="Description" />
                                                </f:facet>
                                                <h:outputText value="#{cege.description}"/>
                                            </p:column>

                                            <p:column width="8%">
                                                <f:facet name="header">
                                                    <h:outputText value="Priority?" />
                                                </f:facet>
                                                <h:outputText value="#{cege.priority}"/>
                                            </p:column>


                                            <p:rowExpansion>
                                                <div class="outlinedBox">


                                                    <h:outputLabel styleClass="bold" value="Enforcement Gudielines:"/>
                                                    <p:spacer height="10px"/>
                                                    <h:outputText value="#{cege.enforcementGuidelines}" escape="false"/>
                                                    <p:spacer height="15px"/>
                                                    <h:outputLabel styleClass="bold" value="Inspection Gudielines:"/>
                                                    <p:spacer height="10px"/>
                                                    <h:outputText value="#{cege.inspectionGuidelines}" escape="false"/>
                                                </div>

                                            </p:rowExpansion>

                                        </p:dataTable> 

                                    </h:form>

                                </p:fieldset>


                            </p:dialog>

                            <p:dialog  id="codesourcemanage-dialog-editcodeelement"
                                       width="1100"
                                       widgetVar="codesourcemanage-dialog-editcodeelement-var"
                                       closable="true" 
                                       header="Edit Existing Code Element (Code Element ID: #{codeElementBB.currentElement.elementID})"
                                       height="85vh"
                                       >

                                <p>
                                    <span class="bold">Source ID: </span><h:outputText value="#{codeElementBB.currentElement.source.sourceID} | "/>
                                    <span class="bold">Source Name: </span> <h:outputText value="#{codeElementBB.currentElement.source.sourceName} | "/>
                                    <span class="bold">Year: </span><h:outputText value="#{codeElementBB.currentElement.source.sourceYear}"/>   
                                </p>

                                <hr/>

                                <h:form id="updateCodeElementForm">

                                    <p>Adjust the fields as needed and click "Update" at the bottom. 
                                        All fields will be overwritten, so leave untouched those you wish to remain unchanged.</p>

                                    <h:panelGrid columns="4" cellpadding="10"  
                                                 columnClasses="gridTd-fixedcolumn, gridTd-fixedcolumn, gridTd-fixedcolumn,gridTd-fixedcolumn">

                                        <h:outputLabel for="cdelOrdChapterNo" >
                                            <h:outputText value="Ordiance chapter number (numbers only)" styleClass="uiLabel" />
                                        </h:outputLabel>

                                        <h:panelGroup>

                                            <p:inputText id="cdelOrdChapterNo" 
                                                         value="#{codeElementBB.formOrdChapterNo}" 
                                                         style="width: 100%;" 
                                                         required="true" 
                                                         styleClass="inputText"
                                                         label="Chapter Number"/>

                                            <h:message for="cdelOrdChapterNo" showDetail="true" showSummary="false" 
                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                        </h:panelGroup>

                                        <h:outputLabel for="cdelOrdChapterTitle" >
                                            <h:outputText value="Chapter title" styleClass="uiLabel" />
                                        </h:outputLabel>

                                        <h:panelGroup>

                                            <p:inputText id="cdelOrdChapterTitle" 
                                                         value="#{codeElementBB.formOrdChapterTitle}" 
                                                         style="width: 100%;" 
                                                         required="true" 
                                                         styleClass="inputText"
                                                         label="Chapter Title" />

                                            <h:message for="cdelOrdChapterTitle" showDetail="true" showSummary="false" 
                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                        </h:panelGroup>

                                        <h:outputLabel for="cdelOrdSecNum" >
                                            <h:outputText value="Section number (may contain letters)" styleClass="uiLabel" />
                                        </h:outputLabel>

                                        <h:panelGroup>
                                            <p:inputText id="cdelOrdSecNum" 
                                                         value="#{codeElementBB.formOrdSecNum}" 
                                                         style="width: 100%;" 
                                                         required="true" 
                                                         styleClass="inputText"
                                                         label="Section Number"/>

                                            <h:message for="cdelOrdSecNum" showDetail="true" showSummary="false" 
                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                        </h:panelGroup>

                                        <h:outputLabel for="ccdelOrdSecTitle" >
                                            <h:outputText value="Section title" styleClass="uiLabel" />
                                        </h:outputLabel>

                                        <h:panelGroup>
                                            <p:inputText id="ccdelOrdSecTitle" 
                                                         value="#{codeElementBB.formOrdSecTitle}" 
                                                         style="width: 100%;" 
                                                         required="true" 
                                                         styleClass="inputText"
                                                         label="Section Title"/>

                                            <h:message for="ccdelOrdSecTitle" showDetail="true" showSummary="false" 
                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                        </h:panelGroup>

                                        <h:outputLabel for="cdelordSubSecNum" >
                                            <h:outputText value="Subsection number (may contain letters)" styleClass="uiLabel" />
                                        </h:outputLabel>

                                        <h:panelGroup>

                                            <p:inputText id="cdelordSubSecNum"
                                                         value="#{codeElementBB.formOrdSubSecNum}" 
                                                         style="width: 100%;" 
                                                         required="false" 
                                                         styleClass="inputText"
                                                         label="Subsection Number" />

                                            <h:message for="cdelordSubSecNum" showDetail="true" showSummary="false" 
                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                        </h:panelGroup>

                                        <h:outputLabel for="cdelOrdSubSecTitle" >
                                            <h:outputText value="Subsection title" styleClass="uiLabel" />
                                        </h:outputLabel>

                                        <h:panelGroup>
                                            <p:inputText id="cdelOrdSubSecTitle" 
                                                         value="#{codeElementBB.formOrdSubSecTitle}" 
                                                         style="width: 100%;" 
                                                         required="false"
                                                         styleClass="inputText"
                                                         label="Subsection Title"/>

                                            <h:message for="cdelOrdSubSecTitle" showDetail="true" showSummary="false" 
                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                        </h:panelGroup>

                                        <h:outputLabel for="cdelUrl" >
                                            <h:outputText value="Resource URL" styleClass="uiLabel" />
                                        </h:outputLabel>

                                        <h:panelGroup>

                                            <p:inputText id="cdelUrl" 
                                                         value="#{codeElementBB.formResourceURL}" 
                                                         style="width: 100%;" 
                                                         required="false" 
                                                         styleClass="inputText"
                                                         label="Resource URL"/>

                                            <h:message for="cdelUrl" showDetail="true" showSummary="false" 
                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                        </h:panelGroup>

                                        <h:outputLabel for="cdelIsActive" >
                                            <h:outputText value="Toggle active element'" styleClass="uiLabel" />
                                        </h:outputLabel>

                                        <h:panelGroup>

                                            <p:selectBooleanCheckbox id="cdelIsActive" 
                                                                     value="#{codeElementBB.formIsActive}" 
                                                                     required="true"
                                                                     styleClass="selectOneRadio"
                                                                     label="Active Element"/>

                                            <h:message for="cdelIsActive" showDetail="true" showSummary="false" 
                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                        </h:panelGroup>



                                        <h:outputLabel for="cdElGuideID" >
                                            <h:outputText value="Code Guide entry ID" styleClass="uiLabel" />
                                        </h:outputLabel>

                                        <h:panelGroup>

                                            <p:outputLabel id="cdElGuideID" 
                                                           value="#{codeElementBB.formGuideEntryID}" 
                                                           style="width: 100%;" 
                                                           styleClass="inputText"/>

                                            <h:message for="cdElGuideID" showDetail="true" showSummary="false" 
                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                        </h:panelGroup>

                                    </h:panelGrid>

                                    <h:outputLabel for="cdelOrdTechnicalText" >
                                        <h:outputText value="Enter the technical text of this ordinance" styleClass="uiLabel" />
                                    </h:outputLabel>

                                    <h:panelGroup>
                                        <p:editor   id="cdelOrdTechnicalText" 
                                                    value="#{codeElementBB.formOrdTechnicalText}" 
                                                    controls="bold italic underline strikethrough font size style color 
                                                    bullets numbering center undo redo rule link removeformat outdent 
                                                    indent link unlink copy cut paste rule alignleft center alignright"
                                                    width="1000" 
                                                    required="true"
                                                    height="200"
                                                    requiredMessage="Technical Text: Validation Error: Value is required."
                                                    />
                                        <h:message for="cdelOrdTechnicalText" showDetail="true" showSummary="false" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </h:panelGroup>


                                    <h:outputLabel for="cdelOrdHumanFriendlyText" >
                                        <h:outputText value="Compose a human-friendly version of this ordinance" styleClass="uiLabel" />
                                    </h:outputLabel>

                                    <h:panelGroup>

                                        <p:editor   id="cdelOrdHumanFriendlyText"
                                                    value="#{codeElementBB.formOrdHumanFriendlyText}" 
                                                    controls="bold italic underline strikethrough font size style color 
                                                    bullets numbering center undo redo rule link removeformat outdent 
                                                    indent link unlink copy cut paste rule alignleft center alignright"
                                                    width="1000" 
                                                    required="false"
                                                    height="200"
                                                    />

                                        <h:message for="cdelOrdHumanFriendlyText" showDetail="true" showSummary="false" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </h:panelGroup>


                                    <p:spacer height="15px"/>

                                    <p:commandButton 
                                        id="insertCodeElement"  
                                        ajax="true"
                                        value="Update code element" 
                                        icon="fa fa-edit"
                                        actionListener="#{codeElementBB.commitUpdatesToCodeElement()}"
                                        oncomplete="DialogRequest(args,'codesourcemanage-dialog-editcodeelement-var')"
                                        update='codesourcemanage-panel-listcodesource
                                        updateCodeElementForm'/>

                                </h:form>

                            </p:dialog>

                            <script >
                                function DialogRequest(args, dialogvar) {
                                    if (args.validationFailed) {
                                        PF(dialogvar).jq.effect("shake", {times: 3}, 100);
                                    } else {
                                        PF(dialogvar).hide();
                                    }
                                }
                            </script>


                        </div>

                    </div>
                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

