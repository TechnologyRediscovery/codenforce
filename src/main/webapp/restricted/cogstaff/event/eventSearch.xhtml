<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Code Enforcement Events</title>
    </h:head>
    <h:body>
        <ui:composition template="/restricted/navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view>
                    <div class="mainContainer">

                        <h1>Event Search</h1> 
                        <h:form id="event-search-messages-form">
                            <h:messages id="event-search-messages" globalOnly="true" showDetail="false" showSummary="true"
                                        warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                            </h:messages>
                        </h:form>
                        <h:panelGrid columns="2" cellpadding="10" styleClass="object-info-box" footerClass="gridFooter"
                                     columnClasses="gridTd, gridTd">

                            <h:panelGroup>

                                <p:panel    id="event-search-query-panel"
                                            toggleable="true"
                                            widgetVar="event-search-query-panel-var"
                                            collapsed="false"
                                            header="Query builder">

                                    <p:commandButton  value="help" 
                                                      onclick="PF('helpdlg').show()" 
                                                      styleClass="noFill button-float-right" 
                                                      icon="fa fa-question-circle"/>

                                    <h:form id="event-selectquery-form">

                                        <h:outputLabel styleClass="bold" 
                                                       value="Select a query:" 
                                                       for="eventquery-som" />

                                        <p:selectOneMenu id="eventquery-som" 
                                                         tabindex="1" 
                                                         value="#{eventSearchBB.querySelected}"
                                                         style="margin-right: 10px;">
                                            <f:converter converterId="bOBQueryConverter"/>
                                            <f:selectItem itemLabel="select a query..." noSelectionOption="true" itemDisabled="true"/>
                                            <f:selectItems id="querylist-si" value="#{eventSearchBB.queryList}" var="ql" itemValue="#{ql}" itemLabel="#{ql.queryTitle}" />
                                            <p:ajax listener="#{eventSearchBB.changeQuerySelected}"/>
                                        </p:selectOneMenu>

                                        <p:spacer height="5px" />

                                        <p:commandButton    id="execute-selected-query" 
                                                            ajax="true"
                                                            value="perform selected query" 
                                                            actionListener="#{eventSearchBB.runQuery}"
                                                            disabled="#{eventSearchBB.querySelected.queryExecuted}"
                                                            icon="fa fa-flash"
                                                            update="
                                                            @form
                                                            event-list-tabview:events-datascroller-form:events-datascroller
                                                            event-list-tabview:events-datatable-form:events-datatable
                                                            event-search-messages-form:ceev-globalmessages
                                                            "/>

                                        <p:commandButton   id="event-search-clear-cb" 
                                                           ajax="true" 
                                                           actionListener="#{eventSearchBB.resetQuery}"
                                                           icon="fa fa-eraser" 
                                                           styleClass="button inline-button"
                                                           value="clear query" 
                                                           disabled="#{!eventSearchBB.querySelected.queryExecuted}"
                                                           update=" occperiod-search-messages-form
                                                           @form
                                                           occperiod-search-log-form
                                                           occperiod-search-form"/>

                                        <p:spacer height="5px" />
                                        
                                        
                                        <p:outputLabel for="event-search-appendresults-chkbox">
                                            <h:outputText value="Append results to list? "/>
                                        </p:outputLabel>

                                        <p:selectBooleanCheckbox   id="event-search-appendresults-chkbox" 
                                                                   value="#{eventSearchBB.appendResultsToList}" 

                                        <p:spacer height="5px" />

                                        <p:fieldset legend="advanced search"
                                                    toggleable="true" collapsed="true" style="background-color: white;">
                                            <h:panelGrid columns="2" cellpadding="10" footerClass="gridFooter"
                                                         columnClasses="topbottom-lines-left, topbottom-lines-right">

                                                <h:panelGroup>
                                                    <p:outputLabel id="event-filter-muni-ol" 
                                                                   for="seev-filter-muni-chkbx" 
                                                                   value="filter by municipality "/>
                                                    <p:selectBooleanCheckbox id="seev-filter-muni-chkbx" value="#{eventSearchBB.searchParamsSelected.muni_ctl}" >
                                                        <p:ajax update="event-search-muni-som"/>
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:selectOneMenu id="event-search-muni-som" tabindex="1" value="#{eventSearchBB.searchParamsSelected.muni_val}"
                                                                     disabled="#{!eventSearchBB.searchParamsSelected.muni_ctl}">
                                                        <f:converter converterId="muniConverter"/>
                                                        <f:selectItem itemLabel="select municipality..." noSelectionOption="true" itemDisabled="true"/>
                                                        <f:selectItems id="muniNameList" value="#{systemServicesBB.municipalityListForSearch}" var="m" itemValue="#{m}" itemLabel="#{m.muniName}" />
                                                    </p:selectOneMenu>
                                                    <h:message for="event-search-muni-som" showDetail="true" showSummary="true" 
                                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:outputLabel id="event-search-startend-chkbx-ol" 
                                                                   for="event-search-startend-chkbx" 
                                                                   value="filter by date range "/>
                                                    <p:selectBooleanCheckbox id="event-search-startend-chkbx" 
                                                                             value="#{eventSearchBB.searchParamsSelected.date_startEnd_ctl}" >
                                                        <p:ajax update="event-search-date-field-val
                                                                event-search-date-start-val
                                                                event-search-date-end-val
                                                                event-search-date-relative-ctl" />
                                                    </p:selectBooleanCheckbox>

                                                </h:panelGroup>

                                                <h:panelGroup>


                                                    <p:selectOneMenu  id="event-search-date-field-val" 
                                                                      tabindex="1" 
                                                                      value="#{eventSearchBB.searchParamsSelected.date_field}"
                                                                      disabled="#{!eventSearchBB.searchParamsSelected.date_startEnd_ctl}">
                                                        <f:selectItem itemLabel="select a date field..." 
                                                                      noSelectionOption="true" 
                                                                      itemDisabled="true"/>
                                                        <f:selectItems id="event-search-date-field-val-items" 
                                                                       value="#{eventSearchBB.searchParamsSelected.dateFieldList}" 
                                                                       var="f" itemValue="#{f}" itemLabel="#{f.title}" />
                                                    </p:selectOneMenu>

                                                </h:panelGroup>

                                                <h:panelGroup styleClass="pgspacer">
                                                    <h:outputText value=" " />
                                                </h:panelGroup>



                                                <h:panelGroup id="datepickers-pg">
                                                    <h:panelGrid    columns="1" 
                                                                    cellpadding="10" 
                                                                    columnClasses="gridTd">
                                                        <h:panelGroup>

                                                            <p:outputLabel for="event-search-date-start-val" 
                                                                           value="start date"/>

                                                            <p:spacer height="1px" />

                                                            <p:calendar id="event-search-date-start-val" 
                                                                        value="#{eventSearchBB.searchParamsSelected.startDate_val_utilDate}" 
                                                                        disabled="#{(!eventSearchBB.searchParamsSelected.date_startEnd_ctl) or eventSearchBB.searchParamsSelected.date_relativeDates_ctl}"
                                                                        mode="popup" 
                                                                        showOn="button" 
                                                                        pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                                        navigator="true" 
                                                                        tabindex="16" 
                                                                        timeInput="true" 
                                                                        showHour="true" showMinute="false" showSecond="false" showMillisec="false"
                                                                        showButtonPanel="true" 
                                                                        showTodayButton="true"
                                                                        required="false"/>
                                                            <h:message for="event-search-date-start-val" showDetail="false" showSummary="true" 
                                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                                        </h:panelGroup>

                                                        <h:panelGroup>

                                                            <p:outputLabel for="event-search-date-end-val" 
                                                                           value="end date"/>

                                                            <p:spacer height="1px" />

                                                            <p:calendar id="event-search-date-end-val" 
                                                                        value="#{eventSearchBB.searchParamsSelected.endDate_val_utilDate}" 
                                                                        disabled="#{(!eventSearchBB.searchParamsSelected.date_startEnd_ctl) or eventSearchBB.searchParamsSelected.date_relativeDates_ctl}"
                                                                        mode="popup" 
                                                                        showOn="button" 
                                                                        pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                                        navigator="true" 
                                                                        tabindex="16" 
                                                                        timeInput="true" 
                                                                        showHour="true" showMinute="false" showSecond="false" showMillisec="false"
                                                                        showButtonPanel="true" 
                                                                        showTodayButton="true"
                                                                        required="false"/>
                                                            <h:message for="event-search-date-end-val" showDetail="false" showSummary="true" 
                                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                                        </h:panelGroup>
                                                    </h:panelGrid>
                                                </h:panelGroup>


                                                <h:panelGroup styleClass="pgspacer">
                                                    <h:outputText value=" " />
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:panelGrid    columns="1" 
                                                                    columnClasses="gridTd">
                                                        <h:panelGroup>
                                                            <p:outputLabel for="event-search-date-relative-ctl" 
                                                                           value="Relative dates"
                                                                           styleClass="datum-label"/>
                                                            <p:selectBooleanCheckbox id="event-search-date-relative-ctl" 
                                                                                     value="#{eventSearchBB.searchParamsSelected.date_relativeDates_ctl}" 
                                                                                     disabled="#{!eventSearchBB.searchParamsSelected.date_startEnd_ctl}">
                                                                <p:ajax update="event-search-date-end-val
                                                                        event-search-date-start-val
                                                                        event-search-date-end-val
                                                                        event-search-date-relative-start-val
                                                                        event-search-date-relative-end-val" />
                                                            </p:selectBooleanCheckbox>
                                                        </h:panelGroup>
                                                        <h:panelGroup>
                                                            <p:outputLabel for="event-search-date-relative-start-val" 
                                                                           value="start x days from today"/>
                                                            <p:spacer height="1px"/>
                                                            <p:inputText id="event-search-date-relative-start-val" 
                                                                         value="#{eventSearchBB.searchParamsSelected.date_relativeDates_start_val}" 
                                                                         disabled="#{!(eventSearchBB.searchParamsSelected.date_startEnd_ctl and eventSearchBB.searchParamsSelected.date_relativeDates_ctl)}" />
                                                            <h:message for="event-search-date-relative-start-val" showDetail="false" showSummary="true" 
                                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                                        </h:panelGroup>
                                                        <h:panelGroup>
                                                            <p:outputLabel for="event-search-date-relative-end-val" 
                                                                           value="end x days from today"/>
                                                            <p:spacer height="1px"/>
                                                            <p:inputText id="event-search-date-relative-end-val" 
                                                                         value="#{eventSearchBB.searchParamsSelected.date_realtiveDates_end_val}" 
                                                                         disabled="#{!(eventSearchBB.searchParamsSelected.date_startEnd_ctl and eventSearchBB.searchParamsSelected.date_relativeDates_ctl)}" />
                                                            <h:message for="event-search-date-relative-end-val" showDetail="false" showSummary="true" 
                                                                       warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                                        </h:panelGroup>
                                                    </h:panelGrid>
                                                </h:panelGroup>


                                                <h:panelGroup>
                                                    <p:outputLabel for="event-search-filter-id-ctl" 
                                                                   value="filter by event id"/>

                                                    <p:selectBooleanCheckbox id="event-search-filter-id-ctl" 
                                                                             value="#{eventSearchBB.searchParamsSelected.bobID_ctl}"
                                                                             disabled="false">
                                                        <p:ajax update="event-search-filter-id-val" />
                                                    </p:selectBooleanCheckbox>

                                                </h:panelGroup>
                                                <h:panelGroup>
                                                    <p:outputLabel for="event-search-filter-id-val" 
                                                                   value="id:" />

                                                    <p:spacer height="5px"/>

                                                    <p:inputText id="event-search-filter-id-val"
                                                                 type="number"
                                                                 value="#{eventSearchBB.searchParamsSelected.bobID_val}"
                                                                 disabled="#{!eventSearchBB.searchParamsSelected.bobID_ctl}"/>
                                                    <h:message for="event-search-filter-id-val" showDetail="false" showSummary="true"
                                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                                </h:panelGroup>


                                                <h:panelGroup>
                                                    <p:outputLabel for="event-search-filter-user-ctl" 
                                                                   value="User filter"/>

                                                    <p:selectBooleanCheckbox id="event-search-filter-user-ctl" 
                                                                             value="#{eventSearchBB.searchParamsSelected.user_ctl}"
                                                                             disabled="#{!(eventSearchBB.searchParamsSelected.user_rtMin.rank lt systemServicesBB.bbSessionUser.keyCard.governingAuthPeriod.role.rank)}">
                                                        <p:ajax update="event-search-filter-user-som
                                                                event-search-user-field-val" />
                                                    </p:selectBooleanCheckbox>

                                                </h:panelGroup>


                                                <h:panelGroup>
                                                    <p:selectOneMenu  id="event-search-user-field-val" 
                                                                      tabindex="1" 
                                                                      value="#{eventSearchBB.searchParamsSelected.user_field}"
                                                                      disabled="#{!eventSearchBB.searchParamsSelected.user_ctl}">
                                                        <f:selectItem itemLabel="select a user field..." 
                                                                      noSelectionOption="true" 
                                                                      itemDisabled="true"/>
                                                        <f:selectItems id="event-search-user-field-val-items" 
                                                                       value="#{eventSearchBB.searchParamsSelected.userFieldList}" 
                                                                       var="uf" itemValue="#{uf}" itemLabel="#{uf.title}" />
                                                    </p:selectOneMenu>
                                                </h:panelGroup>
                                                

                                                <h:panelGroup styleClass="pgspacer">
                                                    <h:outputText value=" " />
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:selectOneMenu id="event-search-filter-user-som" required="false" 
                                                                     value="#{eventSearchBB.searchParamsSelected.user_val}"
                                                                     disabled="#{!eventSearchBB.searchParamsSelected.user_ctl}">
                                                        <f:selectItem itemLabel="select a user..." noSelectionOption="true" />
                                                        <f:selectItems value="#{systemServicesBB.userListForSearch}"  var="u" itemValue="#{u}" 
                                                                       itemLabel="#{u.person.firstName} #{u.person.lastName} (id:#{u.username})"/>
                                                        <f:converter converterId="userConverter"/>
                                                    </p:selectOneMenu>
                                                </h:panelGroup>
                                                
                                                <h:panelGroup>
                                                    <p:outputLabel for="event-search-filter-domain-ctl" 
                                                                   value="User filter"/>

                                                    <p:selectBooleanCheckbox id="event-search-filter-domain-ctl" 
                                                                             value="#{eventSearchBB.searchParamsSelected.eventDomain_ctl}"
                                                                             disabled="#{!(eventSearchBB.searchParamsSelected.user_rtMin.rank lt systemServicesBB.bbSessionUser.keyCard.governingAuthPeriod.role.rank)}">
                                                        <p:ajax update="event-search-filter-domain-val" />
                                                    </p:selectBooleanCheckbox>

                                                </h:panelGroup>


                                                <h:panelGroup>
                                                    <p:selectOneMenu  id="event-search-filter-domain-val" 
                                                                      tabindex="1" 
                                                                      value="#{eventSearchBB.searchParamsSelected.eventDomain_val}"
                                                                      disabled="#{!eventSearchBB.searchParamsSelected.eventDomain_ctl}">
                                                        <f:selectItem itemLabel="select an event domain..." 
                                                                      noSelectionOption="true" 
                                                                      itemDisabled="true"/>
                                                        <f:selectItems id="event-search-filter-domain-items" 
                                                                       value="#{eventSearchBB.searchParamsSelected.eventDomainList}" 
                                                                       var="ed" itemValue="#{ed}" itemLabel="#{ed.title}" />
                                                        <f:converter converterId="eventDomainConverter" />
                                                    </p:selectOneMenu>
                                                </h:panelGroup>
                                                
                                                

                                                <h:panelGroup>
                                                    <p:outputLabel id="event-filter-property-ol" 
                                                                   for="event-filter-property" 
                                                                   value="filter by property "/>

                                                    <p:selectBooleanCheckbox id="event-filter-property" value="#{eventSearchBB.searchParamsSelected.property_ctl}" >
                                                        <p:ajax update="event-criteria-property-som" />
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:selectOneMenu id="event-criteria-property-som" required="false" 
                                                                     value="#{eventSearchBB.searchParamsSelected.property_val}"
                                                                     disabled="#{!eventSearchBB.searchParamsSelected.property_ctl}">

                                                        <f:selectItem itemLabel="select a propery..." noSelectionOption="true" />
                                                        <f:selectItems value="#{systemServicesBB.propertyListForSearch}"  var="prop" itemValue="#{prop}" 
                                                                       itemLabel="#{prop.address} (#{prop.muni.muniName})"/>
                                                        <f:converter converterId="propertyConverter"/>

                                                    </p:selectOneMenu>
                                                </h:panelGroup>
                                                
                                                <h:panelGroup>
                                                    <p:outputLabel for="event-search-filter-usetype-ctl" 
                                                                   value="Use type filter"/>
                                                    <p:selectBooleanCheckbox id="event-search-filter-usetype-ctl" 
                                                                             value="#{eventSearchBB.searchParamsSelected.propertyUseType_ctl}"
                                                                             disabled="false">
                                                        <p:ajax update="event-search-filter-usetype-val" />
                                                    </p:selectBooleanCheckbox>

                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:selectOneMenu    id="event-search-filter-usetype-val" 
                                                                        tabindex="1" 
                                                                        value="#{eventSearchBB.searchParamsSelected.propertyUseType_val}" 
                                                                        disabled="#{!eventSearchBB.searchParamsSelected.propertyUseType_ctl}">
                                                        <f:selectItem   itemLabel="select a use type..." noSelectionOption="true" itemDisabled="true"/>
                                                        <f:selectItems  id="event-search-filter-usetype-items" 
                                                                        value="#{eventSearchBB.putList}" 
                                                                        var="put" itemValue="#{put}" itemLabel="#{put.name}" />
                                                        <f:converter    converterId="propertyUseTypeConverter"/>
                                                    </p:selectOneMenu>
                                                    <h:message for="event-search-filter-usetype-val" showDetail="true" showSummary="true" 
                                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:outputLabel id="event-filter-person-ol" 
                                                                   for="event-criteria-person-val" 
                                                                   value="filter by person"/>

                                                    <p:selectBooleanCheckbox id="event-filter-person-ctl" 
                                                                             value="#{eventSearchBB.searchParamsSelected.person_ctl}" >
                                                        <p:ajax update="event-criteria-person-val" />
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:selectOneMenu id="event-criteria-person-val" required="false" 
                                                                     value="#{eventSearchBB.searchParamsSelected.person_val}"
                                                                     disabled="#{!eventSearchBB.searchParamsSelected.person_ctl}">

                                                        <f:selectItem itemLabel="select a person..." noSelectionOption="true" />
                                                        <f:selectItems value="#{systemServicesBB.personListForSearch}"  var="p" itemValue="#{p}" 
                                                                       itemLabel="#{p.firstName} #{p.lastName} (ID:#{p.personID})"/>
                                                        <f:converter converterId="personConverter"/>

                                                    </p:selectOneMenu>
                                                </h:panelGroup>


                                                
                                                <h:panelGroup>
                                                    <p:outputLabel for="event-search-filter-dismuni-ctl" 
                                                                   value="filter by disclosed to muni"/>
                                                    <p:selectBooleanCheckbox id="event-search-filter-dismuni-ctl" 
                                                                             value="#{eventSearchBB.searchParamsSelected.discloseToMuni_ctl}"
                                                                             disabled="false">
                                                        <p:ajax update="event-search-filter-dismuni-val" />
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:outputLabel for="event-search-filter-dismuni-val" 
                                                                   value="is disclosed to muni"/>
                                                    <p:selectBooleanCheckbox id="event-search-filter-dismuni-val" 
                                                                             value="#{eventSearchBB.searchParamsSelected.discloseToMuni_val}"
                                                                             disabled="#{!eventSearchBB.searchParamsSelected.discloseToMuni_ctl}">
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>
                                                
                                                <h:panelGroup>
                                                    <p:outputLabel for="event-search-filter-dispublic-ctl" 
                                                                   value="filter by disclosed to muni"/>
                                                    <p:selectBooleanCheckbox id="event-search-filter-dispublic-ctl" 
                                                                             value="#{eventSearchBB.searchParamsSelected.discloseToPublic_ctl}"
                                                                             disabled="false">
                                                        <p:ajax update="event-search-filter-dispublic-val" />
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:outputLabel for="event-search-filter-dispublic-val" 
                                                                   value="is disclosed to muni"/>
                                                    <p:selectBooleanCheckbox id="event-search-filter-dispublic-val" 
                                                                             value="#{eventSearchBB.searchParamsSelected.discloseToPublic_val}"
                                                                             disabled="#{!eventSearchBB.searchParamsSelected.discloseToPublic_ctl}">
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>
                                                
                                                <h:panelGroup>
                                                    <p:outputLabel for="event-search-filter-landbank-ctl" 
                                                                   value="filter by land bank held"/>
                                                    <p:selectBooleanCheckbox id="event-search-filter-landbank-ctl" 
                                                                             value="#{eventSearchBB.searchParamsSelected.propertyLandBankHeld_ctl}"
                                                                             disabled="false">
                                                        <p:ajax update="event-search-filter-landbank-val" />
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:outputLabel for="event-search-filter-landbank-val" 
                                                                   value="is in land bank"/>
                                                    <p:selectBooleanCheckbox id="event-search-filter-landbank-val" 
                                                                             value="#{eventSearchBB.searchParamsSelected.propertyLandBankHeld_val}"
                                                                             disabled="#{!eventSearchBB.searchParamsSelected.propertyLandBankHeld_ctl}">
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:outputLabel for="event-search-filter-active-ctl" 
                                                                   value="filter by active"/>
                                                    <p:selectBooleanCheckbox id="event-search-filter-active-ctl" 
                                                                             value="#{eventSearchBB.searchParamsSelected.active_ctl}"
                                                                             disabled="false">
                                                        <p:ajax update="event-search-filter-active-val" />
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:outputLabel for="event-search-filter-active-val" 
                                                                   value="is active"/>
                                                    <p:selectBooleanCheckbox id="event-search-filter-active-val" 
                                                                             value="#{eventSearchBB.searchParamsSelected.active_val}"
                                                                             disabled="#{!eventSearchBB.searchParamsSelected.active_ctl}">
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>


                                                <h:panelGroup>
                                                    <p:outputLabel id="event-query-limit-ol" 
                                                                   for="event-query-limit" 
                                                                   value="limit results"/>
                                                    <p:selectBooleanCheckbox id="event-query-limit" 
                                                                             value="#{eventSearchBB.searchParamsSelected.limitResultCount_ctl}" />
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:inputText id="event-filter-limit-it"
                                                                 type="number"
                                                                 value="#{eventSearchBB.searchParamsSelected.limitResultCount_val}"
                                                                 disabled="#{!eventSearchBB.searchParamsSelected.limitResultCount_ctl}"/>
                                                    <h:message for="event-filter-limit-it" showDetail="false" showSummary="true"
                                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                                </h:panelGroup>




                                                <h:panelGroup>
                                                    <p:outputLabel id="seev-filter-type-ol" for="seev-filter-type" value="filter by event type"/>
                                                    <p:selectBooleanCheckbox id="seev-filter-type" 
                                                                             value="#{eventSearchBB.searchParamsSelected.eventType_ctl}">
                                                        <p:ajax update="ceev-critera-type" />
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>


                                                <h:panelGroup>
                                                    <p:selectOneMenu id="ceev-critera-type" required="false" 
                                                                     value="#{eventSearchBB.searchParamsSelected.eventType_val}" tabindex="10"
                                                                     disabled="#{!eventSearchBB.searchParamsSelected.eventType_ctl}">
                                                        <f:selectItem itemLabel="select an event type..." noSelectionOption="true" />
                                                        <p:ajax update="ceev-criteria-cat" immediate="true"/> 
                                                        <f:selectItems value="#{eventSearchBB.eventTypesList}"/>
                                                    </p:selectOneMenu>
                                                    <h:message for="ceev-critera-type" showDetail="false" showSummary="true" 
                                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <p:outputLabel id="ceev-filter-cat-ol" for="ceev-filter-cat" value="filter by event category "/>
                                                    <p:selectBooleanCheckbox id="ceev-filter-cat" value="#{eventSearchBB.searchParamsSelected.eventCat_ctl}">
                                                        <p:ajax update="ceev-criteria-cat" />
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:outputLabel for="ceev-criteria-cat" id="ceev-criteria-cat-ol">
                                                        <h:outputText value="event Categories in selected event type:"/>
                                                    </h:outputLabel>
                                                    <p:spacer height="1px" />
                                                    <p:selectOneMenu id="ceev-criteria-cat" style="width: 300px;" 
                                                                     value="#{eventSearchBB.searchParamsSelected.eventCat_val}" tabindex="10"
                                                                     disabled="#{!eventSearchBB.searchParamsSelected.eventCat_ctl}">
                                                        <f:selectItem itemLabel="select an event category..." noSelectionOption="true" />
                                                        <f:converter converterId="eventCategoryConverter"/>
                                                        <f:selectItems  id="catItemsList" value="#{eventSearchBB.eventCatList}" var="ec" itemValue="#{ec}" itemLabel="#{ec.eventCategoryTitle}"/>
                                                    </p:selectOneMenu>
                                                    <h:message for="ceev-criteria-cat" showDetail="false" showSummary="true"  
                                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                                </h:panelGroup>
                                                
                                                <h:panelGroup>
                                                    <p:outputLabel id="ceev-filter-id-ol" for="ceev-filter-id" value="filter by ce case ID? "/>
                                                    <p:selectBooleanCheckbox id="ceev-filter-id" value="#{eventSearchBB.searchParamsSelected.filterByCaseID}" 
                                                                             disabled="false" >
                                                        <p:ajax update="ceev-criteria-caseid" />
                                                    </p:selectBooleanCheckbox>
                                                </h:panelGroup>

                                            </h:panelGrid>                                        
                                        </p:fieldset>
                                    </h:form>

                                </p:panel>
                            </h:panelGroup>

                            <h:panelGroup>

                                <p:panel    id="event-search-results-panel"
                                            toggleable="true"
                                            widgetVar="event-search-results-panel-var"
                                            collapsed="false"
                                            header="Search results">


                                    <h:form id="eventlist-prepare-event-report-form">

                                        <p:commandButton   id="print-event-list-report-cb" 
                                                           ajax="true" actionListener="#{eventSearchBB.prepareEventReport}"
                                                           icon="fa fa-print" styleClass="button"
                                                           oncomplete="PF('report-event-diaglog-var').show()"
                                                           value="prepare event report" 
                                                           update="report-eventlist-form
                                                           event-search-messages-form
                                                           ceev-reportconfig-messages-form"/>

                                    </h:form>

                                    <p:spacer height="5px" />



                                    <p:tabView id="event-list-tabview">
                                        <p:tab title="list view (report preview)">
                                            <h:form id="events-datascroller-form">
                                                <p:dataScroller
                                                    id="events-datascroller"
                                                    var="e"
                                                    value="#{eventSearchBB.eventList}"
                                                    widgetVar="ceevent-ds-var">

                                                    <div class="outlinedBox event-ds-box">

                                                        <div class="status-display-container">
                                                            <div class="action-request-icon">
                                                                <i class="material-icons"><h:outputText id="action-request-display-icon-ot" value="#{e.event.category.icon.materialIcon}"/></i>
                                                            </div>
                                                            <div class="status-display-status-list-container">
                                                                <div class="action-request-header">
                                                                    <h:outputText value="#{e.event.category.eventType.label}: #{e.event.category.eventCategoryTitle} "/>
                                                                    <p:commandButton       
                                                                        id="event-view-in-cases-cb" 
                                                                        ajax="false"
                                                                        value="view containing case" 
                                                                        style="background-color: white; font-size: small;"
                                                                        styleClass="button-float-right"
                                                                        action="#{eventSearchBB.editEventInCaseManager(e)}"
                                                                        disabled="false"
                                                                        icon="fa fa-arrow-circle-right"
                                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                                        />
                                                                    <p:commandButton       
                                                                        id="eventlist-hide-event-cb" 
                                                                        ajax="true"
                                                                        value="hide event" 
                                                                        style="background-color: white; font-size: small;"
                                                                        styleClass="button-float-right"
                                                                        actionListener="#{eventSearchBB.hideEvent(e)}"
                                                                        icon="fa fa-moon-o"
                                                                        rendered="#{sessionBeasessionUserer.keyCard.hasEnfOfficialPermissions}"
                                                                        update="event-list-tabview:events-datascroller-form:events-datascroller"
                                                                        />
                                                                </div>
                                                                <div class="action-request-subheader">
                                                                    <h:panelGrid    columns="2" 
                                                                                    cellpadding="5" 
                                                                                    footerClass="no-border"
                                                                                    columnClasses="event-list-halfwidth, event-list-halfwidth">

                                                                        <h:panelGroup>
                                                                            <h:outputText value="Property: " styleClass="bold" />
                                                                            <h:outputText value="#{e.eventCaseBare.property.address} " />
                                                                            <h:outputText value=" (#{e.eventCaseBare.property.muni.muniName}) " />
                                                                            <h:outputText value=" | " styleClass="bold" />
                                                                            <h:outputText value="Prop ID: " styleClass="bold" />
                                                                            <h:outputText value="#{e.eventCaseBare.property.propertyID} " />

                                                                            <br />  

                                                                            <h:outputText value="Date: " styleClass="bold" />
                                                                            <h:outputText value="#{e.event.dateOfRecordPretty}"/>


                                                                        </h:panelGroup>

                                                                        <h:panelGroup>
                                                                            <h:outputText value="Case stage: " styleClass="bold" />
                                                                            <h:outputText value="#{e.eventCaseBare.caseStage.label} " />
                                                                            <h:outputText value=" | " styleClass="bold" />
                                                                            <h:outputText value="Event ID: " styleClass="bold" />
                                                                            <h:outputText value="#{e.event.eventID} " />
                                                                            <h:outputText value=" | " styleClass="bold" />
                                                                            <h:outputText value="Case ID: " styleClass="bold" />
                                                                            <h:outputText value="#{e.eventCaseBare.caseID} " />

                                                                            <br />  

                                                                            <h:outputText value="Event Owner: " styleClass="bold" />
                                                                            <h:outputText value="#{e.event.owner.person.firstName} #{e.event.owner.person.lastName}"/>
                                                                            <h:outputText value="   (#{e.event.owner.username}, 
                                                                                          ID: #{e.event.owner.userID})" />
                                                                        </h:panelGroup>

                                                                        <f:facet name="footer">

                                                                            <div class="rowExpansion">
                                                                                <h:outputText styleClass="bold" value="Description: " />
                                                                                <h:outputText styleClass="weight-normal" 
                                                                                              value="#{e.event.description}"
                                                                                              escape="false"/>
                                                                            </div>
                                                                            <div class="rowExpansion">
                                                                                <h:outputText styleClass="bold" value="Notes: " 
                                                                                              rendered="#{!(empty e.event.notes)}"/>
                                                                                <h:outputText styleClass="weight-normal" 
                                                                                              value="#{e.event.notes}" escape="false"
                                                                                              rendered="#{!(empty e.event.notes)}"/>
                                                                            </div>
                                                                        </f:facet>
                                                                    </h:panelGrid>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </p:dataScroller>
                                            </h:form>
                                        </p:tab>
                                        <p:tab title="data table view (detailed)">

                                            <h:form id="events-datatable-form">
                                                <p:dataTable
                                                    id="events-datatable"
                                                    var="e"
                                                    rowKey="#{e.eventID}"
                                                    value="#{eventSearchBB.eventList}"
                                                    tableStyleClass="primeDataTable"
                                                    resizableColumns="true"
                                                    rowExpandMode="multiple"
                                                    expandedRow="false"
                                                    filteredValue="#{eventSearchBB.filteredEventList}"
                                                    widgetVar="ceevent-dt-var"
                                                    >
                                                    <!--<p:ajax event="rowSelect" update="selectedRowLabel"/>-->

                                                    <p:column width="3%" exportable="false">
                                                        <f:facet name="header">
                                                            <h:outputText value="Expand"/>
                                                        </f:facet>
                                                        <p:rowToggler/>
                                                    </p:column>

                                                    <p:column width="11%" sortBy="#{e.event.dateOfRecord}">
                                                        <f:facet name="header">
                                                            <h:outputText value="Date" />
                                                        </f:facet>
                                                        <h:outputText value="#{e.event.dateOfRecordPretty}"/>
                                                    </p:column>

                                                    <p:column width="15%" sortBy="#{e.eventCaseBare.property.address}">
                                                        <f:facet name="header">
                                                            <h:outputText value="Property" />
                                                        </f:facet>
                                                        <h:outputText value="#{e.eventCaseBare.property.address} (#{e.eventCaseBare.property.muni.muniName}"/>
                                                    </p:column>

                                                    <p:column width="15%">
                                                        <f:facet name="header">
                                                            <h:outputText value="Case name" />
                                                        </f:facet>
                                                        <h:outputText value="#{e.eventCaseBare.caseName})" />
                                                    </p:column>

                                                    <p:column width="8%" sortBy="#{e.event.category.eventType.label}"
                                                              filterBy="#{e.event.category.eventType.label}">
                                                        <f:facet name="header">
                                                            <h:outputText value="Type" />
                                                        </f:facet>
                                                        <h:outputText value="#{e.event.category.eventType.label}"/>
                                                    </p:column>

                                                    <p:column width="10%" sortBy="#{e.event.category.eventCategoryTitle}"
                                                              filterBy="#{e.event.category.eventCategoryTitle}">
                                                        <f:facet name="header">
                                                            <h:outputText value="Category" />
                                                        </f:facet>
                                                        <h:outputText value="#{e.event.category.eventCategoryTitle}"/>
                                                    </p:column>
                                                    <p:column width="5%" filterBy="#{e.event.owner.person.lastName}"
                                                              sortBy="#{e.event.owner.person.lastName}">
                                                        <f:facet name="header">
                                                            <h:outputText value="Creator" />
                                                        </f:facet>
                                                        <h:outputText value="#{e.event.owner.person.lastName}"/>
                                                    </p:column>
                                                    <p:column width="20%" style="word-wrap: normal;">
                                                        <f:facet name="header">
                                                            <h:outputText value="Description" />
                                                        </f:facet>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.event.description}"/>
                                                        </div>
                                                    </p:column>
                                                    <p:column width="5%" exportable="false">
                                                        <f:facet name="header">
                                                            <h:outputText value="edit" />
                                                        </f:facet>
                                                        <p:commandButton icon="fa fa-edit"
                                                                         action="#{caseProfileBB.jumpToCasesToEditCEEvent(e)}" 
                                                                         ajax="false"/>

                                                    </p:column>

                                                    <p:rowExpansion>

                                                        <div class="outlinedBox">
                                                            <h2>Event ID: <h:outputText value="#{e.event.eventID}"/> </h2>
                                                            <h:panelGrid columns="4" cellpadding="10" footerClass="gridFooter"
                                                                         columnClasses="gridTd, gridTd, gridTd, gridTd">

                                                                <h:panelGroup>
                                                                    <h:outputText styleClass="bold" value="Description" />
                                                                    <div class="rowExpansion">
                                                                        <h:outputText value="#{e.event.description}"/>
                                                                    </div>
                                                                </h:panelGroup>

                                                                <h:panelGroup>
                                                                    <h:outputText styleClass="bold" value="Disclose to Municipality Staff?" />
                                                                    <div class="rowExpansion">
                                                                        <h:outputText value="#{e.event.discloseToMunicipality}"/>
                                                                    </div>
                                                                </h:panelGroup>

                                                                <h:panelGroup>
                                                                    <h:outputText styleClass="bold" value="Disclose to Public?" />
                                                                    <div class="rowExpansion">
                                                                        <h:outputText value="#{e.event.discloseToPublic}"/>
                                                                    </div>
                                                                </h:panelGroup>
                                                                <h:panelGroup>
                                                                    <h:outputText styleClass="bold" value="Creation time stamp"/>
                                                                    <div class="rowExpansion">
                                                                        <h:outputText value="#{e.event.timestamp}"/>
                                                                    </div>
                                                                </h:panelGroup>
                                                                <h:panelGroup>
                                                                    <h:outputText styleClass="bold" value="Active Event?"/>
                                                                    <div class="rowExpansion">
                                                                        <h:outputText value="#{e.event.active}"/>
                                                                    </div>
                                                                </h:panelGroup>


                                                                <h:panelGroup>
                                                                    <h:outputText styleClass="bold" value="View confirmed by"/>
                                                                    <div class="rowExpansion">
                                                                        <h:outputText value="#{e.event.responderActual.person.lastName}"/>
                                                                    </div>
                                                                </h:panelGroup>

                                                                <h:panelGroup>
                                                                    <h:outputText styleClass="bold" value="View confirmed at"/>
                                                                    <div class="rowExpansion">
                                                                        <h:outputText value="#{e.event.responseTimestamp}"/>
                                                                    </div>
                                                                </h:panelGroup>



                                                                <f:facet name="footer" class="leftalign">
                                                                    <h:outputLabel styleClass="bold" style="text-align: left" value="Notes"/>
                                                                    <p:spacer height="15px"/>
                                                                    <div class="rowExpansion" style="text-align: left">
                                                                        <h:outputText escape="false" value="#{e.event.notes}"/>
                                                                    </div>
                                                                </f:facet>

                                                            </h:panelGrid>
                                                        </div>
                                                    </p:rowExpansion>
                                                </p:dataTable>
                                            </h:form>
                                        </p:tab>
                                    </p:tabView>
                                </p:panel>
                            </h:panelGroup>
                        </h:panelGrid>


                        <p:dialog header="Building activity reports" 
                                  widgetVar="helpdlg"
                                  responsive="true"
                                  width="80%">
                            <h1>Steps to building an activity report:</h1>
                            <h2>1. Choose a pre-built query</h2>

                            <p>Events are selected from the database through a query, which is made up of many parameters
                                (i.e. criteria) which define which events to retrieve. A set of pre-made queries are designed
                                to speed up the reporting process. Browse those pre-built queries with the drop-down box and then click
                                "perform selected query" to see the results. </p>


                            <p>The list view is more compact and reflects what is printed in event reports. The data table view contains exactly the same
                                <br /> events but with more complete info for in-depth analysis.</p>


                            <h2>2. Trim your event list by hiding events</h2>

                            <p>After performing the query, hide any unwanted events from the results using the 
                                "hide event" button with the moon icon located on the right side of each event's display box.
                                A hidden event is not displayed in your final report, but is still attached to the code enforcement case
                                and can be viewed in the case's event history.</p>

                            <p>NOTE: Hiding an event on this page for report generation ALSO hides the event when viewing the event history 
                                for that event's respective case. You can always un-hide an event by toggling the "view hidden events" switch
                                underneath the event history table in the case manager. </p>

                            <h2>3. Customize your query</h2>
                            <p>Expand the search options to customize your query. The query controls are automatically updated to match 
                                the pre-built queries in the drop-down list above, allowing you to start with the settings associated with
                                a pre-built query and then tune the results to fit your needs.</p>

                            <p>For example, pre-built queries are pre-set to useful date ranges for searching, such as events that occurred in
                                the past month or events about to occur in the next week. By first performing a pre-built query which produces 
                                events you're interested in but over undesirable date range, you can just change the specified date range in the
                                customized query parameters to arrive at your desired output.</p>

                            <h2>4. Preparing and generating an event report</h2>

                            <p>The button labeled "prepare event report" pops up a settings window to configure an event report based on the currently
                                visible events in your list. Additional guidance is provided for each setting inside that dialog box. Remember: the report
                                is generated based on only the events you can see in your result list; hidden events are not included.</p>


                        </p:dialog>



                        <p:dialog  id="ceevents-configure-report-dialog"
                                   widgetVar="report-event-diaglog-var"
                                   closable="true" responsive="true"
                                   dynamic="true"
                                   rendered="#{sessionBeasessionUserer.keyCard.hasMuniReaderPermissions}">

                            <h:form id="ceev-reportconfig-messages-form">
                                <h:messages id="ceev-messages-in-report-dialog" globalOnly="true" showDetail="false" showSummary="true"
                                            warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                </h:messages>
                            </h:form>

                            <h:form id="report-eventlist-form">

                                <h:panelGrid columns="1" border="0" 
                                             cellpadding="5" columnClasses="gridTd"
                                             footerClass="gridFooter">

                                    <f:facet name="header">


                                        <h:outputLabel for="report-case-profile-title-it" value="Report title"/>

                                        <p:spacer height="5px"/>

                                        <p:inputText id="report-case-profile-title-it" style="width: 300px;" value="#{eventSearchBB.reportConfig.title}"/>
                                        <p:spacer height="2px"/>
                                        <h:outputText styleClass="italic" value="note: your name and the current date and time will be automatically inserted" />

                                        <p:spacer height="10px"/>

                                        <h:outputLabel for="report-case-profile-notes-ita" value="Notes"/>
                                        <p:spacer height="5px"/>
                                        <p:inputText id="report-case-profile-notes-ita" style="width: 300px; height: 100px;" value="#{eventSearchBB.reportConfig.notes}"/>
                                        <p:spacer height="5px"/>
                                    </f:facet>

                                    <h:panelGroup>
                                        <h2>Event display options</h2>

                                        <h:outputLabel class="bold" value="Sort events: " for="sort-reverse-chrono-is" />
                                        <p:spacer height="1px"/>
                                        <p:inputSwitch  id="sort-reverse-chrono-is"
                                                        value="#{eventSearchBB.reportConfig.sortInRevChrono}" 
                                                        onLabel="Reverse chrono (newest first)" offLabel="Timeline order (oldest first)" />

                                        <p:spacer height="5px"/>

                                        <h:outputLabel class="bold" value="Include persons attached to events" for="include-attached-persons-is" />
                                        <p:spacer height="1px"/>
                                        <p:inputSwitch  id="include-attached-persons-is"
                                                        value="#{eventSearchBB.reportConfig.includeAttachedPersons}" 
                                                        onLabel="Yes" offLabel="No" />

                                        <p:spacer height="5px"/>

                                        <h:outputLabel class="bold" value="Include event summary chart on page 1" for="include-event-summary-chart-is" />
                                        <p:spacer height="1px"/>
                                        <p:inputSwitch  id="include-event-summary-chart-is"
                                                        value="#{eventSearchBB.reportConfig.includeEventTypeSummaryChart}" 
                                                        onLabel="Yes" offLabel="No" />

                                        <p:spacer height="5px"/>

                                        <h:outputLabel class="bold" value="Include list of all active cases" for="include-active-case-list-is" />
                                        <p:spacer height="1px"/>
                                        <p:inputSwitch  id="include-active-case-list-is"
                                                        value="#{eventSearchBB.reportConfig.includeActiveCaseListing}" 
                                                        onLabel="Yes" offLabel="No" />

                                        <p:spacer height="5px"/>

                                        <h:outputLabel class="bold" value="Include info about events requesting user action" for="include-action-requests-is" />
                                        <p:spacer height="1px"/>
                                        <p:inputSwitch  id="include-action-requests-is"
                                                        value="#{eventSearchBB.reportConfig.includeCaseActionRequestInfo}" 
                                                        onLabel="Yes" offLabel="No" />

                                        <p:spacer height="5px"/>

                                        <h:outputLabel class="bold" value="Include complete query parameters" for="include-queryparams-is" />
                                        <p:spacer height="1px"/>
                                        <p:inputSwitch  id="include-queryparams-is"
                                                        value="#{eventSearchBB.reportConfig.includeCompleteQueryParamsDump}" 
                                                        onLabel="Yes" offLabel="No" />

                                        <p:spacer height="5px"/>

                                    </h:panelGroup>
                                </h:panelGrid>

                                <p:commandButton ajax="true" 
                                                 value="Cancel" icon="fa fa-stop" 
                                                 onclick="PF('report-event-diaglog-var').hide()"/>

                                <p:commandButton ajax="false" action="#{eventSearchBB.generateEventReport}"
                                                 value="Generate report" icon="fa fa-print" 
                                                 rendered="#{sessionBsessionUserUser.keyCard.hasMuniReaderPermissions}"
                                                 />

                            </h:form>
                        </p:dialog>

                    </div>
                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

