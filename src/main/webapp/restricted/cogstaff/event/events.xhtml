<?xml version='1.0' encoding='UTF-8' ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"></link>
        
        <title>Events</title>
    </h:head>

    <h:body id="events-body">

        <ui:composition template="/restricted/navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view id="events-view">

                    <p:outputPanel id="body-panel">
                        <h:form id="form-messages-global">
                            <p:growl id="events-messages-growl"
                                     />
                        </h:form>

                        <h1>Events</h1>

                        <div class="mainContainer">
                            <div class="ui-g data-container">
                                <div class="ui-g-12 ui-md-4 ui-lg-4 list-data-container">
                                    
                                    <p:panel    id="event-settings-panel"
                                                toggleable="true"
                                                style="width: 100%;"
                                                widgetVar="event-setttings-panel-var"
                                                collapsed="false"
                                                rendered="true"
                                                header="Settings" >
                                        <h:form id="event-settings-form">


                                            <div class="ui-g data_container_nested_restrict">

                                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field" >

                                                    <div class="restrict-data-field-label-inline" >
                                                        <p:outputLabel for="events-domain-list-som">
                                                            <h:outputText value="Event Domains"/>
                                                        </p:outputLabel>
                                                    </div>

                                                    <div class="restrict-data-field-value-inline" >

                                                        <p:selectOneMenu id="events-domain-list-som"
                                                                         value="#{eventsBB.eventDomianSelected}">

                                                            <f:selectItems  id="event-domain-list-selitems"
                                                                            value="#{eventsBB.eventDomainList}"
                                                                            var="domain"
                                                                            itemValue="#{domain}"
                                                                            itemLabel="#{domain.title}"/>
                                                            <p:ajax update="events-header-domain
                                                                    mode-form
                                                                    event-list-panel
                                                                    event-settings-panel
                                                                     event-search-panel
                                                                     event-search-log-panel
                                                                     event-profile-panel
                                                                     event-add-panel
                                                                     event-update-panel
                                                                     event-remove-panel
                                                                     event-notes-panel"
                                                                    listener="#{eventsBB.onEventDomainListChange}" />
                                                           
                                                        </p:selectOneMenu>

                                                    </div>
                                                    <p:spacer height="5px" />
                                                     <h:outputText id="events-header-domain"
                                                                   value="#{eventsBB.currentERGBObTitle}" />
                                                  
                                                    
                                                </div>

                                           
                                            </div>
                                        </h:form>

                                    </p:panel>
                                    
                                    <h:form id="mode-form">
                                        <div class="restrict-main-list-mode-button">

                                            <p:selectOneButton style="  width: 100%;
                                                               margin-top: 10px ;
                                                               height: 20px;"
                                                               value="#{eventsBB.currentMode}"
                                                               unselectable="false"
                                                               >
                                                <f:selectItems value="#{eventsBB.pageModes}"
                                                               var="pmo"
                                                               itemDisabled="#{pmo.objectSelectRequiredToEnable and empty eventsBB.currentEvent}"
                                                               itemLabel="#{pmo.title}"/>
                                                <f:ajax render="@all"/>
                                            </p:selectOneButton>
                                        </div>
                                    </h:form>




                                    <p:panel    id="event-list-panel"
                                                toggleable="true"
                                                style="width: 100%;"
                                                widgetVar="event-list-panel-var"
                                                collapsed="false"
                                                rendered="#{eventsBB.activeLookupMode or eventsBB.activeViewMode}"
                                                header="Event list" >

                                        <h:form id="event-list-form">



                                            <div class="ui-g data_container_nested_restrict">
                                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">

                                                    <div class="restrict-data-field-label-inline" >
                                                        <h:outputLabel  for="event-viewoptions-som">
                                                            <h:outputText value="Filter" />
                                                        </h:outputLabel>
                                                    </div>
                                                    <div class="restrict-data-field-value-inline" >

                                                        <p:selectOneMenu    id="event-viewoptions-som"
                                                                            value="#{eventsBB.selectedEventView}"
                                                                            tabindex="10">

                                                            <f:selectItems  id="event-viewoptions-selitems"
                                                                            value="#{eventsBB.eventsViewOptionsCandidates}"
                                                                            var="vo"
                                                                            itemValue="#{vo}"
                                                                            itemLabel="#{vo.label}"/>
                                                            <p:ajax update="events-table"
                                                                    immediate="true"/>
                                                        </p:selectOneMenu>

                                                    </div>

                                                </div>
                                                  <div class="restrict-main-contents-io-button">



                                                        <p:commandButton   id="print-event-list-report-cb" 
                                                                           ajax="true" actionListener="#{eventsBB.prepareEventReport}"
                                                                           icon="fa fa-print" styleClass="button"
                                                                           oncomplete="PF('report-event-diaglog-var').show()"
                                                                           value="prepare event report" 
                                                                           update="report-eventlist-form
                                                                           form-messages-global"/>

                                                    </div>
                                                
                                                    <div class="restrict-main-contents-io-button gray_button">

                                                        <p:commandButton   id="event-search-clear-button" 
                                                                           ajax="true" 
                                                                           actionListener="#{eventsBB.clearEventList}"
                                                                           icon="fa fa-eraser" 
                                                                           disabled="false"
                                                                           styleClass="button"
                                                                           value="clear results list" 
                                                                           update="event-list-panel
                                                                           form-messages-global"/>
                                                    </div>
                                            </div>

                                            <p:dataTable
                                                id="events-table"
                                                var="e"
                                                rowKey="#{e.eventID}"
                                                value="#{eventsBB.eventList}"
                                                tableStyleClass="primeDataTable"
                                                resizableColumns="true"
                                                widgetVar="events-table-var"
                                                >
                                                <!--<p:ajax event="rowSelect" update="selectedRowLabel"/>-->

                                                <p:column width="4%">
                                                    <i class="material-icons"><h:outputText value="#{e.category.icon.materialIcon}"/></i>
                                                </p:column>

                                                <p:column width="4%" sortBy="#{e.domain.abbrev}"
                                                              >
                                                        <f:facet name="header">
                                                            <h:outputText value="Dom" />
                                                        </f:facet>
                                                    <h:outputText value="#{e.domain.abbrev}"/>
                                                </p:column>

                                                <p:column width="12%" sortBy="#{e.category.eventType.label}"
                                                         >
                                                    <f:facet name="header">
                                                        <h:outputText value="Category" />
                                                    </f:facet>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{e.category.eventType.label}"/>
                                                        <p:spacer height="5px" />
                                                        <h:outputText value="#{e.category.eventCategoryTitle}"/>
                                                    </div>
                                                </p:column>

                                                <p:column width="9%" sortBy="#{e.timeStart}">
                                                    <f:facet name="header">
                                                        <h:outputText value="Date" />
                                                    </f:facet>
                                                    <div class="rowExpansion">
                                                        <h:outputText value="#{e.timeStartPretty}"/>
                                                    </div>
                                                </p:column>

                                                <p:column width="4%" sortBy="#{e.eventID}">
                                                    <f:facet name="header">
                                                        <h:outputText value="ID" />
                                                    </f:facet>
                                                    <h:outputText value="#{e.eventID}"/>
                                                </p:column>
                                              
                                               

                                                <p:column width="8%" exportable="false">
                                                    <f:facet name="header">
                                                        <h:outputText value="Action" />
                                                    </f:facet>

                                                    <p:commandButton ajax="true" 
                                                                     actionListener="#{eventsBB.onObjectViewButtonChange(e)}"
                                                                     icon="#{e.eventID == eventsBB.currentEvent.eventID? 'fa fa-hand-o-right':'fa fa-tag'}"
                                                                     style="#{e.eventID == eventsBB.currentEvent.eventID ? 'background-color: #dee461; color:black; border:none;':''}"
                                                                     rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                                     update="event-list-panel
                                                                     event-settings-panel
                                                                     event-search-panel
                                                                     event-search-log-panel
                                                                     event-profile-panel
                                                                     event-add-panel
                                                                     event-update-panel
                                                                     event-remove-panel
                                                                     event-notes-panel
                                                                     "

                                                                     />

                                                    <p:commandButton icon="fa fa-eye-slash"
                                                                     ajax="true"
                                                                     disabled="#{e.hidden}"
                                                                     rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                                     actionListener="#{eventsBB.hideEvent(e)}" 
                                                                     update="event-list-panel
                                                                     form-messages-global"
                                                                     />
                                                    <p:commandButton icon="fa fa-eye"
                                                                     ajax="true"
                                                                     disabled="#{!e.hidden}"
                                                                     actionListener="#{eventsBB.unHideEvent(e)}" 
                                                                     rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                                                     update="event-list-panel
                                                                     form-messages-global"
                                                                     />

                                                </p:column>



                                            </p:dataTable>



                                        </h:form>


                                    </p:panel>

                                    <p:panel    id="event-search-panel"
                                                toggleable="true"
                                                style="width: 100%;"
                                                widgetVar="event-serach-panel-var"
                                                collapsed="false"
                                                rendered="true"
                                                header="Search tools" >
                                        
                                        <h:form id="event-search-form">
                                            <div class="ui-g data_container_nested_restrict">
                                                
                                             <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field" >


                                                    <div class="restrict-data-field-label-inline" >

                                                        <h:outputLabel value="Select a query:" 
                                                                       for="eventquery-som" />
                                                    </div>

                                                    <div class="restrict-data-field-value-inline" >

                                                        <p:selectOneMenu id="eventquery-som" 
                                                                         tabindex="1" 
                                                                         value="#{eventsBB.querySelected}"
                                                                         style="margin-right: 10px;">
                                                            <f:converter converterId="bOBQueryConverter"/>
                                                            <f:selectItem itemLabel="select a query..." noSelectionOption="true" itemDisabled="true"/>
                                                            <f:selectItems id="querylist-si" value="#{eventsBB.queryList}" var="ql" itemValue="#{ql}" itemLabel="#{ql.queryTitle}" />
                                                            <p:ajax listener="#{eventsBB.changeQuerySelected}"
                                                                    update="form-messages-global
                                                                    @form
                                                                    "/>
                                                        </p:selectOneMenu>
                                                    </div>

                                                </div>

                                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field" >

                                                    <div class="restrict-main-contents-io-button">
                                                            <p:commandButton icon="fa fa-lightning"
                                                                 ajax="true"
                                                                 value="Execute Search"
                                                                 disabled="false"
                                                                 actionListener="#{eventsBB.executeQuery}" 
                                                                 update="event-list-panel
                                                                 event-search-log-panel
                                                                 form-messages-global"
                                                                 />

                                                    </div>

                                                    <div class="restrict-main-contents-io-button gray_button">
                                                        <p:commandButton   id="event-search-clear-cb" 
                                                                           ajax="true" 
                                                                           actionListener="#{eventsBB.resetQuery}"
                                                                           icon="fa fa-eraser" 
                                                                           styleClass="button inline-button"
                                                                           value="clear query" 
                                                                           disabled="#{!eventsBB.querySelected.queryExecuted}"
                                                                           update="form-messages-global
                                                                           @form
                                                                           event-search-log-form"/>

                                                    </div>


                                                    <div class="restrict-main-contents-io-button">
                                                        <p:commandLink id="textblock-manager-commandlink"
                                                                       value="Advanced search"
                                                                       type="button"
                                                                       update="event-search-advanced-dialog"
                                                                       oncomplete="PF('event-search-advanced-dialog-var').show()" />
                                                    </div>
                                                </div>

                                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">

                                                    <div class="restrict-data-field-label-inline" >

                                                        <p:outputLabel for="event-search-appendresults-chkbox">
                                                            <h:outputText value="Append results to list? "/>
                                                        </p:outputLabel>

                                                    </div>
                                                    <div class="restrict-data-field-value-inline" >
                                                        <p:selectBooleanCheckbox   id="event-search-appendresults-chkbox" 
                                                                                   value="#{eventsBB.appendResultsToList}" >
                                                            <p:ajax />
                                                        </p:selectBooleanCheckbox>
                                                    </div>
                                                </div>

                                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">

                                                  

                                                    <div class="restrict-main-contents-io-button gray_button">
                                                        <p:commandButton   id="event-search-loadhistory-button" 
                                                                           ajax="true" 
                                                                           actionListener="#{eventsBB.loadEventHistory}"
                                                                           icon="fa fa-clock-o" 
                                                                           styleClass="button"
                                                                           value="load event history" 
                                                                           update="event-list-panel
                                                                           form-messages-global"/>
                                                    </div>
                                                    <div class="restrict-main-contents-io-button gray_button">
                                                        <p:commandButton  value="help" 
                                                                          onclick="PF('helpdlg').show()" 
                                                                          styleClass="noFill button-float-right" 
                                                                          icon="fa fa-question-circle"/>    
                                                    </div>
                                                </div>
                                            </div>

                                        </h:form>

                                    </p:panel>

                                    <p:panel  id="event-search-log-panel"
                                              toggleable="true"
                                              widgetVar="event-search-log-panel-var"
                                              collapsed="false"
                                              style="width:100%;"
                                              header="Query log">

                                        <h:form id="event-search-log-form">
                                            <div class='search-query-desc'>
                                                <h:outputText id="event-search-log-ot" 
                                                              value="#{eventsBB.querySelected.queryLog}"
                                                              escape="false"/>
                                            </div>
                                        </h:form>
                                    </p:panel>


                                </div>

                                <div class="ui-g-12 ui-md-8 ui-lg-8 object-data-container">

                                    <p:panel    id="event-profile-panel"
                                                toggleable="true"
                                                widgetVar="event-profile-panel-var"
                                                collapsed="false"
                                                rendered="#{eventsBB.activeViewMode}"
                                                header="Event Info (ID:#{eventsBB.currentEvent.eventID}) | Created by #{!(empty eventsBB.currentEvent.userCreator) ? eventsBB.currentEvent.userCreator.person.lastName : ''} | last updated on #{eventsBB.getPrettyDate(eventsBB.currentEvent.lastUpdatedTS)} by #{!(empty eventsBB.currentEvent.lastUpdatedBy) ? eventsBB.currentEvent.lastUpdatedBy.person.lastName: ''}">

                                        <h:form id="event-profile-form">
                                            <div class="ui-g data_container_nested_restrict">

                                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field" >


                                                    <div class="restrict-data-field-label-inline" >
                                                        <p:outputLabel for="event-domain-ot">
                                                            <h:outputText value="Domain"/>
                                                        </p:outputLabel>

                                                    </div>

                                                    <div class="restrict-data-field-value-inline" >
                                                        <h:outputText id="event-domain-ot" 
                                                                      value="#{eventsBB.currentEvent.domain.title} "/>
                                                    </div>
                                                </div>

                                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field" >


                                                    <div class="restrict-data-field-label-inline" >
                                                        <p:outputLabel for="event-et-ot">
                                                            <h:outputText value="Type"/>
                                                        </p:outputLabel>

                                                    </div>

                                                    <div class="restrict-data-field-value-inline" >
                                                        <h:outputText id="event-et-ot" 
                                                                      value="#{eventsBB.currentEvent.category.eventType.label} "/>
                                                    </div>
                                                </div>
                                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field" >


                                                    <div class="restrict-data-field-label-inline" >
                                                        <p:outputLabel for="event-ec-ot">
                                                            <h:outputText value="Category"/>
                                                        </p:outputLabel>

                                                    </div>

                                                    <div class="restrict-data-field-value-inline" >
                                                        <h:outputText id="event-ec-ot" 
                                                                      value="#{eventsBB.currentEvent.category.eventCategoryTitle}"/>
                                                    </div>
                                                    <p:commandLink id="event-cat-details-cl" 
                                                                   disabled="false"
                                                                   type="button"
                                                                   value="details" />
                                                </div>



                                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field" >
                                                    <div class="restrict-data-field-label-inline" >
                                                        <p:outputLabel for="event-descr-ot">
                                                            <h:outputText value="Description:"/>
                                                        </p:outputLabel>

                                                    </div>
                                                    <div class="restrict-data-field-value-inline" >
                                                        <h:outputText id="event-descr-ot" 
                                                                      value="#{eventsBB.currentEvent.description}" />
                                                    </div>
                                                </div>
                                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field" >
                                                    <div class="restrict-data-field-label-inline" >
                                                        <p:outputLabel for="event-st-ot">
                                                            <h:outputText value="Start time"/>
                                                        </p:outputLabel>

                                                    </div>

                                                    <div class="restrict-data-field-value-inline" >

                                                        <h:outputText id="event-st-ot" 
                                                                      value="#{eventsBB.getPrettyDate(eventsBB.currentEvent.timeStart)}" />

                                                    </div>
                                                </div>
                                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field" >


                                                    <div class="restrict-data-field-label-inline" >
                                                        <p:outputLabel for="event-time-end-ot">
                                                            <h:outputText value="End time"/>
                                                        </p:outputLabel>

                                                    </div>


                                                    <div class="restrict-data-field-value-inline" >
                                                        <h:outputText id="event-time-end-ot" 
                                                                      value="#{eventsBB.getPrettyDate(eventsBB.currentEvent.timeEnd)}" />


                                                    </div>
                                                </div>


                                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field" >

                                                    <div class="restrict-data-field-label-inline" >
                                                        <p:outputLabel for="event-mintoview-ot">
                                                            <h:outputText value="Rank req. to view"/>
                                                        </p:outputLabel>

                                                    </div>

                                                    <div class="restrict-data-field-value-inline" >
                                                        <h:outputText id="event-mintoview-ot" 
                                                                      value="#{eventsBB.currentEvent.category.userRankMinimumToView}" />
                                                    </div>
                                                </div>

                                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field" >

                                                    <div class="restrict-data-field-label-inline" >
                                                        <p:outputLabel for="event-mintoupdate-ot">
                                                            <h:outputText value="Rank req. to update"/>
                                                        </p:outputLabel>

                                                    </div>

                                                    <div class="restrict-data-field-value-inline" >
                                                        <h:outputText id="event-mintoupdate-ot" 
                                                                      value="#{eventsBB.currentEvent.category.userRankMinimumToUpdate}" />
                                                    </div>
                                                </div>

                                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field" >

                                                    <div class="restrict-data-field-label-inline" >
                                                        <p:outputLabel for="event-active-ot">
                                                            <h:outputText value="Active"/>
                                                        </p:outputLabel>

                                                    </div>

                                                    <div class="restrict-data-field-value-inline" >
                                                        <h:outputText id="event-active-ot" 
                                                                      value="#{eventsBB.currentEvent.active ? 'Yes':'No'}" />
                                                    </div>
                                                </div>

                                            </div>
                                        </h:form>

                                    </p:panel>

                                    <p:overlayPanel id="event-cat-details-overlay"
                                                    for="event-profile-form:event-cat-details-cl "
                                                    widgetVar="event-cat-details-overlay-var" 
                                                    showEffect="fade" 
                                                    hideEffect="fade"
                                                    dismissable="true" 
                                                    showCloseIcon="true">



                                        <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field" >
                                            <div class="restrict-data-field-label-inline" >
                                                <p:outputLabel for="event-cd-ot">
                                                    <h:outputText value="Cateogry description:"/>
                                                </p:outputLabel>

                                            </div>

                                            <div class="restrict-data-field-value-inline" >
                                                <h:outputText id="event-cd-ot" 
                                                              value="#{eventsBB.currentEvent.category.eventCategoryDesc}" />
                                            </div>
                                        </div>
                                    </p:overlayPanel>

                                    <p:panel    id="event-add-panel"
                                                toggleable="true"
                                                widgetVar="event-add-panel-var"
                                                collapsed="false"
                                                rendered="#{eventsBB.activeInsertMode}"
                                                header="Create a new event">


                                        <h:form id="event-add-form">
                                            
                                            <div class="ui-g data_container_nested_restrict">

                                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">
                                                    <h:outputText id="event-add-header-domain"
                                                                  value="Attaching new event to #{!(empty eventsBB.eventDomainActive) ? eventsBB.eventDomainActive.title : ''} " />
                                                    <h:outputText id="event-add-header-id"
                                                                  value="Object ID #{!(empty eventsBB.currentERGBOb) ? eventsBB.currentERGBOb.BObID : ''} " />
                                                    <p:spacer height="5px" />
                                                    <h2><h:outputText id="event-add-currtypecat-type-ot"
                                                                      value="#{eventsBB.eventTypeSelected.label}"
                                                                      />
                                                        <h:outputText value=": " />
                                                        <h:outputText id="event-add-currtypecat-cat-ot"
                                                                       value="#{eventsBB.eventCategorySelected.eventCategoryTitle}" 
                                                                      />
                                                    </h2>
                                                    
                                                     <h:outputText id="selectedEventCategoryDescription"
                                                                      value="#{eventsBB.eventCategorySelected.eventCategoryDesc}" 
                                                                      />
                                                     <p:spacer height="4px" />
                                                            <p:commandLink id="event-add-cat-details-cl" 
                                                                   disabled="#{empty eventsBB.eventCategorySelected}"
                                                                   type="button"
                                                                   value="details" />
                                                </div>
                                                <div class="ui-g-12 ui-md-12 ui-lg-6 restrict-data-field">
                                                    <div class="restrict-main-contents-io-title" >
                                                        <h:outputLabel for="event-add-type-solb">
                                                            <h:outputText value="Type"/>
                                                        </h:outputLabel>
                                                    </div>

                                                    <div class="restrict-main-contents-io-content" >
                                                        <p:growl for="event-add-type-solb" />
                                                        <p:selectOneListbox id="event-add-type-solb" 
                                                                            required="true" 
                                                                            value="#{eventsBB.eventTypeSelected}" 
                                                                            tabindex="10">
                                                            <p:ajax listener="#{eventsBB.onEventTypeMunuChange}"
                                                                    update="categoryList
                                                                    event-add-dialog-show-cb
                                                                    event-add-currtypecat-type-ot" /> 
                                                            <f:selectItems value="#{eventsBB.eventTypeCandidates}" var="et" itemLabel="#{et.label}" />
                                                        </p:selectOneListbox>

                                                    </div>
                                                </div>


                                                <div class="ui-g-12 ui-md-12 ui-lg-6 restrict-data-field">
                                                    <div class="restrict-main-contents-io-title" >
                                                        <h:outputLabel for="event-add-cat-solb">
                                                            <h:outputText value="Category"/>
                                                        </h:outputLabel>
                                                    </div>

                                                    <div class="restrict-main-contents-io-content" >
                                                        <p:selectOneListbox style="width: 100%;" 
                                                                            id="categoryList" 
                                                                            value="#{eventsBB.eventCategorySelected}" 
                                                                            tabindex="11">
                                                            <p:ajax update="selectedEventCategoryDescription
                                                                    selectedEventCategoryDescription 
                                                                    event-add-cat-details-cl
                                                                    event-add-dialog-show-cb
                                                                    event-add-currtypecat-cat-ot
                                                                    event-add-time-start-cal
                                                                    event-add-time-end-cal
                                                                    event-add-descr-it
                                                                    event-add-duration-in
                                                                    event-add-time-end-cal
                                                                    " 
                                                                    listener="#{eventsBB.onEventCategoryMenuChange}"
                                                                    />
                                                            <f:converter converterId="eventCategoryConverter"/>
                                                            <f:selectItems  id="catItemsList" 
                                                                            value="#{eventsBB.eventCategoryCandidates}" 
                                                                            var="ec" 
                                                                            itemValue="#{ec}" 
                                                                            itemLabel="#{ec.eventCategoryTitle}"/>
                                                        </p:selectOneListbox>
                                                       
                                                    </div>
                                                    
                                                    <p:spacer height="5px" />
                                                    
                                                    <div class="restrict-main-contents-io-content" >
                                                        

                                                        <p:selectBooleanButton  id="event-add-updatefields-sbb" 
                                                                            onLabel="Update event values"
                                                                            onIcon="fa fa-indent"
                                                                            offLabel="Custom event values"
                                                                            offIcon="fa fa-eraser"
                                                                            value="#{eventsBB.updateNewEventFieldsWithCatChange}" 
                                                                            disabled="false" />

                                                    </div>
                                            
                                                    
                                                </div>

                                                <div class="ui-g-12 ui-md-12 ui-lg-4 restrict-data-field">

                                                    <div class="restrict-main-contents-io-title" >
                                                        <h:outputLabel for="event-add-time-start-cal">
                                                            <h:outputText value="Start time"/>
                                                        </h:outputLabel>
                                                    </div>

                                                    <div class="restrict-main-contents-io-content" >
                                                        <p:growl for="event-add-time-start-cal" />
                                                        <p:calendar value="#{eventsBB.currentEvent.timeStartUtilDate}" 
                                                                    id="event-add-time-start-cal"
                                                                    mode="popup"  
                                                                    showOn="button" 
                                                                    pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                                    navigator="true" tabindex="16" timeInput="true" showHour="true" showMinute="true" showSecond="false" showMillisec="false"
                                                                    showButtonPanel="true" 
                                                                    showTodayButton="true"
                                                                    required="true">
                                                            <p:ajax update="event-add-time-end-cal" 
                                                                    listener="#{eventsBB.onTimeStartChange}"/>
                                                        </p:calendar>
                                                    </div>
                                                </div>
                                                <div class="ui-g-12 ui-md-12 ui-lg-4 restrict-data-field">

                                                    <div class="restrict-main-contents-io-title" >
                                                        <h:outputLabel for="event-add-time-start-cal">
                                                            <h:outputText value="Duration"/>
                                                        </h:outputLabel>
                                                    </div>

                                                    <div class="restrict-main-contents-io-content" >
                                                        <p:inputNumber  id="event-add-duration-in"
                                                                        value="#{eventsBB.eventDurationFormField}"
                                                                        style="width: 50px;">
                                                            <p:ajax listener="#{eventsBB.onEventDurationChange}"
                                                                    update="event-add-time-end-cal" />
                                                        </p:inputNumber>
                                                                       
                                                       
                                                    </div>
                                                </div>

                                                <div class="ui-g-12 ui-md-12 ui-lg-4 restrict-data-field">
                                                    <div class="restrict-main-contents-io-title" >
                                                        <h:outputLabel for="event-add-time-end-cal">
                                                            <h:outputText value="End time"/>
                                                        </h:outputLabel>
                                                    </div>

                                                    <div class="restrict-main-contents-io-content" >
                                                        <p:growl for="event-add-time-end-cal" />
                                                        <p:calendar value="#{eventsBB.currentEvent.timeEndUtilDate}" 
                                                                    id="event-add-time-end-cal"
                                                                    mode="popup"  
                                                                    showOn="button" 
                                                                    disabled="true"
                                                                    pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                                    navigator="true" tabindex="16" timeInput="true" showHour="true" showMinute="true" showSecond="false" showMillisec="false"
                                                                    showButtonPanel="true" 
                                                                    showTodayButton="true"
                                                                    required="true"/>
                                                    </div>
                                                </div>
                                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">
                                                    <div class="restrict-main-contents-io-title" >
                                                        <h:outputLabel for="event-add-descr-it">
                                                            <h:outputText value="Description"/>
                                                        </h:outputLabel>
                                                    </div>

                                                    <div class="restrict-main-contents-io-content" >
                                                        <p:inputText  id="event-add-descr-it" 
                                                                      value="#{eventsBB.currentEvent.description}" 
                                                                      style="width: 100%;" 
                                                                      tabindex="3" 
                                                                      required="false" />
                                                    </div>
                                                </div>
                                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">
                                                    <div class="restrict-main-contents-io-title" >
                                                        <h:outputLabel for="event-add-descr">
                                                            <h:outputText value="Person connections"/>
                                                        </h:outputLabel>
                                                    </div>
                                                    <div class="restrict-main-contents-io-button gray_button">
                                                        <p:commandButton  value="Manage person connections" 
                                                                          onclick="PF('event-personchoose-dialog-var').show()" 
                                                                          update="event-personchoose-dialog"
                                                                          icon="fa fa-user"/>    
                                                    </div>
                                                    <div class="restrict-main-contents-io-content" >

                                                        <p:dataScroller
                                                            id="event-add-personlist"
                                                            value="#{eventsBB.currentEvent.personList}"
                                                            var="per" 
                                                            widgetVar="noticebuilder-pers-ds-var">

                                                            <h:outputText value="#{per.firstName} #{per.lastName} (ID:#{per.personID})"/>
                                                        </p:dataScroller>

                                                    </div>
                                                </div>

                                            </div>
                                            <div class="restrict-main-contents-io-button">


                                                <p:commandButton    id="event-add-dialog-show-cb"
                                                                    ajax="false" 
                                                                    action="#{eventsBB.onEventAddCommitButtonChange}" 
                                                                    disabled="#{empty eventsBB.eventCategorySelected}"
                                                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                                    value="Create new event "  
                                                                    icon="fa fa-bolt"/>
                                            </div>

                                        </h:form>
                                    </p:panel>


                                    <p:panel id="event-update-panel"
                                             toggleable="true"
                                             collapsed="false"
                                             header="Update event (ID:#{eventsBB.currentEvent.eventID}) | Created by #{!(empty eventsBB.currentEvent.userCreator) ? eventsBB.currentEvent.userCreator.person.lastName : ''} | last updated on #{eventsBB.getPrettyDate(eventsBB.currentEvent.lastUpdatedTS)} by #{!(empty eventsBB.currentEvent.lastUpdatedBy) ? eventsBB.currentEvent.lastUpdatedBy.person.lastName: ''}"
                                             rendered="#{eventsBB.activeUpdateMode}"
                                             >

                                        <h:form id="event-update-form">
                                            <p style="font-style:  italic;">Note: Event type and category cannot be updated. Instead, remove incorrect event and make a new one.</p>
                                            <div class="ui-g data_container_nested_restrict">

                                                <div class="ui-g-12 ui-md-12 ui-lg-4 restrict-data-field">

                                                    <div class="restrict-main-contents-io-title" >
                                                        <h:outputLabel for="event-update-time-start-cal">
                                                            <h:outputText value="Start time"/>
                                                        </h:outputLabel>
                                                    </div>

                                                    <div class="restrict-main-contents-io-content" >
                                                        <p:growl for="event-update-time-start-cal" />
                                                        <p:calendar value="#{eventsBB.currentEvent.timeStartUtilDate}" 
                                                                    id="event-update-time-start-cal"
                                                                    mode="popup"  
                                                                    showOn="button" 
                                                                    pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                                    navigator="true" tabindex="16" timeInput="true" showHour="true" showMinute="true" showSecond="false" showMillisec="false"
                                                                    showButtonPanel="true" 
                                                                    showTodayButton="true"
                                                                    required="true">
                                                            <p:ajax listener="#{eventsBB.onTimeStartChange()}"
                                                                    update="event-update-time-end-cal" />
                                                        </p:calendar>
                                                    </div>
                                                </div>
                                                
                                                 <div class="ui-g-12 ui-md-12 ui-lg-4 restrict-data-field">

                                                    <div class="restrict-main-contents-io-title" >
                                                        <h:outputLabel for="event-update-time-start-cal">
                                                            <h:outputText value="Duration"/>
                                                        </h:outputLabel>
                                                    </div>

                                                    <div class="restrict-main-contents-io-content" >
                                                        <p:inputNumber  id="event-update-duration-in"
                                                                        value="#{eventsBB.eventDurationFormField}"
                                                                        style="width: 50px;">
                                                            <p:ajax listener="#{eventsBB.onEventDurationChange}"
                                                                    update="event-update-time-end-cal" />
                                                        </p:inputNumber>
                                                                       
                                                       
                                                    </div>
                                                </div>

                                                <div class="ui-g-12 ui-md-12 ui-lg-4 restrict-data-field">
                                                    <div class="restrict-main-contents-io-title" >
                                                        <h:outputLabel for="event-update-time-end-cal">
                                                            <h:outputText value="End time"/>
                                                        </h:outputLabel>
                                                    </div>

                                                    <div class="restrict-main-contents-io-content" >
                                                        <p:growl for="event-update-time-end-cal" />
                                                        <p:calendar value="#{eventsBB.currentEvent.timeEndUtilDate}" 
                                                                    id="event-update-time-end-cal"
                                                                    mode="popup"  
                                                                    disabled="true"
                                                                    showOn="button" 
                                                                    pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                                    navigator="true" tabindex="16" timeInput="true" showHour="true" showMinute="true" showSecond="false" showMillisec="false"
                                                                    showButtonPanel="true" 
                                                                    showTodayButton="true"
                                                                    required="true"/>
                                                    </div>
                                                </div>
                                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">
                                                    <div class="restrict-main-contents-io-title" >
                                                        <h:outputLabel for="event-update-descr">
                                                            <h:outputText value="Description"/>
                                                        </h:outputLabel>
                                                    </div>

                                                    <div class="restrict-main-contents-io-content" >
                                                        <p:inputText  id="eventDesc" 
                                                                      value="#{eventsBB.currentEvent.description}" 
                                                                      style="width: 100%;" 
                                                                      tabindex="3" 
                                                                      required="false" />
                                                    </div>
                                                </div>

                                                <div class="restrict-main-contents-io-button">

                                                    <p:commandButton    id="event-update-dialog-show-cb"
                                                                        ajax="false" 
                                                                        action="#{eventsBB.onEventUpdateCommitButtonChange}" 
                                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                                        value="Save edits"  
                                                                        icon="fa fa-edit"/>
                                                </div>
                                            </div>

                                        </h:form>


                                    </p:panel>



                                    <!--Remove Panel-->
                                    <p:panel id="event-remove-panel"
                                             toggleable="true"
                                             collapsed="false"
                                             header="Remove Event"
                                             rendered="#{eventsBB.activeRemoveMode}"
                                             >

                                        <h:form id="event-remove-form">

                                            <div class="ui-g data_container_nested_restrict">
                                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field" >
                                                    <div class="restrict-data-field-label-inline" >
                                                        <h:outputLabel  for="event-remove-button">
                                                            <h:outputText value="Removed events can only be rescued by sys admins." />
                                                        </h:outputLabel>
                                                    </div>
                                                </div>
                                                <div class="restrict-main-contents-io-button red_button">


                                                    <p:commandButton ajax="false" action="#{eventsBB.onEventRemoveCommitButtonChange}"
                                                                     value="Nuke event" icon="fa fa-bomb"
                                                                     rendered="#{eventsBB.currentEvent.category.userRankMinimumToUpdate le systemServicesBB.bbSessionUser.role.rank}"
                                                                     />
                                                </div>
                                            </div>

                                        </h:form>

                                    </p:panel>


                                    <p:panel id="event-notes-panel"
                                             toggleable="true"
                                             collapsed="false"
                                             header="Notes"
                                             rendered="#{eventsBB.activeViewMode}"
                                             >

                                        <h:form id="event-notes-form">

                                            <p:commandButton   id="event-notes-add-button"
                                                               rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                               value="Add New Note"  
                                                               icon="fa fa-sticky-note-o"
                                                               actionListener="#{eventsBB.onNoteInitButtonChange}"
                                                               oncomplete="PF('event-note-dialog-var').show()"
                                                               update="event-note-form"/>

                                            <h:outputText id="event-note-ot"
                                                          value="#{eventsBB.currentEvent.notes}"
                                                          escape="false" />

                                        </h:form>

                                    </p:panel>

                                </div>
                            </div>
                        </div>

                    </p:outputPanel>



                    <p:dialog   id="event-note-dialog"
                                height="300" width="750"
                                widgetVar="event-note-dialog-var"
                                closable="true"
                                header="Note Builder"
                                rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                >

                        <h:form id="event-note-form">
                            <h:outputText styleClass="ui-label" value="Note text: "/>
                            <p:editor   id="event-notes-editor"
                                        value="#{eventsBB.formNoteText}"
                                        controls="bold italic underline strikethrough font size style color
                                        bullets numbering center undo redo rule link removeformat"
                                        width="400" required="false"
                                        height="200"/>


                            <p:commandButton    id="event-note-button-cancel"
                                                ajax="true" 
                                                tabindex="27"
                                                value="Cancel"
                                                icon="fa fa-stop"
                                                immediate="true"
                                                onclick="PF('event-note-dialog-var').hide()"
                                                />

                            <p:commandButton   id="event-dialog-notes-button-addnote"
                                               ajax="false" 
                                               actionListener="#{eventsBB.onNoteCommitButtonChange}"
                                               oncomplete="PF('event-note-dialog-var').hide()"
                                               rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"                                                                               
                                               value="Attach Note"  
                                               styleClass="inline-button"
                                               icon="fa fa-sticky-note-o"
                                               update="event-notes-form"/>
                        </h:form>
                    </p:dialog>


                    <p:dialog   id="event-personchoose-dialog"
                                height="300" width="750"
                                widgetVar="event-personchoose-dialog-var"
                                closable="true"
                                header="Choose persons to connect to this event"
                                rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                >


                        <h:form id="event-person-form">

                            <div class="ui-g data_container_nested_restrict">

                                <div class="ui-g-12 ui-md-8 ui-lg-8 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel id="person-list-menu-ol" 
                                                       for="person-list-menu" 
                                                       value="Current person list:"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >

                                        <p:selectOneMenu id="person-list-menu" required="false" value="#{eventsBB.personSelected}">
                                            <f:selectItem itemLabel="select a person..." noSelectionOption="true" />
                                            <f:selectItems value="#{systemServicesBB.bbSessionPersonList}"  var="p" itemValue="#{p}" 
                                                           itemLabel="#{p.firstName} #{p.lastName} (id:#{p.personID})"/>
                                            <f:converter converterId="personConverter"/>
                                        </p:selectOneMenu>
                                        <h:message for="person-list-menu" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </div>
                                </div>
                                <div class="ui-g-12 ui-md-4 ui-lg-4 restrict-data-field">
                                    <div class="restrict-main-contents-io-button">   


                                        <p:commandButton    ajax="true" actionListener="#{eventsBB.queueSelectedPerson}"
                                                            value="Add selected person to event" disabled="true"
                                                            update="person-scroller"/>
                                    </div>

                                </div>
                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">

                                    <h2>Option 2: Manual person lookup</h2>

                                    <p>If you wish to send the letter to a person not on the list above, 
                                        enter the Person's ID number in the box below and click "Look Up Person". 
                                        You can open the Persons's search page by "right-clicking" the link to "Persons" 
                                        on the left side bar and opening that page in its own browser tab.</p>

                                    <p>You can also go and find a person in the Person search tool, view a person of interest, and then return to this page. The person will appear in the session list above
                                        <h:commandLink  class="bold" target="_blank" action="persons" value="Open person search in new tab ---> "/>
                                    </p>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <h:outputLabel for="personIDIT" value="Person ID Number: "/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >

                                        <p:inputText id="personIDIT" value="#{eventsBB.personIDForLookup}"/>
                                        <p:spacer height="5px" />
                                        <p:commandButton id="event-add-lookupperson-button" 
                                                         value="Look up person" 
                                                         actionListener="#{eventsBB.onPersonLookupByIDButtonChange}" 
                                                         ajax="true" 
                                                         immediate="true"
                                                         update="form-messages-global
                                                         person-scroller"/>
                                    </div>
                                </div>
                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">
                                    <p:dataScroller
                                        id="person-scroller"
                                        value="#{eventsBB.personCandidates}"
                                        var="per" 
                                        widgetVar="noticebuilder-pers-ds-var">

                                        <h:outputText value="#{per.firstName} #{per.lastName}"/>
                                        <p:spacer height="5px"/>

                                        <p:commandButton id="use-person-from-lookup-cb2"
                                                         rendered="#{eventsBB.currentNotice.noticeID==0}"
                                                         ajax="true"
                                                         value="Select"
                                                         actionListener="#{eventsBB.storeRecipient(per)}" 
                                                         oncomplete="PF('event-personchoose-dialog-var').hide()."
                                                         update="event-lookupperson-table
                                                         "
                                                         />
                                    </p:dataScroller>


                                </div>

                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">



                                    <p:dataTable
                                        id="event-lookupperson-table"
                                        var="person"
                                        rowKey="#{person.personID}"
                                        value="#{eventsBB.currentEvent.personList}"
                                        tableStyleClass="primeDataTable"
                                        expandedRow="false"
                                        rowExpandMode="single"
                                        rowIndexVar="rowIndex">


                                        <p:column width="5%">
                                            <p:rowToggler />
                                        </p:column>
                                        <p:column width="50%">
                                            <f:facet name="header">
                                                <h:outputText value="Last" />
                                            </f:facet>
                                            <h:outputText value="#{person.firstName}"/>
                                            <h:outputText value=" "/>
                                            <h:outputText value="#{person.lastName}"/>
                                            <h:outputText value="(ID: #{person.personID})"/>
                                            <p:spacer height="2px" />
                                            <h:outputText value="#{person.addressStreet}"/>
                                            <p:spacer height="2px" />
                                            <h:outputText value="#{person.addressCity}"/>
                                            <h:outputText value=" "/>
                                            <h:outputText value="#{person.addressState}"/>
                                            <h:outputText value=", "/>
                                            <h:outputText value="#{person.addressZip}"/>
                                        </p:column>
                                        <p:column width="8%">
                                            <f:facet name="header">
                                                <h:outputText value="Person Type" />
                                            </f:facet>
                                            <h:outputText value="#{person.personType.label}"/>
                                        </p:column>
                                        <p:column width="15%">
                                            <f:facet name="header">
                                                <h:outputText value="Municipality" />
                                            </f:facet>
                                            <h:outputText value="#{person.muniName}"/>
                                        </p:column>


                                        <p:rowExpansion>
                                            <div class="outlinedBox">
                                                <h2><h:outputText value="#{person.firstName} #{person.lastName}"/>, Person ID:<h:outputText value="#{person.personID}"/> </h2>
                                                <h:panelGrid columns="2" cellpadding="10" footerClass="gridFooter"
                                                             columnClasses="gridTd, gridTd, gridTd, gridTd">
                                                    <h:panelGroup>
                                                        <h:outputLabel styleClass="bold" value="Person Type: "/>
                                                        <h:outputText value="#{person.personType.label}"/>

                                                        <p:spacer height="5px"/>

                                                        <h:outputLabel styleClass="bold" value="Job Title: "/>
                                                        <h:outputText value="#{person.jobTitle}"/>

                                                        <p:spacer height="5px"/>

                                                        <h:outputLabel styleClass="bold" value="Email: "/>
                                                        <h:outputText value="#{person.email}"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputLabel styleClass="bold" value="Last Updated: "/>
                                                        <h:outputText value="#{person.lastUpdatedPretty}"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputLabel styleClass="bold" value="Address: "/>
                                                        <p:spacer height="5px"/>
                                                        <h:outputText escape="false" value="#{person.addressStreet}"/>
                                                        <p:spacer height="5px"/>
                                                        <h:outputText value="#{person.addressCity}, #{person.addressState} #{person.addressZip}"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputLabel styleClass="bold" value="Use separate mailing address?"/>
                                                        <h:outputText value="#{person.useSeparateMailingAddress ? 'Yes':'No'}"/>
                                                        <p:spacer height="5px"/>
                                                        <h:outputText escape="false" value="#{person.mailingAddressStreet}"/>
                                                        <p:spacer height="5px"/>
                                                        <h:outputText value="#{person.mailingAddressCity}, #{person.mailingAddressState} #{person.mailingAddressZip}"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputLabel styleClass="bold" value="Under 18? "/>
                                                        <h:outputText value="#{person.under18 ? 'Yes':'No'}"/>

                                                        <p:spacer height="5px"/>

                                                        <h:outputLabel styleClass="bold" value="Active? "/>
                                                        <h:outputText value="#{person.active ? 'Yes':'No'}"/>

                                                        <p:spacer height="5px"/>

                                                        <h:outputLabel styleClass="bold" value="Composite last name? "/>
                                                        <h:outputText value="#{person.compositeLastName? 'Yes':'No'}"/>
                                                    </h:panelGroup>


                                                    <h:panelGroup>
                                                        <h:outputLabel styleClass="bold" value="Allowed to expire? "/>
                                                        <h:outputText value="#{person.canExpire ? 'Yes':'No'}"/>
                                                        <p:spacer height="5px"/>

                                                        <h:outputLabel styleClass="bold" value="Expires: "/>
                                                        <h:outputText value="#{person.expireString}"/>

                                                        <p:spacer height="5px"/>
                                                        <h:outputLabel styleClass="bold" value="Expiry Notes: "/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{person.expiryNotes}"/>
                                                        </div>

                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputLabel styleClass="bold" value="Phone(h): "/>
                                                        <h:outputText value="#{person.phoneHome}"/>
                                                        <p:spacer height="5px"/>

                                                        <h:outputLabel styleClass="bold" value="Phone(w): "/>
                                                        <h:outputText value="#{person.phoneWork}"/>
                                                        <p:spacer height="5px"/>

                                                        <h:outputLabel styleClass="bold" value="Phone(m): "/>
                                                        <h:outputText value="#{person.phoneCell}"/>
                                                    </h:panelGroup>
                                                    <h:panelGroup>
                                                        <h:outputLabel styleClass="bold" value="Linked to user? "/>
                                                        <h:outputText value="#{person.linkedUserID == 0 ? 'No':'Yes'}"/>
                                                        <p:spacer height="5px"/>

                                                    </h:panelGroup>
                                                </h:panelGrid>
                                            </div>
                                        </p:rowExpansion>
                                    </p:dataTable>


                                </div>

                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">
                                    <div class="restrict-main-contents-io-button gray_button">   

                                        <p:commandButton ajax="true" 
                                                         value="Cancel" icon="fa fa-stop" 
                                                         onclick="PF('event-personchoose-dialog-var').hide()"/>
                                    </div>
                                    <div class="restrict-main-contents-io-button">   

                                        <p:commandButton actionListener="#{eventsBB.onPersonListCommitButtonChange}"
                                                         ajax="true" 
                                                         value="Save person list" 
                                                         icon="fa fa-edit"
                                                         oncomplete="PF('event-personchoose-dialog-var').hide()"
                                                         disabled="#{!(eventsBB.currentEvent.eventID == 0)}"
                                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                         update="event-update-panel
                                                         event-add-panel"/>

                                    </div>
                                </div>
                            </div>

                        </h:form>
                    </p:dialog>


                    <p:dialog   id="event-search-advanced-dialog"
                                height="300" width="750"
                                widgetVar="event-search-advanced-dialog-var"
                                closable="true"
                                header="Advanced search"
                                rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                >
                        <h:form id="event-search-advanced-form">


                            <div class="ui-g data_container_nested_restrict">


                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel id="event-filter-muni-ol" 
                                                       for="seev-filter-muni-chkbx" 
                                                       value="filter by municipality "/>

                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:selectBooleanCheckbox id="seev-filter-muni-chkbx" value="#{eventsBB.searchParamsSelected.muni_ctl}" >
                                            <p:ajax update="event-search-muni-som"/>
                                        </p:selectBooleanCheckbox>

                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">

                                    <div class="restrict-main-contents-io-content" >
                                        <p:selectOneMenu id="event-search-muni-som" tabindex="1" value="#{eventsBB.searchParamsSelected.muni_val}"
                                                         disabled="#{!eventsBB.searchParamsSelected.muni_ctl}">
                                            <f:converter converterId="muniConverter"/>
                                            <f:selectItem itemLabel="select municipality..." noSelectionOption="true" itemDisabled="true"/>
                                            <f:selectItems id="muniNameList" value="#{systemServicesBB.municipalityListForSearch}" var="m" itemValue="#{m}" itemLabel="#{m.muniName}" />
                                        </p:selectOneMenu>

                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">

                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel id="event-search-startend-chkbx-ol" 
                                                       for="event-search-startend-chkbx" 
                                                       value="filter by date range "/>

                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:selectBooleanCheckbox id="event-search-startend-chkbx" 
                                                                 value="#{eventsBB.searchParamsSelected.date_startEnd_ctl}" >
                                            <p:ajax update="event-search-date-field-val
                                                    event-search-date-start-val
                                                    event-search-date-end-val
                                                    event-search-date-relative-ctl" />
                                        </p:selectBooleanCheckbox>

                                    </div>
                                </div>
                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">

                                    <div class="restrict-main-contents-io-content" >

                                        <p:selectOneMenu  id="event-search-date-field-val" 
                                                          tabindex="1" 
                                                          value="#{eventsBB.searchParamsSelected.date_field}"
                                                          disabled="#{!eventsBB.searchParamsSelected.date_startEnd_ctl}">
                                            <f:selectItem itemLabel="select a date field..." 
                                                          noSelectionOption="true" 
                                                          itemDisabled="true"/>
                                            <f:selectItems id="event-search-date-field-val-items" 
                                                           value="#{eventsBB.searchParamsSelected.dateFieldList}" 
                                                           var="f" itemValue="#{f}" itemLabel="#{f.title}" />
                                        </p:selectOneMenu>

                                    </div>
                                </div>
                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >

                                        <p:outputLabel for="event-search-date-start-val" 
                                                       value="start date"/>

                                    </div>

                                    <div class="restrict-main-contents-io-content" >

                                        <p:calendar id="event-search-date-start-val" 
                                                    value="#{eventsBB.searchParamsSelected.startDate_val_utilDate}" 
                                                    disabled="#{(!eventsBB.searchParamsSelected.date_startEnd_ctl) or eventsBB.searchParamsSelected.date_relativeDates_ctl}"
                                                    mode="popup" 
                                                    showOn="button" 
                                                    pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                    navigator="true" 
                                                    tabindex="16" 
                                                    timeInput="true" 
                                                    showHour="true" showMinute="false" showSecond="false" showMillisec="false"
                                                    showButtonPanel="true" 
                                                    showTodayButton="true"
                                                    required="false"/>
                                        <h:message for="event-search-date-start-val" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    </div>
                                </div>
                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >

                                        <p:outputLabel for="event-search-date-end-val" 
                                                       value="end date"/>

                                    </div>

                                    <div class="restrict-main-contents-io-content" >


                                        <p:calendar id="event-search-date-end-val" 
                                                    value="#{eventsBB.searchParamsSelected.endDate_val_utilDate}" 
                                                    disabled="#{(!eventsBB.searchParamsSelected.date_startEnd_ctl) or eventsBB.searchParamsSelected.date_relativeDates_ctl}"
                                                    mode="popup" 
                                                    showOn="button" 
                                                    pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                    navigator="true" 
                                                    tabindex="16" 
                                                    timeInput="true" 
                                                    showHour="true" showMinute="false" showSecond="false" showMillisec="false"
                                                    showButtonPanel="true" 
                                                    showTodayButton="true"
                                                    required="false"/>
                                        <h:message for="event-search-date-end-val" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >

                                        <p:outputLabel for="event-search-date-relative-ctl" 
                                                       value="Relative dates"
                                                       styleClass="datum-label"/>

                                    </div>

                                    <div class="restrict-main-contents-io-content" >

                                        <p:selectBooleanCheckbox id="event-search-date-relative-ctl" 
                                                                 value="#{eventsBB.searchParamsSelected.date_relativeDates_ctl}" 
                                                                 disabled="#{!eventsBB.searchParamsSelected.date_startEnd_ctl}">
                                            <p:ajax update="event-search-date-end-val
                                                    event-search-date-start-val
                                                    event-search-date-end-val
                                                    event-search-date-relative-start-val
                                                    event-search-date-relative-end-val" />
                                        </p:selectBooleanCheckbox>
                                    </div>
                                </div>


                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel for="event-search-date-relative-start-val" 
                                                       value="start x days from today"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:inputText id="event-search-date-relative-start-val" 
                                                     value="#{eventsBB.searchParamsSelected.date_relativeDates_start_val}" 
                                                     disabled="#{!(eventsBB.searchParamsSelected.date_startEnd_ctl and eventsBB.searchParamsSelected.date_relativeDates_ctl)}" />
                                        <h:message for="event-search-date-relative-start-val" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    </div>
                                </div>


                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel for="event-search-date-relative-end-val" 
                                                       value="end x days from today"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:inputText id="event-search-date-relative-end-val" 
                                                     value="#{eventsBB.searchParamsSelected.date_realtiveDates_end_val}" 
                                                     disabled="#{!(eventsBB.searchParamsSelected.date_startEnd_ctl and eventsBB.searchParamsSelected.date_relativeDates_ctl)}" />
                                        <h:message for="event-search-date-relative-end-val" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    </div>
                                </div>


                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >

                                        <p:outputLabel for="event-search-filter-id-ctl" 
                                                       value="filter by event id"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >

                                        <p:selectBooleanCheckbox id="event-search-filter-id-ctl" 
                                                                 value="#{eventsBB.searchParamsSelected.bobID_ctl}"
                                                                 disabled="false">
                                            <p:ajax update="event-search-filter-id-val" />
                                        </p:selectBooleanCheckbox>

                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel for="event-search-filter-id-val" 
                                                       value="id:" />
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:inputText id="event-search-filter-id-val"
                                                     type="number"
                                                     value="#{eventsBB.searchParamsSelected.bobID_val}"
                                                     disabled="#{!eventsBB.searchParamsSelected.bobID_ctl}"/>

                                        <h:message for="event-search-filter-id-val" showDetail="false" showSummary="true"
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel for="event-search-filter-user-ctl" 
                                                       value="User filter"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >



                                        <p:selectBooleanCheckbox id="event-search-filter-user-ctl" 
                                                                 value="#{eventsBB.searchParamsSelected.user_ctl}"
                                                                 disabled="#{!(eventsBB.searchParamsSelected.user_rtMin.rank lt systemServicesBB.bbSessionUser.keyCard.governingAuthPeriod.role.rank)}">
                                            <p:ajax update="event-search-filter-user-som
                                                    event-search-user-field-val" />
                                        </p:selectBooleanCheckbox>

                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:selectOneMenu  id="event-search-user-field-val" 
                                                          tabindex="1" 
                                                          value="#{eventsBB.searchParamsSelected.user_field}"
                                                          disabled="#{!eventsBB.searchParamsSelected.user_ctl}">
                                            <f:selectItem itemLabel="select a user field..." 
                                                          noSelectionOption="true" 
                                                          itemDisabled="true"/>
                                            <f:selectItems id="event-search-user-field-val-items" 
                                                           value="#{eventsBB.searchParamsSelected.userFieldList}" 
                                                           var="uf" itemValue="#{uf}" itemLabel="#{uf.title}" />
                                        </p:selectOneMenu>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:selectOneMenu id="event-search-filter-user-som" required="false" 
                                                         value="#{eventsBB.searchParamsSelected.user_val}"
                                                         disabled="#{!eventsBB.searchParamsSelected.user_ctl}">
                                            <f:selectItem itemLabel="select a user..." noSelectionOption="true" />
                                            <f:selectItems value="#{systemServicesBB.userListForSearch}"  var="u" itemValue="#{u}" 
                                                           itemLabel="#{u.person.firstName} #{u.person.lastName} (id:#{u.username})"/>
                                            <f:converter converterId="userConverter"/>
                                        </p:selectOneMenu>

                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel for="event-search-filter-domain-ctl" 
                                                       value="User filter"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >


                                        <p:selectBooleanCheckbox id="event-search-filter-domain-ctl" 
                                                                 value="#{eventsBB.searchParamsSelected.eventDomain_ctl}"
                                                                 disabled="#{!(eventsBB.searchParamsSelected.user_rtMin.rank lt systemServicesBB.bbSessionUser.keyCard.governingAuthPeriod.role.rank)}">
                                            <p:ajax update="event-search-filter-domain-val" />
                                        </p:selectBooleanCheckbox>

                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">

                                    <div class="restrict-main-contents-io-content" >

                                        <p:selectOneMenu  id="event-search-filter-domain-val" 
                                                          tabindex="1" 
                                                          value="#{eventsBB.searchParamsSelected.eventDomain_val}"
                                                          disabled="#{!eventsBB.searchParamsSelected.eventDomain_ctl}">
                                            <f:selectItem itemLabel="select an event domain..." 
                                                          noSelectionOption="true" 
                                                          itemDisabled="true"/>
                                            <f:selectItems id="event-search-filter-domain-items" 
                                                           value="#{eventsBB.searchParamsSelected.eventDomainList}" 
                                                           var="ed" itemValue="#{ed}" itemLabel="#{ed.title}" />
                                            <f:converter converterId="eventDomainConverter" />
                                        </p:selectOneMenu>
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel id="event-filter-property-ol" 
                                                       for="event-filter-property" 
                                                       value="filter by property "/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >

                                        <p:selectBooleanCheckbox id="event-filter-property" value="#{eventsBB.searchParamsSelected.property_ctl}" >
                                            <p:ajax update="event-criteria-property-som" />
                                        </p:selectBooleanCheckbox>

                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                    </div>

                                    <div class="restrict-main-contents-io-content" >

                                        <p:selectOneMenu id="event-criteria-property-som" required="false" 
                                                         value="#{eventsBB.searchParamsSelected.property_val}"
                                                         disabled="#{!eventsBB.searchParamsSelected.property_ctl}">

                                            <f:selectItem itemLabel="select a propery..." noSelectionOption="true" />
                                            <f:selectItems value="#{systemServicesBB.propertyListForSearch}"  var="prop" itemValue="#{prop}" 
                                                           itemLabel="#{prop.address} (#{prop.muni.muniName})"/>
                                            <f:converter converterId="propertyConverter"/>

                                        </p:selectOneMenu>
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel for="event-search-filter-usetype-ctl" 
                                                       value="Property use type filter"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:selectBooleanCheckbox id="event-search-filter-usetype-ctl" 
                                                                 value="#{eventsBB.searchParamsSelected.propertyUseType_ctl}"
                                                                 disabled="false">
                                            <p:ajax update="event-search-filter-usetype-val" />
                                        </p:selectBooleanCheckbox>
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:selectOneMenu    id="event-search-filter-usetype-val" 
                                                            tabindex="1" 
                                                            value="#{eventsBB.searchParamsSelected.propertyUseType_val}" 
                                                            disabled="#{!eventsBB.searchParamsSelected.propertyUseType_ctl}">
                                            <f:selectItem   itemLabel="select a use type..." noSelectionOption="true" itemDisabled="true"/>
                                            <f:selectItems  id="event-search-filter-usetype-items" 
                                                            value="#{eventsBB.propUseTypeList}" 
                                                            var="put" itemValue="#{put}" itemLabel="#{put.name}" />
                                            <f:converter    converterId="propertyUseTypeConverter"/>
                                        </p:selectOneMenu>
                                        <h:message for="event-search-filter-usetype-val" showDetail="true" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel id="event-filter-person-ol" 
                                                       for="event-criteria-person-val" 
                                                       value="filter by person"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >



                                        <p:selectBooleanCheckbox id="event-filter-person-ctl" 
                                                                 value="#{eventsBB.searchParamsSelected.person_ctl}" >
                                            <p:ajax update="event-criteria-person-val" />
                                        </p:selectBooleanCheckbox>
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:selectOneMenu id="event-criteria-person-val" required="false" 
                                                         value="#{eventsBB.searchParamsSelected.person_val}"
                                                         disabled="#{!eventsBB.searchParamsSelected.person_ctl}">

                                            <f:selectItem itemLabel="select a person..." noSelectionOption="true" />
                                            <f:selectItems value="#{systemServicesBB.personListForSearch}"  var="p" itemValue="#{p}" 
                                                           itemLabel="#{p.firstName} #{p.lastName} (ID:#{p.personID})"/>
                                            <f:converter converterId="personConverter"/>

                                        </p:selectOneMenu>
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >

                                        <p:outputLabel for="event-search-filter-active-ctl" 
                                                       value="filter by active"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:selectBooleanCheckbox id="event-search-filter-active-ctl" 
                                                                 value="#{eventsBB.searchParamsSelected.active_ctl}"
                                                                 disabled="false">
                                            <p:ajax update="event-search-filter-active-val" />
                                        </p:selectBooleanCheckbox>
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel for="event-search-filter-active-val" 
                                                       value="is active"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:selectBooleanCheckbox id="event-search-filter-active-val" 
                                                                 value="#{eventsBB.searchParamsSelected.active_val}"
                                                                 disabled="#{!eventsBB.searchParamsSelected.active_ctl}">
                                        </p:selectBooleanCheckbox>
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel id="event-query-limit-ol" 
                                                       for="event-query-limit" 
                                                       value="limit results"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:selectBooleanCheckbox id="event-query-limit" 
                                                                 value="#{eventsBB.searchParamsSelected.limitResultCount_ctl}" />

                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:inputText id="event-filter-limit-it"
                                                     type="number"
                                                     value="#{eventsBB.searchParamsSelected.limitResultCount_val}"
                                                     disabled="#{!eventsBB.searchParamsSelected.limitResultCount_ctl}"/>
                                        <h:message for="event-filter-limit-it" showDetail="false" showSummary="true"
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel id="seev-filter-type-ol" for="seev-filter-type" value="filter by event type"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >

                                        <p:selectBooleanCheckbox id="seev-filter-type" 
                                                                 value="#{eventsBB.searchParamsSelected.eventType_ctl}">
                                            <p:ajax update="ceev-critera-type" />
                                        </p:selectBooleanCheckbox>

                                    </div>
                                </div>
                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >

                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:selectOneMenu id="ceev-critera-type" required="false" 
                                                         value="#{eventsBB.searchParamsSelected.eventType_val}" tabindex="10"
                                                         disabled="#{!eventsBB.searchParamsSelected.eventType_ctl}">
                                            <f:selectItem itemLabel="select an event type..." noSelectionOption="true" />
                                            <p:ajax update="ceev-criteria-cat" immediate="true"/> 
                                            <f:selectItems value="#{eventsBB.eventTypesList}"/>
                                        </p:selectOneMenu>
                                        <h:message for="ceev-critera-type" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </div>
                                </div>
                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <p:outputLabel id="ceev-filter-cat-ol" for="ceev-filter-cat" value="filter by event category "/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >

                                        <p:selectBooleanCheckbox id="ceev-filter-cat" value="#{eventsBB.searchParamsSelected.eventCat_ctl}">
                                            <p:ajax update="ceev-criteria-cat" />
                                        </p:selectBooleanCheckbox>
                                    </div>
                                </div>
                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                    <div class="restrict-main-contents-io-title" >
                                        <h:outputLabel for="ceev-criteria-cat" id="ceev-criteria-cat-ol">
                                            <h:outputText value="event Categories in selected event type:"/>
                                        </h:outputLabel>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:selectOneMenu id="ceev-criteria-cat" style="width: 300px;" 
                                                         value="#{eventsBB.searchParamsSelected.eventCat_val}" tabindex="10"
                                                         disabled="#{!eventsBB.searchParamsSelected.eventCat_ctl}">
                                            <f:selectItem itemLabel="select an event category..." noSelectionOption="true" />
                                            <f:converter converterId="eventCategoryConverter"/>
                                            <f:selectItems  id="catItemsList" value="#{eventsBB.eventCatList}" var="ec" itemValue="#{ec}" itemLabel="#{ec.eventCategoryTitle}"/>
                                        </p:selectOneMenu>
                                        <h:message for="ceev-criteria-cat" showDetail="false" showSummary="true"  
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">
                                    <div class="restrict-main-contents-io-button gray_button">

                                        <p:commandButton ajax="true" 
                                                         immediate="true"
                                                         process="@none"
                                                         value="Cancel" 
                                                         icon="fa fa-stop" 
                                                         onclick="PF('event-search-advanced-dialog-var').hide()"/>
                                    </div>

                                    <div class="restrict-main-contents-io-button">
                                        <p:commandButton    id="execute-selected-query" 
                                                            ajax="true"
                                                            value="perform selected query" 
                                                            actionListener="#{eventsBB.runQuery}"
                                                            disabled="#{eventsBB.querySelected.queryExecuted}"
                                                            icon="fa fa-flash"
                                                            oncomplete="PF('event-search-advanced-dialog-var').hide()"
                                                            update="event-settings-panel
                                                            event-list-panel
                                                            form-messages-global
                                                            event-search-log-form
                                                            "/>
                                    </div>
                                </div>
                            </div>

                        </h:form>

                    </p:dialog>


                    <p:dialog header="Building activity reports" 
                              widgetVar="helpdlg"
                              responsive="true"
                              width="80%">
                        <h1>Steps to building an activity report:</h1>
                        <h2>1. Choose a pre-built query</h2>

                        <p>Events are selected from the database through a query, which is made up of many parameters
                            (i.e. criteria) which define which events to retrieve. A set of pre-made queries are designed
                            to speed up the reporting process. Browse those pre-built queries with the drop-down box and then click
                            "perform selected query" to see the results. </p>


                        <p>The list view is more compact and reflects what is printed in event reports. The data table view contains exactly the same
                            <br /> events but with more complete info for in-depth analysis.</p>


                        <h2>2. Trim your event list by hiding events</h2>

                        <p>After performing the query, hide any unwanted events from the results using the 
                            "hide event" button with the moon icon located on the right side of each event's display box.
                            A hidden event is not displayed in your final report, but is still attached to the code enforcement case
                            and can be viewed in the case's event history.</p>

                        <p>NOTE: Hiding an event on this page for report generation ALSO hides the event when viewing the event history 
                            for that event's respective case. You can always un-hide an event by toggling the "view hidden events" switch
                            underneath the event history table in the case manager. </p>

                        <h2>3. Customize your query</h2>
                        <p>Expand the search options to customize your query. The query controls are automatically updated to match 
                            the pre-built queries in the drop-down list above, allowing you to start with the settings associated with
                            a pre-built query and then tune the results to fit your needs.</p>

                        <p>For example, pre-built queries are pre-set to useful date ranges for searching, such as events that occurred in
                            the past month or events about to occur in the next week. By first performing a pre-built query which produces 
                            events you're interested in but over undesirable date range, you can just change the specified date range in the
                            customized query parameters to arrive at your desired output.</p>

                        <h2>4. Preparing and generating an event report</h2>

                        <p>The button labeled "prepare event report" pops up a settings window to configure an event report based on the currently
                            visible events in your list. Additional guidance is provided for each setting inside that dialog box. Remember: the report
                            is generated based on only the events you can see in your result list; hidden events are not included.</p>


                    </p:dialog>



                    <p:dialog  id="ceevents-configure-report-dialog"
                               widgetVar="report-event-diaglog-var"
                               closable="true" responsive="true"
                               dynamic="true"
                               rendered="#{sessionBeasessionUserer.keyCard.hasMuniReaderPermissions}">

                        <h:form id="events-reportconfig-messages-form">
                            <h:messages id="ceev-messages-in-report-dialog" globalOnly="true" showDetail="false" showSummary="true"
                                        warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                            </h:messages>
                        </h:form>

                        <h:form id="report-eventlist-form">
                            <div class="ui-g data_container_nested_restrict">
                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">
                                    <div class="restrict-main-contents-io-title" >
                                        <h:outputLabel for="report-case-profile-title-it" 
                                                       value="Report title"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:inputText id="report-case-profile-title-it" style="width: 300px;" value="#{eventsBB.reportConfig.title}"/>
                                        <p:spacer height="5px" />
                                        <h:outputText styleClass="italic" value="note: your name and the current date and time will be automatically inserted" />

                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">
                                    <div class="restrict-main-contents-io-title" >
                                        <h:outputLabel for="report-case-profile-notes-ita" value="Notes"/>
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:inputText id="report-case-profile-notes-ita" style="width: 300px; height: 100px;" value="#{eventsBB.reportConfig.notes}"/>
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">
                                    <h2>Event display options</h2>

                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">
                                    <div class="restrict-main-contents-io-title" >
                                        <h:outputLabel value="Sort events: " 
                                                       for="sort-reverse-chrono-is" />
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:inputSwitch  id="sort-reverse-chrono-is"
                                                        value="#{eventsBB.reportConfig.sortInRevChrono}" 
                                                        onLabel="Reverse chrono (newest first)" 
                                                        offLabel="Timeline order (oldest first)" />

                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">
                                    <div class="restrict-main-contents-io-title" >
                                        <h:outputLabel value="Include persons attached to events" 
                                                       for="include-attached-persons-is" />
                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:inputSwitch  id="include-attached-persons-is"
                                                        value="#{eventsBB.reportConfig.includeAttachedPersons}" 
                                                        onLabel="Yes" offLabel="No" />
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">
                                    <div class="restrict-main-contents-io-title" >
                                        <h:outputLabel value="Include event summary chart on page 1" 
                                                       for="include-event-summary-chart-is" />

                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:inputSwitch  id="include-event-summary-chart-is"
                                                        value="#{eventsBB.reportConfig.includeEventTypeSummaryChart}" 
                                                        onLabel="Yes" offLabel="No" />
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">
                                    <div class="restrict-main-contents-io-title" >
                                        <h:outputLabel value="Include list of all active cases" 
                                                       for="include-active-case-list-is" />

                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:inputSwitch  id="include-active-case-list-is"
                                                        value="#{eventsBB.reportConfig.includeActiveCaseListing}" 
                                                        onLabel="Yes" offLabel="No" />
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">
                                    <div class="restrict-main-contents-io-title" >
                                        <h:outputLabel value="Include info about events requesting user action" 
                                                       for="include-action-requests-is" />

                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:inputSwitch  id="include-action-requests-is"
                                                        value="#{eventsBB.reportConfig.includeCaseActionRequestInfo}" 
                                                        onLabel="Yes" offLabel="No" />
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">
                                    <div class="restrict-main-contents-io-title" >
                                        <h:outputLabel value="Include complete query parameters" 
                                                       for="include-queryparams-is" />

                                    </div>

                                    <div class="restrict-main-contents-io-content" >
                                        <p:inputSwitch  id="include-queryparams-is"
                                                        value="#{eventsBB.reportConfig.includeCompleteQueryParamsDump}" 
                                                        onLabel="Yes" offLabel="No" />

                                    </div>
                                </div>
                                <div class="ui-g-12 ui-md-6 ui-lg-4 restrict-data-field">

                                    <div class="restrict-main-contents-io-button gray_button">

                                        <p:commandButton ajax="true" 
                                                         value="Cancel" icon="fa fa-stop" 
                                                         onclick="PF('report-event-diaglog-var').hide()"/>
                                    </div>

                                    <div class="restrict-main-contents-io-button">
                                        <p:commandButton ajax="false" action="#{eventsBB.generateEventReport}"
                                                         value="Generate report" icon="fa fa-print" 
                                                         rendered="#{sessionBsessionUserUser.keyCard.hasMuniReaderPermissions}"
                                                         />
                                    </div>

                                </div>
                            </div>

                        </h:form>
                    </p:dialog>
                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>


