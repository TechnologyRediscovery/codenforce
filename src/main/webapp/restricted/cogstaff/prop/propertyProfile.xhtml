<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Property Profile</title>
    </h:head>
    <h:body>
        <ui:composition template="/restricted/navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view id="prop-info-view">

                    <!-- GLOBAL MESSAGES -->
                    <h:form id="property-messages-global">
                        <p:growl id="messages-global" showDetail="false"/>
                    </h:form>

                    <div class="mainContainer">

                        <h2>
                            <h:outputText value="#{propertyProfileBB.currentProperty.address.addressPretty1Line} (Parcel ID: #{propertyProfileBB.currentProperty.countyParcelID})" />
                        </h2>

                        <div class="page-links">
                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#propinfo-panel-info">property info</a>
                            </div>

                            <h:outputText value=" | " />

                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-cases-panel">
                                    <h:outputText value="code enf cases (#{propertyProfileBB.currentProperty.ceCaseList.size()})" />
                                </a>
                            </div>

                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-periods-panel">
                                    <h:outputText value="occupancy periods (#{propertyProfileBB.currentProperty.completePeriodList.size()})" />
                                </a>
                            </div>

                            <h:outputText value=" | " />

                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-units-panel">
                                    <h:outputText value="units (#{propertyProfileBB.currentProperty.unitWithListsList.size()})" />
                                </a>
                            </div>

                            <h:outputText value=" | " />

                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-persons-panel">
                                    <h:outputText value="persons (#{propertyProfileBB.currentProperty.humanLinkList.size()})" />
                                </a>
                            </div>

                            <h:outputText value=" | " />

                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-events-panel">
                                    <h:outputText value="events (#{propertyProfileBB.currentProperty.completeEventList.size()})" />
                                </a>
                            </div>

                            <h:outputText value=" | " />


                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#propinfo-notes-panel">notes</a>
                            </div>

                            <h:outputText value=" | " />


                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-blobs-panel">docs and photos</a>
                            </div>
                            <h:outputText value=" | " />


                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-extinfo-panel">external data</a>
                            </div>
                        </div>

                        <!-- DATA CONTAINER -->
                        <div class="p-grid nested-grid">

                            <!-- OBJECT DATA CONTAINER --> 
                            <div class="p-col">


                                <!-- OBJECT DATA PANEL--> 
                                <p:panel id="parcel-id-panel"
                                         toggleable="true"
                                         collapsed="false"
                                         header="Parcel #{propertyProfileBB.currentProperty.countyParcelID} (#{propertyProfileBB.currentProperty.muni.muniName})"
                                         rendered="true"
                                         >
                                    <div class="p-grid nested-grid">
                                        <div class="p-col-4">
                                            <h:form id="parcel-photo-form">
                                                <div class="p-grid">

                                                    <div class="p-col-12">
                                                        <p:graphicImage value="#{blobsterBB.image}"
                                                                        alt="no preview available" 
                                                                        style="width: 100%; margin-right: 10px;" 
                                                                        cache="false"
                                                                        rendered="true">
                                                            <f:param name="blobid" value="#{propertyProfileBB.currentProperty.broadviewPhoto.photoDocID}"/>
                                                        </p:graphicImage>
                                                        <p:spacer height="2px" />
                                                        <p:commandLink      id="prop-broadviewphoto-change-cl"
                                                                            ajax="true"
                                                                            actionListener="#{propertyProfileBB.onChangeBroadviewPhotoInitLinkClick}"
                                                                            style="color:blue; font-weight: bold;"
                                                                            oncomplete="PF('property-broadview-dialog-var').show()"
                                                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                                            update="property-broadview-dialog
                                                                            property-broadview-form"
                                                                            value="change broadview photo" >

                                                        </p:commandLink>
                                                    </div>
                                                </div>
                                            </h:form>
                                        </div>
                                        <div class="p-col-8">
                                            <h:form id="parcel-id-form">
                                                <div class="p-grid">
                                                    <div class="p-col-12">
                                                            <p:commandButton    id="parcel-id-edit-abort-button"
                                                                                ajax="true"
                                                                                style="margin-left: 5px;"
                                                                                rendered="#{propertyProfileBB.currentPropertyEditMode}"
                                                                                value="Abort edit"
                                                                                actionListener="#{propertyProfileBB.onPropertyEditModeOperationAbortButtonChange}"
                                                                                update="property-messages-global
                                                                                @form"
                                                                                icon="fa fa-stop" />
                                                        <p:commandButton id="parcel-id-edit-button"
                                                                         value="#{propertyProfileBB.currentPropertyEditMode ? 'Save changes' : 'Edit'}"
                                                                         rendered="true"
                                                                         ajax="true"
                                                                         icon="fa #{propertyProfileBB.currentPropertyEditMode ? 'fa-check' : 'fa-pencil'}"
                                                                         actionListener="#{propertyProfileBB.onPropertyEditModeToggleButtonChange}"
                                                                         update="@form
                                                                         property-messages-global"
                                                                         />
                                                                       

                                                    </div>

                                                    <div class="p-col-6 data_field_label">
                                                        <h:outputText value="Parcel ID (County)"  />
                                                    </div>
                                                    <div class="p-col-6">
                                                        <h:outputText value="#{propertyProfileBB.currentProperty.countyParcelID} "
                                                                      rendered="#{!propertyProfileBB.currentPropertyEditMode}" />

                                                        <p:spacer height="3px" />
                                                        <p>
                                                            <a href="https://www2.alleghenycounty.us/RealEstate/GeneralInfo.aspx?ParcelID=#{propertyProfileBB.currentProperty.countyParcelID}"
                                                               target="_blank"
                                                               style="color:blue;">Visit county profile</a>
                                                        </p>
                                                        <p:spacer height="3px" />

                                                        <p:inputText value="#{propertyProfileBB.currentProperty.countyParcelID}"
                                                                     rendered="#{propertyProfileBB.currentPropertyEditMode}" />

                                                    </div>

                                                    <div class="p-col-6 data_field_label">
                                                        <h:outputText value="Municipality" />
                                                    </div>
                                                    <div class="p-col-6">
                                                        <h:outputText value="#{propertyProfileBB.currentProperty.muni.muniName} (Muni Code:#{propertyProfileBB.currentProperty.muni.muniCode}) "/>
                                                    </div>

                                                    <div class="p-col-6 data_field_label">
                                                        <h:outputText value="InternalID" />
                                                    </div>
                                                    <div class="p-col-6">
                                                        <h:outputText value="#{propertyProfileBB.currentProperty.propertyID} "/>
                                                    </div>

                                                    <div class="p-col-6 data_field_label">
                                                        <h:outputText value="Property Source" />
                                                    </div>
                                                    <div class="p-col-6">
                                                        <h:outputText value="#{propertyProfileBB.currentProperty.source.title} "
                                                                      rendered="#{!propertyProfileBB.currentPropertyEditMode}" />

                                                        <h:selectOneMenu id="property-id-source-som"
                                                                         value="#{propertyProfileBB.currentProperty.source}" style="width:175px;height:25px"
                                                                         rendered="#{propertyProfileBB.currentPropertyEditMode}" >

                                                            <f:converter converterId="bobSourceConverter"/>

                                                            <f:selectItem itemLabel="select a source..." noSelectionOption="true" />

                                                            <f:selectItems id="parcel-info-source-selitems"
                                                                           value="#{propertyProfileBB.sourceList}"
                                                                           var="bs" itemValue="#{bs}" itemLabel="#{bs.title}"/>

                                                        </h:selectOneMenu>
                                                    </div>

                                                    <div class="p-col-6 data_field_label">
                                                        <h:outputText value="Created" />
                                                    </div>
                                                    <div class="p-col-6">
                                                        <h:outputText value="#{propertyProfileBB.getPrettyDate(propertyProfileBB.currentProperty.createdTS)} "/>
                                                        <h:outputText value="#{!empty propertyProfileBB.currentProperty.createdBy ? propertyProfileBB.currentProperty.createdBy.username : ''}"/>
                                                    </div>

                                                    <div class="p-col-6 data_field_label">
                                                        <h:outputText value="Last Updated" />
                                                    </div>
                                                    <div class="p-col-6">
                                                        <h:outputText value="#{propertyProfileBB.getPrettyDate(propertyProfileBB.currentProperty.lastUpdatedTS)}" />
                                                    </div>
                                                </div>
                                            </h:form>
                                        </div>
                                    </div>
                                </p:panel>

                                <p:panel id="property-adresses-panel"
                                         toggleable="true"
                                         collapsed="false"
                                         header="Addresses links">
                                    <h:form id="property-profile-addresses-form">

                                        <p:commandButton        id="prop-addresses-add-cb"
                                                                value="Link a new address to property" 
                                                                ajax="true"
                                                                icon="fa fa-link"
                                                                actionListener="#{addressBB.onLinkPersonPropToAddressInitButtonChange(propertyProfileBB.currentProperty)}"
                                                                rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                                oncomplete="PF('address-search-dialog-var').show(); "
                                                                update="address-search-dialog">
                                            <f:param name="initiating-address-list-component-id" value="property-profile-addresses-form" />
                                        </p:commandButton>

                                        <p:spacer height="5px"/>

                                        <p:dataTable    id="property-addresses-table"
                                                        value="#{propertyProfileBB.currentPropertyMADLinkList}"
                                                        var="pml"
                                                        rowKey="#{pml.linkID}"
                                                        tableStyleClass="primeDataTable"
                                                        draggableRows="true" 
                                                        tabindex="6">


                                            <p:column width="10%">
                                                <f:facet name="header">
                                                    <h:outputText value="ID"/>
                                                </f:facet>
                                                <h:outputText value="#{pml.addressID}" />
                                            </p:column>

                                            <p:column width="50%">
                                                <f:facet name="header">
                                                    <h:outputText value="Address"/>
                                                </f:facet>

                                                <h:outputText value="#{pml.addressPretty2LineEscapeFalse}"
                                                              escape="false" />
                                            </p:column>

                                            <p:column width="25%">
                                                <f:facet name="header">
                                                    <h:outputText value="Actions"/>
                                                </f:facet>

                                                <p:commandLink      id="prop-address-actions-cl"
                                                                    ajax="true"
                                                                    actionListener="#{addressBB.onMalingAddressLinkViewEditInit(pml)}"
                                                                    style="color:blue;"
                                                                    oncomplete="PF('address-link-dialog-var').show()"
                                                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                                    update="address-link-dialog"
                                                                    value="view/edit" >
                                                    <f:param name="initiating-address-list-component-id" value="property-profile-addresses-form" />
                                                </p:commandLink>

                                            </p:column>
                                        </p:dataTable>
                                    </h:form>          
                                </p:panel>


                                <p:panel id="parcel-info-panel"
                                         toggleable="true"
                                         collapsed="false"
                                         header="#{propertyProfileBB.currentProperty.countyParcelID} (#{propertyProfileBB.currentProperty.muni.muniName})"
                                         rendered="true"
                                         >
                                    <h:form id="parcel-info-form">

                                        <p:commandButton id="parcel-info-edit-button"
                                                         value="#{propertyProfileBB.currentParcelInfoEditMode ? 'Save changes' : 'Edit'}"
                                                         rendered="true"
                                                         ajax="true"
                                                         icon="fa #{propertyProfileBB.currentParcelInfoEditMode ? 'fa-check' : 'fa-pencil'}"
                                                         actionListener="#{propertyProfileBB.onParcelInfoEditModeToggleButtonChange}"
                                                         update="@form
                                                         property-messages-global"
                                                         />

                                            <p:commandButton    id="parcel-info-edit-abort-button"
                                                                ajax="true"
                                                                rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                                value="Abort edit"
                                                                actionListener="#{propertyProfileBB.onParcelInfoEditModeOperationAbortButtonChange}"
                                                                style="margin-left: 5px;"
                                                                update="property-messages-global
                                                                        @form"
                                                                icon="fa fa-stop" />

                                        <p:spacer height="5px"/>    
                                        <div class="p-grid">
                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="Info record ID"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.parcelInfoID}" />
                                            </div>
                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="Parcel Key (internal)"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.parcelParcelKey}" />
                                            </div>
                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="County"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.countyCode}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}" />
                                            </div>

                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="Condition"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.condition)
                                                                       ? propertyProfileBB.currentProperty.parcelInfo.condition.title
                                                                       : ''}"
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}" />

                                                <h:selectOneMenu id="prop-add-condition-som"
                                                                 value="#{propertyProfileBB.currentProperty.parcelInfo.condition}" 
                                                                 style="width:100%;"
                                                                 rendered="#{propertyProfileBB.currentParcelInfoEditMode}" >
                                                    <f:converter converterId="intensityClassConverter"/>
                                                    <f:selectItem itemLabel="select a condition ..." noSelectionOption="true" />
                                                    <f:selectItems id="propinfoedit-condition-selitems"
                                                                   value="#{propertyProfileBB.conditionIntensityList}"
                                                                   var="ic" itemValue="#{ic}" itemLabel="#{ic.numericRating}: #{ic.title}"/>

                                                </h:selectOneMenu>
                                            </div>

                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="Use Type"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.useType.name}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"  />

                                                <h:selectOneMenu id="prop-add-source-som"
                                                                 value="#{propertyProfileBB.currentProperty.parcelInfo.useType}" 
                                                                 style="width:100%;"
                                                                 rendered="#{propertyProfileBB.currentParcelInfoEditMode}" >
                                                    <f:converter converterId="propertyUseTypeConverter"/>
                                                    <f:selectItem itemLabel="select a use type..." noSelectionOption="true" />
                                                    <f:selectItems id="parcel-info-put-selitems"
                                                                   value="#{propertyProfileBB.putList}"
                                                                   var="put" itemValue="#{put}" itemLabel="#{put.name}"/>

                                                </h:selectOneMenu>
                                            </div>

                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="Non-Addressable"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.nonAddressable? 'Yes': 'No'}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}" />

                                                <p:inputSwitch value="#{propertyProfileBB.currentProperty.parcelInfo.nonAddressable}"
                                                               onLabel="Non-addressable"
                                                               offLabel="Normal (addressable)"
                                                               rendered="#{propertyProfileBB.currentParcelInfoEditMode}"  />

                                            </div>

                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="TCLB Held (old)"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.landBankHeld ? 'Yes': 'No'}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}" />

                                                <p:inputSwitch value="#{propertyProfileBB.currentProperty.parcelInfo.landBankHeld}"
                                                               onLabel="Held by TCLB"
                                                               offLabel="Not TCLB held"
                                                               rendered="#{propertyProfileBB.currentParcelInfoEditMode}"  />

                                            </div>

                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="Land bank prospect (old)"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.landBankProspect)
                                                                       ? propertyProfileBB.currentProperty.parcelInfo.landBankProspect.title : ' '}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}" />

                                                <h:selectOneMenu id="prop-add-landprospect-som"
                                                                 value="#{propertyProfileBB.currentProperty.parcelInfo.landBankProspect}" style="width:175px;height:25px"
                                                                 rendered="#{propertyProfileBB.currentParcelInfoEditMode}" >
                                                    <f:converter converterId="intensityClassConverter"/>
                                                    <f:selectItem itemLabel="select a muni..." noSelectionOption="true" />
                                                    <f:selectItems id="propinfoedit-landprospect-selitems"
                                                                   value="#{propertyProfileBB.landBankProspectIntensityList}"
                                                                   var="ic" itemValue="#{ic}" itemLabel="#{ic.numericRating}: #{ic.title}"/>

                                                </h:selectOneMenu>

                                            </div>


                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="Info record source"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.bobSource.title}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}" />

                                                <h:selectOneMenu id="prop-info-source-som"
                                                                 value="#{propertyProfileBB.currentProperty.parcelInfo.bobSource}" style="width:175px;height:25px"
                                                                 rendered="#{propertyProfileBB.currentParcelInfoEditMode}" >
                                                    <f:converter converterId="bobSourceConverter"/>
                                                    <f:selectItem itemLabel="select a source..." noSelectionOption="true" />
                                                    <f:selectItems id="parcel-info-source-selitems"
                                                                   value="#{propertyProfileBB.sourceList}"
                                                                   var="bs" itemValue="#{bs}" itemLabel="#{bs.title}"/>

                                                </h:selectOneMenu>
                                            </div>

                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="Info record creation"/>
                                            </div>
                                            <div class="p-col-8 restrict-data-field-value-inline">
                                                <h:outputText value="#{propertyProfileBB.getPrettyDate(propertyProfileBB.currentProperty.parcelInfo.createdTS)}" 
                                                              rendered="true" />
                                            </div>
                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="Info record last update"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.getPrettyDate(propertyProfileBB.currentProperty.parcelInfo.lastUpdatedTS)}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}" />
                                            </div>



                                            <div class="p-col-12" >
                                                <p:separator />
                                            </div>
                                            
                                            <div class="p-col-4" >
                                                <h:outputText value="&nbsp;"
                                                              escape="false" />
                                            </div>
                                            
                                            
                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="Start date" />
                                            </div>
                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="Stop date" />
                                            </div>
                                            
                                            <div class="p-col-12 restrict-data-field-label-inline" >
                                                <p:separator />
                                                <h3>
                                                    Property Status Designations
                                                </h3>
                                            </div>
                                            
                                            <div class="p-col-4 restrict-data-field-label-inline" >
                                                <h:outputLabel value="Unfitness of Occupancy"/>
                                            </div>
                                            <div class="p-col-4">
                                                <h:outputText id="propinfo-ot-unfitstart-1"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.unfitDateStart) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.unfitDateStart) 
                                                                       : ''}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"/>


                                                <p:datePicker id="prop-add-unfit-start-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.unfitDateStart}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              showTime="false"
                                                              yearNavigator="true"
                                                              mask="true"
                                                              tabindex="16" >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>



                                            </div>

                                            <div class="p-col-4">
                                                <h:outputText id="propinfo-ot-unfitstop-1"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.unfitDateStop) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.unfitDateStop) 
                                                                       : ''}"
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}" />

                                                <p:datePicker id="prop-add-unfit-end-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.unfitDateStop}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              yearNavigator="true"
                                                              showTime="false"
                                                              mask="true"
                                                              tabindex="16" >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>

                                            </div>


                                            <div class="p-col-4 restrict-data-field-label-inline" >
                                                <h:outputLabel value="Vacancy"/>
                                            </div>


                                            <div class="p-col-4">
                                                <h:outputText id="propinfo-ot-vacantstart-1"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.vacantDateStart) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.vacantDateStart) 
                                                                       : ''}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}" />

                                                <p:datePicker id="prop-add-vacant-start-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.vacantDateStart}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              yearNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              showTime="false"
                                                              mask="true"
                                                              tabindex="16" >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>


                                            </div>
                                            
                                               <div class="p-col-4">
                                                <h:outputText id="propinfo-ot-vacantstop-1"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.vacantDateStop) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.vacantDateStop) 
                                                                       : ''}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}" />

                                                <p:datePicker id="prop-add-vacant-stop-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.vacantDateStop}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              yearNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              showTime="false"
                                                              mask="true"
                                                              tabindex="16"
                                                              >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>


                                            </div>
                                    
                                            

                                            <div class="p-col-4 restrict-data-field-label-inline" >
                                                <h:outputLabel value="Abandonment"/>
                                            </div>


                                            <div class="p-col-4">
                                                <h:outputText id="propinfo-ot-abandonedstart-1"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.abandonedDateStart) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.abandonedDateStart) 
                                                                       : ''}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}" />

                                                <p:datePicker id="prop-add-abandoned-start-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.abandonedDateStart}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              yearNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              showTime="false"
                                                              mask="true"
                                                              tabindex="16"
                                                              >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>

                                            

                                            </div>

                                            <div class="p-col-4">
                                                <h:outputText id="propinfo-ot-abandonedstop-1"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.abandonedDateStop) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.abandonedDateStop) 
                                                                       : ''}" />

                                                <p:datePicker id="prop-add-abandoned-stop-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.abandonedDateStop}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              yearNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              showTime="false"
                                                              mask="true"
                                                              tabindex="16"
                                                              >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>

                                            </div>

                                         
                                            
                                            
                                            <div class="p-col-12 restrict-data-field-label-inline" >
                                                <p:separator />
                                                <h3>
                                                    TCLB Designations
                                                </h3>
                                            </div>
                                            
                                            <div class="p-col-4 restrict-data-field-label-inline" >
                                                <h:outputLabel value="LB Prospect"/>
                                            </div>

                                            <div class="p-col-4">
                                                <h:outputText id="lb-prospect-start-ot"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.landbankProspectStart) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.landbankProspectStart) 
                                                                       : ''}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"/>


                                                <p:datePicker id="lb-prospect-start-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.landbankProspectStart}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              showTime="false"
                                                              yearNavigator="true"
                                                              mask="true"
                                                              tabindex="16" >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>
                                            </div>
                                            
                                            
                                            <div class="p-col-4">
                                                <h:outputText id="lb-prospect-stop-ot"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.landbankProspectStop) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.landbankProspectStop) 
                                                                       : ''}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"/>


                                                <p:datePicker id="lb-prospect-stop-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.landbankProspectStop}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              showTime="false"
                                                              yearNavigator="true"
                                                              mask="true"
                                                              tabindex="16" >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>
                                            </div>
                                            
                                            <div class="p-col-4 restrict-data-field-label-inline" >
                                                <h:outputLabel value="LB Candidate "/>
                                            </div>
                                            <div class="p-col-4">
                                                <h:outputText id="lb-acqcand-start-ot"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.landbankAcqCandidateStart) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.landbankAcqCandidateStart) 
                                                                       : ''}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"/>


                                                <p:datePicker id="lb-acqcand-start-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.landbankAcqCandidateStart}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              showTime="false"
                                                              yearNavigator="true"
                                                              mask="true"
                                                              tabindex="16" >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>
                                            </div>
                                            <div class="p-col-4">
                                                <h:outputText id="lb-acqcand-stop-ot"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.landbankAcqCandidateStop) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.landbankAcqCandidateStop) 
                                                                       : ''}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"/>


                                                <p:datePicker id="lb-acqcand-stop-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.landbankAcqCandidateStop}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              showTime="false"
                                                              yearNavigator="true"
                                                              mask="true"
                                                              tabindex="16" >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>
                                            </div>

                                            <div class="p-col-4 restrict-data-field-label-inline" >
                                                <h:outputLabel value="LB Pursuing"/>
                                            </div>


                                            <div class="p-col-4">
                                                <h:outputText id="lb-pursuing-start-ot"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.landbankPursuingStart) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.landbankPursuingStart) 
                                                                       : ''}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"/>


                                                <p:datePicker id="lb-purusing-start-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.landbankPursuingStart}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              showTime="false"
                                                              yearNavigator="true"
                                                              mask="true"
                                                              tabindex="16" >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>
                                            </div>
                                            
                                      
                                            <div class="p-col-4">
                                                <h:outputText id="lb-pursuing-stop-ot"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.landbankPursuingStop) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.landbankPursuingStop) 
                                                                       : ''}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"/>


                                                <p:datePicker id="lb-purusing-stop-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.landbankPursuingStop}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              showTime="false"
                                                              yearNavigator="true"
                                                              mask="true"
                                                              tabindex="16" >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>
                                            </div>

                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel value="LB Owned" />
                                            </div>


                                            <div class="p-col-4">
                                                <h:outputText id="lb-owned-start-ot"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.landbankOwnedStart) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.landbankOwnedStart) 
                                                                       : ''}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"/>


                                                <p:datePicker id="lb-owned-start-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.landbankOwnedStart}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              showTime="false"
                                                              yearNavigator="true"
                                                              mask="true"
                                                              tabindex="16" >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>
                                            </div>
                                    

                                            
                                            

                                            
                                            <div class="p-col-4">
                                                <h:outputText id="lb-owned-stop-ot"
                                                              value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.landbankOwnedStop) 
                                                                       ? propertyProfileBB.getPrettyLocalDateOnlyNoTime(propertyProfileBB.currentProperty.parcelInfo.landbankOwnedStop) 
                                                                       : ''}" 
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"/>


                                                <p:datePicker id="lb-owned-stop-cal"
                                                              value="#{propertyProfileBB.currentProperty.parcelInfo.landbankOwnedStop}"
                                                              rendered="#{propertyProfileBB.currentParcelInfoEditMode}"
                                                              showButtonBar="true"
                                                              pattern="MM/dd/yyyy"
                                                              monthNavigator="true"
                                                              hideOnDateTimeSelect="true"
                                                              showOnFocus="false"
                                                              showIcon="true"
                                                              showTime="false"
                                                              yearNavigator="true"
                                                              mask="true"
                                                              tabindex="16" >
                                                    <f:convertDateTime pattern="MM/dd/yyyy" type="localDate"/>
                                                </p:datePicker>
                                            </div>
                                            
                                            
                                            <div class="p-col-12 restrict-data-field-label-inline" >
                                                <p:separator />
                                                <h3>
                                                    TCLB Notes
                                                </h3>
                                            </div>
                                            
                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputText value="LB Prospect Notes" />
                                            </div>
                                            <div class="p-col-8 restrict-data-field-value-inline">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.landbankProspectNotes}"
                                                              escape="false"
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"/>
                                                
                                                <p:inputTextarea    value="#{propertyProfileBB.currentProperty.parcelInfo.landbankProspectNotes}"
                                                                    cols="20"
                                                                    rows="5"
                                                                    rendered="#{propertyProfileBB.currentParcelInfoEditMode}"/>
                                            </div>
                                            
                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputText value="LB Candidate Notes" />
                                            </div>
                                            <div class="p-col-8 restrict-data-field-vale-inline">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.landbankAcqCandidateNotes}"
                                                              escape="false"
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"/>
                                                
                                                <p:inputTextarea    value="#{propertyProfileBB.currentProperty.parcelInfo.landbankAcqCandidateNotes}"
                                                                    cols="20"
                                                                    rows="5"
                                                                    rendered="#{propertyProfileBB.currentParcelInfoEditMode}"/>
                                            </div>
                                            
                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputText value="LB Pursuing Notes" />
                                            </div>
                                            <div class="p-col-8 restrict-data-field-value-inline">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.landbankPursuingNotes}"
                                                              escape="false"
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"/>
                                                
                                                <p:inputTextarea    value="#{propertyProfileBB.currentProperty.parcelInfo.landbankPursuingNotes}"
                                                                    cols="20"
                                                                    rows="5"
                                                                    rendered="#{propertyProfileBB.currentParcelInfoEditMode}"/>
                                            </div>
                                            
                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputText value="LB Owned Notes" />
                                            </div>
                                            <div class="p-col-8 restrict-data-field-value-inline">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.landbankOwnedNotes}"
                                                              escape="false"
                                                              rendered="#{!propertyProfileBB.currentParcelInfoEditMode}"/>
                                                
                                                <p:inputTextarea    value="#{propertyProfileBB.currentProperty.parcelInfo.landbankOwnedNotes}"
                                                                    cols="20"
                                                                    rows="5"
                                                                    rendered="#{propertyProfileBB.currentParcelInfoEditMode}"/>
                                            </div>
                                            
                                        </div>
                                    </h:form>
                                </p:panel>

                                <p:panel id="propinfo-notes-panel"
                                         toggleable="true"
                                         collapsed="false"
                                         header="Property Notes"
                                         rendered="true"
                                         > 
                                    <h:form id="propinfo-notes-form">
                                        <h:messages id="propinfo-notes-messages"
                                                    globalOnly="true" showDetail="true" showSummary="true"
                                                    warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                        </h:messages>

                                        <div class="ui-g data-container">
                                            <p:commandButton   id="propinfo-notes-add-button"
                                                               rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                               value="Add new note"  
                                                               icon="fa fa-sticky-note-o"
                                                               actionListener="#{propertyProfileBB.onParcelNoteAppendInit}"
                                                               disabled="false"
                                                               oncomplete="PF('propinfo-notes-dialog-var').show()"
                                                               update="propinfo-note-create-form" />
                                        </div>
                                            <p:spacer height="5px" />
                                            <div    id="propinf-ot-notes-div"
                                                    class="data_field"
                                                    style="clear:both;">
                                                <h:outputLabel  styleClass="data_field_label"
                                                                for="propinfo-ot-notes"
                                                                value="Notes"/>

                                                <h:outputText   id="propinfo-ot-notes"
                                                                styleClass="data_field_value"
                                                                value="#{propertyProfileBB.currentProperty.notes}"
                                                                escape="false"/>
                                            </div>

                                    </h:form>
                                </p:panel>

                            </div>

                            <div class="p-col">
                                <p:panel    id="prop-persons-panel"
                                            toggleable="true"
                                            widgetVar="prop-events-panel-var"
                                            collapsed="false"
                                            header="Persons"
                                            rendered="true">
                                    <h:form id="prop-persons-panel-form">

                                        <p:commandButton   id="prop-persons-manage-button"
                                                           ajax="true"
                                                           actionListener="#{personBB.onSelectAndLinkPersonsInit(propertyProfileBB.currentProperty)}"
                                                           oncomplete="PF('human-search-dialog-var').show()"
                                                           rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                           value="Manage property-person links"
                                                           update=" human-search-dialog
                                                           property-messages-global
                                                           search-query-form
                                                           pers-selected-form
                                                           hlh-humlist-form"
                                                           icon="fa fa-user-plus"
                                                           >
                                            <f:param name="person-list-component-to-update"
                                                     value="prop-persons-panel-form" />
                                        </p:commandButton>

                                        <p:spacer height="5px" />

                                        <p:dataTable id="prop-persons-table"
                                                     var="human"
                                                     value="#{propertyProfileBB.managedHumanLinkList}"
                                                     tableStyleClass="primeDataTable"
                                                     rowKey="#{human.humanID}"
                                                     >


                                            <p:column headerText="Name"
                                                      width="35%"
                                                      styleClass="centeredColumnContent">
                                                <h:outputText value="#{human.name}" />

                                            </p:column>

                                            <p:column headerText="Role"
                                                      width="35%"
                                                      styleClass="centeredColumnContent">
                                                <h:outputText value="#{human.linkedObjectRole.title}"/>

                                            </p:column>

                                            <p:column headerText="Actions"
                                                      width="30%"
                                                      styleClass="centeredColumnContent">
                                                <p:commandLink      id="prop-person-exploreperson-cl"
                                                                    ajax="true"
                                                                    style="color:blue;"
                                                                    action="#{personBB.onHumanViewLinkClick(human)}"
                                                                    value="View Person"
                                                                    oncomplete="PF('person-profile-dialog-var').show();"
                                                                    />
                                                <h:outputText value=" (HumID: #{human.humanID})" />
                                                <p:spacer height="3px" />
                                                <p:commandLink      id="prop-personlink-vieweditlink-cl"
                                                                    ajax="true"
                                                                    style="color:blue;"
                                                                    action="#{personBB.onHumanLinkEditInitButtonChange(human, propertyProfileBB.currentProperty)}"
                                                                    value="View/Edit link"
                                                                    oncomplete="PF('humanlink-viewedit-dialog-var').show();"
                                                                    update="humanlink-viewedit-dialog
                                                                    humanlink-viewedit-form"
                                                                    >
                                                    <f:param name="person-list-component-to-update"
                                                             value="prop-persons-panel-form" />
                                                </p:commandLink>
                                                <h:outputText value=" (LnkID: #{human.linkID})" />

                                            </p:column>
                                        </p:dataTable>
                                    </h:form>
                                </p:panel>

                                <p:panel    id="prop-cases-panel"
                                            toggleable="true"
                                            widgetVar="prop-cases-panel-var"
                                            collapsed="false"
                                            header="Code Enforcement Cases"
                                            rendered="true">
                                    <h:form id="prop-cases-panel-form">

                                        <p:commandButton   id="prop-cases-newcase-button"
                                                           ajax="true"
                                                           actionListener="#{propertyProfileBB.onCECaseAddInitButtonChange}"
                                                           rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                           value="Create New Code Enforcement Case"
                                                           icon="fa fa-archive"
                                                           oncomplete="PF('cecase-add-dialog-var').show();"
                                                           update="cecase-add-dialog
                                                           cecase-add-form"
                                                           />

                                        <p:spacer height="5px" />

                                        <p:dataTable id="prop-cases-table"
                                                     var="cse"
                                                     value="#{propertyProfileBB.currentProperty.ceCaseList}"
                                                     tableStyleClass="primeDataTable"
                                                     rowKey="#{cse.caseID}"
                                                     >

                                            <p:column headerText="Date Opened"
                                                      styleClass="centeredColumnContent"
                                                      sortBy="#{cse.originationDate}">
                                                <h:outputText value="#{!(empty cse.originationDate) ? propertyProfileBB.getPrettyDate(cse.originationDate) : ''}"/>
                                            </p:column>
                                            <p:column headerText="Unit"
                                                      sortBy="#{cse.propUnit.unitNumber}"
                                                      styleClass="centeredColumnContent">
                                                <h:outputText value="#{!empty cse.propUnit ? cse.propUnit.unitNumber:'-'}" />
                                            </p:column>

                                            <p:column headerText="Status"
                                                      styleClass="centeredColumnContent"
                                                      sortBy="#{cse.statusBundle.phase.caseOpen}">
                                                <h:outputText value="#{cse.statusBundle.phase.caseOpen ? 'Open' : 'Closed'}"/>
                                            </p:column>

                                            <p:column headerText="Name"
                                                      styleClass="centeredColumnContent">
                                                <h:outputText value="#{cse.caseName}"/>
                                            </p:column>

                                            <p:column headerText="Manager"
                                                      styleClass="centeredColumnContent">
                                                <h:outputText value="#{!(empty cse.caseManager) ? cse.caseManager.human.name:'No manager '}"/>
                                            </p:column>

                                            <p:column headerText="Options"
                                                      styleClass="centeredColumnContent">
                                                <p:commandButton    id="prop-person-viewcase-button"
                                                                    ajax="false"
                                                                    styleClass="noFill button-size-small"
                                                                    action="#{propertyProfileBB.onViewCaseButtonChange(cse)}"
                                                                    icon="fa fa-folder-open-o"
                                                                    value="View"
                                                                    />
                                                <h:outputText value="(ID: #{cse.caseID})"/>
                                            </p:column>
                                        </p:dataTable>
                                    </h:form>
                                </p:panel>

                                <p:panel    id="prop-periods-panel"
                                            toggleable="true"
                                            widgetVar="prop-periods-list-panel-var"
                                            collapsed="false"
                                            header="Permit File">

                                    <h:form id="prop-periods-form">

                                        <p:dataTable id="prop-periods-table"
                                                     var="period"
                                                     value="#{propertyProfileBB.currentProperty.completePeriodList}"
                                                     tableStyleClass="primeDataTable"
                                                     rowKey="#{period.periodID}"
                                                     >
                                            <p:column width="8%">
                                                <f:facet name="header">
                                                    <h:outputText value="File ID"/>
                                                </f:facet>
                                                <h:outputText value="#{period.periodID}" />
                                            </p:column>
                                            <p:column width="8%">
                                                <f:facet name="header">
                                                    <h:outputText value="Unit ID"/>
                                                </f:facet>
                                                <h:outputText value="#{period.propertyUnitID}" />
                                            </p:column>


                                            <p:column width="15%">
                                                <f:facet name="header">
                                                    <h:outputText value="Dates"/>
                                                </f:facet>
                                                <h:outputText value="Start Date: " 
                                                              styleClass="ui-label-inline" />

                                                <h:outputText value="#{propertyProfileBB.getPrettyDate(period.startDate)}" 
                                                              styleClass="data-text"/>

                                                <p:spacer height="3px" />

                                                <h:outputText value="End Date: " 
                                                              styleClass="ui-label-inline" />

                                                <h:outputText value="#{propertyProfileBB.getPrettyDate(period.endDate)}" 
                                                              styleClass="data-text"/>
                                            </p:column>

                                            <p:column width="15%">
                                                <f:facet name="header">
                                                    <h:outputText value="Actions"/>
                                                </f:facet>
                                                <p:commandLink          id="occperiodtable-exploreperiod-cl"
                                                                        value="view permit file"  
                                                                        style="color:blue; font-weight: bold;"
                                                                        ajax="false" 
                                                                        action="#{propertyProfileBB.onViewOccPeriodButtonChange(period)}"
                                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                                        />
                                            </p:column>
                                        </p:dataTable>
                                    </h:form>

                                </p:panel>

                                <ui:include src="compositions/unitTools.xhtml" />
                                <ui:include src="/restricted/compositions/blobTools.xhtml" />
                                <p:panel id="prop-blobs-panel"
                                         toggleable="true"
                                         collapsed="false"
                                         header="Files and Photos"
                                         rendered="true"
                                         >

                                    <h:form id="prop-blobs-form">

                                        <p:commandButton    id="property-blob-add-button"
                                                            ajax="true"
                                                            styleClass="noFill button-size-small"
                                                            actionListener="#{blobUtilitiesBB.onUploadBlobInitButtonChange(propertyProfileBB.currentProperty)}"
                                                            oncomplete="PF('blob-upload-dialog-var').show()"
                                                            update="blob-upload-dialog
                                                            blob-uploadconnect-tabview"
                                                            value="Upload photo or document"
                                                            icon="fa fa-upload"
                                                            >
                                            <f:param name="blob-list-component-to-update" value="prop-blobs-form" />
                                        </p:commandButton>


                                        <p:spacer height="5px" />

                                        <p:dataTable
                                            id="prop-blobs-table"
                                            var="blob"
                                            value="#{propertyProfileBB.currentProperty.blobList}"
                                            rowKey="#{blob.bytesID}"
                                            tableStyleClass="primeDataTable"
                                            resizableColumns="true"
                                            draggableRows="false" tabindex="6">

                                            <p:column width="15%">
                                                <f:facet name="header">
                                                    <h:outputText value="File Type"/>
                                                </f:facet>
                                                <h:outputText value="#{blob.type.title}"/>
                                                <!-- type icon here -->
                                            </p:column>

                                            <p:column width="15%">
                                                <f:facet name="header">
                                                    <h:outputText value="IDs"/>
                                                </f:facet>
                                                <h:outputText value="linkID: #{blob.photoDocID}"/>
                                                <br/>
                                                <h:outputText value="bytesID: #{blob.bytesID}"/>

                                            </p:column>

                                            <p:column width="45%">
                                                <f:facet name="header">
                                                    <h:outputText value="Info"/>
                                                </f:facet>
                                                <div class="rowExpansion">
                                                    <h:outputText value="title: #{blob.title}"/>
                                                    <br/>
                                                    <h:outputText value="descr: #{blob.description}"/>
                                                    <br/>
                                                    <h:outputText value="filename: #{blob.filename}"/>
                                                    <br/>
                                                    <h:outputText value="created: #{propertyProfileBB.getPrettyDateNoTime(blob.createdTS)}"/>
                                                </div>
                                            </p:column>


                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputText value="Actions"/>
                                                </f:facet>
                                                <p:commandButton 
                                                    value="Download" 
                                                    ajax="false"
                                                    icon="fa fa-arrow-down" 
                                                    styleClass="ui-button-outlined">
                                                    <p:fileDownload value="#{blobRetrieveBB.retrieveBlob(blob)}"
                                                                    />
                                                </p:commandButton>
                                                <br/>
                                                <div class="restrict-main-contents-io-link link-button">

                                                    <p:commandLink      id="blob-update-button"
                                                                        ajax="true"
                                                                        styleClass="noFill button-size-small"
                                                                        action="#{blobUtilitiesBB.onViewBlobLinkClick(blob, propertyProfileBB.currentProperty)}"
                                                                        value="view"
                                                                        oncomplete="PF('blobs-viewblob-dialog-var').show()"
                                                                        update="blobs-viewblob-dialog
                                                                        blob-viewblob-form"
                                                                        />
                                                    <p:spacer height="3px" />
                                                    <p:commandLink      id="blob-edit-button"
                                                                        ajax="true"
                                                                        styleClass="noFill button-size-small"
                                                                        action="#{blobUtilitiesBB.onBlobEditMetaDataInitLinkClick(blob, propertyProfileBB.currentProperty)}"
                                                                        value="edit"
                                                                        oncomplete="PF('blobs-vieweditmetadata-dialog-var').show()"
                                                                        update="blob-vieweditmetadata-dialog
                                                                        blob-veweditmetadata-form"
                                                                        >
                                                        <f:param name="blob-list-component-to-update" value="prop-blobs-form" />
                                                    </p:commandLink>
                                                    <p:spacer height="3px" />
                                                    <p:commandLink      id="blob-remove-button"
                                                                        ajax="true"
                                                                        styleClass="noFill button-size-small"
                                                                        action="#{blobUtilitiesBB.onDeactivateBlobInitLinkClick(blob, propertyProfileBB.currentProperty)}"
                                                                        oncomplete="PF('blobs-deactivate-dialog-var').show();"
                                                                        value="remove"
                                                                        update="blob-deactivate-dialog
                                                                        blob-deactivate-form"
                                                                        >
                                                        <f:param name="blob-list-component-to-update" value="prop-blobs-form" />
                                                    </p:commandLink>
                                                </div>
                                            </p:column>
                                        </p:dataTable>
                                    </h:form>
                                </p:panel>

                                <p:panel    id="prop-events-panel"
                                            toggleable="true"
                                            widgetVar="prop-events-panel-var"
                                            collapsed="false"
                                            header="Events"
                                            rendered="false">

                                    <h:form id="prop-events-panel-form">


                                        <p:selectOneMenu style="width: 300px;" 
                                                         id="prop-viewoptionsevents-solb" 
                                                         value="#{propertyProfileBB.eventViewOptionSelected}" 
                                                         tabindex="10">

                                            <p:ajax update="prop-events-datatable"                                                           
                                                    immediate="true"/>

                                            <f:selectItems  id="prop-events-selitems" 
                                                            value="#{propertyProfileBB.eventViewOptions}" 
                                                            var="evo" 
                                                            itemValue="#{evo}" 
                                                            itemLabel="#{evo.label}"/>
                                        </p:selectOneMenu>

                                        <p:spacer height="5px" />

                                        <p:dataTable id="prop-events-datatable"
                                                     var="event"
                                                     value="#{propertyProfileBB.currentProperty.completeEventList}"
                                                     tableStyleClass="primeDataTable"
                                                     rowKey="#{event.eventID}"
                                                     >

                                            <p:column headerText="ID"
                                                      styleClass="centeredColumnContent">

                                                <h:outputText value="#{event.eventID}"/>

                                            </p:column>

                                            <p:column headerText="Category"
                                                      styleClass="centeredColumnContent">
                                                <h:outputText value="#{event.category.eventCategoryTitle}" />


                                            </p:column>

                                            <p:column headerText="Description"
                                                      styleClass="centeredColumnContent">

                                                <h:outputText value="#{event.description}"/>

                                            </p:column>
                                            <p:column headerText="Options"
                                                      styleClass="centeredColumnContent">

                                                <p:commandButton    id="prop-events-open-button"
                                                                    ajax="false"
                                                                    styleClass="noFill button-size-small"
                                                                    action="#{propertyProfileBB.onViewEventButtonChange(event)}"
                                                                    value="View Event"
                                                                    icon="fa fa-folder-open-o"
                                                                    />
                                            </p:column>
                                        </p:dataTable>
                                    </h:form>
                                </p:panel>

                            </div>
                        </div>

                        <p:dialog id="property-broadview-dialog"
                                  modal="true"
                                  height="500" 
                                  width="800"
                                  widgetVar="property-broadview-dialog-var"
                                  closable="true"
                                  closeOnEscape="true"
                                  responsive="true"
                                  resizable="true"
                                  dynamic="true"
                                  header="Change the broadview photo on Parcel ID: #{propertyProfileBB.currentProperty.countyParcelID}"
                                  rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                  >

                            <h:form id="property-broadview-form">


                                <p:spacer height="5px" />

                                <p:dataTable id="blob-table"
                                             value="#{propertyProfileBB.broadViewPhotoCandidates}"
                                             var="bvblob"
                                             rowKey="#{bvblob.photoDocID}"
                                             resizableColumns="true"
                                             >

                                    <p:column headerText="PhotoDoc ID"
                                              style="width:5%;">
                                        <h:outputText value="#{bvblob.photoDocID}" />
                                    </p:column>
                                    <p:column headerText="Blob ID"
                                              style="width:5%;">
                                        <h:outputText value="#{bvblob.bytesID}" />
                                    </p:column>

                                    <p:column headerText="Type"
                                              style="width:10%;">
                                        <h:outputText value="#{bvblob.type.title}" />
                                    </p:column>
                                    <p:column headerText="Timestamp"
                                              style="width:15%;">
                                        <h:outputText value="#{bvblob.createdTS}" />
                                    </p:column>
                                    <p:column headerText="Title / Descr"
                                              style="width:20%;">
                                        <h:outputText value="#{bvblob.title}" />
                                        <p:spacer height="5px" />
                                        <h:outputText value="#{bvblob.description}" />
                                    </p:column>
                                    <p:column headerText="Preview"
                                              style="width:30%;">
                                        <p:graphicImage value="#{blobsterBB.image}"
                                                        alt="no preview available" 
                                                        style="width: 150px" 
                                                        cache="false"
                                                        rendered="#{bvblob.type.browserViewable}">
                                            <f:param name="blobid" value="#{bvblob.photoDocID}"/>
                                        </p:graphicImage>

                                        <h:outputText value="no preview available; download to view"
                                                      rendered="#{!bvblob.type.browserViewable}" />
                                    </p:column>
                                    <p:column headerText="Actions"
                                              style="width:15%;">
                                        <p:commandLink id="bvblob-viewblob-cl"
                                                       actionListener="#{blobUtilitiesBB.onViewBlobLinkClick(bvblob, propertyProfileBB.currentProperty)}"
                                                       value="view"
                                                       style="color:blue; font-weight: bold;"
                                                       rendered="#{bvblob.type.browserViewable}"
                                                       update="blobs-viewblob-dialog
                                                       blob-viewblob-form"
                                                       oncomplete="PF('blobs-viewblob-dialog-var').show();" />

                                        <h:outputText value=" | "/>

                                        <p:commandLink id="bvblob-select-cl"
                                                       actionListener="#{propertyProfileBB.onChangeBroadviewPhotoCommitLinkClick(bvblob)}"
                                                       value="select"
                                                       style="color:blue; font-weight: bold;"
                                                       rendered="true"
                                                       update="property-messages-global
                                                       parcel-photo-form" 
                                                       oncomplete="PF('property-broadview-dialog-var').hide();"/>

                                    </p:column>
                                </p:dataTable>
                            </h:form>
                        </p:dialog>


                        <p:dialog id="cecase-add-dialog"
                                  modal="true"
                                  height="500" 
                                  width="600"
                                  widgetVar="cecase-add-dialog-var"
                                  closable="true"
                                  closeOnEscape="true"
                                  responsive="true"
                                  resizable="true"
                                  dynamic="true"
                                  header="Create code enforcement case at #{propertyProfileBB.currentProperty.address.addressPretty1Line}, Parcel ID: #{propertyProfileBB.currentProperty.countyParcelID}"
                                  rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                  >

                            <h:form id="cecase-add-form">

                                <div class="p-grid">
                                    <div class="p-col-4">
                                        <h:outputLabel value="Case Name" 
                                                       for="caseNameIT"/>
                                        <p:commandButton id="casename-help-button"
                                                         icon="fa fa-question-circle-o"
                                                         styleClass="button-help"
                                                         type="button" />

                                        <p:overlayPanel for="casename-help-button"
                                                        style="width:350px;" 
                                                        dismissable="true"
                                                        showCloseIcon="true">
                                            <h3>Code enforcement case names</h3>
                                            <p>A case's name is a text field for INTERNAL office use only that allows managers to label a case something memorable,
                                                such as 'deer feeding lady' or 'fridge in front yard' or 'imploded garage'. The case name appears on the dashboard's
                                                case list for easy ID but does not by default print on case list reports .</p>
                                        </p:overlayPanel>

                                    </div>
                                    <div class="p-col-8">
                                        <p:inputText    id="caseNameIT" 
                                                        value="#{propertyProfileBB.currentCECase.caseName}" 
                                                        style="width: 100%;" 
                                                        tabindex="1" 
                                                        required="false" />
                                    </div>

                                    <div class="p-col-4">
                                        <h:outputLabel value="Case Opening Date" 
                                                       for="formOpenDateCal"/>
                                    </div>
                                    <div class="p-col-8">
                                        <p:datePicker       value="#{propertyProfileBB.currentCECase.originationDate}" 
                                                            id="cecase-add-origdate-picker"
                                                            showButtonBar="true"
                                                            monthNavigator="true"
                                                            timeInput="true"
                                                            yearNavigator="true"
                                                            hideOnDateTimeSelect="true"
                                                            showOnFocus="false"
                                                            showIcon="true"
                                                            mask="false"
                                                            tabindex="16" >

                                        </p:datePicker>
                                    </div>
                                    <div class="p-col-4">
                                        <h:outputLabel value="Case manager" />
                                    </div>
                                    <div class="p-col-8">

                                        <p:selectOneMenu rendered="true"
                                                         value="#{propertyProfileBB.currentCECase.caseManager}"
                                                         converter="userConverter">
                                            <f:selectItem itemLabel="select a case manager"
                                                          noSelectionOption="true" 
                                                          itemDisabled="true"/>
                                            <f:selectItems value="#{systemServicesBB.bbSessionMuni.swornOfficerList}" 
                                                           var="user"
                                                           itemLabel="#{user.human.name} (#{user.username})"
                                                           itemValue="#{user}"/>
                                        </p:selectOneMenu>
                                    </div>
                                    <div class="p-col-4">
                                        <h:outputLabel value="Origination category" 
                                                       for="cecase-add-origevent-som"/>

                                        <p:commandButton id="case-originationevent-help-button"
                                                         icon="fa fa-question-circle-o"
                                                         styleClass="button-help"
                                                         type="button" />

                                        <p:overlayPanel for="case-originationevent-help-button"
                                                        style="width:350px;" 
                                                        dismissable="true"
                                                        showCloseIcon="true">
                                            <h3>Origination events</h3>
                                            <p>An origination event is automatically attached to a code enforcement case to signal 
                                                where the case came from, such as resulting from an officer's routine patrol or from
                                                a lapsed occupancy permit inspection with outstanding violation.</p>

                                            <p>By selecting an accurate event category from this list now, 
                                                the case's even history will be accurate from the beginning.</p>
                                        </p:overlayPanel>

                                    </div>
                                    <div class="p-col-8">
                                        <h:selectOneMenu id="cecase-add-origevent-som"
                                                         value="#{propertyProfileBB.ceCaseOriginationEventSelected}"
                                                         required="true">

                                            <f:converter converterId="eventCategoryConverter"/>
                                            <f:selectItem itemLabel="select an event category"
                                                          noSelectionOption="true" 
                                                          itemDisabled="true"/>
                                            <f:selectItems id="cecase-add-origevent-selectitems"
                                                           value="#{propertyProfileBB.ceCaseOriginiationEventCandidateList}"
                                                           var="ec" 
                                                           itemValue="#{ec}" 
                                                           itemLabel="#{ec.eventCategoryTitle}"/>
                                        </h:selectOneMenu>
                                    </div>

                                    <div class="p-col-4">
                                        <h:outputLabel value="Associated with unit?" />
                                    </div>
                                    <div class="p-col-8">

                                        <p:inputSwitch value="#{propertyProfileBB.ceCaseUnitAssociated}"
                                                       onLabel="Yes"
                                                       offLabel="No">
                                            <p:ajax update="cecase-unit-som" />
                                        </p:inputSwitch>

                                        <h:selectOneMenu id="cecase-unit-som"
                                                         value="#{propertyProfileBB.ceCaseUnitAssociation}"
                                                         required="false"
                                                         disabled="#{!propertyProfileBB.ceCaseUnitAssociated}">

                                            <f:converter converterId="propertyUnitConverter"/>
                                            <f:selectItem itemLabel="select a unit on current property"
                                                          noSelectionOption="true" 
                                                          itemDisabled="true"/>
                                            <f:selectItems id="cecase-unit-selectitems"
                                                           value="#{propertyProfileBB.currentProperty.unitList}"
                                                           var="pu" 
                                                           itemValue="#{pu}" 
                                                           itemLabel="#{pu.unitNumber} (ID:#{pu.unitID})"/>
                                        </h:selectOneMenu>
                                    </div>

                                    <div class="p-col-4">
                                        <h:outputLabel value="Case opening notes" 
                                                       for="cecase-add-notes"/>
                                    </div>
                                    <div class="p-col-8">
                                        <p:inputTextarea    id="cecase-add-notes"
                                                            value="#{propertyProfileBB.currentCECase.notes}"
                                                            rows="5"
                                                            cols="30" />
                                        <p:spacer height="3px" />

                                        <p style="font-style: italic">Your name and the date will be automatically included in the note.</p>
                                    </div>
                                </div>

                                <p:spacer height="5px" />

                                <p:commandButton ajax="false" 
                                                 tabindex="5" 
                                                 icon="fa fa-archive"
                                                 value="Open Code Enforcement Case" 
                                                 action="#{propertyProfileBB.onAddNewCaseCommitButtonChange}" />

                            </h:form>
                        </p:dialog>


                        <p:dialog id="prop-remove-dialog"
                                  modal="true"
                                  height="300" 
                                  width="550"
                                  widgetVar="prop-remove-dialog-var"
                                  closable="true"
                                  header="Remove property #{propertySaddressString.currentProperty.address}"
                                  rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                  >

                            <h:form id="propinfo-remove-form">

                                <p>Caution: This action is like 'delete'; we have to dig the record back out by
                                    hand if you goof.</p>
                                <p:commandButton icon="fa fa-trash"
                                                 ajax="false"
                                                 action="#{propertyProfileBB.onRemoveButtonChange}"
                                                 value="Permanently remove property ID:#{propertyProfileBB.currentProperty.propertyID}"
                                                 />

                            </h:form>
                        </p:dialog>




                        <p:dialog   id="propinfo-notes-dialog"
                                    height="450" width="750"
                                    widgetVar="propinfo-notes-dialog-var"
                                    closable="true"
                                    dynamic="true"
                                    closeOnEscape="true"
                                    header="Append note to Property with parcelkey #{propertyProfileBB.currentProperty.parcelKey}"
                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                    >

                            <h:form id="propinfo-note-create-form">

                                <h:messages id="propinfo-dialog-note-messages"
                                            globalOnly="true" showDetail="true" showSummary="true"
                                            warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                </h:messages>


                                <h:outputText styleClass="ui-label" value="Note text: (Your name and date are automatically included) "/>
                                <p:spacer height="5px" />
                                <p:textEditor   id="propinfo-notes-editor"
                                                value="#{propertyProfileBB.formNoteText}"
                                                secure="false"
                                                required="false"
                                                height="200"/>


                                <p:spacer height="5px" />
                                <p:commandButton    id="propinfo-updatemetadata-button-cancel"
                                                    ajax="true"  tabindex="27"
                                                    value="Cancel"
                                                    icon="fa fa-stop"
                                                    immediate="true"
                                                    onclick="PF('propinfo-notes-dialog-var').hide()"
                                                    />

                                <p:commandButton   id="propinfo-dialog-notes-button-addnote"
                                                   ajax="true" 
                                                   actionListener="#{propertyProfileBB.onParcelNoteAppendCommit}"
                                                   oncomplete="PF('propinfo-notes-dialog-var').hide()"
                                                   rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"                                                                               
                                                   value="Attach Note"  
                                                   styleClass="inline-button"
                                                   icon="fa fa-sticky-note-o"
                                                   update="propinfo-notes-form
                                                   property-messages-global"/>
                            </h:form>
                        </p:dialog>
                    </div>
                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

