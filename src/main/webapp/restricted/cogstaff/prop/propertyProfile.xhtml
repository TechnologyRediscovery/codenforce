<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Property Profile</title>
    </h:head>
    <h:body>
        <ui:composition template="/restricted/navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view id="prop-info-view">

                    <!-- GLOBAL MESSAGES -->
                    <h:form id="form-messages-global">
                        <p:growl id="messages-global" showDetail="false"/>
                    </h:form>

                    <div class="mainContainer">

                        <div class="page-links">
                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#propinfo-panel-info">property info</a>
                            </div>

                            <h:outputText value=" | " />

                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-cases-panel">
                                    <h:outputText value="code enf cases (#{propertyProfileBB.currentProperty.ceCaseList.size()})" />
                                </a>
                            </div>

                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-periods-panel">
                                    <h:outputText value="occupancy periods (#{propertyProfileBB.currentProperty.completePeriodList.size()})" />
                                </a>
                            </div>

                            <h:outputText value=" | " />

                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-units-panel">
                                    <h:outputText value="units (#{propertyProfileBB.currentProperty.unitWithListsList.size()})" />
                                </a>
                            </div>

                            <h:outputText value=" | " />

                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-persons-panel">
                                    <h:outputText value="persons (#{propertyProfileBB.currentProperty.humanLinkList.size()})" />
                                </a>
                            </div>

                            <h:outputText value=" | " />

                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-events-panel">
                                    <h:outputText value="events (#{propertyProfileBB.currentProperty.completeEventList.size()})" />
                                </a>
                            </div>

                            <h:outputText value=" | " />


                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#propinfo-notes-panel">notes</a>
                            </div>

                            <h:outputText value=" | " />


                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-blobs-panel">docs and photos</a>
                            </div>
                            <h:outputText value=" | " />


                            <div class="restrict-main-contents-io-link link-button">
                                <a href="#prop-extinfo-panel">external data</a>
                            </div>
                        </div>

                        <!-- DATA CONTAINER -->
                        <div class="p-grid nested-grid">

                            <!-- OBJECT DATA CONTAINER --> 
                            <div class="p-col">

                                <p:panel id="property-tools-panel"
                                         toggleable="true"
                                         collapsed="false"
                                         header="Property tools: #{propertyProfileBB.currentProperty.muni.muniName}"
                                         rendered="true"
                                         >

                                    <h:form id="property-tools-form">

                                        <p:commandButton id="prop-add-init-cb"
                                                         ajax="true"
                                                         value="Add new property"
                                                         icon="fa fa-plus"
                                                         actionListener="#{propertyProfileBB.onPropertyAddInit}"
                                                         oncomplete="PF('prop-addupdate-dialog-var').show();"
                                                         update="prop-addupdate-dialog
                                                         prop-addupdate-form" />
                                    </h:form>
                                </p:panel>

                                <!-- OBJECT DATA PANEL--> 
                                <p:panel id="parcel-info-panel"
                                         toggleable="true"
                                         collapsed="false"
                                         header="Parcel #{propertyProfileBB.currentProperty.countyParcelID} (#{propertyProfileBB.currentProperty.muni.muniName})"
                                         rendered="true"
                                         >
                                    <h:form id="parcel-info-form">
                                        <div class="p-grid">

                                            <div class="p-col-4 data_field_label">
                                                <h:outputText value="Parcel ID (County)"  />
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.countyParcelID} "/>
                                            </div>


                                            <div class="p-col-4 data_field_label">
                                                <h:outputText value="Municipality" />
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.muni.muniName} (#{propertyProfileBB.currentProperty.muni.muniCode} "/>
                                            </div>

                                            <div class="p-col-4 data_field_label">
                                                <h:outputText value="InternalID" />
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.propertyID} "/>
                                            </div>

                                            <div class="p-col-4 data_field_label">
                                                <h:outputText value="Source" />
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.source.title} "/>
                                            </div>

                                            <div class="p-col-4 data_field_label">
                                                <h:outputText value="Created" />
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.getPrettyDate(propertyProfileBB.currentProperty.createdTS)} "/>
                                            </div>

                                            <div class="p-col-4 data_field_label">
                                                <h:outputText value="Last Updated" />
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.getPrettyDate(propertyProfileBB.currentProperty.lastUpdatedTS)}" />
                                            </div>

                                        </div>
                                    </h:form>
                                </p:panel>

                                <p:panel id="parcel-addresses-panel"
                                         toggleable="true"
                                         collapsed="false"
                                         header="Addresses on Parcel #{propertyProfileBB.currentProperty.countyParcelID} "
                                         rendered="true"
                                         >

                                    <h:form id="parcel-addresses-form">

                                        <p:commandButton id="parcel-address-add-init-cb"
                                                         ajax="true"
                                                         value="Connect Address"
                                                         icon="fa fa-plus"
                                                         actionListener="#{propertyProfileBB.onLinkNewAddressToParcelButtonChange}"
                                                         />
                                        
                                        <p:spacer height="5px" />

                                        <p:dataTable    id="parcel-addresses-table"
                                                        value="#{propertyProfileBB.currentProperty.addresses}"
                                                        var="pma"
                                                        rowKey="#{pma.addressID}"
                                                        tableStyleClass="primeDataTable"
                                                        draggableRows="true" 
                                                        tabindex="6">


                                            <p:column width="10%">
                                                <f:facet name="header">
                                                    <h:outputText value="ID"/>
                                                </f:facet>
                                                <h:outputText value="#{pma.addressID}" />
                                            </p:column>

                                            <p:column width="50%">
                                                <f:facet name="header">
                                                    <h:outputText value="Address"/>
                                                </f:facet>

                                                <h:outputText value="#{pma.addressPretty2LineEscapeFalse}"
                                                              escape="false"/>
                                            </p:column>

                                            <p:column width="25%">
                                                <f:facet name="header">
                                                    <h:outputText value="Actions"/>
                                                </f:facet>

                                                <p:commandLink      id="parcel-addr-actions-cl"
                                                                    ajax="true"
                                                                    actionListener="#{addressBB.onMailingAddressViewEditLinkClick(hmal)}"
                                                                    style="color:blue;"
                                                                    oncomplete="PF('address-dialog-var').show()"
                                                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                                    update="address-info-form
                                                                    address-links-form"
                                                                    value="view/edit" />
                                            </p:column>
                                        </p:dataTable>
                                    </h:form>
                                </p:panel>

                                <p:panel id="propinfo-panel-info"
                                         toggleable="true"
                                         collapsed="false"
                                         header="#{propertyProfileBB.currentProperty.countyParcelID} (#{propertyProfileBB.currentProperty.muni.muniName})"
                                         rendered="true"
                                         >
                                    <h:form id="evruleconfig-panel-info-form">


                                        <p:commandButton id="prop-update-init-cb"
                                                         ajax="true"
                                                         value="Update property"
                                                         icon="fa fa-edit"
                                                         actionListener="#{propertyProfileBB.onPropertyUpdateInit}"
                                                         oncomplete="PF('prop-addupdate-dialog-var').show();"
                                                         update="prop-addupdate-dialog
                                                         prop-addupdate-form" />

                                        <p:spacer height="5px" />
                                        
                                        
                                        
                                        
                                        
                                <div    id="prop-add-parid-div"
                                        class="ui-g-12 ui-md-12 ui-lg-12 data_field">

                                    <p:outputLabel value="ParcelID"
                                                   for="prop-add-parid-it"/>

                                    <p:inputText    id="prop-add-parid-it"
                                                    value="#{propertyProfileBB.currentProperty.parID}"/>
                                </div>

                                <div    id="prop-add-usegroup-div"
                                        class="ui-g-12 ui-md-12 ui-lg-12 data_field">

                                    <p:outputLabel value="Use Group"
                                                   for="prop-add-usegroup-it"/>

                                    <p:inputText    id="prop-add-usegroup-it"
                                                    value="#{propertyProfileBB.currentProperty.useGroup}"/>
                                </div>


                                <div    id="prop-add-const-div"
                                        class="ui-g-12 ui-md-12 ui-lg-12 data_field">

                                    <p:outputLabel value="Construction type"
                                                   for="prop-add-const-it"/>

                                    <p:inputText    id="prop-add-const-it"
                                                    value="#{propertyProfileBB.currentProperty.constructionType}"/>
                                </div>


                                <ui:remove>


                                    <div    id="prop-add-cond-div"
                                            class="ui-g-12 ui-md-12 ui-lg-12 data_field">

                                        <p:outputLabel  value="Condition"
                                                        for="prop-add-condition-som"/>

                                        <h:selectOneMenu id="prop-add-condition-som"
                                                         value="#{propertyProfileBB.currentProperty.condition}" style="width:175px;height:25px">
                                            <f:converter converterId="intensityClassConverter"/>
                                            <f:selectItem itemLabel="select a muni..." noSelectionOption="true" />
                                            <f:selectItems id="propinfoedit-condition-selitems"
                                                           value="#{propertyProfileBB.conditionIntensityList}"
                                                           var="ic" itemValue="#{ic}" itemLabel="#{ic.numericRating}: #{ic.title}"/>

                                        </h:selectOneMenu>
                                    </div>

                                    <div    id="prop-add-landprospect-div"
                                            class="ui-g-12 ui-md-12 ui-lg-12 data_field">

                                        <p:outputLabel  value="Land Bank Prospect"
                                                        for="prop-add-landprospect-som"/>

                                        <h:selectOneMenu id="prop-add-landprospect-som"
                                                         value="#{propertyProfileBB.currentProperty.landBankProspect}" style="width:175px;height:25px">
                                            <f:converter converterId="intensityClassConverter"/>
                                            <f:selectItem itemLabel="select a muni..." noSelectionOption="true" />
                                            <f:selectItems id="propinfoedit-landprospect-selitems"
                                                           value="#{propertyProfileBB.landBankProspectIntensityList}"
                                                           var="ic" itemValue="#{ic}" itemLabel="#{ic.numericRating}: #{ic.title}"/>

                                        </h:selectOneMenu>
                                    </div>

                                    <div    id="prop-add-source-div"
                                            class="ui-g-12 ui-md-12 ui-lg-12 data_field">

                                        <p:outputLabel  value="Object Source"
                                                        for="prop-add-source-som"/>

                                        <h:selectOneMenu id="prop-add-source-som"
                                                         value="#{propertyProfileBB.currentProperty.bobSource}" style="width:175px;height:25px">
                                            <f:converter converterId="bobSourceConverter"/>
                                            <f:selectItem itemLabel="select a source..." noSelectionOption="true" />
                                            <f:selectItems id="propinfoedit-sourcess-elitems"
                                                           value="#{propertyProfileBB.sourceList}"
                                                           var="bs" itemValue="#{bs}" itemLabel="#{bs.title}"/>

                                        </h:selectOneMenu>
                                    </div>

                                </ui:remove>

                                <div    id="prop-add-unfit-div"
                                        class="ui-g-12 ui-md-12 ui-lg-12 data_field">

                                    <p:outputLabel value="Unfit Start Date"
                                                   for="prop-add-unfit-start-cal"/>

                                    <p:calendar id="prop-add-unfit-start-cal"
                                                value="#{propertyProfileBB.currentProperty.unfitDateUtilStart}"
                                                mode="popup"
                                                pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                navigator="true"
                                                tabindex="16"
                                                timeInput="true"
                                                showHour="true" showMinute="false" showSecond="false" showMillisec="false"
                                                showButtonPanel="true"
                                                showTodayButton="true"
                                                maxdate="#{propertyProfileBB.currentProperty.unfitDateUtilStop}">
                                    </p:calendar>
                                </div>

                                <div    id="prop-add-unfit-div"
                                        class="ui-g-12 ui-md-12 ui-lg-12 data_field">

                                    <p:outputLabel value="Unfit End Date"
                                                   for="prop-add-unfit-end-cal"/>
                                    <p:spacer height="3px"/>
                                    <p:calendar id="prop-add-unfit-end-cal"
                                                value="#{propertyProfileBB.currentProperty.unfitDateUtilStop}"
                                                mode="popup"
                                                pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                navigator="true"
                                                tabindex="16"
                                                timeInput="true"
                                                showHour="true" showMinute="false" showSecond="false" showMillisec="false"
                                                showButtonPanel="true"
                                                showTodayButton="true"
                                                mindate="#{propertyProfileBB.currentProperty.unfitDateUtilStart}">
                                    </p:calendar>

                                </div>

                                <div    id="prop-add-vacant-div"
                                        class="ui-g-12 ui-md-12 ui-lg-12 data_field">

                                    <p:outputLabel  value="Vacant Start Date"
                                                    for="prop-add-vacant-start-cal"/>

                                    <p:calendar id="prop-add-vacant-start-cal"
                                                value="#{propertyProfileBB.currentProperty.vacantDateUtilStart}"
                                                mode="popup"
                                                pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                navigator="true"
                                                tabindex="16"
                                                timeInput="true"
                                                showHour="true" showMinute="false" showSecond="false" showMillisec="false"
                                                showButtonPanel="true"
                                                showTodayButton="true"
                                                maxdate="#{propertyProfileBB.currentProperty.vacantDateUtilStop}">
                                    </p:calendar>
                                </div>

                                <div    id="prop-add-vacant-stop-div"
                                        class="ui-g-12 ui-md-12 ui-lg-12 data_field">

                                    <p:outputLabel value="Vacant Stop Date"
                                                   for="prop-add-vacant-stop-cal"/>

                                    <p:calendar id="prop-add-vacant-stop-cal"
                                                value="#{propertyProfileBB.currentProperty.vacantDateUtilStop}"
                                                mode="popup"
                                                pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                navigator="true"
                                                tabindex="16"
                                                timeInput="true"
                                                showHour="true" showMinute="false" showSecond="false" showMillisec="false"
                                                showButtonPanel="true"
                                                showTodayButton="true"
                                                mindate="#{propertyProfileBB.currentProperty.vacantDateUtilStart}">
                                    </p:calendar>
                                </div>

                                <div    id="prop-add-abandoned-div"
                                        class="ui-g-12 ui-md-12 ui-lg-12 data_field">

                                    <p:outputLabel value="Abandoned Start Date"
                                                   for="prop-add-abandoned-start-cal"/>

                                    <p:calendar id="prop-add-abandoned-start-cal"
                                                value="#{propertyProfileBB.currentProperty.abandonedDateUtilStart}"
                                                mode="popup"
                                                pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                navigator="true"
                                                tabindex="16"
                                                timeInput="true"
                                                showHour="true" showMinute="false" showSecond="false" showMillisec="false"
                                                showButtonPanel="true"
                                                showTodayButton="true"
                                                maxdate="#{propertyProfileBB.currentProperty.abandonedDateUtilStop}">
                                    </p:calendar>
                                </div>

                                <div    id="prop-add-abandoned-stop-div"
                                        class="ui-g-12 ui-md-12 ui-lg-12 data_field">

                                    <p:outputLabel value="Abandoned Stop Date"
                                                   for="prop-add-abandoned-stop-cal"/>

                                    <p:calendar id="prop-add-abandoned-stop-cal"
                                                value="#{propertyProfileBB.currentProperty.abandonedDateUtilStop}"
                                                mode="popup"
                                                pattern="EEE, dd MMM, yyyy HH:mm:ss"
                                                navigator="true"
                                                tabindex="16"
                                                timeInput="true"
                                                showHour="true" showMinute="false" showSecond="false" showMillisec="false"
                                                showButtonPanel="true"
                                                showTodayButton="true"
                                                mindate="#{propertyProfileBB.currentProperty.abandonedDateUtilStart}">
                                    </p:calendar>
                                </div>




                                    <p:commandButton    id="prop-add-discard-button-2"
                                                        icon="fa fa-trash-o"
                                                        ajax="true"
                                                        action="#{propertyProfileBB.onDiscardNewPropertyDataButtonChange}"
                                                        value="Discard new record"
                                                        rendered="#{propertyProfileBB.currentProperty.propertyID == 0}"
                                                        />
               


                                        <div class="p-grid">

                                            <div class="p-col-4 data_field_label">
                                                <h:outputLabel value="County"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.countyCode}" />
                                            </div>
                                         
                                            <div class="p-col-4 data_field_label">
                                                <h:outputLabel value="Condition"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.condition)
                                                                       ? propertyProfileBB.currentProperty.parcelInfo.condition.title
                                                                       : ''}" />
                                            </div>

                                            <div class="p-col-4 data_field_label">
                                                <h:outputLabel value="Use Type"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.useType.name}" />
                                            </div>

                                            <div class="p-col-4 data_field_label">
                                                <h:outputLabel value="Non-Addressable"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.nonAddressable? 'Yes': 'No'}" />
                                            </div>

                                            <div class="p-col-4 data_field_label">
                                                <h:outputLabel value="TCLB Held"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.landBankHeld ? 'Yes': 'No'}" />
                                            </div>

                                            <div class="p-col-4 data_field_label">
                                                <h:outputLabel value="Land bank prospect"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.landBankProspect)
                                                                       ? propertyProfileBB.currentProperty.parcelInfo.landBankProspect.title : ' '}" />
                                            </div>


                                            <div class="p-col-4 data_field_label">
                                                <h:outputLabel value="Info record source"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.currentProperty.parcelInfo.bobSource.title}" />
                                            </div>

                                            <div class="p-col-4 data_field_label">
                                                <h:outputLabel value="Info record creation"/>
                                            </div>
                                            <div class="p-col-8">
                                                <h:outputText value="#{propertyProfileBB.getPrettyDate(proertyProfileBB.currentProperty.parcelInfo.createdTS)}" />
                                            </div>
                                        </div>

                                        <p:spacer height="5px" />

                                        <div class="ui-g data_container_nested_restrict">

                                            <div class="ui-g-3 ui-md-3 ui-lg-3 restrict-data-field-vertical">
                                                <div class="restrict-data-field-label-vertical" >
                                                    <h:outputLabel value=" "/>
                                                </div>
                                                <div class="restrict-data-field-value-vertical" style="font-weight: 700;">
                                                    Start Date:
                                                </div>
                                                <div class="restrict-data-field-value-vertical" style="font-weight: 700;">
                                                    End Date:
                                                </div>

                                            </div>

                                            <div class="ui-g-3 ui-md-3 ui-lg-3 restrict-data-field-vertical">
                                                <div class="restrict-data-field-label-vertical" >
                                                    <h:outputLabel value="Unfitness of Occupancy"/>
                                                </div>
                                                <div class="restrict-data-field-value-vertical" >
                                                    <h:outputText id="propinfo-ot-unfitstart-1"
                                                                  value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.unfitDateStart) ? propertyProfileBB.getPrettyDateNoTime(propertyProfileBB.currentProperty.parcelInfo.unfitDateStart) : ''}" />
                                                </div>
                                                <div class="restrict-data-field-value-vertical" >
                                                    <h:outputText id="propinfo-ot-unfitstop-1"
                                                                  value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.unfitDateStop) ? propertyProfileBB.getPrettyDateNoTime(propertyProfileBB.currentProperty.parcelInfo.unfitDateStop) : ''}" />
                                                </div>

                                            </div>

                                            <div class="ui-g-3 ui-md-3 ui-lg-3 restrict-data-field-vertical">
                                                <div class="restrict-data-field-label-vertical" >
                                                    <h:outputLabel value="Vacancy"/>
                                                </div>
                                                <div class="restrict-data-field-value-vertical" >

                                                    <h:outputText id="propinfo-ot-vacantstart-1"
                                                                  value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.vacantDateStart) ? propertyProfileBB.getPrettyDateNoTime(propertyProfileBB.currentProperty.parcelInfo.vacantDateStart) : ''}" />

                                                </div>
                                                <div class="restrict-data-field-value-vertical" >
                                                    <h:outputText id="propinfo-ot-vacantstop-1"
                                                                  value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.vacantDateStop) ? propertyProfileBB.getPrettyDateNoTime(propertyProfileBB.currentProperty.parcelInfo.vacantDateStop) : ''}" />
                                                </div>

                                            </div>

                                            <div class="ui-g-3 ui-md-3 ui-lg-3 restrict-data-field-vertical">
                                                <div class="restrict-data-field-label-vertical" >
                                                    <h:outputLabel value="Abandonment"/>
                                                </div>
                                                <div class="restrict-data-field-value-vertical" >
                                                    <h:outputText id="propinfo-ot-abandonedstart-1"
                                                                  value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.abandonedDateStart) ? propertyProfileBB.getPrettyDateNoTime(propertyProfileBB.currentProperty.parcelInfo.abandonedDateStart) : ''}" />

                                                </div>
                                                <div class="restrict-data-field-value-vertical" >
                                                    <h:outputText id="propinfo-ot-abandonedstop-1"
                                                                  value="#{!(empty propertyProfileBB.currentProperty.parcelInfo.abandonedDateStop) ? propertyProfileBB.getPrettyDateNoTime(propertyProfileBB.currentProperty.parcelInfo.abandonedDateStop) : ''}" />
                                                </div>
                                            </div>
                                        </div>
                                    </h:form>
                                </p:panel>

                                <p:panel    id="prop-cases-panel"
                                            toggleable="true"
                                            widgetVar="prop-cases-panel-var"
                                            collapsed="false"
                                            header="Code Enforcement Cases"
                                            rendered="true">
                                    <h:form id="prop-cases-panel-form">

                                        <p:commandButton   id="prop-cases-newcase-button"
                                                           ajax="fase"
                                                           action="#{propertyProfileBB.onCreateNewCaseButtonChange}"
                                                           rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                           value="Create New Code Enforcement Case"
                                                           icon="fa fa-archive"
                                                           />

                                        <p:spacer height="5px" />

                                        <p:dataTable id="prop-cases-table"
                                                     var="cse"
                                                     value="#{propertyProfileBB.currentProperty.ceCaseList}"
                                                     tableStyleClass="primeDataTable"
                                                     rowKey="#{cse.caseID}"
                                                     >

                                            <p:column headerText="Date Opened"
                                                      styleClass="centeredColumnContent"
                                                      sortBy="#{cse.originationDate}">

                                                <h:outputText value="#{!(empty cse.originationDate) ? propertyProfileBB.getPrettyDate(cse.originationDate) : ''}"/>

                                            </p:column>

                                            <p:column headerText="Status"
                                                      styleClass="centeredColumnContent">

                                                <h:outputText value="#{cse.statusBundle.phase.caseOpen ? 'Open' : 'Closed'}"/>

                                            </p:column>

                                            <p:column headerText="Name"
                                                      styleClass="centeredColumnContent">

                                                <h:outputText value="#{cse.caseName}"/>

                                            </p:column>

                                            <p:column headerText="Manager"
                                                      styleClass="centeredColumnContent">

                                                <h:outputText value="#{!(empty cse.caseManager) ? cse.caseManager.human.name:'No manager '}"/>

                                            </p:column>
                                            <p:column headerText="ID"
                                                      styleClass="centeredColumnContent">

                                                <h:outputText value="#{cse.caseID}"/>

                                            </p:column>

                                            <p:column headerText="Options"
                                                      styleClass="centeredColumnContent">

                                                <p:commandButton    id="prop-person-viewcase-button"
                                                                    ajax="false"
                                                                    styleClass="noFill button-size-small"
                                                                    action="#{propertyProfileBB.onViewCaseButtonChange(cse)}"
                                                                    icon="fa fa-folder-open-o"
                                                                    value="View"
                                                                    />

                                            </p:column>
                                        </p:dataTable>
                                    </h:form>
                                </p:panel>

                                <p:panel    id="prop-periods-panel"
                                            toggleable="true"
                                            widgetVar="prop-periods-list-panel-var"
                                            collapsed="false"
                                            header="Occupancy periods">

                                    <h:form id="prop-periods-form">

                                        <p:dataTable id="prop-periods-table"
                                                     var="period"
                                                     value="#{propertyProfileBB.currentProperty.completePeriodList}"
                                                     tableStyleClass="primeDataTable"
                                                     rowKey="#{period.periodID}"
                                                     >
                                            <p:column width="10%" 
                                                      headerText="Exp.">
                                                <p:rowToggler/>
                                            </p:column>

                                            <p:column width="8%">
                                                <f:facet name="header">
                                                    <h:outputText value="Period ID"/>
                                                </f:facet>
                                                <h:outputText value="#{period.periodID}" />
                                            </p:column>
                                            <p:column width="8%">
                                                <f:facet name="header">
                                                    <h:outputText value="Unit ID"/>
                                                </f:facet>
                                                <h:outputText value="#{period.propertyUnitID}" />
                                            </p:column>
                                            <p:column width="15%">
                                                <f:facet name="header">
                                                    <h:outputText value="Type"/>
                                                </f:facet>
                                                <h:outputText value="#{period.type.title}" />
                                            </p:column>


                                            <p:column width="15%">
                                                <f:facet name="header">
                                                    <h:outputText value="Dates"/>
                                                </f:facet>
                                                <h:outputText value="Start Date: " 
                                                              styleClass="ui-label-inline" />

                                                <h:outputText value="#{propertyProfileBB.getPrettyDate(period.startDate)}" 
                                                              styleClass="data-text"/>

                                                <p:spacer height="3px" />

                                                <h:outputText value="End Date: " 
                                                              styleClass="ui-label-inline" />

                                                <h:outputText value="#{propertyProfileBB.getPrettyDate(period.endDate)}" 
                                                              styleClass="data-text"/>
                                            </p:column>

                                            <p:column width="15%">
                                                <f:facet name="header">
                                                    <h:outputText value="Actions"/>
                                                </f:facet>
                                                <p:commandButton       id="button-occperiodtable-exploreperiod"
                                                                       value="explore occ period"  
                                                                       ajax="false" 
                                                                       action="#{propertyProfileBB.exploreOccPeriod(period)}"
                                                                       rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                                       icon="fa fa-binoculars"/>
                                            </p:column>
                                        </p:dataTable>
                                    </h:form>

                                </p:panel>

                                <ui:include src="compositions/unitTools.xhtml" />

                                <p:panel id="prop-blobs-panel"
                                         toggleable="true"
                                         collapsed="false"
                                         header="Files and Photos"
                                         rendered="true"
                                         >

                                    <h:form id="prop-blobs-form">

                                        <p:commandButton    id="prop-blob-add-button"
                                                            ajax="true"
                                                            styleClass="noFill button-size-small"
                                                            actionListener="#{propertyProfileBB.onBlobAddButtonChange}"
                                                            oncomplete="PF('prop-blobs-dialog-var').show()"
                                                            value="Add Photos or Documents"
                                                            icon="fa fa-upload"
                                                            />

                                        <p:spacer height="5px" />

                                        <p:dataTable
                                            id="prop-blobs-table"
                                            var="blob"
                                            value="#{propertyProfileBB.currentProperty.blobList}"
                                            rowKey="#{blob.bytesID}"
                                            tableStyleClass="primeDataTable"
                                            resizableColumns="true"
                                            draggableRows="false" tabindex="6">

                                            <p:column width="15%">
                                                <f:facet name="header">
                                                    <h:outputText value="File Type"/>
                                                </f:facet>
                                                <h:outputText value="#{blob.type.title}"/>
                                                <!-- type icon here -->
                                            </p:column>

                                            <p:column width="15%">
                                                <f:facet name="header">
                                                    <h:outputText value="IDs"/>
                                                </f:facet>
                                                <h:outputText value="linkID: #{blob.photoDocID}"/>
                                                <br/>
                                                <h:outputText value="bytesID: #{blob.bytesID}"/>

                                            </p:column>

                                            <p:column width="45%">
                                                <f:facet name="header">
                                                    <h:outputText value="Info"/>
                                                </f:facet>
                                                <div class="rowExpansion">
                                                    <h:outputText value="title: #{blob.title}"/>
                                                    <br/>
                                                    <h:outputText value="descr: #{blob.description}"/>
                                                    <br/>
                                                    <h:outputText value="filename: #{blob.filename}"/>
                                                    <br/>
                                                    <h:outputText value="created: #{propertyProfileBB.getPrettyDateNoTime(blob.createdTS)}"/>
                                                </div>
                                            </p:column>


                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputText value="Actions"/>
                                                </f:facet>
                                                <p:commandButton 
                                                    value="View in tab" 
                                                    ajax="false"
                                                    icon="fa fa-eye" 
                                                    styleClass="ui-button-outlined">
                                                    <p:fileDownload value="#{blobRetrieveBB.retrieveBlob(blob)}"
                                                                    contentDisposition="inline"
                                                                    />
                                                </p:commandButton>
                                                <br/>
                                                <p:commandButton 
                                                    value="Download" 
                                                    ajax="false"
                                                    icon="fa fa-arrow-down" 
                                                    styleClass="ui-button-outlined">
                                                    <p:fileDownload value="#{blobRetrieveBB.retrieveBlob(blob)}"
                                                                    />
                                                </p:commandButton>
                                                <br/>
                                                <div class="restrict-main-contents-io-link link-button">

                                                    <p:commandLink      id="blob-update-button"
                                                                        ajax="true"
                                                                        styleClass="noFill button-size-small"
                                                                        action="#{propertyProfileBB.onBlobSelectButtonChange(blob)}"
                                                                        value="edit"
                                                                        oncomplete="PF('blob-edit-dialog-var').show()"
                                                                        update="blob-edit-dialog
                                                                        blob-edit-form"
                                                                        />
                                                </div>


                                                <h:outputText value="&nbsp;&nbsp;|" />
                                                <div class="restrict-main-contents-io-link link-button">

                                                    <p:commandLink      id="blob-remove-button"
                                                                        ajax="true"
                                                                        styleClass="noFill button-size-small"
                                                                        action="#{propertyProfileBB.onBlobRemoveInitButtonChange(blob)}"
                                                                        value="remove"
                                                                        oncomplete="PF('blob-remove-dialog-var').show()"
                                                                        update="blob-remove-dialog
                                                                        blob-remove-form"
                                                                        />
                                                </div>
                                            </p:column>
                                        </p:dataTable>
                                    </h:form>
                                </p:panel>

                                <p:panel id="prop-workflow-panel"
                                         toggleable="true"
                                         widgetVar="prop-workflow-panel-var"
                                         collapsed="false"
                                         header="Proposals"
                                         rendered="false">
                                    <h:form id="prop-workflow-form">

                                        <p:selectOneMenu id="prop-workflow-viewoptions-som"
                                                         value="#{propertyProfileBB.selectedPropViewOption}"
                                                         tabindex="10">

                                            <f:selectItems  id="prop-workflow-viewoptions-selitems"
                                                            value="#{workflowBB.proposalsViewOptions}"
                                                            var="pvo"
                                                            itemValue="#{pvo}"
                                                            itemLabel="#{pvo.label}"/>
                                            <p:ajax update="proposals-proposalscroller"
                                                    immediate="true"/>
                                        </p:selectOneMenu>

                                        <p:dataScroller id="proposals-proposalscroller"
                                                        var="proposal"
                                                        widgetVar="proposals-proposalscroller-var"
                                                        value="#{propertyProfileBB.currentProperty.assembleProposalList(propertyProfileBB.selectedPropViewOption)}"
                                                        rowIndexVar="#{proposal.proposalID}">

                                            <div class="outlinedBox">
                                                <div class="proposal-metadata-container">
                                                    <div class="proposal-propbuttoncontainer">
                                                        <p:commandButton    id="proposal-button-showdescription"
                                                                            styleClass="noFill button-size-small button-moreinfo"
                                                                            icon="fa fa-info"/>

                                                        <p:overlayPanel id="proposal-overlaypanel-proposaldescription"
                                                                        for="proposal-button-showdescription"
                                                                        dynamic="true"
                                                                        showCloseIcon="true"
                                                                        style="width:300px"
                                                                        modal="false">

                                                            <h:outputText       styleClass="proposal-description"
                                                                                value="#{proposal.directive.description}" />
                                                        </p:overlayPanel>


                                                        <p:commandButton    id="proposal-button-rejectionreason"
                                                                            styleClass="noFill button-size-small"
                                                                            oncomplete="PF('occperiod-rejectproposal-dialog-var').show()"
                                                                            rendered="#{!proposal.directive.requiredEvaluationForBOBClose
                                                                                        or systemServicesBB.bbSessionUser.keyCard.hasSysAdminPermissions }"
                                                                            icon="fa fa-trash"/>
                                                    </div>
                                                    <div class="proposal-prophead">
                                                        <h:outputText value="#{proposal.directive.title}" />
                                                    </div>

                                                    <p:spacer height="5px" />

                                                    <h:panelGrid   id="prop-workflow-propinfo-pg"
                                                                   columns="1"
                                                                   style="clear:both;"
                                                                   columnClasses="gridTd"
                                                                   rendered="true">
                                                        <h:panelGroup>
                                                            <h:outputText styleClass="ui-label-inline"
                                                                          value="Intended for: "  />
                                                            <h:outputText styleClass="data-text"
                                                                          value="#{proposal.responderIntended.person.firstName}" />
                                                            <h:outputText styleClass="data-text"
                                                                          value=" " />
                                                            <h:outputText styleClass="data-text"
                                                                          value="#{proposal.responderIntended.person.lastName}" />
                                                        </h:panelGroup>
                                                    </h:panelGrid>
                                                </div>

                                                <p:dataScroller id="proposals-choicescroller"
                                                                var="choice"
                                                                widgetVar="proposals-choicescroller-var"
                                                                value="#{proposal.directive.choiceListVisible}"
                                                                rowIndexVar="#{choice.choiceID}">

                                                    <p:commandButton    id="proposal-choice-button-choose"
                                                                        ajax="true"
                                                                        styleClass="proposal-choice-button"
                                                                        actionListener="#{workflowBB.proposals_makeChoice(choice, proposal)}"
                                                                        disabled="#{!choice.canChoose or !(empty proposal.responseTS)}"
                                                                        value="#{choice.title}"
                                                                        icon="#{!(empty choice.icon) ? choice.icon.fontAwesome : 'fa fa-fighter-jet'}"
                                                                        title="#{choice.description}"
                                                                        update="occperiod-form-proposals
                                                                        occperiod-panel-proposals-messages-form"/>
                                                    <p:spacer height="5px" />
                                                </p:dataScroller>
                                            </div>
                                        </p:dataScroller>
                                    </h:form>
                                </p:panel>

                                <p:panel    id="prop-events-panel"
                                            toggleable="true"
                                            widgetVar="prop-events-panel-var"
                                            collapsed="false"
                                            header="Events"
                                            rendered="true">

                                    <h:form id="prop-events-panel-form">


                                        <p:selectOneMenu style="width: 300px;" 
                                                         id="prop-viewoptionsevents-solb" 
                                                         value="#{propertyProfileBB.eventViewOptionSelected}" 
                                                         tabindex="10">

                                            <p:ajax update="prop-events-datatable"                                                           
                                                    immediate="true"/>

                                            <f:selectItems  id="prop-events-selitems" 
                                                            value="#{propertyProfileBB.eventViewOptions}" 
                                                            var="evo" 
                                                            itemValue="#{evo}" 
                                                            itemLabel="#{evo.label}"/>
                                        </p:selectOneMenu>

                                        <p:spacer height="5px" />

                                        <p:dataTable id="prop-events-datatable"
                                                     var="event"
                                                     value="#{propertyProfileBB.currentProperty.completeEventList}"
                                                     tableStyleClass="primeDataTable"
                                                     rowKey="#{event.eventID}"
                                                     >

                                            <p:column headerText="ID"
                                                      styleClass="centeredColumnContent">

                                                <h:outputText value="#{event.eventID}"/>

                                            </p:column>

                                            <p:column headerText="Category"
                                                      styleClass="centeredColumnContent">
                                                <h:outputText value="#{event.category.eventCategoryTitle}" />


                                            </p:column>

                                            <p:column headerText="Description"
                                                      styleClass="centeredColumnContent">

                                                <h:outputText value="#{event.description}"/>

                                            </p:column>
                                            <p:column headerText="Options"
                                                      styleClass="centeredColumnContent">

                                                <p:commandButton    id="prop-events-open-button"
                                                                    ajax="false"
                                                                    styleClass="noFill button-size-small"
                                                                    action="#{propertyProfileBB.onViewEventButtonChange(event)}"
                                                                    value="View Event"
                                                                    icon="fa fa-folder-open-o"
                                                                    />
                                            </p:column>
                                        </p:dataTable>
                                    </h:form>
                                </p:panel>
                            </div>
                            
                            <div class="p-col">
                                <p:panel    id="prop-persons-panel"
                                            toggleable="true"
                                            widgetVar="prop-events-panel-var"
                                            collapsed="false"
                                            header="Persons"
                                            rendered="true">
                                    <h:form id="prop-persons-panel-form">

                                        <p:commandButton   id="prop-persons-manage-button"
                                                           ajax="true"
                                                           actionListener="#{propertyProfileBB.onPersonConnectInitButtonChange}"
                                                           oncomplete="PF('prop-persons-manage-var').show()"
                                                           rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                           value="Link Person to Property"
                                                           icon="fa fa-user-plus"
                                                           />

                                        <p:spacer height="5px" />

                                        <p:dataTable id="prop-persons-table"
                                                     var="human"
                                                     value="#{propertyProfileBB.currentProperty.humanLinkList}"
                                                     tableStyleClass="primeDataTable"
                                                     rowKey="#{human.humanID}"
                                                     >

                                            <p:column headerText="Name"
                                                      styleClass="centeredColumnContent">

                                                <h:outputText value="#{human.name}"/>



                                            </p:column>

                                            <p:column headerText="ID"
                                                      styleClass="centeredColumnContent">

                                                <h:outputText value="#{human.humanID}"/>

                                            </p:column>

                                            <p:column headerText="Actions"
                                                      styleClass="centeredColumnContent">
                                                <p:commandLink      id="prop-person-exploreperson-button"
                                                                    ajax="true"
                                                                    style="color:blue;"
                                                                    action="#{personBB.onHumanViewLinkClick(human)}"
                                                                    value="View Person"
                                                                    oncomplete="PF('person-profile-dialog-var').show();"
                                                                    />

                                            </p:column>
                                        </p:dataTable>
                                    </h:form>
                                </p:panel>



                                <p:panel id="propinfo-notes-panel"
                                         toggleable="true"
                                         collapsed="false"
                                         header="Property Notes"
                                         rendered="true"
                                         > 
                                    <h:form id="propinfo-notes-form">
                                        <h:messages id="propinfo-notes-messages"
                                                    globalOnly="true" showDetail="true" showSummary="true"
                                                    warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                        </h:messages>

                                        <div class="ui-g data-container">
                                            <p:commandButton   id="propinfo-notes-add-button"
                                                               rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                               value="Add new note"  
                                                               icon="fa fa-sticky-note-o"
                                                               actionListener="#{propertyProfileBB.onNoteInitButtonChange}"
                                                               oncomplete="PF('propinfo-notes-dialog-var').show()"
                                                               update="propinfo-note-create-form"/>
                                            <p:spacer height="5px" />
                                            <div    id="propinf-ot-notes-div"
                                                    class="data_field"
                                                    style="clear:both;">
                                                <h:outputLabel  styleClass="data_field_label"
                                                                for="propinfo-ot-notes"
                                                                value="Notes"/>

                                                <h:outputText   id="propinfo-ot-notes"
                                                                styleClass="data_field_value"
                                                                value="#{propertyProfileBB.currentProperty.notes}"
                                                                escape="false"/>
                                            </div>
                                        </div>

                                    </h:form>
                                </p:panel>
                            </div>
                        </div>
                    </div>




                    <p:dialog id="prop-remove-dialog"
                              modal="true"
                              height="300" 
                              width="550"
                              widgetVar="prop-remove-dialog-var"
                              closable="true"
                              header="Remove property #{propertySaddressString.currentProperty.address}"
                              rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                              >

                        <h:form id="propinfo-remove-form">

                            <p>Caution: This action is like 'delete'; we have to dig the record back out by
                                hand if you goof.</p>
                            <p:commandButton icon="fa fa-trash"
                                             ajax="false"
                                             action="#{propertyProfileBB.onRemoveButtonChange()}"
                                             value="Permanently remove property ID:#{propertyProfileBB.currentProperty.propertyID}"
                                             />

                        </h:form>
                    </p:dialog>



                    <p:dialog    id="prop-addperiod-dialog"
                                 height="400" width="600"
                                 widgetVar="prop-addperiod-dialog-var"
                                 closable="true"
                                 header="Add New Occupancy Period">


                        <h:form id="dialog-addoccperiod-form">
                            <h:messages id="prop-occperiods-addop-messages"
                                        globalOnly="true" showDetail="true" showSummary="true"
                                        warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                            </h:messages>


                            <h:outputLabel styleClass="ui-label" for="som-occperiodtype" value="Occupancy type" />

                            <p:selectOneMenu
                                id="som-occperiodtype" tabindex="1" required="true"
                                value="#{propertyOccPeriodsBB.selectedOccPeriodType}">
                                <f:converter converterId="occPeriodTypeConverter"/>
                                <f:selectItem itemLabel="Select a period type..." itemDisabled="true" noSelectionOption="true"/>
                                <f:selectItems id="si-typelist"
                                               value="#{propertyOccPeriodsBB.occPeriodTypeList}"
                                               var ="opt"
                                               itemValue="#{opt}"
                                               itemLabel="#{opt.title}" />
                            </p:selectOneMenu>

                            <p:spacer height="5px" />

                            <p:commandButton ajax="true"
                                             value="Cancel" icon="fa fa-stop"
                                             onclick="PF('dialog-addoccperiod-var').hide()"
                                             tabindex="4"/>


                            <p:commandButton ajax="false"
                                             action="#{propertyOccPeriodsBB.addNewOccPeriod}"
                                             icon="fa fa-plus-square"
                                             styleClass="inline-button"
                                             value="Create new period"
                                             tabindex="3"/>

                        </h:form>
                    </p:dialog>

                    <p:dialog   id="propinfo-notes-dialog"
                                height="300" width="750"
                                widgetVar="propinfo-notes-dialog-var"
                                closable="true"
                                header="Note Builder"
                                rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                >

                        <h:form id="propinfo-note-create-form">

                            <h:messages id="propinfo-dialog-note-messages"
                                        globalOnly="true" showDetail="true" showSummary="true"
                                        warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                            </h:messages>

                            <h:panelGrid columns="1"
                                         columnClasses="gridTd, gridTd">

                                <h:panelGroup>
                                    <h:outputText styleClass="ui-label" value="Note text: "/>
                                    <p:textEditor   id="propinfo-notes-editor"
                                                    value="#{propertyProfileBB.formNoteText}"
                                                    secure="false"
                                                    required="false"
                                                    height="200"/>


                                    <p:spacer height="5px" />
                                    <p:commandButton    id="propinfo-updatemetadata-button-cancel"
                                                        ajax="true"  tabindex="27"
                                                        value="Cancel"
                                                        icon="fa fa-stop"
                                                        immediate="true"
                                                        onclick="PF('propinfo-notes-dialog-var').hide()"
                                                        />

                                    <p:commandButton   id="propinfo-dialog-notes-button-addnote"
                                                       ajax="true" 
                                                       actionListener="#{propertyProfileBB.onNoteCommitButtonChange}"
                                                       oncomplete="PF('propinfo-notes-dialog-var').hide()"
                                                       rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"                                                                               
                                                       value="Attach Note"  
                                                       styleClass="inline-button"
                                                       icon="fa fa-sticky-note-o"
                                                       update="propinfo-notes-form"/>
                                </h:panelGroup>
                            </h:panelGrid>
                        </h:form>
                    </p:dialog>



                </f:view>

                <script type="text/javascript">
                    $(function () {
                        $.extend(PF("datatable"), {
                            onKeyDown: function (e) {
                                var key = e.which,
                                        keyCode = $.ui.keyCode;
                                if ((key === keyCode.ENTER || key === keyCode.NUMPAD_ENTER)) {
                                    e.preventDefault();
                                }
                            },
                            onKeyUp: function (e, rowIndex) {
                                var key = e.which,
                                        keyCode = $.ui.keyCode;
                                //.ui-row-editor-check .ui-icon-check .ui-c
                                if ((key === keyCode.ENTER || key === keyCode.NUMPAD_ENTER)) {
                                    this.tbody
                                            .find('.ui-row-editor .ui-icon-check')
                                            .eq(rowIndex)
                                            .click();
                                }
                                if (key === keyCode.ESCAPE) {
                                    this.tbody
                                            .find('.ui-row-editor .ui-icon-close')
                                            .eq(rowIndex)
                                            .click();
                                }
                            }
                        });
                    });
                </script>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

