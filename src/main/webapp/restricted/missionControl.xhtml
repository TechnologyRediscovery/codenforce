<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>

        <h:outputStylesheet name="css/dashboards.css"/>

        <title>CodeNForce Dashboard</title>
    </h:head>
    <h:body>
        <ui:composition template="navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view id="missionControlView">
                    <div class="mainContainer">

                        <h:form id="messages-global-form">

                            <p:growl id="messages-global-growl"
                                     redisplay="false"
                                     />
                        </h:form>

                        <div class="ui-g data_container_nested_restrict">

                            <!--NESTED DATA FIELD VERTICAL-->
                            <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                <p:panel    id="event-search-panel"
                                            toggleable="true"
                                            style="width: 100%;"
                                            widgetVar="event-serach-panel-var"
                                            collapsed="true"
                                            rendered="true"
                                            header="Activity in #{sessionBean.sessMuni.muniName}" >
                                    <h:form id="event-bar-form">
                                        
                                        <p:pieChart id="event-bar"
                                                    model="#{missionControlBB.pieEvents}" />
                                    </h:form>
                                    
                                    <h:form id="event-search-form">
                                        <div class="ui-g data_container_nested_restrict">

                                            <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field" >
                                                
                                                <div class="help-link">

                                                    <div class="restrict-main-contents-io-link">

                                                      
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            <div class="ui-g-12 ui-md-12 ui-lg-6 restrict-data-field" >


                                                <div class="restrict-data-field-label-inline" >

                                                    <h:outputLabel value="Select a query:" 
                                                                   for="eventquery-som" />
                                                </div>

                                                <div class="restrict-data-field-value-inline" >

                                                    <p:selectOneMenu id="eventquery-som" 
                                                                     tabindex="1" 
                                                                     value="#{eventsBB.querySelected}"
                                                                     style="margin-right: 10px;">
                                                        <f:converter converterId="bOBQueryConverter"/>
                                                        <f:selectItem itemLabel="select a query..." noSelectionOption="true" itemDisabled="true"/>
                                                        <f:selectItems id="querylist-si" value="#{eventsBB.queryList}" var="ql" itemValue="#{ql}" itemLabel="#{ql.queryTitle}" />
                                                        <p:ajax listener="#{eventsBB.changeQuerySelected}"
                                                                update="messages-global-form
                                                                @form
                                                                "/>
                                                    </p:selectOneMenu>
                                                </div>

                                            </div>

                                            <div class="ui-g-12 ui-md-12 ui-lg-6 restrict-data-field" >

                                                <div class="restrict-main-contents-io-button">
                                                    <p:commandButton icon="fa fa-search"
                                                                     ajax="true"
                                                                     value="Search"
                                                                     style="clear:none; display: block; float: left;"
                                                                     disabled="false"
                                                                     actionListener="#{eventsBB.executeQuery}" 
                                                                     update="event-list-form
                                                                     event-search-log-panel
                                                                     messages-global-form"
                                                                     />

                                                    <p:commandButton   id="event-search-clear-cb" 
                                                                       ajax="true" 
                                                                       actionListener="#{eventsBB.resetQuery}"
                                                                       icon="fa fa-eraser" 
                                                                       style="padding-left: 5px; clear:none; display: block; float:left;"
                                                                       styleClass="button inline-button"
                                                                       value="Reset Query" 
                                                                       disabled="false"
                                                                       update="messages-global-form
                                                                       event-list-form
                                                                       event-search-log-form"/>

                                                </div>
                                            </div>
                                        </div>
                                    </h:form>

                                    <h:form id="event-list-form">
                                        <h:outputText id="event-list-info-ot-0"
                                                      rendered="#{!(empty eventsBB.querySelected.BOBResultList)}"
                                                      value="showing #{eventsBB.querySelected.BOBResultList.size()} events" 
                                                      style="font-style: italic"/>
                                        <h:outputText id="event-list-info-ot-1"
                                                      rendered="#{eventsBB.querySelected.queryExecuted}"
                                                      value=" | query executed at #{eventsBB.querySelected.executionTimestampPretty} " 
                                                      style="font-style: italic"/>

                                        <p:dataTable
                                            id="events-table"
                                            var="e"
                                            rowKey="#{e.eventID}"
                                            value="#{eventsBB.eventList}"
                                            tableStyleClass="primeDataTable"
                                            resizableColumns="true"
                                            widgetVar="events-table-var"
                                            >
                                            <!--<p:ajax event="rowSelect" update="selectedRowLabel"/>-->

                                            <p:column width="4%">
                                                <i class="material-icons"><h:outputText value="#{e.category.icon.materialIcon}"/></i>
                                                <p:spacer height="2px" />
                                                <h:outputText value="#{e.domain.abbrev}"/>
                                                <p:spacer height="2px" />
                                                <h:outputText value="#{e.eventID}"/>
                                            </p:column>

                                            <p:column width="20%" sortBy="#{e.category.eventType.label}"
                                                      >
                                                <f:facet name="header">
                                                    <h:outputText value="Description" />
                                                </f:facet>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{e.category.eventType.label}: #{e.category.eventCategoryTitle}"
                                                                  style="font-weight: bold;"/>
                                                    <p:spacer height="5px" />
                                                    <h:outputText value="#{e.property.address} (#{e.property.muni.muniName}): Case ID: #{e.cecase.caseID}"/>
                                                </div>
                                            </p:column>

                                            <p:column width="9%" sortBy="#{e.timeStart}">
                                                <f:facet name="header">
                                                    <h:outputText value="Date" />
                                                </f:facet>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{e.timeStartPretty}"/>
                                                    <p:spacer height="2px" />
                                                    <h:outputText value="#{e.computeEventDurationMins()} mins"/>
                                                </div>
                                            </p:column>

                                            <p:column width="4%" exportable="false">
                                                <f:facet name="header">
                                                    <h:outputText value="Action" />
                                                </f:facet>

                                                <div class="restrict-main-contents-io-link">

                                                    <p:commandLink id="violation-ord-details-cl" 
                                                                   ajax="false"
                                                                   action="#{missionControlBB.onViewEventButtonChange(e)}"
                                                                   value="view" 
                                                                   style="color:blue;"
                                                                   type="button" />
                                                </div>


                                            </p:column>



                                        </p:dataTable>
                                        <div class="ui-g data_container_nested_restrict">

                                            <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">

                                                <div class="restrict-data-field-label-inline" >
                                                    <h:outputLabel  for="event-viewoptions-som">
                                                        <h:outputText value="Filter" />
                                                    </h:outputLabel>
                                                </div>
                                                <div class="restrict-data-field-value-inline" >

                                                    <p:selectOneMenu    id="event-viewoptions-som"
                                                                        value="#{eventsBB.selectedEventView}"
                                                                        tabindex="10">

                                                        <f:selectItems  id="event-viewoptions-selitems"
                                                                        value="#{eventsBB.eventsViewOptionsCandidates}"
                                                                        var="vo"
                                                                        itemValue="#{vo}"
                                                                        itemLabel="#{vo.label}"/>
                                                        <p:ajax update="events-table"
                                                                immediate="true"/>
                                                    </p:selectOneMenu>
                                                </div>
                                            </div>
                                        </div>
                                    </h:form>
                                </p:panel>

                                <p:panel  id="event-search-log-panel"
                                          toggleable="true"
                                          widgetVar="event-search-log-panel-var"
                                          collapsed="true"
                                          style="width:100%;"
                                          header="Query log">

                                    <h:form id="event-search-log-form">
                                        <div class='search-query-desc'>
                                            <h:outputText id="event-search-log-ot" 
                                                          value="#{eventsBB.querySelected.queryLog}"
                                                          escape="false"/>
                                        </div>
                                    </h:form>
                                </p:panel>
                                
                                
                                
                                <p:panel  id="event-future-list-panel"
                                          toggleable="true"
                                          widgetVar="event-future-list-panel-var"
                                          collapsed="false"
                                          style="width:100%;"
                                          header="Upcoming events">
                                    <h:form id="event-future-list-form">
                                        <p:dataTable
                                            id="events-future-table"
                                            var="ef"
                                            rowKey="#{ef.eventID}"
                                            value="#{sessionBean.queryEventFuture7Days.BOBResultList}"
                                            tableStyleClass="primeDataTable"
                                            resizableColumns="true"
                                            widgetVar="events-table-var"
                                            >
                                            <!--<p:ajax event="rowSelect" update="selectedRowLabel"/>-->

                                            <p:column width="4%">
                                                <i class="material-icons"><h:outputText value="#{ef.category.icon.materialIcon}"/></i>
                                                <p:spacer height="2px" />
                                                <h:outputText value="#{ef.domain.abbrev}"/>
                                                <p:spacer height="2px" />
                                                <h:outputText value="#{ef.eventID}"/>
                                            </p:column>


                                            <p:column width="20%" sortBy="#{ef.category.eventType.label}"
                                                      >
                                                <f:facet name="header">
                                                    <h:outputText value="Description" />
                                                </f:facet>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{ef.category.eventType.label}: #{ef.category.eventCategoryTitle}"
                                                                  style="font-weight: bold;"/>
                                                    <p:spacer height="5px" />
                                                    <h:outputText value="#{ef.property.address} (#{ef.property.muni.muniName}): Case ID: #{ef.cecase.caseID}"/>
                                                </div>
                                            </p:column>

                                            <p:column width="9%" sortBy="#{ef.timeStart}">
                                                <f:facet name="header">
                                                    <h:outputText value="Date" />
                                                </f:facet>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{ef.timeStartPretty}"/>
                                                    <p:spacer height="2px" />
                                                    <h:outputText value="#{ef.computeEventDurationMins()} mins"/>
                                                </div>
                                            </p:column>

                                            <p:column width="4%" exportable="false">
                                                <f:facet name="header">
                                                    <h:outputText value="Action" />
                                                </f:facet>

                                                <div class="restrict-main-contents-io-link">

                                                    <p:commandLink id="violation-ord-details-cl" 
                                                                   ajax="false"
                                                                   action="#{missionControlBB.onViewEventButtonChange(e)}"
                                                                   value="view" 
                                                                   style="color:blue;"
                                                                   type="button" />
                                                </div>


                                            </p:column>

                                        </p:dataTable>
                                    </h:form>
                                
                                </p:panel>

                                <p:panel id="prop-search-query-panel"
                                         toggleable="true"
                                         widgetVar="prop-search-query-panel-var"
                                         collapsed="false"
                                         style="width:100%;"
                                         header="Property Search"
                                         rendered="true">

                                    <!--MESSAGES -->
                                    <h:form id="prop-search-messages-form">
                                        <p:growl id="prop-search-messages" showDetail="false"/>
                                    </h:form>
                                    
                                    <h:form id="prop-pie-form">
                                        
                                        <p:pieChart id="pie-property"
                                                    model="#{missionControlBB.pieProperty}" />
                                    </h:form>

                                    <h:form id="prop-search-query-form">

                                        <!-- NESTED DATA CONTAINER -->
                                        <div class="ui-g data_container_nested_restrict">

                                            <!--NESTED DATA FIELD GRID:12-->
                                            <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">

                                                <!-- NESTED DATA TITLE -->
                                                <div class="restrict-main-contents-io-title">
                                                    <h:outputLabel value="Select Tpye of Search"
                                                                   for="prop-search-query-som" 
                                                                   />
                                                </div>
                                                <!-- NESTED DATA CONTENT -->
                                                <div class="restrict-main-contents-io-content">
                                                    <p:selectOneMenu id="prop-search-query-som"
                                                                     tabindex="1"
                                                                     value="#{propertySearchBB.querySelected}"
                                                                     style="width: 100%"
                                                                     >
                                                        <f:converter converterId="bOBQueryConverter"/>

                                                        <f:selectItem itemLabel="select one..."
                                                                      noSelectionOption="true"
                                                                      itemDisabled="true"
                                                                      />
                                                        <f:selectItems id="prop-search-query-si"
                                                                       value="#{propertySearchBB.queryList}"
                                                                       var="ql"
                                                                       itemValue="#{ql}"
                                                                       itemLabel="#{ql.queryTitle}" 
                                                                       />
                                                        <p:ajax update="prop-search-filter-addr-val-0
                                                                @form
                                                                prop-search-messages-form"
                                                                listener="#{propertySearchBB.changeQuerySelected}"
                                                                />
                                                    </p:selectOneMenu>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- NESTED DATA CONTAINER -->
                                        <div class="ui-g data_container_nested_restrict">

                                            <!-- NESTED DATA FIELD GRID:12-->
                                            <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">

                                                <!-- NESTED DATA TITLE -->
                                                <div class="restrict-main-contents-io-title">
                                                    <h:outputLabel value="Enter Search Criteria"
                                                                   for="cears-query-desc-ot" />
                                                    <div class="restrict-main-contents-io-link">
                                                        <p:commandLink id="prop-search-advanced-button"
                                                                       ajax="true"
                                                                       actionListener="#{propertySearchBB.onAdvancedSearchButtonChange}"
                                                                       oncomplete="PF('prop-search-advanced-var').show()"
                                                                       rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                                       value="Advanced search"
                                                                       />

                                                    </div>
                                                </div>

                                                <!-- NESTED DATA CONTENT -->
                                                <div class="restrict-main-contents-io-content">
                                                    <p:inputText id="prop-search-filter-addr-val-0"
                                                                 value="#{propertySearchBB.searchParamsSelected.address_val}"
                                                                 style="width: 100%;"
                                                                 tabindex="2"
                                                                 disabled="#{!propertySearchBB.searchParamsSelected.address_ctl}"
                                                                 required="false"
                                                                 styleClass="data_field_value"
                                                                 placeholder="#{propertySearchBB.querySelected.queryName.desc}"
                                                                 />

                                                    <p:message for="prop-search-filter-addr-val-0" showDetail="false" showSummary="true"/>
                                                </div>

                                                <!-- NESTED DATA FILTER -->
                                                <div class="restrict-main-contents-io-filter">

                                                    <p:selectBooleanCheckbox class="checkbox"
                                                                             id="prop-search-filter-addr-ctl-0"
                                                                             value="#{propertySearchBB.searchParamsSelected.address_ctl}" >
                                                        <p:ajax update="prop-search-filter-addr-val-0"/>
                                                    </p:selectBooleanCheckbox>

                                                    <p:outputLabel for="prop-search-filter-addr-ctl-0" 
                                                                   value="Filter by street/number"
                                                                   />
                                                </div>

                                                <!-- NESTED DATA FILTER -->
                                                <div class="restrict-main-contents-io-filter">

                                                    <p:selectBooleanCheckbox class="checkbox"
                                                                             id="prop-search-appendresults-chkbox-0"
                                                                             value="#{propertySearchBB.appendResultsToList}"
                                                                             disabled="false" />

                                                    <p:outputLabel for="prop-search-appendresults-chkbox-0"
                                                                   value="Add to results below"
                                                                   />

                                                </div>
                                            </div>
                                        </div>

                                        <!-- NESTED DATA CONTAINER -->
                                        <div class="ui-g data_container_nested_restrict">

                                            <!--NESTED DATA FIELD GRID:12-->
                                            <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">

                                                <!-- NESTED DATA BUTTON -->
                                                <div class="restrict-main-contents-io-button">
                                                    <p:commandButton id="prop-search-exec-cb-0"
                                                                     ajax="true"
                                                                     actionListener="#{propertySearchBB.executeQuery}"
                                                                     icon="fa fa-search"
                                                                     value="Search"
                                                                     style="width: 100%"
                                                                     disabled="#{propertySearchBB.querySelected.queryExecuted}"
                                                                     update=" 
                                                                     @form
                                                                     messages-global-form
                                                                     prop-search-messages-form
                                                                     prop-search-log-form
                                                                     prop-search-results-panel
                                                                     prop-search-clear-cb-0"/>

                                                </div>

                                                <!-- NESTED DATA GRAY BUTTON -->
                                                <div class="restrict-main-contents-io-button gray_button">
                                                    <p:commandButton id="prop-search-clear-cb-0"
                                                                     ajax="true"
                                                                     actionListener="#{propertySearchBB.resetQuery}"
                                                                     icon="fa fa-eraser"
                                                                     value="Clear"
                                                                     style="width: 100%"
                                                                     disabled="#{!propertySearchBB.querySelected.queryExecuted}"
                                                                     update=" prop-search-messages-form
                                                                     prop-search-log-form
                                                                     prop-search-results-panel
                                                                     @form
                                                                     prop-search-query-form"/>

                                                </div>
                                            </div>
                                        </div>
                                    </h:form>
                                </p:panel>

                                <!-- PANEL CONTAINER -->
                                <p:panel id="prop-search-results-panel"
                                         toggleable="true"
                                         widgetVar="prop-search-query-panel-var"
                                         collapsed="false"
                                         style="width:100%;"
                                         header="Property Search Results"
                                         rendered="true">


                                    <h:form id="prop-search-results-form">

                                        <!-- NESTED DATA CONTAINER -->
                                        <div class="ui-g data_container_nested_restrict">

                                            <!--NESTED DATA FIELD GRID:12-->
                                            <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">

                                                <!-- NESTED DATA BUTTON -->
                                                <div class="restrict-main-contents-io-button gray_button">
                                                    <p:commandButton id="prop-search-results-clear"
                                                                     ajax="true"
                                                                     actionListener="#{propertySearchBB.clearPropertyList}"
                                                                     icon="fa fa-eraser"
                                                                     style="width: 100%"
                                                                     value="Clear Results "
                                                                     update=" prop-search-messages-form
                                                                     prop-search-results-form"/>

                                                </div>
                                            </div>
                                        </div>

                                        <p:dataTable id="prop-search-results-table"
                                                     var="prop"
                                                     value="#{propertySearchBB.propListMaster}"
                                                     rowKey="#{prop.propertyID}"
                                                     tableStyleClass="primeDataTable"
                                                     draggableRows="false"
                                                     draggableColumns="true"
                                                     tabindex="6"
                                                     >

                                            <p:column width="10%;" style="text-align: center">
                                                <f:facet name="header">
                                                    <h:outputText value="ID"/>
                                                </f:facet>
                                                <h:outputText value="#{prop.propertyID}" />
                                            </p:column>

                                            <p:column width="35%" style="text-align: center">
                                                <f:facet name="header">
                                                    <h:outputText value="Address"/>
                                                </f:facet>
                                                <h:outputText value="#{prop.address}" />
                                            </p:column>

                                            <p:column width="35%" style="text-align: center">
                                                <f:facet name="header">
                                                    <h:outputText value="Municipality" />
                                                </f:facet>
                                                <h:outputText value="#{prop.muni.muniName}"/>
                                            </p:column>

                                            <p:column width="20%" style="text-align: center">
                                                <f:facet name="header">
                                                    <h:outputText value="Actions"/>
                                                </f:facet>
                                                <div class="gray_button">
                                                    <p:commandButton id="prop-search-loadprop-button"
                                                                     icon="fa fa-folder-open-o"
                                                                     value="Details"
                                                                     action="#{missionControlBB.onViewPropertyButtonChange(prop)}"
                                                                     ajax="false"
                                                                     />
                                                </div>
                                            </p:column>
                                        </p:dataTable>
                                    </h:form>
                                </p:panel>



                                <p:panel  id="prop-search-log-panel"
                                          toggleable="true"
                                          widgetVar="prop-search-log-panel-var"
                                          collapsed="true"
                                          style="width:100%;"
                                          header="Property Query log"
                                          rendered="true">

                                    <h:form id="prop-search-log-form">
                                        <div class='search-query-desc'>
                                            <h:outputText id="prop-search-log-ot"
                                                          value="#{propertySearchBB.querySelected.queryLog}"
                                                          escape="false"/>
                                        </div>
                                    </h:form>
                                </p:panel>




                            </div>


                            <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">

                                <p:panel    id="cecase-query-panel"
                                            toggleable="true"
                                            widgetVar="cecase-query-panel-var"
                                            collapsed="false"
                                            rendered="#{ceCaseSearchProfileBB.activeLookupMode}"
                                            header="Code Enforcement Cases">

                                    <h:form id="cecase-help-form">
                                        <div class="restrict-main-contents-help-link">
                                            <a href="https://technologyrediscovery.github.io/codenforce/dashboard/caselistbuilder"
                                               target="_blank">
                                               <i class="material-icons status-display-icon-i">help_outline</i>
                                            </a>
                                        </div>
                                    </h:form>
                                    <p:divider />
                                    
                                    <h:form id="cecase-pie-status-form">
                                        <p:pieChart id="cecase-pie-status"
                                                    model="#{missionControlBB.pieCasePhase}" />
                                        
                                    </h:form>
                                    
                                    <h:form id="cecase-bar-violations-form">
                                        <p:barChart id="cecase-bar-violations"
                                                    model="#{missionControlBB.barViolations}" />
                                        
                                    </h:form>
                                    <h:form id="cecase-search-form">

                                        <h:outputLabel styleClass="bold" 
                                                       value="Select a query:" 
                                                       for="cecase-query-desc-ot" />

                                        <p:selectOneMenu id="cecase-query-som" 
                                                         tabindex="1" 
                                                         value="#{ceCaseSearchProfileBB.querySelected}"
                                                         disabled="#{ceCaseSearchProfileBB.querySelected.queryExecuted}">
                                            <f:converter converterId="bOBQueryConverter"/>
                                            <f:selectItem itemLabel="select one..." noSelectionOption="true" itemDisabled="true"/>
                                            <f:selectItems id="querylist-si" value="#{ceCaseSearchProfileBB.queryList}" var="ql" itemValue="#{ql}" itemLabel="#{ql.queryTitle}" />
                                            <p:ajax listener="#{ceCaseSearchProfileBB.changeQuerySelected}"
                                                    update="@form
                                                    messages-global-form" />
                                        </p:selectOneMenu>

                                        <p:spacer height="5px" />

                                        <h:outputLabel styleClass="bold" 
                                                       value="Description: " 
                                                       for="cecase-query-desc-ot" />
                                        <h:outputText id="cecase-query-desc-ot" 
                                                      value="#{ceCaseSearchProfileBB.querySelected.queryName.desc}" />

                                        <p:spacer height="5px" />

                                        <p:commandButton   id="cecase-executequery-cb" 
                                                           ajax="true" 
                                                           actionListener="#{ceCaseSearchProfileBB.executeQuery}"
                                                           disabled="#{ceCaseSearchProfileBB.querySelected.queryExecuted}"
                                                           icon="fa fa-flash" 
                                                           styleClass="button"
                                                           value="run query" 
                                                           update="@form
                                                           cecase-search-results-form
                                                           cecase-search-log-form"/>

                                        <p:commandButton   id="cecase-search-clear-cb" 
                                                           ajax="true" 
                                                           actionListener="#{ceCaseSearchProfileBB.resetQuery}"
                                                           icon="fa fa-eraser" 
                                                           styleClass="button inline-button"
                                                           value="clear query" 
                                                           disabled="#{!ceCaseSearchProfileBB.querySelected.queryExecuted}"
                                                           update=" cecase-search-log-form
                                                           @form"/>


                                        <p:selectBooleanButton  id="cecase-search-appendresults-chkbox" 
                                                                onLabel="Add Results to Existing Case List"
                                                                onIcon="fa fa-indent"
                                                                offLabel="Build Fresh Case List On Search"
                                                                offIcon="fa fa-eraser"
                                                                value="#{ceCaseSearchProfileBB.appendResultsToList}" 
                                                                disabled="false" />

                                    </h:form>

                                    <h:form id="cecase-search-results-form" >

                                        <p:commandButton   id="cecase-search-results-clear-button" 
                                                           ajax="true" 
                                                           actionListener="#{ceCaseSearchProfileBB.clearCECaseList}"
                                                           icon="fa fa-eraser" 
                                                           styleClass="button"
                                                           value="clear results list" 
                                                           update="messages-global-form
                                                           cecase-search-results-form"/>

                                        <p:commandButton   id="cecase-search-loadhistory-button" 
                                                           ajax="true" 
                                                           rendered="false"
                                                           actionListener="#{ceCaseSearchProfileBB.loadCECaseHistory}"
                                                           icon="fa fa-clock-o" 
                                                           styleClass="button"
                                                           value="load case history" 
                                                           update="messages-global-form
                                                           cecase-search-results-form"/>
                                        
                                        <p:commandButton   id="cecase-export-excel-button" 
                                                           ajax="false" 
                                                           icon="fa fa-file-text-o" 
                                                           styleClass="button"
                                                           value="Export CSV" 
                                                           >
                                            <p:dataExporter type="csv" 
                                                            target="cecase-search-results-table"
                                                            fileName="caseExport" />
                                        </p:commandButton>


                                        <p:commandButton   id="print-case-list-cb" 
                                                           ajax="true" 
                                                           actionListener="#{ceCaseSearchProfileBB.prepareReportCECaseList}"
                                                           icon="fa fa-print" 
                                                           styleClass="button"
                                                           oncomplete="PF('cecase-list-report-dialog-var').show()"
                                                           value="Prepare Case List Report" 
                                                           update="cecase-list-report-form"/>


                                        <p:spacer height="5px" />

                                        <h:outputText value="listing #{ceCaseSearchProfileBB.caseListSize} cases" 
                                                      styleClass="italic"/>
                                        <p:spacer height="5px" />

                                        <p:dataTable
                                            id="cecase-search-results-table"
                                            var="c"
                                            filteredValue="#{ceCaseSearchProfileBB.filteredCaseList}"
                                            rowKey="#{c.caseID}"
                                            rowExpandMode="multiple"
                                            widgetVar="ceViewTable"
                                            value="#{ceCaseSearchProfileBB.caseList}"
                                            tableStyleClass="primeDataTable">

                                            <p:column width="5%" sortBy="#{c.caseID}">
                                                <f:facet name="header">
                                                    <h:outputText value="ID" />
                                                </f:facet>
                                                <h:outputText value="#{c.caseID}"/>
                                            </p:column>
                                            <p:column width="10%" sortBy="#{c.originationDate}">
                                                <f:facet name="header">
                                                    <h:outputText value="Opened" />
                                                </f:facet>
                                                <h:outputText value="#{ceCaseSearchProfileBB.getPrettyDateNoTime(c.originationDate)}"/>
                                                <p:spacer height="2px"/>
                                                <h:outputText value="Age: #{c.caseAge} days"
                                                              style="font-style: italic"/>

                                            </p:column>
                                            <p:column width="12%" sortBy="#{c.property.address}">
                                                <f:facet name="header">
                                                    <h:outputText value="Property" />
                                                </f:facet>
                                                <h:outputText value="#{c.property.address} "/>
                                                <p:spacer height="2px"/>
                                                <h:outputText value=" (#{c.property.muni.muniName})"/>
                                            </p:column>
                                            <p:column width="10%">
                                                <f:facet name="header">
                                                    <h:outputText value="Name" />
                                                </f:facet>
                                                <h:outputText value="#{c.caseName}"/>
                                            </p:column>
                                            <p:column width="8%" sortBy="#{c.statusBundle.phase.caseStage.label}">
                                                <f:facet name="header">
                                                    <h:outputText value="Stage" />
                                                </f:facet>
                                                <div class="#{c.statusBundle.phaseIcon.styleClass}">
                                                    <i class="material-icons status-display-icon-i"><h:outputText value="#{c.statusBundle.phaseIcon.materialIcon}"/></i>
                                                </div>
                                            </p:column>
                                            <p:column width="8%">
                                                <f:facet name="header">
                                                    <h:outputText value="Actions" />
                                                </f:facet>
                                                
                                                <div class="restrict-main-contents-io-link">

                                                        <p:commandLink  id="cecase-search-view-case"
                                                                        value="view"
                                                                        action="#{navigationBB.onCECaseListItemSelect(c)}"
                                                                        ajax="false"/>

                                                </div>
                                            </p:column>
                                        </p:dataTable>


                                        <p:spacer height="10px"/>

                                    </h:form>

                                </p:panel>


                                <p:panel  id="cecase-search-log-panel"
                                          toggleable="true"
                                          widgetVar="cecase-search-log-panel-var"
                                          collapsed="true"
                                          style="width:100%;"
                                          header="CECase Query log">

                                    <h:form id="cecase-search-log-form">
                                        <div class='search-query-desc'>
                                            <h:outputText id="cecase-search-log-ot" 
                                                          value="#{ceCaseSearchProfileBB.querySelected.queryLog}"
                                                          escape="false"/>
                                        </div>
                                    </h:form>
                                </p:panel>



                                <p:panel id="dashpanel-ce-cears"
                                         collapsed="false"
                                         closable="true"
                                         toggleable="true"
                                         header="#{sessionBean.sessCEARList.size()} CE Action Requests Awaitng Review"
                                         rendered="true"
                                         footer=""
                                         toggleableHeader="true"
                                         menuTitle="">
                                    <p:scrollPanel style="height: 550px;"
                                                   >

                                        <h:form id="dash-cears-form">

                                            <p:dataTable id="requestTable"
                                                         var="r"
                                                         rowKey="#{r.requestID}"
                                                         value="#{sessionBean.sessCEARList}"
                                                         tableStyleClass="primeDataTable"
                                                         >

                                                <p:column headerText="Date Submitted000"
                                                          styleClass="centeredColumnContent">

                                                    <h:outputText value="#{missionControlBB.getPrettyDateNoTime(r.submittedTimeStamp)}"/>

                                                </p:column>

                                                <p:column headerText="Address"
                                                          styleClass="centeredColumnContent">

                                                    <h:outputText value="#{r.requestProperty.address}"/>

                                                </p:column>

                                                <p:column headerText="Issue Type"
                                                          styleClass="centeredColumnContent">

                                                    <h:outputText value="#{r.issue.name}"/>

                                                </p:column>

                                                <p:column headerText="View"
                                                          styleClass="centeredColumnContent"
                                                          >

                                                    <p:commandButton    
                                                        id="dash-switchuser-button-switch"
                                                        value="View"
                                                        styleClass="button" 
                                                        ajax="false"
                                                        action="#{missionControlBB.onViewCEARButtonChange(r)}" 
                                                        icon="fa fa-cogs" />


                                                </p:column>

                                            </p:dataTable>

                                            <p:spacer height="15px"/>

                                            <p:chart type="donut" 
                                                     model="#{cEActionRequestsBB.requestReasonDonut}" 
                                                     style="width:600px; height: 600px;"/>

                                            <p:spacer height="10px"/>

                                        </h:form>

                                    </p:scrollPanel>
                                </p:panel>


                                <p:panel id="dashpanel-sys-switchmuni"
                                         collapsed="false"
                                         closable="true"
                                         toggleable="true"
                                         header="Switch session municipality"
                                         rendered="true"
                                         footer=""
                                         toggleableHeader="true"
                                         menuTitle="">
                                    <h:form id="switch-muni-form">

                                        <p:commandButton    id="dash-switchmuni-button-switch"
                                                            disabled="false"
                                                            value="Change session credential" 
                                                            styleClass="button" 
                                                            action="#{missionControlBB.reauthenticate}" 
                                                            icon="fa fa-exchange" />
                                    </h:form>
                                </p:panel>

                                <p:panel id="dashpanel-sys-switchuser"
                                         collapsed="false"
                                         closable="true"
                                         toggleable="true"
                                         header="Switch user"
                                         rendered="true"
                                         footer=""
                                         toggleableHeader="true"
                                         menuTitle="">
                                    <h:form id="switch-user-form">


                                        <p:selectOneMenu id="dash-switchuser-solb-chooseuser" tabindex="12" value="#{missionControlBB.selectedUser}">
                                            <f:converter converterId="userConverter"/>
                                            <f:selectItem itemLabel="select a user..." noSelectionOption="true" itemDisabled="true"/>
                                            <f:selectItems id="dash-switchuser-si-username" 
                                                           value="#{missionControlBB.userList}"
                                                           var="u" itemValue="#{u}" itemLabel="#{u.username} (#{u.userID})" />
                                            <p:ajax update="dash-switchuser-button-switch" />
                                        </p:selectOneMenu>
                                        <h:message for="dash-switchuser-solb-chooseuser" showDetail="true" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                        <p:commandButton    id="dash-switchuser-button-switch"
                                                            disabled="#{empty missionControlBB.selectedUser}"
                                                            value="Switch to #{missionControlBB.selectedUser.username}" 
                                                            styleClass="button" 
                                                            action="#{missionControlBB.switchToUser}" 
                                                            icon="fa fa-universal-access" />
                                    </h:form>
                                </p:panel>


                            </div>
                        </div>
                    </div>


                    <p:dialog header="About page: Mission Control" 
                              widgetVar="helpdlg" 
                              responsive="true" 
                              width="400"
                              modal="false"
                              height="600">
                        <h:form id="about-form">

                            <h2>Help Topic: Dashboard</h2>

                            <p>The dashboard is both a set of links to various system tools and a display of key data metrics of the system.</p>

                            <h3>You current municipality</h3>

                            <p>You are always navigating the system from the standpoint of a certain municipality, which is 
                                always listed in the dark blue top banner bar. You cannot be in an "all municipalities" view mode. </p>

                            <p>CodeConnects looks up your current municipality to decide which case lists to show you when 
                                viewing code enforcement data. On pages for searching or creating muni-specific data, your current
                                municipality is used to set the default values.</p>

                            <p:commandLink  value="close help" onclick="PF('helpdlg').hide()" styleClass="noFill"/>

                            <h4>Switching municipalities</h4>

                            <p>If you are authorized to change your municipality, you can do so with this drop down box and command button. After issuing
                                the command to switch to a new municipality, the page will reload and both the listing on this page
                                and in the header bar will reflect these changes.</p>

                            <h4>What is COG Land?</h4>

                            <p>COG Land is a dream world where all mistakes are allowed and nothing bad ever happens. 
                                If you make a mistake, nobody cares so you can tinker and explore and experiment with freedom and ease. All
                                data stored in COG Land behaves just like a non-dreamland municipality but impacts no actual humans.</p>

                            <h3>User info verification</h3>

                            <p>CodeConnect is built on a system called Java ServerFaces(JSF) and the PrimeFaces library that works with JSF.
                                The entire system runs inside a web server called Wildfly. Page control is managed by Glassfish but all other
                                data in the system is linked to your user that's managed by JSF, hence the heading: 
                                <span class="italic">Authenticated Faces User</span>.</p>

                            <p:commandLink  value="close help" onclick="PF('helpdlg').hide()" styleClass="noFill"/>
                        </h:form>


                    </p:dialog>



                    <p:dialog   id="cecase-list-report-dialog"
                                widgetVar="cecase-list-report-dialog-var"
                                closable="true" 
                                responsive="true"
                                >

                        <h:form id="cecase-list-report-form">

                            <div class="ui-g data_container_nested_restrict">
                            
                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">
                                    

                                    <h:outputLabel for="report-caselist-profile-title-it" value="Report title"/>

                                    <p:spacer height="5px"/>

                                    <p:inputText id="report-caselist-title-it" style="width: 300px;" value="#{ceCaseSearchProfileBB.reportCECaseList.title}"/>
                                    <p:spacer height="5px"/>
                                    <h:outputText styleClass="italic" value="note: your name and the current date and time will be automatically inserted" />

                                    <p:spacer height="5px"/>

                                    <h:outputLabel class="bold" value="Include case names" for="report-caselist-casename-chkbox" />
                                    <p:selectBooleanCheckbox id="report-caselist-casename-chkbox" value="#{ceCaseSearchProfileBB.reportCECaseList.includeCaseNames}" />


                                            <p:outputLabel for="cecase-list-report-date-start-cal" 
                                                           value="start date"/>

                                            <p:spacer height="1px" />

                                            <p:calendar id="cecase-list-report-date-start-cal" 
                                                        value="#{ceCaseSearchProfileBB.reportCECaseList.startDate_val_utilDate}" 
                                                        disabled="false"
                                                        mode="popup" 
                                                        showOn="button" 
                                                        pattern="EEE, dd MMM, yyyy"
                                                        navigator="true" 
                                                        tabindex="16" 
                                                        timeInput="true" 
                                                        showHour="false" showMinute="false" showSecond="false" showMillisec="false"
                                                        showButtonPanel="true" 
                                                        showTodayButton="true"
                                                        required="true"/>



                                            <p:outputLabel for="cecase-list-report-date-end-cal" 
                                                           value="end date"/>

                                            <p:spacer height="1px" />

                                            <p:calendar id="cecase-list-report-date-end-cal" 
                                                        value="#{ceCaseSearchProfileBB.reportCECaseList.endDate_val_utilDate}" 
                                                        disabled="false"
                                                        mode="popup" 
                                                        showOn="button" 
                                                        pattern="EEE, dd MMM, yyyy"
                                                        navigator="true" 
                                                        tabindex="16" 
                                                        timeInput="true" 
                                                        showHour="false" showMinute="false" showSecond="false" showMillisec="false"
                                                        showButtonPanel="true" 
                                                        showTodayButton="true"
                                                        required="true"/>



                                    <h:outputLabel for="report-caselist-notes-ita" value="Notes"/>
                                    <p:spacer height="5px"/>
                                    <p:inputText id="report-caselist-notes-ita" style="width: 300px; height: 100px;" value="#{ceCaseSearchProfileBB.reportCECaseList.notes}"/>
                                </div>
                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">
                                    

                                    <h3>Additional case list report options</h3>

                                    <h:outputLabel class="bold" value="Include full owner contact info: " for="report-caselist-ownercontact-chkbox" />
                                    <p:selectBooleanCheckbox id="report-caselist-ownercontact-chkbox" value="#{ceCaseSearchProfileBB.reportCECaseList.includeListSummaryFigures}" />

                                    <p:spacer height="5px"/>

                                    <h:outputLabel class="bold" value="Include violation list for each case: " for="report-caselist-viols-chkbox" />
                                    <p:selectBooleanCheckbox id="report-caselist-viols-chkbox" value="#{ceCaseSearchProfileBB.reportCECaseList.includeViolationList}" />

                                    <p:spacer height="5px"/>

                                    <h:outputLabel class="bold" value="Include summary of each case's event history: " for="report-caselist-eventhist-chkbox" />
                                    <p:selectBooleanCheckbox id="report-caselist-eventhist-chkbox" value="#{ceCaseSearchProfileBB.reportCECaseList.includeEventSummaryByCase}" />

                                    <p:spacer height="5px"/>

                                    <h:outputLabel class="bold" value="Include extended property info for each listing: " for="report-caselist-propertyinfo" />
                                    <p:selectBooleanCheckbox id="report-caselist-propertyinfo" value="#{ceCaseSearchProfileBB.reportCECaseList.includeExtendedPropertyDetails}" />


                                </div>

                                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">
                                    <div class="restrict-main-contents-io-link">

                                        <p:commandLink  ajax="false" 
                                                        action="#{ceCaseSearchProfileBB.generateReportCECaseList}"
                                                        value="Click to generate report in new tab" 
                                                        target="_blank"
                                                        styleClass="font-size:2em;"
                                                        rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                                        />
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">
                                        <div class="ui-button gray_button">

                                            <p:commandButton ajax="true" 
                                                             value="Cancel" icon="fa fa-stop" immediate="true"
                                                             onclick="PF('report-caselist-profile-diaglog-var').hide()"/>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </h:form>
                    </p:dialog>

                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

