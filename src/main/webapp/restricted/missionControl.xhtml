<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>
        <h:outputStylesheet name="css/dashboards.css"/>
        <title>CodeNForce Dashboard</title>
    </h:head>
    <h:body>
        <ui:composition template="navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view id="missionControlView">
                    <div class="mainContainer">

                        <h:form id="messages-global-form">

                            <p:growl id="messages-global-growl"
                                     redisplay="false"
                                     />
                        </h:form>
                        
                        

                        <div class="ui-g data_container_nested_restrict">
                            <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">
                                <ui:include src="/restricted/compositions/eventCalendar.xhtml"/>
                                
                            </div>
                            
                            <!--NESTED DATA FIELD VERTICAL-->
                            <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">


                                <p:panel    id="dash-event-search-panel"
                                            toggleable="true"
                                            style="width: 100%;"
                                            widgetVar="event-serach-panel-var"
                                            collapsed="false"
                                            rendered="true"
                                            header="Activity in #{sessionBean.sessMuni.muniName}" >


                                    <ui:include src="cogstaff/compositions/eventSearch.xhtml" />
                                </p:panel>


                                <ui:include src="cogstaff/occ/compositions/occPeriodListSearch.xhtml"/>
                                <ui:include src="cogstaff/occ/compositions/occPermitListSearch.xhtml"/>


                                <p:panel  id="event-future-list-panel"
                                          toggleable="true"
                                          widgetVar="event-future-list-panel-var"
                                          collapsed="false"
                                          style="width:100%;"
                                          header="Upcoming Events">
                                    <h:form id="event-future-list-form">
                                        <p:dataTable
                                            id="events-future-table"
                                            var="ef"
                                            rowKey="#{ef.eventID}"
                                            value="#{sessionEventConductor.queryEventFuture7Days.BOBResultList}"
                                            tableStyleClass="primeDataTable"
                                            resizableColumns="true"
                                            widgetVar="events-table-var"
                                            >
                                            <!--<p:ajax event="rowSelect" update="selectedRowLabel"/>-->

                                            <p:column width="4%">
                                                <i class="material-icons"><h:outputText value="#{ef.category.icon.materialIcon}"/></i>
                                                <p:spacer height="2px" />
                                                <h:outputText value="#{ef.domain.abbrev}"/>
                                                <p:spacer height="2px" />
                                                <h:outputText value="#{ef.eventID}"/>
                                            </p:column>


                                            <p:column width="20%" sortBy="#{ef.category.eventType.label}"
                                                      >
                                                <f:facet name="header">
                                                    <h:outputText value="Description" />
                                                </f:facet>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{ef.category.eventType.label}: #{ef.category.eventCategoryTitle}"
                                                                  style="font-weight: bold;"/>
                                                    <p:spacer height="5px" />
                                                    <h:outputText value="#{ef.property.addressString} (#{ef.property.muni.muniName}): Case ID: #{ef.cecase.caseID}"/>
                                                </div>
                                            </p:column>

                                            <p:column width="9%" sortBy="#{ef.timeStart}">
                                                <f:facet name="header">
                                                    <h:outputText value="Date" />
                                                </f:facet>
                                                <div class="rowExpansion">
                                                    <h:outputText value="#{missionControlBB.getPrettyDate(ef.timeStart)}"/>
                                                    <p:spacer height="2px" />
                                                    <h:outputText value="#{ef.duration} mins"/>
                                                </div>
                                            </p:column>

                                            <p:column width="4%" exportable="false">
                                                <f:facet name="header">
                                                    <h:outputText value="Action" />
                                                </f:facet>

                                                <div class="restrict-main-contents-io-link">

                                                    <p:commandLink id="violation-ord-details-cl" 
                                                                   ajax="false"
                                                                   action="#{missionControlBB.onViewEventButtonChange(e)}"
                                                                   value="view" 
                                                                   style="color:blue;"
                                                                   type="button" />
                                                </div>


                                            </p:column>

                                        </p:dataTable>
                                    </h:form>
                                </p:panel>
                            </div>

                            <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">
                                <p:panel    id="cecase-query-panel"
                                            toggleable="true"
                                            widgetVar="cecase-query-panel-var"
                                            collapsed="false"
                                            rendered="true"
                                            header="Code Enforcement Cases">

                                    <h:form id="cecase-help-form">
                                        <div class="restrict-main-contents-help-link">
                                            <a href="https://technologyrediscovery.github.io/codenforce/dashboard/caselistbuilder"
                                               target="_blank">
                                                <i class="material-icons status-display-icon-i">help_outline</i>
                                            </a>
                                        </div>
                                    </h:form>


                                    <h:form id="cecase-search-form">

                                        <h:outputLabel styleClass="bold" 
                                                       value="Search By:" 
                                                       for="cecase-query-desc-ot" />

                                        <p:selectOneMenu id="cecase-query-som" 
                                                         tabindex="1" 
                                                         value="#{ceCaseSearchAndReportBB.querySelected}"
                                                         disabled="#{ceCaseSearchAndReportBB.querySelected.queryExecuted}">
                                            <f:converter converterId="bOBQueryConverter"/>
                                            <f:selectItem itemLabel="select one..." noSelectionOption="true" itemDisabled="true"/>
                                            <f:selectItems id="querylist-si" value="#{ceCaseSearchAndReportBB.queryList}" var="ql" itemValue="#{ql}" itemLabel="#{ql.queryTitle}" />
                                            <p:ajax listener="#{ceCaseSearchAndReportBB.changeQuerySelected}"
                                                    update="@form
                                                    messages-global-form" />
                                        </p:selectOneMenu>

                                        <p:spacer height="5px" />

                                        <h:outputLabel styleClass="bold" 
                                                       value="Description: " 
                                                       for="cecase-query-desc-ot" />
                                        <h:outputText id="cecase-query-desc-ot" 
                                                      value="#{ceCaseSearchAndReportBB.querySelected.queryName.desc}" />

                                        <p:spacer height="5px" />

                                        <p:commandButton   id="cecase-executequery-cb" 
                                                           ajax="true" 
                                                           actionListener="#{ceCaseSearchAndReportBB.executeQuery}"
                                                           disabled="#{ceCaseSearchAndReportBB.querySelected.queryExecuted}"
                                                           icon="fa fa-flash" 
                                                           styleClass="button"
                                                           value="Run Search" 
                                                           update="@form
                                                           cecase-search-results-form
                                                           cecase-search-log-form"/>

                                        <p:commandButton   id="cecase-search-clear-cb" 
                                                           ajax="true" 
                                                           actionListener="#{ceCaseSearchAndReportBB.resetQuery}"
                                                           icon="fa fa-eraser" 
                                                           styleClass="button inline-button"
                                                           value="Clear Search" 
                                                           disabled="#{!ceCaseSearchAndReportBB.querySelected.queryExecuted}"
                                                           update=" cecase-search-log-form
                                                           @form"/>


                                        <p:selectBooleanButton  id="cecase-search-appendresults-chkbox" 
                                                                onLabel="Add Results to Existing Case List"
                                                                onIcon="fa fa-indent"
                                                                offLabel="Build Fresh Case List On Search"
                                                                offIcon="fa fa-eraser"
                                                                value="#{ceCaseSearchAndReportBB.appendResultsToList}" 
                                                                disabled="false" />

                                    </h:form>

                                    <h:form id="cecase-search-results-form" >

                                        <p:commandButton   id="cecase-search-results-clear-button" 
                                                           ajax="true" 
                                                           actionListener="#{ceCaseSearchAndReportBB.clearCECaseList}"
                                                           icon="fa fa-eraser" 
                                                           styleClass="button"
                                                           value="Clear Results" 
                                                           update="messages-global-form
                                                           cecase-search-results-form"/>

                                        <p:commandButton   id="cecase-search-loadhistory-button" 
                                                           ajax="true" 
                                                           rendered="false"
                                                           actionListener="#{ceCaseSearchAndReportBB.loadCECaseHistory}"
                                                           icon="fa fa-clock-o" 
                                                           styleClass="button"
                                                           value="Load Case History" 
                                                           update="messages-global-form
                                                           cecase-search-results-form"/>

                                        <p:commandButton   id="cecase-export-excel-button" 
                                                           ajax="false" 
                                                           icon="fa fa-file-text-o" 
                                                           styleClass="button"
                                                           value="Export CSV" 
                                                           >
                                            <p:dataExporter type="csv" 
                                                            target="cecase-search-results-table"
                                                            fileName="caseExport" />
                                        </p:commandButton>

                                        <p:spacer height="5px" />

                                        <h:outputText value="listing #{ceCaseSearchAndReportBB.caseListSize} cases" 
                                                      styleClass="italic"/>
                                        <p:spacer height="5px" />

                                        <p:dataTable
                                            id="cecase-search-results-table"
                                            var="cse"
                                            filteredValue="#{ceCaseSearchAndReportBB.filteredCaseList}"
                                            rowKey="#{cse.caseID}"
                                            widgetVar="ceViewTable"
                                            value="#{ceCaseSearchAndReportBB.caseList}"
                                            tableStyleClass="primeDataTable"
                                            rowExpandMode="single"
                                            expandedRow="false"
                                            resizableColumns="true"
                                            >

                                            <p:column width="5%">
                                                <f:facet name="header">
                                                    <h:outputText value="Exp" />
                                                </f:facet>
                                                <p:rowToggler />
                                            </p:column>
                                            <p:column width="15%" 
                                                      sortBy="#{cse.priority.label}"
                                                      styleClass="#{!empty cse.priority ? cse.priority.rowStyleClass:''}">
                                                <f:facet name="header">
                                                    <h:outputText value="Priority" />
                                                </f:facet>
                                                <i class="material-icons">
                                                    <h:outputText value="#{!empty cse.priorityIcon ? cse.priorityIcon.materialIcon:''}"/>
                                                </i>
                                                <p:spacer height="3px" />
                                                <h:outputText value="#{cse.priority.label}" style="font-size:0.7em;" />

                                            </p:column>
                                            <p:column width="15%" sortBy="#{cse.caseManager.human.name}">
                                                <f:facet name="header">
                                                    <h:outputText value="Manager" />
                                                </f:facet>
                                                <h:outputText value="#{cse.caseManager.human.name}"/>
                                            </p:column>
                                            <p:column width="20%" sortBy="#{cse.originationDate}">
                                                <f:facet name="header">
                                                    <h:outputText value="Opened" />
                                                </f:facet>
                                                <h:outputText value="#{ceCaseSearchAndReportBB.getPrettyDateNoTime(cse.originationDate)}"/>
                                                <p:spacer height="2px"/>
                                                <h:outputText value="Age: #{cse.caseAge} days"
                                                              style="font-style: italic"/>
                                            </p:column>
                                            <p:column width="35%" 
                                                      sortBy="#{cse.property.address.buildingNo}"
                                                      filterBy="#{cse.property.address.buildingNo}">

                                                <f:facet name="header">
                                                    <h:outputText value="Info" />
                                                </f:facet>

                                                <h:outputText value="#{cse.property.address.addressPretty1Line} "
                                                              styleClass="bold"/>

                                                <f:subview id="case-property-unit-subview"
                                                           rendered="#{!empty cse.propUnit}" >

                                                    <p:spacer height="2px"
                                                              rendered="#{!(empty cse.propUnit)}"/>
                                                    <h:outputText value="Unit: #{cse.propUnit.unitNumber}" />
                                                </f:subview>
                                                <p:spacer height="2px"
                                                          rendered="#{!(empty cse.originationEvent)}"/>

                                                <h:outputText value="Origin: #{cse.originationEvent.category.eventCategoryTitle}"
                                                              rendered="#{!empty cse.originationEvent}"/>
                                                <p:spacer height="2px" />
                                                <h:outputText value="Name: #{cse.caseName}"/>

                                            </p:column>

                                            <p:column width="10%">
                                                <f:facet name="header">
                                                    <h:outputText value="Actions" />
                                                </f:facet>

                                                <div class="restrict-main-contents-io-link">

                                                    <p:commandLink  id="cecase-search-view-case"
                                                                    value="view"
                                                                    action="#{navigationBB.onCECaseListItemSelect(cse)}"
                                                                    ajax="false" />
                                                    <p:spacer height="2px" />
                                                    <p:commandLink  id="cecase-search-action-link"
                                                                    value="actions"
                                                                    type="button"
                                                                    disabled="false"
                                                                    ajax="true" />
                                                    <p:spacer height="2px" />
                                                    <h:outputText value="(ID: #{cse.caseID})" />


                                                </div>
                                                <p:overlayPanel for="cecase-search-action-link"
                                                                style="width:350px;" 
                                                                dismissable="true"
                                                                showCloseIcon="true" >

                                                    <h4>Actions available for case id 
                                                        <h:outputText value="#{cse.caseID}" />
                                                    </h4>

                                                    <div class="restrict-main-contents-io-link">
                                                        <p:commandLink  id="cecase-action-pincase"
                                                                        value="#{cse.pinned ? 'unpin case':'pin case'}"
                                                                        actionListener="#{pinningBB.togglePin(cse)}"
                                                                        style="button"
                                                                        ajax="true"
                                                                        disabled="true"
                                                                        update="@form" />

                                                        <p:spacer height="3px" />

                                                        <p:commandLink  id="cecase-action-logevent"
                                                                        value="log new event"
                                                                        style="button"
                                                                        actionListener="#{eventBB.onEventAddInit(cse)}"
                                                                        ajax="true"
                                                                        oncomplete="PF('event-add-dialog-var').show()"
                                                                        update="event-add-dialog
                                                                        messages-global-form"/>

                                                        <p:spacer height="3px" />

                                                        <p:commandLink  id="cecase-action-extendstipcomp"
                                                                        value="extend stipulated compliance date(s)"
                                                                        ajax="true" 
                                                                        style="button"
                                                                        actionListener="#{ceCaseBB.onViolationUpdateStipCompDateBatch(cse)}"
                                                                        oncomplete="PF('violation-update-stipdates-batch-dialog-var').show();"
                                                                        update="violation-update-stipdates-batch-form"
                                                                        />
                                                    </div>

                                                </p:overlayPanel>

                                            </p:column>
                                            <p:rowExpansion>
                                                <h4>Case Details 
                                                    <h:outputText value=" (#{cse.daysSinceLastEvent} days since last event)" />

                                                </h4>

                                                <p:spacer height="3px" />

                                                <p:accordionPanel id="case-expansioninfo-panel">
                                                    <p:tab title="Violations (#{cse.violationList.size()})">

                                                        <p:dataScroller id="violations-scroller"
                                                                        value="#{cse.violationList}"
                                                                        var="viol"
                                                                        style="font-family: sans-serif;">

                                                            <h:outputText value="#{!(empty viol.status) ? viol.status.label : ''}"
                                                                          style="font-weight: bold;"/>


                                                            <h:outputText value="#{!(empty viol.status) ? ': ' : ''}"
                                                                          style="font-weight: bold;"/>

                                                            <h:outputText    id="violation-scroller-chapter-ot"
                                                                             value="#{viol.violatedEnfElement.headerString}"
                                                                             escape="false"/>


                                                        </p:dataScroller>

                                                    </p:tab>
                                                    <p:tab title="Notices (#{cse.noticeList.size()})">

                                                        <p:dataScroller id="case-nov-scroller"
                                                                        value="#{cse.noticeList}"
                                                                        var="nov"
                                                                        style="font-family: sans-serif;">

                                                            <h:outputText value="Mailed on: " 
                                                                          rendered="#{!(empty nov.sentTS)}"/>
                                                            <h:outputText value="#{nov.sentTSPretty}"
                                                                          rendered="#{!(empty nov.sentTS)}"/>

                                                        </p:dataScroller>

                                                    </p:tab>
                                                    <p:tab title="Citations (#{cse.citationList.size()})">

                                                        <p:dataScroller id="case-citations-scroller"
                                                                        value="#{cse.citationList}"
                                                                        var="cit"
                                                                        style="font-family: sans-serif;">
                                                            <div style="text-decoration: underline;">
                                                                <h:outputText value="ID: #{cit.citationNo}" />
                                                            </div>
                                                            <p:spacer height="3px" />
                                                            <ui:repeat id="citation-status-uir"
                                                                       value="#{cit.statusLog}"
                                                                       var="logentry">
                                                                <h:outputText value="#{reportingBB.getPrettyDateNoTime(logentry.dateOfRecord)}: #{logentry.status.statusTitle}"/>
                                                                <p:spacer height="3px" />
                                                            </ui:repeat>
                                                        </p:dataScroller>

                                                    </p:tab>
                                                    <p:tab title="Events (#{cse.eventList.size()})">
                                                        <p:dataScroller id="case-events-scroller"
                                                                        value="#{cse.eventList}"
                                                                        var="ev">
                                                            <h:outputText value="#{missionControlBB.getPrettyDate(ev.timeStart)}" 
                                                                          style="font-weight: bold;"/>
                                                            <h:outputText value=": "
                                                                          style="font-weight: bold;"/>

                                                            <h:outputText value="#{ev.category.eventCategoryTitle}" />
                                                            <p:spacer height="3px" />


                                                        </p:dataScroller>
                                                    </p:tab>
                                                </p:accordionPanel>
                                                <h4>
                                                    Priority log
                                                </h4>
                                                <h:outputText value="#{cse.priorityAssignmentLog}"
                                                              escape="false"/>
                                            </p:rowExpansion>
                                        </p:dataTable>
                                    </h:form>
                                </p:panel>

                                <p:dialog   id="violation-update-stipdates-batch-dialog"
                                            height="500" width="700"
                                            widgetVar="violation-update-stipdates-batch-dialog-var"
                                            responsive="true"
                                            dynamic="true"
                                            modal="true"
                                            resizable="true"
                                            closable="true"
                                            closeOnEscape="true"
                                            header="Extend compliance timeframe for violations "
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                            >

                                    <h:form id="violation-update-stipdates-batch-form">
                                        <h4>Current Compliance Dates</h4>
                                        <p>
                                            <h:outputText value="#{ceCaseBB.getPrettyDate(ceCaseBB.currentViolation.stipulatedComplianceDate)}"/>
                                        </p>

                                        <div class="p-grid">
                                            <div class="p-col-12 restrict-data-field">
                                                <p:dataTable
                                                    id="updatestipdate-violations-table" 
                                                    var="vstpdt"
                                                    rowKey="#{vstpdt.violationID}"
                                                    value="#{ceCaseBB.currentCase.violationList}"
                                                    tableStyleClass="primeDataTable"
                                                    draggableColumns="false"
                                                    reflow="true" >



                                                    <p:column width="10%" 
                                                              sortBy="#{vstpdt.queuedForStipCompExtDate}"
                                                              headerText="Sel" >
                                                        <p:selectBooleanCheckbox value="#{vstpdt.queuedForStipCompExtDate}" />
                                                        <p:spacer height="3px" />
                                                        <h:outputText value="(ID:#{vstpdt.violationID})" />        
                                                    </p:column>

                                                    <p:column width="10%" sortBy="#{vstpdt.status.label}">
                                                        <f:facet name="header">
                                                            <h:outputText value="Status" />
                                                        </f:facet>
                                                        <i class="material-icons"><h:outputText value="#{vstpdt.icon.materialIcon}" /></i>
                                                        <p:spacer height="2px" />
                                                        <h:outputText value="#{!(empty vstpdt.status) ? vstpdt.status.label : ''}" />

                                                    </p:column>

                                                    <p:column width="30%"
                                                              styleClass="wrapText">

                                                        <f:facet name="header">
                                                            <h:outputText value="Ordinance" />
                                                        </f:facet>

                                                        <h:outputText  value="#{vstpdt.violatedEnfElement.headerString}"
                                                                       escape="false"/>

                                                    </p:column>

                                                    <p:column width="20%"
                                                              styleClass="wrapText">
                                                        <f:facet name="header">
                                                            <h:outputText value="Date" />
                                                        </f:facet>
                                                        <h:outputText value="#{(empty vstpdt.actualComplianceDate) and (empty vstpdt.nullifiedTS) ? 'Compliance due on ' : ''}"
                                                                      styleClass="compliance-date-stipulated"/>
                                                        <p:spacer height="3px"
                                                                  rendered="#{empty(vstpdt.actualComplianceDate) }"/>
                                                        <h:outputText value="#{(empty vstpdt.actualComplianceDate) and (empty vstpdt.nullifiedTS)  ? ceCaseBB.getPrettyDate(vstpdt.stipulatedComplianceDate) : ''}"
                                                                      styleClass="compliance-date-stipulated"/>

                                                        <h:outputText value="#{!empty(vstpdt.actualComplianceDate) ? 'Compliance achieved on '  : ''}"
                                                                      styleClass="compliance-date"/>
                                                        <p:spacer height="3px"
                                                                  rendered="#{!empty(vstpdt.actualComplianceDate) }"/>
                                                        <h:outputText value="#{!empty(vstpdt.actualComplianceDate) ? ceCaseBB.getPrettyDate(vstpdt.actualComplianceDate) : ''}"
                                                                      styleClass="compliance-date"/>

                                                        <h:outputText value="#{!empty(vstpdt.nullifiedTS) ? 'Nullified on '  : ''}"
                                                                      styleClass="compliance-date-nullified"/>
                                                        <p:spacer height="3px"
                                                                  rendered="#{!empty(vstpdt.nullifiedTS) }"/>
                                                        <h:outputText value="#{!empty(vstpdt.nullifiedTS) ? ceCaseBB.getPrettyDate(vstpdt.nullifiedTS): ''}"
                                                                      styleClass="compliance-date-nullified"/>
                                                    </p:column>

                                                    <p:column width="5%"
                                                              sortBy="#{vstpdt.daysUntilStipulatedComplianceDate}">
                                                        <f:facet name="header">
                                                            <h:outputText value="Days left" />
                                                        </f:facet>
                                                        <h:outputText value="#{empty vstpdt.actualComplianceDate and empty vstpdt.nullifiedTS ? vstpdt.daysUntilStipulatedComplianceDate: ''}"/>

                                                    </p:column>


                                                </p:dataTable>
                                            </div>
                                            <div class="p-col-4 restrict-data-field">
                                                <div class="restrict-main-contents-io-title" >

                                                    <p:outputLabel for="update-stipdate-sbb"
                                                                   styleClass="data_field_label">
                                                        <h:outputText value="Select an extension method:"
                                                                      rendered="true"/>
                                                    </p:outputLabel>
                                                </div>
                                            </div>
                                            <div class="p-col-8 restrict-data-field">
                                                <div class="restrict-main-contents-io-content" >

                                                    <p:selectBooleanButton id="violation-update-stipdate-sbb"
                                                                           onLabel="Pick a date"
                                                                           offLabel="Enter a number of days from today"
                                                                           styleClass="selectButton"
                                                                           rendered="true"
                                                                           value="#{ceCaseBB.formExtendStipCompUsingDate}"
                                                                           >
                                                        <p:ajax update="update-stipdate-cal
                                                                update-stipdate-numdays-it" />
                                                    </p:selectBooleanButton>
                                                </div>

                                            </div>
                                            <div class="p-col-6 restrict-data-field">

                                                <div class="restrict-main-contents-io-title" >
                                                    <h:outputLabel for="update-stipdate-cal">
                                                        <h:outputText value="New stipulated compliance date"/>
                                                    </h:outputLabel>
                                                </div>

                                                <div class="restrict-main-contents-io-content" >
                                                    <p:growl for="update-stipdate-cal"/>

                                                    <p:datePicker  id="update-stipdate-cal"
                                                                   value="#{ceCaseBB.currentViolation.stipulatedComplianceDate}"
                                                                   disabled="#{!ceCaseBB.formExtendStipCompUsingDate}"
                                                                   rendered="true"
                                                                   style="width: 100%;"
                                                                   pattern="MM/dd/yyyy HH:mm"
                                                                   showButtonBar="true"
                                                                   hideOnDateTimeSelect="true"
                                                                   showOnFocus="false"
                                                                   showIcon="true"
                                                                   mask="true"
                                                                   tabindex="16"
                                                                   timeInput="true"
                                                                   required="true" />


                                                </div>
                                            </div>


                                            <div class="p-col-6 restrict-data-field">
                                                <div class="restrict-main-contents-io-title" >

                                                    <p:outputLabel  for="update-stipdate-numdays-it"
                                                                    value="Set new compliance date this Number of days from today"/>
                                                </div>

                                                <div class="restrict-main-contents-io-content" >

                                                    <p:inputText id="update-stipdate-numdays-it"
                                                                 disabled="#{ceCaseBB.formExtendStipCompUsingDate}"
                                                                 value="#{ceCaseBB.formExtendedStipCompDaysFromToday}"
                                                                 style="width: 50px;"
                                                                 tabindex="3"
                                                                 type="number"
                                                                 required="false"
                                                                 styleClass="inputText"/>

                                                    <h:message for="update-stipdate-numdays-it" showDetail="false" showSummary="true"
                                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                                </div>

                                            </div>


                                            <div class="p-col-4 restrict-data-field-label-inline">
                                                <h:outputLabel for="update-stipdate-cal">
                                                    <h:outputText value="Event log description"/>
                                                </h:outputLabel>
                                            </div>

                                            <div class="p-col-8 restrict-data-field-value-inline" >
                                                <div class="restrict-main-contents-io-content" >
                                                    <p:inputTextarea id="violation-updatestipdate-evreason-ita"
                                                                     value="#{ceCaseBB.formViolationStipCompDateExtReason}" />
                                                </div>
                                            </div>

                                            <div class="p-col-12 restrict-data-field-value-inline" >

                                                <p:commandButton
                                                    id="update-stipdate-sbb"
                                                    icon="fa fa-calendar"
                                                    ajax="true"
                                                    actionListener="#{ceCaseBB.onViolationExtendStipCompDateCommitButtonChange}"
                                                    value="Extend stipulated compliance dates"
                                                    disabled="false"
                                                    oncomplete="PF('violation-update-stipdate-dialog-var').hide();"
                                                    update="cecase-violations-form
                                                    cecase-violations-panel
                                                    violation-details-dialog
                                                    violation-details-form
                                                    violation-growl-form"
                                                    />

                                                <p:spacer height="5px" />

                                                <div class="gray_button">
                                                    <p:commandButton    id="violation-update-stipdate-cancel-button"
                                                                        ajax="true"  tabindex="27"
                                                                        value="Cancel"
                                                                        icon="fa fa-stop"
                                                                        immediate="true"
                                                                        process="@none"
                                                                        onclick="PF('violation-update-stipdate-dialog-var').hide()"
                                                                        />
                                                </div>
                                            </div>
                                        </div>
                                    </h:form>
                                </p:dialog>



                                <p:panel  id="cecase-search-log-panel"
                                          toggleable="true"
                                          widgetVar="cecase-search-log-panel-var"
                                          collapsed="true"
                                          style="width:100%;"
                                          header="CECase Search Log">

                                    <h:form id="cecase-search-log-form">
                                        <div class='search-query-desc'>
                                            <h:outputText id="cecase-search-log-ot" 
                                                          value="#{ceCaseSearchAndReportBB.querySelected.queryLog}"
                                                          escape="false"/>
                                        </div>
                                    </h:form>
                                </p:panel>



                                <p:panel id="dashpanel-ce-cears"
                                         collapsed="false"
                                         closable="true"
                                         toggleable="true"
                                         header="#{sessionBean.sessCEARList.size()} CE Action Requests Awaiting Review"
                                         rendered="true"
                                         footer=""
                                         toggleableHeader="true"
                                         menuTitle="">
                                    <p:scrollPanel style="height: 550px;"
                                                   >

                                        <h:form id="dash-cears-form">

                                            <p:dataTable id="requestTable"
                                                         var="r"
                                                         rowKey="#{r.requestID}"
                                                         value="#{sessionBean.sessCEARList}"
                                                         tableStyleClass="primeDataTable"
                                                         >

                                                <p:column headerText="Date Submitted"
                                                          styleClass="centeredColumnContent">

                                                    <h:outputText value="#{missionControlBB.getPrettyDateNoTime(r.submittedTimeStamp)}"/>

                                                </p:column>

                                                <p:column headerText="Address"
                                                          styleClass="centeredColumnContent">

                                                    <h:outputText value="#{r.requestProperty.addressString}"/>

                                                </p:column>

                                                <p:column headerText="Issue Type"
                                                          styleClass="centeredColumnContent">

                                                    <h:outputText value="#{r.issue.name}"/>

                                                </p:column>

                                                <p:column headerText="View"
                                                          styleClass="centeredColumnContent"
                                                          >

                                                    <p:commandButton    
                                                        id="dash-switchuser-button-switch"
                                                        value="View"
                                                        styleClass="button" 
                                                        ajax="false"
                                                        action="#{missionControlBB.onViewCEARButtonChange(r)}" 
                                                        icon="fa fa-cogs" />


                                                </p:column>

                                            </p:dataTable>

                                            <p:spacer height="15px"/>

                                            <p:chart type="donut" 
                                                     model="#{cEActionRequestsBB.requestReasonDonut}" 
                                                     style="width:600px; height: 600px;"/>

                                            <p:spacer height="10px"/>

                                        </h:form>

                                    </p:scrollPanel>
                                </p:panel>


                                <p:panel id="dashpanel-sys-switchmuni"
                                         collapsed="false"
                                         closable="true"
                                         toggleable="true"
                                         header="Switch Session Municipality"
                                         rendered="true"
                                         footer=""
                                         toggleableHeader="true"
                                         menuTitle="">
                                    <h:form id="switch-muni-form">

                                        <p:commandButton    id="dash-switchmuni-button-switch"
                                                            disabled="false"
                                                            value="Change Session Credential" 
                                                            styleClass="button" 
                                                            action="#{missionControlBB.reauthenticate}" 
                                                            icon="fa fa-exchange" />
                                    </h:form>
                                </p:panel>

                                <p:panel id="dashpanel-sys-switchuser"
                                         collapsed="false"
                                         closable="true"
                                         toggleable="true"
                                         header="Switch User"
                                         rendered="true"
                                         footer=""
                                         toggleableHeader="true"
                                         menuTitle="">
                                    <h:form id="switch-user-form">


                                        <p:selectOneMenu id="dash-switchuser-solb-chooseuser" tabindex="12" value="#{missionControlBB.selectedUser}">
                                            <f:converter converterId="userConverter"/>
                                            <f:selectItem itemLabel="select a user..." noSelectionOption="true" itemDisabled="true"/>
                                            <f:selectItems id="dash-switchuser-si-username" 
                                                           value="#{missionControlBB.userList}"
                                                           var="u" itemValue="#{u}" itemLabel="#{u.username} (#{u.userID})" />
                                            <p:ajax update="dash-switchuser-button-switch" />
                                        </p:selectOneMenu>
                                        <h:message for="dash-switchuser-solb-chooseuser" showDetail="true" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                        <p:commandButton    id="dash-switchuser-button-switch"
                                                            disabled="#{empty missionControlBB.selectedUser}"
                                                            value="Switch to #{missionControlBB.selectedUser.username}" 
                                                            styleClass="button" 
                                                            action="#{missionControlBB.switchToUser}" 
                                                            icon="fa fa-universal-access" />
                                    </h:form>
                                </p:panel>


                            </div>
                        </div>
                    </div>


                    <p:dialog header="About page: Mission Control" 
                              widgetVar="helpdlg" 
                              responsive="true" 
                              width="400"
                              modal="false"
                              height="600">
                        <h:form id="about-form">

                            <h2>Help Topic: Dashboard</h2>

                            <p>The dashboard is both a set of links to various system tools and a display of key data metrics of the system.</p>

                            <h3>You current municipality</h3>

                            <p>You are always navigating the system from the standpoint of a certain municipality, which is 
                                always listed in the dark blue top banner bar. You cannot be in an "all municipalities" view mode. </p>

                            <p>CodeConnects looks up your current municipality to decide which case lists to show you when 
                                viewing code enforcement data. On pages for searching or creating muni-specific data, your current
                                municipality is used to set the default values.</p>

                            <p:commandLink  value="close help" onclick="PF('helpdlg').hide()" styleClass="noFill"/>

                            <h4>Switching municipalities</h4>

                            <p>If you are authorized to change your municipality, you can do so with this drop down box and command button. After issuing
                                the command to switch to a new municipality, the page will reload and both the listing on this page
                                and in the header bar will reflect these changes.</p>

                            <h4>What is COG Land?</h4>

                            <p>COG Land is a dream world where all mistakes are allowed and nothing bad ever happens. 
                                If you make a mistake, nobody cares so you can tinker and explore and experiment with freedom and ease. All
                                data stored in COG Land behaves just like a non-dreamland municipality but impacts no actual humans.</p>

                            <h3>User info verification</h3>

                            <p>CodeConnect is built on a system called Java ServerFaces(JSF) and the PrimeFaces library that works with JSF.
                                The entire system runs inside a web server called Wildfly. Page control is managed by Glassfish but all other
                                data in the system is linked to your user that's managed by JSF, hence the heading: 
                                <span class="italic">Authenticated Faces User</span>.</p>

                            <p:commandLink  value="close help" onclick="PF('helpdlg').hide()" styleClass="noFill"/>
                        </h:form>


                    </p:dialog>



                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

