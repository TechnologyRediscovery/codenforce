<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Case Report</title>
    </h:head>
    <h:body>
        <ui:composition template="./../report_template.xhtml">
            <ui:define name="print-content">
                <f:view id="report-cecase-view">

                    <h:form id="case-details-form">
                        
                        <div class="p-grid">
                            <div class="p-col-6">
                                <div class="p-grid">
                                    <div class="p-col-12">
                                        <h:outputText id="header-id-ot" 
                                                      style="font-style: italic;"
                                                      value=" Code enforcement case (ID: #{reportingBB.reportCECase.cse.caseID}) at"/>
                                        
                                        <h1>

                                            <h:outputText id="header-addr-ot" 
                                                          value="#{reportingBB.reportCECase.cse.property.address.addressPretty2LineEscapeFalse}"
                                                          escape="false"/>  
                                        </h1>
                                    </div>
                                    <div class="p-col-12">
                                        <p>Broadview photo here</p>
                                    </div>

                                    <div class="p-col-12">
                                        <h2>Property info</h2>
                                    </div>

                                    <div class="p-col-4 data_field_label">
                                        <h:outputText value="Parcel ID (County)"  />
                                    </div>
                                    <div class="p-col-8">
                                        <h:outputText value="#{reportingBB.reportCECase.propDH.countyParcelID} "
                                                      rendered="true" />
                                    </div>

                                    <div class="p-col-4 data_field_label">
                                        <h:outputText value="InternalID" />
                                    </div>
                                    <div class="p-col-8">
                                        <h:outputText value="#{reportingBB.reportCECase.propDH.propertyID} "/>
                                    </div>

                                    <div class="p-col-4 data_field_label">
                                        <h:outputText value="Property Source" />
                                    </div>
                                    <div class="p-col-8">
                                        <h:outputText value="#{reportingBB.reportCECase.propDH.source.title} "
                                                      />
                                    </div>

                                    <div class="p-col-4 data_field_label">
                                        <h:outputLabel value="County"/>
                                    </div>
                                    <div class="p-col-8">
                                        <h:outputText value="#{reportingBB.reportCECase.propDH.parcelInfo.countyCode}"  />
                                    </div>

                                    <div class="p-col-4 data_field_label">
                                        <h:outputLabel value="Condition"/>
                                    </div>
                                    <div class="p-col-8">
                                        <h:outputText value="#{!(empty reportingBB.reportCECase.propDH.parcelInfo.condition) ? reportingBB.reportCECase.propDH.parcelInfo.condition.title : ''}" />
                                    </div>

                                    <div class="p-col-4 data_field_label">
                                        <h:outputLabel value="Use Type"/>
                                    </div>
                                    <div class="p-col-8">
                                        <h:outputText value="#{reportingBB.reportCECase.propDH.parcelInfo.useType.name}"  />
                                    </div>
                                </div>
                            </div>
                            <div class="p-col-6">
                                <f:subview id="rpt-cecase-persons-subview"
                                           rendered="#{reportingBB.reportCECase.includeAssociatedPersons}">

                                    <div class="p-grid nested-grid">
                                        <div class="p-col-12">
                                            <h2>Person connections</h2>
                                        </div>
                                        <ui:repeat id="person-con-uir"
                                                   value="#{reportingBB.reportCECase.cse.humanLinkList}" 
                                                   var="csehl">
                                            <div class="p-grid">

                                                <div class="p-col-4">
                                                    <h:outputText value="#{csehl.name}" />
                                                </div>
                                                <div class="p-col-8">
                                                    <h:outputText value="#{csehl.linkedObjectRole.title}" />
                                                    <h:outputText value=" " />
                                                    <h:outputText value="#{csehl.linkedObjectRole.schema.TARGET_OBJECT_FRIENDLY_NAME}" />
                                                    <h:outputText value=" " />
                                                    <h:outputText value="(ID: #{csehl.parentObjectID})" />
                                                    
                                                </div>
                                                <f:subview id="rpt-cecase-person-contact"
                                                           rendered="#{reportingBB.reportCECase.includePersonAddrPhoneEmail}">
                                                    <div class="p-col-4">
                                                        <h:outputText value="address(s)" />
                                                    </div>
                                                    <div class="p-col-8">
                                                        <h:outputText value="#{csehl.mailingAddressListPretty}"
                                                                      escape="false"/>
                                                    </div>
                                                    <div class="p-col-4">
                                                        <h:outputText value="phone number(s)" />
                                                    </div>
                                                    <div class="p-col-8">
                                                        <h:outputText value="#{csehl.phoneListPretty}"
                                                                      escape="false"/>
                                                    </div>
                                                    <div class="p-col-4">
                                                        <h:outputText value="email address(es)" />
                                                    </div>
                                                    <div class="p-col-8">
                                                        <h:outputText value="#{csehl.emailListPretty}"
                                                                      escape="false"/>
                                                    </div>
                                                </div>

                                            </f:subview>
                                        </ui:repeat>
                                    </div>
                                </f:subview>
                            </div>
                        </div>


                        <p>
                            <a href="#event-history">event history <h:outputText value=" (#{reportingBB.reportCECase.cse.eventList.size()})" /></a> | 
                            <a href="#violations">violations <h:outputText value=" (#{reportingBB.reportCECase.cse.violationList.size()})" /></a> | 
                            <a href="#notices">notices <h:outputText value=" (#{reportingBB.reportCECase.cse.noticeList.size()})" /></a> | 
                            <a href="#citations">citations <h:outputText value=" (#{reportingBB.reportCECase.cse.citationList.size()})" /></a> | 
                            <a href="#requests">enforcement requests <h:outputText value=" (#{reportingBB.reportCECase.cse.ceActionRequestList.size()})" /></a>  
                        </p>



                        <div class="report-trailblaze-headerbox">
                            <div class="report-trailblaze-headerbox-title">
                                <h:outputText value="Code Violations" />
                            </div>
                            <div class="report-trailblaze-headerbox-tail">
                                <h:outputText value="I'm invisible !"/>
                            </div>
                        </div>


                        <p:dataScroller
                            id="violation-table"
                            var="v"
                            value="#{reportingBB.reportCECase.cse.violationList}">


                            <h2>
                                <h:outputLabel styleClass="mono" value="#{v.violatedEnfElement.headerString}"
                                               escape="false" />
                                <h:outputText value="Violation ID:  #{v.violationID}"/><h:outputText id="violation-compactlist-line-ot-resolved" value="#{v}"/>
                                <h:outputText id="sep-compactlist-line-ot-resolved" value=" | "/>
                                <h:outputText id="status-compactlist-line-ot-resolved" styleClass="italic" value="#{v.status.label}"/>
                            </h2>


                            <h:outputLabel styleClass="bold" value="Ordindance: "  />
                            <p:spacer height="5px" />

                            <h:outputLabel styleClass="bold" value="Full ordinance text: "/>
                            <div class="ord-text">
                                <h:outputText value="#{v.violatedEnfElement.ordTechnicalText}"/>
                            </div>
                            <p:spacer height="5px"/>
                            <h:outputLabel styleClass="bold" value="Description of violation: "/>
                            <h:outputText styleClass="weight-normal" value="#{v.description}"/>
                            <h:outputText styleClass="bold" value="Violation ID: " />
                            <h:outputText value="#{v.violationID}"/>

                            <p:spacer height="5px"/>

                            <h:outputText styleClass="bold" value="Date of record: " />
                            <h:outputText value="#{v.dateOfRecord}"/>
                            <p:spacer height="5px"/>

                            <h:outputText styleClass="bold" value="Stipulated Compliance Date: " />
                            <h:outputText value="#{v.stipulatedComplianceDatePretty}"/>
                            <p:spacer height="5px"/>

                            <h:outputText styleClass="bold" value="Days left: " />
                            <h:outputText value="#{empty v.actualComplianceDate ? v.daysUntilStipulatedComplianceDate: null}"/>
                            <p:spacer height="5px"/>

                            <h:outputText styleClass="bold" value="Actual Comp Date: " />
                            <h:outputText value="#{v.actualComplianceDatePretty}"/>



                            <h:outputText value="Photo count: " />
                            <h:outputText value="#{empty v.blobList ? '0' : v.blobList.size()}"/>

                            <p:spacer height="5px"/>

                            <h:outputText class="bold" value="Citations: " />
                            <h:outputText value="#{v.citationListAsString}"/>
                            <p:spacer height="5px"/>

                            <h:outputLabel styleClass="bold" value="Penalty:"/>
                            <h:outputText value="#{v.penalty}"/>


                            <p:spacer height="5px"/>

                            <h:outputLabel styleClass="bold" value="Officer Notes: "/>
                            <h:outputText value="#{v.notes}" escape="false"/>


                            <h4>Photos</h4>
                            <ui:repeat value="#{v.blobList}"
                                       var="vblob" >
                                <h4>
                                    <h:outputText value=" Photo ID:#{vblob.photoDocID}"
                                                  rendered="#{reportingBB.reportConfigFieldInspection.includePhotoIDs}"/>

                                    <h:outputText value=": #{vblob.title}"
                                                  rendered="#{reportingBB.reportConfigFieldInspection.includePhotoTitles}"/>
                                </h4>
                                <h:outputText value="Description: #{vblob.description}"
                                              rendered="#{reportingBB.reportConfigFieldInspection.includePhotoDescriptions and vblob.description ne ''}"
                                              />
                                <p:spacer height="3px" />
                                <h:outputText value="Filename: #{vblob.filename}"
                                              rendered="#{reportingBB.reportConfigFieldInspection.includePhotoOriginalFileNames}"
                                              />
                                <p:spacer height="3px" />

                                <p:graphicImage value="#{blobsterBB.image}"
                                                alt="no preview available" 
                                                style="width: #{reportingBB.reportConfigFieldInspection.unifiedPhotoWidth}px" 
                                                cache="false"
                                                rendered="#{vblob.type.browserViewable}">
                                    <f:param name="blobid" value="#{vblob.photoDocID}"/>
                                </p:graphicImage>

                                <h:outputText value="no preview available; download to view"
                                              rendered="#{!vblob.type.browserViewable}" />
                                <p:divider />
                            </ui:repeat>
                        </p:dataScroller>


                        <div class="report-trailblaze-headerbox">
                            <div class="report-trailblaze-headerbox-title">
                                <h:outputText value="Event Log" />
                            </div>
                            <div class="report-trailblaze-headerbox-tail">
                                <h:outputText value="I'm invisible !"/>
                            </div>
                        </div>

                        <h2 id="event-history" class="printing-page-break-before">Event history</h2>

                        <p:dataScroller
                            id="events-datascroller"
                            var="e"
                            value="#{reportingBB.reportCECase.cse.eventList}"
                            widgetVar="ceevent-ds-var">

                            <div class="action-request-icon">
                                <i class="material-icons"><h:outputText id="action-request-display-icon-ot-evhist" value="#{e.category.icon.materialIcon}"/></i>
                            </div>
                            <div class="status-display-status-list-container">
                                <div class="action-request-header">
                                    <h:outputText value="#{e.category.eventType.label}: #{e.category.eventCategoryTitle} "/>
                                </div>
                            </div>
                            <h:outputText styleClass="weight-normal" value="#{e.description}"/>
                            <p>
                                <h:outputText value="Owner: " styleClass="bold" />
                                <h:outputText value="#{e.userCreator.human.name}"/>
                                <br />
                                <h:outputText styleClass="bold" value="Date of record: "/>
                                <h:outputText value="#{reportingBB.getPrettyDate(e.timeStart)}"/>
                                <br />
                                <h:outputText styleClass="bold" value="Event ID: "/>
                                <h:outputText value="#{e.eventID}"/>
                                <br />
                            </p>

                            <h:outputLabel styleClass="bold" style="text-align: left" value="Event notes"/>
                            <p:spacer height="15px"/>
                            <div class="rowExpansion" style="text-align: left">
                                <h:outputText escape="false" value="#{e.notes}"/>
                            </div>

                        </p:dataScroller>



                        <div class="report-trailblaze-headerbox">
                            <div class="report-trailblaze-headerbox-title">
                                <h:outputText value="Notices of Violation" />
                            </div>
                            <div class="report-trailblaze-headerbox-tail">
                                <h:outputText value="I'm invisible !"/>
                            </div>
                        </div>

                        <p:dataScroller
                            id="notices-ds"
                            value="#{reportingBB.reportCECase.cse.noticeList}"
                            var="notice"
                            rendered="true">

                            <h:outputText styleClass="bold" style="font-size:1.5em;"  value="Notice ID:" />
                            <h:outputText style="font-size:1.5em;"   value="#{notice.noticeID}"/>

                            <p:spacer height="5px"/>

                            <h:outputText styleClass="bold"   value="Date of Record: " />
                            <h:outputText value="#{reportingBB.getPrettyDateNoTime(notice.dateOfRecord)}"/>

                            <p:spacer height="5px"/>

                            <h:outputText styleClass="bold"   value="Queued for Mailing: " />
                            <h:outputText id="nov-queued-ot" value="#{reportingBB.getPrettyDateNoTime(notice.lockedAndqueuedTS)}"/>
                            <p:spacer height="5px"/>

                            <h:outputText styleClass="bold"  value="Sent Date: " />
                            <h:outputText id="nov-sent-date" value="#{reportingBB.getPrettyDateNoTime(notice.sentTS)}"/>

                            <p:spacer height="5px"/>
                            <h:outputText styleClass="bold"  value="Returned? " />
                            <h:outputText id="nov-returned-date" value="#{!empty notice.returnedTS ? 'Yes' : 'No'}"/>

                            <p:spacer height="5px"/>
                            <h:outputText styleClass="bold"  value="Recipient" />
                            <h:outputText value="#{noticeOfViolationBB.currentNotice.fixedRecipientName}"/>
                            <br />
                            <h:outputText escape="false" value="#{noticeOfViolationBB.currentNotice.fixedRecipientBldgNo}"/>
                            <h:outputText escape="false" value=" "/>
                            <h:outputText escape="false" value="#{noticeOfViolationBB.currentNotice.fixedRecipientStreet}"/>
                            <br />
                            <h:outputText value="#{noticeOfViolationBB.currentNotice.fixedRecipientCity}, #{noticeOfViolationBB.currentNotice.fixedRecipientState} #{noticeOfViolationBB.currentNotice.fixedRecipientZip}"/>



                        </p:dataScroller>

                        <div class="report-trailblaze-headerbox">
                            <div class="report-trailblaze-headerbox-title">
                                <h:outputText value="Citations" />
                            </div>
                            <div class="report-trailblaze-headerbox-tail">
                                <h:outputText value="I'm invisible !"/>
                            </div>
                        </div>
                        <p:dataScroller
                            id="citation-table"
                            var="citation"
                            value="#{reportingBB.reportCECase.cse.citationList}">

                            <h:outputText value="Filing date: " />
                            <h:outputText value="#{citation}"/>
                            <p:spacer height="5px" />
                            <h:outputText value="Issued by: " />
                            <h:outputText value="#{citation.filingOfficer.human.name}"/>
                            <p:spacer height="5px" />
                            <h:outputText value="Court entity: " />
                            <h:outputText value="#{citation.origin_courtentity.courtEntityName}"/>

                            
                            <p:spacer height="5px" />
                            <h:outputText value="Citation ID (internal)" />
                            <h:outputText value="#{citation.citationID}"/>
                            <p:spacer height="5px" />
                            <h:outputLabel value="Citation text: "/>
                            <div class="rowExpansion">
                                <h:outputText value="#{citation.notes}"/>
                            </div>

                            <h:outputLabel value="Violations: "/>
                            <p:dataScroller 
                                id="citation-violations-datascroller"
                                value="#{citation.violationList}"
                                var="citv"
                                widgetVar="citation-violation-compactlist-widgetvar">
                                <h:outputText id="v-source-name-compactlist-ot" value="#{citv.violatedEnfElement.headerString}"/>
                            </p:dataScroller>
                            <ui:repeat id="citation-status-uir"
                                       value="#{cit.statusLog}"
                                       var="logentry">
                                <h:outputText value="#{reportingBB.getPrettyDateNoTime(logentry.dateOfRecord)}: #{logentry.status.statusTitle}"/>
                                <p:spacer height="3px" />
                            </ui:repeat>
                        </p:dataScroller>



                        <div class="report-trailblaze-headerbox">
                            <div class="report-trailblaze-headerbox-title">
                                <h:outputText value="Action Requests" />
                            </div>
                            <div class="report-trailblaze-headerbox-tail">
                                <h:outputText value="I'm invisible !"/>
                            </div>
                        </div>
                        <p:dataScroller
                            id="actionRequestTable"
                            var="r"
                            value="#{reportingBB.reportCECase.cse.ceActionRequestList}">

                            <h3>Code Enforcement Action Request</h3>
                            <h:outputLabel class="bold" value="Issue Type" />
                            <p:spacer height="5px"/>
                            <div class="wrapText">
                                <h:outputText value="#{r.issue.name}"/>
                            </div>
                            <h:outputLabel class="bold" value="Address" />
                            <p:spacer height="5px"/>
                            <div class="rowExpansion">
                                <h:outputText value="#{r.requestProperty.address}"/>
                            </div>

                            <h:outputLabel class="bold" value="Date Submitted" />
                            <p:spacer height="5px"/>
                            <div class="wrapText">
                                <h:outputText value="#{r.formattedSubmittedTimeStamp}"/>
                            </div>

                            <h:outputLabel styleClass="bold" value="ID"/>
                            <p:spacer height="5px"/>
                            <div class="wrapText">
                                <h:outputText value="#{r.requestID}"/>
                            </div>

                            <div class="wrapText">
                                <h:outputLabel styleClass="bold" value="Human safety issue?"/>
                                <p:spacer height="5px"/>
                                <h:outputText value="#{r.isUrgent}"/>
                            </div>
                            <p:spacer height="5px"/>
                            <h:outputText value="Age: " />
                            <h:outputText value="#{r.daysSinceDateOfRecord}"/>

                            <div class="wrapText">
                                <h:outputLabel styleClass="bold" value="Requestor (#{r.requestor.personType.label}): "/>
                                <p:spacer height="5px"/>

                                <h:outputText value="#{r.requestor.firstName} "/> 
                                <h:outputText value="#{r.requestor.lastName}" />
                                <br />
                                <h:outputText value="#{r.requestor.addressStreet}" />                                    
                                <h:outputText value="#{r.requestor.addressCity}" />                                    
                                <h:outputText value="#{r.requestor.addressState}" />                                    
                                <h:outputText value="#{r.requestor.addressZip}" />          
                            </div>

                           
                            <h:outputLabel styleClass="bold" value="Request description"/>
                            <p:spacer height="15px"/>
                            <div class="rowExpansion" style="leftalign">
                                <h:outputText escape="false" value="#{r.requestDescription}"/>
                            </div>

                        </p:dataScroller>
                    </h:form>
                </f:view>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

