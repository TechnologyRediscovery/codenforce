<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns="http://www.w3.org/1999/xhtml">

    <h:form id="inspectiontools-growl-form">
        <p:growl id="inspectiontools-growl" />
    </h:form>

    <p:dialog id="inspection-profile-dialog"
              widgetVar="inspection-profile-dialog-var"
              width="1200"
              height="600"
              header="Inspection Profile (ID:#{fieldInspectionBB.currentInspection.inspectionID})"
              modal="true"
              dynamic="true"
              resizable="true"
              closable="true"
              closeOnEscape="true"
              >
        <div class="p-grid nested-grid">

            <!-- Inspection metadata-->
            <div class="p-col-6">
                <h:form id="inspection-profile-form">
                    <p:commandButton id="inspections-inspectiondetails-editbutton"
                                     value="#{fieldInspectionBB.editModeInspectionMetadata ? 'Save Changes' : 'Edit'}"
                                     disabled="#{!empty fieldInspectionBB.currentInspection.deactivatedBy}"
                                     rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                     icon="fa #{fieldInspectionBB.editModeInspectionMetadata ? 'fa-check' : 'fa-pencil'}"
                                     actionListener="#{fieldInspectionBB.onToggleEditModeInspectionMetadata}"
                                     oncomplete="PF('inspection-profile-dialog-var').show();"
                                     update="@form
                                     @form:@parent:inspectiontools-growl-form
                                     #{fieldInspectionBB.inspectionListComponentForUpdate}"/>

                    <div class="gray_button">

                        <p:commandButton id="inspections-inspectiondetails-abort"
                                         value="Cancel"
                                         styleClass="gray-button"
                                         rendered="#{fieldInspectionBB.editModeInspectionMetadata}"
                                         icon="fa fa-stop"
                                         actionListener="#{fieldInspectionBB.abortEditsOccInspectionMetadata}"
                                         oncomplete="PF('inspection-profile-dialog-var').show()"
                                         update="@form
                                         @form:@parent:inspectiontools-growl-form"/>
                    </div>



                    <p:spacer height="5px"/>

                    <p:panel id="inspections-inspectiondetails-generalpanel"
                             toggleable="true"
                             collapsed="false"
                             header="General">

                        <div class="p-grid">
                            <div class="p-col-6">ID</div>
                            <div class="p-col-6">
                                <h:outputText value="#{fieldInspectionBB.currentInspection.inspectionID}" />
                            </div>
                            <div class="p-col-6">
                                Re-inspection?
                            </div>
                            <div class="p-col-6">

                                <h:outputText rendered="#{fieldInspectionBB.currentInspection.followUpToInspectionID eq 0 and !fieldInspectionBB.editModeInspectionMetadata}" 
                                              value="No; first inspection"/>

                                <h:outputText rendered="#{fieldInspectionBB.currentInspection.followUpToInspectionID ne 0 and !fieldInspectionBB.editModeInspectionMetadata}" 
                                              value="Yes: To inspection ID: #{fieldInspectionBB.currentInspection.followUpToInspectionID}"/>



                            </div>
                            <div class="p-col-6">
                                Inspector
                            </div>
                            <div class="p-col-6">
                                <h:outputText rendered="#{!fieldInspectionBB.editModeInspectionMetadata}" 
                                              value="#{fieldInspectionBB.currentInspection.inspector.human.name}" />
                                <h:outputText rendered="#{!fieldInspectionBB.editModeInspectionMetadata}" 
                                              value=" (#{fieldInspectionBB.currentInspection.inspector.username})" />

                                <p:selectOneMenu rendered="#{fieldInspectionBB.editModeInspectionMetadata}"
                                                 value="#{fieldInspectionBB.currentInspection.inspector}"
                                                 filter="true"
                                                 filterMatchMode="contains"
                                                 required="false"
                                                 converter="userConverter">
                                    <f:selectItems value="#{systemServicesBB.bbSessionMuni.swornOfficerList}" 
                                                   var="user"
                                                   itemLabel="#{user.human.name} (#{user.username})"
                                                   itemValue="#{user}"/>
                                </p:selectOneMenu>
                            </div>

                            <p:divider/>

                            <div class="p-col-6">
                                Created
                            </div>

                            <div class="p-col-6">
                                <h:outputText value="#{fieldInspectionBB.currentInspection.createdBy.human.name} 
                                              (#{fieldInspectionBB.currentInspection.createdBy.username})" 
                                              rendered="#{!empty fieldInspectionBB.currentInspection.createdBy}"/>
                                <p:spacer height="3px" />

                                <h:outputText value="at "
                                              rendered="#{!empty fieldInspectionBB.currentInspection.creationTS}" />

                                <h:outputText value="#{fieldInspectionBB.getPrettyDate(fieldInspectionBB.currentInspection.creationTS)}" 
                                              rendered="#{!empty fieldInspectionBB.currentInspection.creationTS}"/>
                            </div>

                            <div class="p-col-6">
                                Last updated
                            </div>

                            <div class="p-col-6">
                                <h:outputText value="#{fieldInspectionBB.currentInspection.lastUpdatedBy.human.name} 
                                              (#{fieldInspectionBB.currentInspection.lastUpdatedBy.username})" 
                                              rendered="#{!empty fieldInspectionBB.currentInspection.lastUpdatedBy}"/>

                                <p:spacer height="3px" />
                                <h:outputText value="at "
                                              rendered="#{!empty fieldInspectionBB.currentInspection.lastUpdatedTS}" />

                                <h:outputText value="#{fieldInspectionBB.getPrettyDate(fieldInspectionBB.currentInspection.lastUpdatedTS)}" 
                                              rendered="#{!empty fieldInspectionBB.currentInspection.lastUpdatedTS}"/>
                            </div>
                            <div class="p-col-6">
                                Deactivated
                            </div>
                            <div class="p-col-6">

                                <h:outputText value="Active Record" 
                                              rendered="#{empty fieldInspectionBB.currentInspection.deactivatedBy}"/>

                                <h:outputText value="#{fieldInspectionBB.currentInspection.deactivatedBy.human.name} 
                                              (#{fieldInspectionBB.currentInspection.deactivatedBy.username})" 
                                              rendered="#{!empty fieldInspectionBB.currentInspection.deactivatedBy}"/>
                                <p:spacer height="3px" />

                                <h:outputText value="at "
                                              rendered="#{!empty fieldInspectionBB.currentInspection.deactivatedTS}" />

                                <h:outputText value="#{fieldInspectionBB.getPrettyDate(fieldInspectionBB.currentInspection.deactivatedTS)}" 
                                              rendered="#{!empty fieldInspectionBB.currentInspection.deactivatedBy}"/>
                            </div>
                        </div>
                    </p:panel>

                    <p:panel id="inspections-inspectiondetails-inspectionpanel"
                             toggleable="true"
                             collapsed="false"
                             header="Inspection">
                        <div class="p-grid">

                            <div class="p-col-6">
                                Cause
                            </div>
                            <div class="p-col-6">
                                <h:outputText rendered="#{!fieldInspectionBB.editModeInspectionMetadata}" 
                                              value="#{fieldInspectionBB.currentInspection.cause.title}"
                                              title="#{fieldInspectionBB.currentInspection.cause.description}"
                                              />

                                <p:selectOneMenu rendered="#{fieldInspectionBB.editModeInspectionMetadata}"
                                                 value="#{fieldInspectionBB.currentInspection.cause}"
                                                 converter="occInspectionCauseConverter"
                                                 required="false">
                                    <f:selectItems value="#{fieldInspectionBB.causeList}" 
                                                   var="cause"
                                                   itemLabel="#{cause.title}"
                                                   itemValue="#{cause}"/>
                                </p:selectOneMenu>

                            </div>

                            <div class="p-col-6">
                                Checklist
                            </div>
                            <div class="p-col-6">

                                <h:outputText rendered="#{!fieldInspectionBB.editModeInspectionMetadata}" 
                                              value="#{fieldInspectionBB.currentInspection.checklistTemplate.title}"/>

                                <p:selectOneMenu rendered="#{fieldInspectionBB.editModeInspectionMetadata}"
                                                 value="#{fieldInspectionBB.currentInspection.checklistTemplate}"
                                                 converter="checklistTitleConverter"
                                                 required="false">
                                    <f:selectItems value="#{fieldInspectionBB.checklistTemplateList}" 
                                                   var="temp"
                                                   itemLabel="#{temp.title}"
                                                   itemValue="#{temp}"/>
                                </p:selectOneMenu>
                                <h:outputText rendered="#{fieldInspectionBB.editModeInspectionMetadata}" 
                                              value="Warning: changing templates after an inspection has begun is a recipe for disaster!"/>
                            </div>

                            <div class="p-col-4">
                                Start time
                            </div>

                            <div class="p-col-8">
                                <h:outputText rendered="#{!fieldInspectionBB.editModeInspectionMetadata}" 
                                              value="#{fieldInspectionBB.getPrettyDate(fieldInspectionBB.currentInspection.timeStart)}"/>

                                <p:datePicker 	 id="inspection-time-start-datepicker"
                                                rendered="#{fieldInspectionBB.editModeInspectionMetadata}"
                                                value="#{fieldInspectionBB.currentInspection.timeStart}" 
                                                style="width: 100%;"
                                                pattern="MM/dd/yyyy HH:mm"
                                                disabled="false"
                                                showButtonBar="true"
                                                hideOnDateTimeSelect="true"
                                                showOnFocus="false"
                                                showIcon="true"
                                                mask="true"
                                                timeInput="true" 
                                                required="false" />
                            </div>

                            <div class="p-col-4">
                                End time
                            </div>

                            <div class="p-col-8">
                                <h:outputText   rendered="#{!fieldInspectionBB.editModeInspectionMetadata}" 
                                                value="#{fieldInspectionBB.getPrettyDate(fieldInspectionBB.currentInspection.timeEnd)}"/>
                                <p:datePicker 	 id="inspection-time-end-datepicker"
                                                rendered="#{fieldInspectionBB.editModeInspectionMetadata}"
                                                value="#{fieldInspectionBB.currentInspection.timeEnd}" 
                                                style="width: 100%;"
                                                pattern="MM/dd/yyyy HH:mm"
                                                disabled="false"
                                                showButtonBar="true"
                                                hideOnDateTimeSelect="true"
                                                showOnFocus="false"
                                                showIcon="true"
                                                mask="true"
                                                timeInput="true" 
                                                required="false" />
                            </div>

                            <div class="p-col-4">
                                Determination
                                <p:spacer height="3px" />
                                <p:commandLink id="determination-init-button"
                                               ajax="true"
                                               style="color:blue;"
                                               oncomplete="PF('inspection-finalize-dialog-var').show()"
                                               disabled="#{fieldInspectionBB.editModeInspectionMetadata}"
                                               rendered="#{systemServicesBB.bbSessionUser.keyCard.hasEnfOfficialPermissions}"
                                               update="inspection-finalize-form
                                               inspection-finalize-dialog"
                                               value="#{!empty fieldInspectionBB.currentInspection.determination ? 'edit determination':'finalize inspection'}">
                                    <f:actionListener binding="#{fieldInspectionBB.onViewInspectedSpaceLinkClick(inspectedSpace)}"/>
                                </p:commandLink>
                            </div>

                            <div class="p-col-8">
                                <h:outputText value="#{!empty fieldInspectionBB.currentInspection.determination 
                                                       ? fieldInspectionBB.currentInspection.determination.title 
                                                       : ''}" />
                            </div>


                            <p:divider/>

                            <div class="p-col-6">
                                Max occupants allowed
                            </div>
                            <div class="p-col-6">
                                <h:outputText rendered="#{!fieldInspectionBB.editModeInspectionMetadata}" 
                                              value="#{fieldInspectionBB.currentInspection.maxOccupantsAllowed}"/>

                                <p:inputText rendered="#{fieldInspectionBB.editModeInspectionMetadata}"  
                                             value="#{fieldInspectionBB.currentInspection.maxOccupantsAllowed}"
                                             required="false"/>
                            </div>
                            <div class="p-col-6">
                                Number of bedrooms
                            </div>
                            <div class="p-col-6">
                                <h:outputText rendered="#{!fieldInspectionBB.editModeInspectionMetadata}" 
                                              value="#{fieldInspectionBB.currentInspection.numBedrooms}"/>
                                <p:inputText rendered="#{fieldInspectionBB.editModeInspectionMetadata}"  
                                             value="#{fieldInspectionBB.currentInspection.numBedrooms}"
                                             required="false"/>
                            </div>

                            <div class="p-col-6">
                                Number of bathrooms
                            </div>
                            <div class="p-col-6">
                                <h:outputText rendered="#{!fieldInspectionBB.editModeInspectionMetadata}" 
                                              value="#{fieldInspectionBB.currentInspection.numBathrooms}"/>
                                <p:inputText rendered="#{fieldInspectionBB.editModeInspectionMetadata}"  
                                             value="#{fieldInspectionBB.currentInspection.numBathrooms}"
                                             required="false"/>
                            </div>
                        </div>
                    </p:panel>

                    <p:panel id="inspections-inspectiondetails-notespanel"
                             toggleable="true"
                             collapsed="false"
                             header="Notes">
                        <div class="p-grid">
                            <div class="p-col-6">
                                Pre-inspection notes
                            </div>
                            <div class="p-col-6">
                                <h:outputText   rendered="#{!fieldInspectionBB.editModeInspectionMetadata}" 
                                                value="#{fieldInspectionBB.currentInspection.notesPreInspection}"/>

                                <p:inputTextarea    rendered="#{fieldInspectionBB.editModeInspectionMetadata}" 
                                                    value="#{fieldInspectionBB.currentInspection.notesPreInspection}"
                                                    rows="8"
                                                    cols="30"
                                                    required="false"/>
                            </div>

                            <div class="p-col-6">
                                Remarks
                            </div>

                            <div class="p-col-6">
                                <h:outputText   rendered="#{!fieldInspectionBB.editModeInspectionMetadata}" 
                                                value="#{fieldInspectionBB.currentInspection.remarks}"/>

                                <p:inputTextarea    rendered="#{fieldInspectionBB.editModeInspectionMetadata}" 
                                                    value="#{fieldInspectionBB.currentInspection.remarks}"
                                                    rows="8"
                                                    cols="30"
                                                    required="false"/>
                            </div>

                            <div class="p-col-6">
                                General Comments
                            </div>
                            <div class="p-col-6">
                                <h:outputText   rendered="#{!fieldInspectionBB.editModeInspectionMetadata}" 
                                                value="#{fieldInspectionBB.currentInspection.generalComments}"/>

                                <p:inputTextarea    rendered="#{fieldInspectionBB.editModeInspectionMetadata}" 
                                                    value="#{fieldInspectionBB.currentInspection.generalComments}"
                                                    rows="8"
                                                    cols="30"
                                                    required="false"/>
                            </div>
                        </div>
                    </p:panel>
                </h:form>
                <p:panel id="inspection-advancedtools-panel"
                         toggleable="true"
                         collapsed="true"
                         header="Transfer or Deactivation">
                    <h:form id="inspection-advancedtools-form">
                        <h3>Transfer inspection to new period</h3>

                        <h:outputText     value="Current Occupancy period ID: #{fieldInspectionBB.currentInspection.occPeriodID}"/>

                        <p:spacer height="4px" />

                        <h:outputText  value="Enter the ID of the Occupancy Period to which this inspection should be transferred. On successful transfer, you'll be sent to the dashboard." />

                        <p:inputNumber value="#{fieldInspectionBB.occPeriodIDFortransferFormField}"
                                       required="true" />

                        <p:commandButton id="inspection-occperiodxfer-button"
                                         action="#{fieldInspectionBB.onOccPeriodXferButtonClick}"
                                         ajax="false"
                                         value="Transfer this inspection!" />

                        <h3>Deactivate inspection</h3>

                        <p:commandButton  id="inspection-deacinspection-button"
                                          action="#{fieldInspectionBB.onDeactivateInspectionButtonClick}"
                                          ajax="false"
                                          value="Deactivate inspection ID #{fieldInspectionBB.currentInspection.inspectionID}"
                                          update="#{fieldInspectionBB.inspectionListComponentForUpdate}"
                                          >
                        </p:commandButton>

                        <h3>Remove finalization of inspection</h3>

                        <p:commandButton  id="inspection-removefinalization-button"
                                          actionListener="#{fieldInspectionBB.onRemoveFinalizationOfInspection}"
                                          disabled="#{!empty fieldInspectionBB.currentInspection.determinationTS}"
                                          ajax="True"
                                          value="Remove finalization of inspection ID #{fieldInspectionBB.currentInspection.inspectionID}" 
                                          update="@form:@parent:inspectiontools-growl-form
                                          @form
                                          @form:@parent:inspection-profile-form
                                          #{fieldInspectionBB.inspectionListComponentForUpdate}"

                                          >
                        </p:commandButton>
                    </h:form>  
                </p:panel>
            </div>
            <div class="p-col-6">

                <p:panel id="inspection-tools-panel"
                         toggleable="true"
                         collapsed="false"
                         header="Inspection Tools">

                    <h:form id="inspection-actions-form">

                        <div class="p-grid">
                            <div class="p-col-4">

                                <p:commandButton  id="inspection-uploadphotos-cl"
                                                  value="Add Photos"
                                                  actionListener="#{fieldInspectionBB.onUploadImagesToInspectionInitButtonClick(ins)}"
                                                  ajax="true"
                                                  icon="fa fa-upload"
                                                  oncomplete="PF('blob-upload-dialog-var').show()"
                                                  rendered="true"
                                                  disabled="#{fieldInspectionBB.editModeInspectionMetadata}"
                                                  update="@form:@parent:@parent:blob-upload-dialog"
                                                  />

                            </div>
                            <div class="p-col-4">

                                <p:commandButton  id="inspection-viewphotos-cl"
                                                  value="View photo pool"
                                                  actionListener="#{fieldInspectionBB.onViewPhotoPoolLinkClick(ins)}" 
                                                  ajax="true"
                                                  icon="fa fa-file-image-o"
                                                  oncomplete="PF('blobs-gallery-dialog-var').show()"
                                                  disabled="#{fieldInspectionBB.editModeInspectionMetadata}"
                                                  rendered="true"
                                                  update="@form:@parent:@parent:blobs-gallery-dialog
                                                  "
                                                  />

                            </div>
                            <div class="p-col-4">

                                <p:commandButton  id="inspection-generatereport-cl"
                                                  value="Inspection report"
                                                  actionListener="#{fieldInspectionBB.onFieldInspectionReportInitLinkClick(ins)}"
                                                  ajax="true"
                                                  disabled="#{fieldInspectionBB.editModeInspectionMetadata}"
                                                  rendered="true"
                                                  icon="fa fa-print"
                                                  oncomplete="PF('inspection-reportconfig-dialog-var').show()"
                                                  update="inspection-reportconfig-dialog
                                                  inspection-reportconfig-form"
                                                  />

                            </div>
                            <div class="p-col-4">
                                <p:commandButton    id="insp-followup-button"
                                                    value="Setup Re-inspection"
                                                    ajax="true"
                                                    disabled="#{fieldInspectionBB.editModeInspectionMetadata}"
                                                    actionListener="#{fieldInspectionBB.onSetupReinspectionButtonClick}"
                                                    oncomplete="PF('inspection-followup-dialog-var').show()"
                                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                    icon="fa fa-repeat"
                                                    update="inspection-followup-form"
                                                    />

                            </div>
                            <div class="p-col-4">
                                <p:commandButton    id="insp-extractviolations-button"
                                                    value="Extract Violated Elements"
                                                    ajax="true"
                                                    disabled="true"
                                                    actionListener="#{fieldInspectionBB.onSetupReinspectionButtonClick}"
                                                    oncomplete="PF('inspection-followup-dialog-var').show()"
                                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                                    icon="fa fa-gavel"
                                                    update="inspection-followup-form"
                                                    />

                            </div>

                        </div>
                    </h:form>
                </p:panel>

                <p:panel id="inspection-spaces-panel"
                         toggleable="true"
                         collapsed="false"
                         header="Inspected Spaces">
                    <h:form id="inspection-inspectedspaces-form">


                        <p:commandButton    id="insp-addspace-comlink"
                                            value="Inspect new space"
                                            ajax="true"
                                            actionListener="#{fieldInspectionBB.onAddSpaceInitLinkClick}"
                                            oncomplete="PF('inspections-selecttype-var').show()"
                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                            disabled="#{fieldInspectionBB.editModeInspectionMetadata}"
                                            icon="fa fa-plus"
                                            update="inspections-selecttype-form"
                                            />


                        <p:spacer height="5px" />

                        <p:dataTable var="inspectedSpace"
                                     value="#{fieldInspectionBB.currentInspection.inspectedSpaceList}"
                                     rowKey="#{inspectedSpace.inspectedSpaceID}"
                                     reflow="true">

                            <p:column style="width:2rem">
                                <p:rowToggler/>
                            </p:column>
                            <p:column headerText="Type">
                                <h:outputText value="#{inspectedSpace.type.spaceTypeTitle} (ID:#{inspectedSpace.inspectedSpaceID})"/>
                                <h:panelGroup id="inspections-selectspace-dt-spacetypeinfoicon">
                                    <i class="p-ml-1 pi pi-info-circle"/>
                                </h:panelGroup>
                                <p:tooltip for="inspections-selectspace-dt-spacetypeinfoicon"
                                           value="#{inspectedSpace.type.spaceTypeDescription}" position="right"/>
                            </p:column>
                            <p:column headerText="Uninsp"
                                      style="width:10%;">
                                <h:outputText value="#{inspectedSpace.elementListNotIns.size()}" />
                            </p:column>
                            <p:column headerText="Pass"
                                      style="width:10%;">
                                <h:outputText value="#{inspectedSpace.elementListPass.size()}" />
                            </p:column>
                            <p:column headerText="Violation"
                                      style="width:10%;">
                                <h:outputText value="#{inspectedSpace.elementListFail.size()}" />
                            </p:column>

                            <p:column headerText="Actions">
                                <p:commandLink ajax="true"
                                               style="color:blue;"
                                               oncomplete="PF('inspections-entryscreen-var').show()"
                                               rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"
                                               update="inspections-entryscreen-form
                                               inspections-entryscreen"
                                               value="Edit">
                                    <f:actionListener binding="#{fieldInspectionBB.onViewInspectedSpaceLinkClick(inspectedSpace)}"/>
                                </p:commandLink>
                            </p:column>
                            <p:rowExpansion>

                                <h4>Violated</h4>
                                <ul>
                                    <ui:repeat id="spaceele-uir-fail"
                                               value="#{inspectedSpace.elementListFail}"
                                               var="ele_fail">
                                        <li>
                                            <h:outputText value="#{ele_fail.headerString}" 
                                                          escape="false"/>

                                            <h:outputText value=" [#{ele_fail.inspectionNotes}]" 
                                                          escape="true"
                                                          rendered="#{!empty ele_fail.inspectionNotes}"/>
                                        </li>
                                    </ui:repeat>
                                </ul>

                                <h4>Not Inspected</h4>
                                <ul>

                                    <ui:repeat id="spaceele-uir-notins"
                                               value="#{inspectedSpace.elementListNotIns}"
                                               var="ele_notins">
                                        <li>
                                            <h:outputText value="#{ele_notins.headerString}"
                                                          escape="false"/>
                                            <h:outputText value=" [#{ele_notins.inspectionNotes}]" 
                                                          escape="true"
                                                          rendered="#{!empty ele_notins.inspectionNotes}"/>
                                        </li>

                                    </ui:repeat>
                                </ul>

                                <h4>Pass</h4>
                                <ul>
                                    <ui:repeat id="spaceele-uir-pass"
                                               value="#{inspectedSpace.elementListPass}"
                                               var="ele_pass">
                                        <li>

                                            <h:outputText value="#{ele_pass.headerString}" 
                                                          escape="false"/>
                                            <h:outputText value=" [#{ele_pass.inspectionNotes}]" 
                                                          escape="true"
                                                          rendered="#{!empty ele_pass.inspectionNotes}"/>
                                        </li>

                                    </ui:repeat>
                                </ul>
                            </p:rowExpansion>
                        </p:dataTable>
                    </h:form>
                </p:panel>
            </div>
        </div>
    </p:dialog>


    <!-- Inspection Creation Flow -->

    <!-- Checklist selection dialog used in inspection creation flow -->
    <p:dialog id="inspections-selectchecklist"
              width="1000"
              widgetVar="inspections-selectchecklist-var"
              header="Choose Checklist"
              modal="true"
              dynamic="true"
              resizable="true">
        <h:form id="inspections-selectchecklist-form">
            <p:dataTable id="inspections-selectchecklist-dt"
                         scrollHeight="600"
                         var="checklist" value="#{fieldInspectionBB.checklistTemplateList}"
                         rowKey="#{checklist.inspectionChecklistID}"
                         selection="#{fieldInspectionBB.selectedChecklistTemplate}"
                         stripedRows="true">
                <p:ajax event="rowSelect"
                        update=":inspections-selectchecklist-form:inspections-selectchecklist-continuebutton"/>
                <p:column selectionMode="single" style="width:16px;text-align:center"/>
                <p:column headerText="Title">
                    <h:outputText value="#{checklist.title} (ID:#{checklist.inspectionChecklistID})"/>
                </p:column>

                <p:column headerText="Description">
                    <h:outputText value="#{checklist.description}"/>
                </p:column>

                <p:column headerText="Municipality">
                    <h:outputText value="#{checklist.muni.muniName}"/>
                </p:column>

                <p:column headerText="Code Source">
                    <h:outputText
                        value="#{checklist.governingCodeSource.sourceName} (#{checklist.governingCodeSource.sourceYear})"/>
                </p:column>
            </p:dataTable>


            <p:commandButton id="inspections-selectchecklist-continuebutton"
                             value="Create"
                             rendered="true"
                             disabled="false"
                             style="margin-right: 5px;"
                             icon="pi pi-arrow-right"
                             actionListener="#{fieldInspectionBB.onChecklistSelectionCompleteButtonClick}"
                             update="   inspectiontools-growl-form
                             inspection-profile-dialog
                             inspection-advancedtools-form
                             inspection-actions-form
                             inspection-inspectedspaces-form
                             #{fieldInspectionBB.inspectionListComponentForUpdate}"
                             oncomplete="PF('inspections-selectchecklist-var').hide(); PF('inspection-profile-dialog-var').show();"/>

            <p:commandButton value="Cancel"
                             icon="pi pi-times"
                             style="background-color: darkgrey; border: solid darkgray; color:white;"
                             class="ui-button-outlined p-mr-1"
                             oncomplete="PF('inspections-selectchecklist-var').hide()"/>

        </h:form>
    </p:dialog>



    <!-- Space add flow -->
    <!-- (Currently a bit defunct) -->

    <!-- Type selection used in space add flow -->
    <p:dialog id="inspections-selecttype"
              width="800"
              closeOnEscape="true"
              widgetVar="inspections-selecttype-var"
              header="Select Space Type"
              modal="true"
              dynamic="true"
              resizable="true">
        <h:form id="inspections-selecttype-form">

            <p:dataTable id="inspections-selecttype-dt"
                         scrollHeight="600"
                         var="ost" 
                         value="#{fieldInspectionBB.currentInspection.checklistTemplate.occSpaceTypeList}"
                         rowKey="#{ost.checklistSpaceTypeID}"
                         selection="#{fieldInspectionBB.currentSpaceType}"
                         stripedRows="true"
                         rowExpandMode="multiple">
                <p:ajax event="rowSelect"
                        update=":inspections-selecttype-form:inspections-selecttype-continuebutton"/>
                <p:column selectionMode="single" style="width:16px;text-align:center"/>
                <p:column style="width:2rem">
                    <p:rowToggler/>
                </p:column>
                <p:column headerText="CSTID">
                    <h:outputText value="#{ost.checklistSpaceTypeID}"/>
                </p:column>
                <p:column headerText="Type ID">
                    <h:outputText value="#{ost.spaceTypeID}"/>
                </p:column>
                <p:column headerText="Chklst ID">
                    <h:outputText value="#{ost.checklistParentID}"/>
                </p:column>
                <p:column headerText="Name">
                    <h:outputText value="#{ost.spaceTypeTitle}"/>
                </p:column>
                <p:column headerText="Description">
                    <h:outputText value="#{ost.spaceTypeDescription}"/>
                </p:column>
                <p:column headerText="Required">
                    <i class="#{ost.required ? 'pi pi-star' : ''}"/>
                </p:column>
                <p:rowExpansion>
                    <p:dataTable id="ordbytype-table"
                                 var="ord"
                                 value="#{ost.codeElementList}"
                                 rowKey="#{ord.elementID}"
                                 stripedRows="true">

                        <p:column headerText="EleID">
                            <h:outputText value="#{ord.elementID}"/>
                        </p:column>
                        <p:column headerText="subsec">
                            <h:outputText value="#{ord.ordSubSecTitle}"/>
                        </p:column>

                    </p:dataTable>

                </p:rowExpansion>


            </p:dataTable>
            <p:spacer height="3px" />

            <p:commandButton value="Cancel"
                             icon="pi pi-times"
                             process="@none"
                             immediate="true"
                             class="ui-button-outlined p-mr-1"
                             oncomplete="PF('inspections-selecttype-var').hide()"/>
            <p:commandButton id="inspections-selecttype-continuebutton"
                             actionListener="#{fieldInspectionBB.onAddSpaceTypeSelectedButtonChange}"
                             ajax="true"
                             value="Continue"
                             disabled="false"
                             icon="pi pi-arrow-right"
                             update="inspections-selectspace-form"
                             oncomplete="PF('inspections-selecttype-var').hide(); 
                             PF('inspections-selectspace-var').show()"/>
        </h:form>
    </p:dialog>

    <!-- Actual space(?) selection used in space add flow -->
    <p:dialog id="inspections-selectspace"
              width="800"
              widgetVar="inspections-selectspace-var"
              header="Identify location of space type: #{fieldInspectionBB.currentSpaceType.spaceTypeTitle}"
              dynamic="true"
              modal="true"
              resizable="true">
        <h:form id="inspections-selectspace-form">
            <p:spacer height="5px"/>
            <div class="p-col-12 p-md-6">
                <p:commandButton value="New location descriptor"
                                 actionListener="#{fieldInspectionBB.initSkeletonLocDescriptor}"
                                 update="inspections-addlocdesc-form"
                                 oncomplete="PF('inspections-addlocdesc-var').show()"
                                 icon="pi pi-plus"/>
            </div>
            <p:outputLabel styleClass="p-d-block">OR Choose a Location descriptor:</p:outputLabel>
            <div class="p-grid">
                <div class="p-col-12 p-md-6">
                    <p:selectOneMenu value="#{fieldInspectionBB.currentLocationDescriptor}"
                                     converter="occLocationDescriptorConverter"
                                     var="ld" filter="true" filterMatchMode="contains">
                        <p:ajax update="inspections-selectspace-continuebutton
                                @form"/>
                        <f:selectItems value="#{fieldInspectionBB.currentInspection.allUniqueLocationDescriptors}" var="locdep"
                                       itemLabel="#{locdep.locationDescription}" itemValue="#{locdep}"/>
                        <p:column>
                            <h:outputText value="#{ld.locationDescription}"/>
                        </p:column>
                    </p:selectOneMenu>
                </div>

            </div>

            <h3>Selected location</h3>

            <h:outputText value="#{fieldInspectionBB.currentLocationDescriptor.locationDescription}"/>
            <p:spacer height="3px" />
            <h:outputText value="Floor: #{fieldInspectionBB.currentLocationDescriptor.buildingFloorNo}"/>
            <p:spacer height="3px" />
            <h:outputText value="#{fieldInspectionBB.currentLocationDescriptor.locationID}"/>
            <p:spacer height="5px" />
            <p:commandButton value="Back"
                             icon="pi pi-arrow-left"
                             class="ui-button-outlined p-mr-1"
                             oncomplete="PF('inspections-selectspace-var').hide(); PF('inspections-selecttype-var').show()"
                             style="margin-right: 5px;"/>

            <p:commandButton id="inspections-selectspace-continuebutton"
                             value="Add to inspection and close"
                             icon="pi pi-plus"
                             actionListener="#{fieldInspectionBB.onAddSpaceToInspectionCommitButtonChange}"
                             update="inspection-inspectedspaces-form
                             inspectiontools-growl-form"
                             oncomplete="PF('inspections-selectspace-var').hide()"
                             style="margin-right: 5px;"/>

            <p:commandButton id="inspections-selectspace-inspectnow"
                             value="Inspect space now!"
                             icon="pi pi-check-square "
                             actionListener="#{fieldInspectionBB.onAddSpaceToInspectionCommitButtonChange}"
                             update="inspection-inspectedspaces-form
                             inspectiontools-growl-form
                             inspections-entryscreen
                             inspections-entryscreen-controls-form"
                             oncomplete="PF('inspections-selectspace-var').hide();
                             PF('inspections-entryscreen-var').show();"/>
        </h:form>
    </p:dialog>

    <!-- Independent dialogs that are not necessarily used in a flow -->


    <!-- Currently not working and not realized dialog for editing of an OccInspectedSpace's basic info -->
    <p:dialog id="inspections-editspace"
              widgetVar="inspections-editspace-var"
              header="Edit Space"
              dynamic="true"
              modal="true"
              closable="false"
              resizable="true">
        <h:form id="inspections-editspace-form">
            <p:outputLabel styleClass="p-d-block">Space name:</p:outputLabel>
            <!--            <p:inputText styleClass="p-d-block" value="!{fieldInspectionBB.selectedSpace.name}"/>-->

            <p:outputLabel styleClass="p-d-block">Space description:</p:outputLabel>
            <!--            <p:inputTextarea rows="6" cols="33" value="!{fieldInspectionBB.selectedSpace.description}"/>-->

            <!--                                 update="inspections-selectspace-form:inspections-selectspace-dt
                                         inspections-selectspace-form:inspections-selectspace-continuebutton" -->
            <f:facet name="footer">
                <p:commandButton id="inspections-editspace-continuebutton"
                                 value="Ok"
                                 icon="pi pi-check"
                                 oncomplete="PF('inspections-editspace-var').hide()"/>
            </f:facet>
        </h:form>
    </p:dialog>

    <!-- Dialog used for adding new location descriptors. Yep, it's pretty defunct. -->
    <p:dialog id="inspections-addlocdesc"
              widgetVar="inspections-addlocdesc-var"
              header="Add Location Descriptor"
              dynamic="true"
              modal="true"
              closable="true"
              closeOnEscape="true"
              resizable="true">
        <h:form id="inspections-addlocdesc-form">

            <p:outputLabel for="inspections-locdesc-input" styleClass="p-d-block">Location description:</p:outputLabel>
            <p:inputTextarea id="inspections-locdesc-input"
                             rows="6" 
                             cols="33" 
                             value="#{fieldInspectionBB.skeletonLocationDescriptor.locationDescription}"
                             required="true">
                <p:ajax update="inspections-addlocdesc-continuebutton"/>
            </p:inputTextarea>

            <p:outputLabel for="inspections-floornumber-input" styleClass="p-d-block">Building floor number:</p:outputLabel>
            <p:inputNumber id="inspections-floornumber-input"
                           value="#{fieldInspectionBB.skeletonLocationDescriptor.buildingFloorNo}"/>

            <p:spacer height="3px" />
            <p:commandButton value="Cancel"
                             icon="pi pi-times"
                             oncomplete="PF('inspections-addlocdesc-var').hide()"/>
            <p:commandButton id="inspections-addlocdesc-continuebutton"
                             value="Add"
                             disabled="false"
                             icon="pi pi-plus"
                             update="@form:@parent:inspections-selectspace-form"
                             actionListener="#{fieldInspectionBB.createLocDescriptor}"
                             oncomplete="PF('inspections-addlocdesc-var').hide()"/>
        </h:form>
    </p:dialog>

    <!-- Barely realized form that should show stats for one OccInspectedSpace(?) and all of its ordinances -->

    <p:dialog id="inspections-entryscreen"
              height="600" width="1000"
              widgetVar="inspections-entryscreen-var"
              header="Inspect ordiances in #{fieldInspectionBB.currentInspectedSpace.type.spaceTypeTitle} (ID: #{fieldInspectionBB.currentInspectedSpace.inspectedSpaceID})"
              dynamic="true"
              modal="true"
              resizable="true"
              closable="true"
              closeOnEscape="true">

        <div class="p-d-flex p-jc-between">

            <div>
                <h:form id="inspections-entryscreen-controls-form">
                    <p:selectOneMenu    id="inspections-entryscreen-statussel" 
                                        value="#{fieldInspectionBB.selectedElementStatusForBatch}" 
                                        >
                        <!-- Strangely this element needs to update itself to call the setter -->
                        <f:selectItem noSelectionOption="true"
                                      itemDisabled="true"
                                      itemLabel="choose a batch status" />
                        <f:selectItems value="#{fieldInspectionBB.statuses}" 
                                       var="status" 
                                       itemLabel="#{status.label}"/>
                    </p:selectOneMenu>
                    <p:spacer height="3px" />

                    <p:commandLink     id="applybatch-cl"
                                       ajax="true"
                                       style="color:blue;"
                                       update="@form:@parent:inspections-entryscreen-form:element-accordion
                                       @form:@parent:inspectiontools-growl-form"
                                       value="Batch apply to all ords"
                                       actionListener="#{fieldInspectionBB.onBatchProcessElementLinkClick}" />
                </h:form>
            </div>
            <div>
                <h:form id="stinspection-tools-form">
                    <p>use default findings on violation: </p>

                    <p:selectBooleanCheckbox id="stinspection-usedefaultfindings-cb"
                                             value="#{fieldInspectionBB.useDefaultFindingsOnCurrentOISE}"
                                             label="use default findings"
                                             title="when an element is violated, populate findings with default findings on the ordinance">
                        <p:ajax />
                    </p:selectBooleanCheckbox>

                    <h:outputText value=" | " />

                    <p:commandLink     id="stinspection-editspace"
                                       ajax="true"
                                       style="color:blue;"
                                       update=""
                                       value="edit space"
                                       actionListener="#{fieldInspectionBB.onSpaceTypeEditLinkClick}" />

                    <h:outputText value=" | " />

                    <p:commandLink     id="stinspection-removespace"
                                       ajax="true"
                                       style="color:blue;"
                                       update=""
                                       value="remove space from inspection"
                                       actionListener="#{fieldInspectionBB.onSpaceTypeRemoveLinkClick}" >
                        <p:confirm header="Confirm remove space from inspection?"
                                   message="Are you sure?"
                                   icon="ui-icon-alert" />
                    </p:commandLink>

                    <p>Filter elements (See mobile specs) </p>
                    <p:inputText id="ordsearch" />
                </h:form>


            </div>
        </div>


        <p:separator />

        <h:form id="inspections-entryscreen-form">

            <p:commandButton id="inspections-saveandclose"
                             value="Save space data and close"
                             disabled="false"
                             rendered="true"
                             icon="fa fa-save"
                             actionListener="#{fieldInspectionBB.onSavCurrentSpaceChanges}"
                             oncomplete="PF('inspections-entryscreen-var').hide()"
                             update="@form:@parent:inspection-inspectedspaces-form
                             @form:@parent:inspectiontools-growl-form"/>

            <p:spacer height="5px" />

            <p:accordionPanel id="element-accordion"
                              value="#{fieldInspectionBB.currentInspectedSpace.inspectedElementGroupList}" 
                              var="elegrp" multiple="true"
                              >
                <p:ajax/>
                <p:tab title="#{elegrp.groupTitle}"
                       >
                    <p:repeat   id="elements-repeat"
                                value="#{elegrp.elementList}" 
                                var="spaceElement"
                                varStatus="eleStatus">
                        <div class="p-grid nested-grid">
                            <div class="p-col-8">
                                <div class="p-grid">
                                    <div class="p-col-12">
                                        <h2>
                                            <h:outputText value="#{spaceElement.headerString}"
                                                          escape="false" />
                                        </h2>
                                    </div>

                                    <div class="p-col-4">
                                        <p:commandLink     id="spaceelement-vieword-cl"
                                                           ajax="true"
                                                           type="button"
                                                           style="color:blue;"
                                                           actionListener="#{fieldInspectionBB.onSpaceElementViewLinkClick(spaceElement)}"
                                                           update="codeelement-fulltext-dialog"
                                                           oncomplete="PF('codeelement-fulltext-dialog-var').show();"
                                                           value="ordinance text"/>

                                        <h:outputText value=" | " />

                                        <p:commandLink     id="spaceelement-viewmeta"
                                                           ajax="true"
                                                           type="button"
                                                           style="color:blue;"
                                                           actionListener="#{fieldInspectionBB.onSpaceElementViewLinkClick(spaceElement)}"
                                                           update="codeelement-metadata-dialog"
                                                           oncomplete="PF('codeelement-metadata-dialog-var').show();"
                                                           value="element info"/>

                                    </div>
                                    <div class="p-col-8">
                                        <div class="p-grid">
                                            <div class="p-col-12>">

                                                <p:selectOneButton id="inspections-entryscreen-statussel" 
                                                                   value="#{spaceElement.statusEnum}" 
                                                                   unselectable="false"
                                                                   >
                                                    <!-- Strangely this element needs to update itself to call the setter -->
                                                    <p:ajax listener="#{fieldInspectionBB.onElementInspectionStatusButtonChange(spaceElement)}" />
                                                    <p:ajax update="inspections-entryscreen-statussel"/>
                                                    <!--<p:ajax update="@form:element-accordion"/>-->
                                                    <p:ajax update="@form:@parent:inspectiontools-growl-form"/>
                                                    <p:ajax update="@form"/>
                                                    <f:selectItems value="#{fieldInspectionBB.statuses}" 
                                                                   var="status" 
                                                                   itemLabel="#{status.label}"/>
                                                </p:selectOneButton>
                                            </div>
                                            <div class="p-col-12>">
                                                <p:selectBooleanCheckbox    id="insp-ele-excludefromnov-cb"
                                                                            itemLabel="Include in code enf. case"
                                                                            rendered="#{(!empty spaceElement.lastInspectedTS) and (empty spaceElement.complianceGrantedTS)}"
                                                                            value="#{spaceElement.migrateToCaseOnFail}"/>
                                                <p:spacer height="5px" />
                                                <p>
                                                    <h:outputText id="inspectedby-user"
                                                                  value="Inspected by: #{spaceElement.lastInspectedBy.human.name}" 
                                                                  rendered="#{!empty spaceElement.lastInspectedBy}"/>
                                                    <p:spacer height="2px" />
                                                    <h:outputText id="inspectedby-ts"
                                                                  value="on #{fieldInspectionBB.getPrettyDate(spaceElement.lastInspectedTS)}" 
                                                                  rendered="#{!empty spaceElement.lastInspectedTS}"/>
                                                    <p:spacer height="2px" />
                                                    <h:outputText id="inspectedby-failed"
                                                                  value="Violated" 
                                                                  rendered="#{!empty spaceElement.lastInspectedTS and empty spaceElement.complianceGrantedTS}"/>
                                                    <p:spacer height="2px" />
                                                    <h:outputText id="inspectedby-comp-user"
                                                                  value="Compliance granted by: #{spaceElement.complianceGrantedBy.human.name}" 
                                                                  rendered="#{!empty spaceElement.complianceGrantedBy}"/>
                                                    <p:spacer height="2px" />
                                                    <h:outputText id="inspectedby-comp-ts"
                                                                  value="on #{fieldInspectionBB.getPrettyDate(spaceElement.complianceGrantedTS)}" 
                                                                  rendered="#{!empty spaceElement.complianceGrantedTS}"/>

                                                </p>
                                            </div>
                                            <div class="p-col-12">

                                                <p:outputLabel  for="fail-severity-som"
                                                                rendered="#{!empty spaceElement.lastInspectedTS and empty spaceElement.complianceGrantedTS}">
                                                    <h:outputText value="Violation severity" />
                                                </p:outputLabel>

                                                <h:selectOneMenu id="fail-severity-som"
                                                                 value="#{spaceElement.faillureSeverity}" 
                                                                 rendered="#{!empty spaceElement.lastInspectedTS and empty spaceElement.complianceGrantedTS}">
                                                    <f:converter converterId="intensityClassConverter"/>

                                                    <f:selectItem itemLabel="select a severity" 
                                                                  noSelectionOption="true" />

                                                    <f:selectItems id="fail-severity-selitems"
                                                                   value="#{fieldInspectionBB.failSeverityList}"
                                                                   var="ic" itemValue="#{ic}" 
                                                                   itemLabel="#{ic.numericRating}: #{ic.title}"/>

                                                </h:selectOneMenu>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-col-4">
                                <div class="p-grid">
                                    <div class="p-col-12">
                                        <p class="p-mb-0">Findings:</p>
                                        <p:inputTextarea    id="element-findings"
                                                            value="#{spaceElement.inspectionNotes}"
                                                            rows="6" cols="33"/>

                                    </div>
                                    <div class="p-col-12">

                                        <p:commandLink  id="oise-uploadphotos-cl"
                                                        ajax="true"
                                                        style="color:blue;"
                                                        oncomplete="PF('blob-upload-dialog-var').show()"
                                                        rendered="true"
                                                        update="@form:@parent:@parent:blob-upload-dialog
                                                        "
                                                        value="Add Photos"
                                                        actionListener="#{fieldInspectionBB.onManageBlobsOnInspectedElement(spaceElement)}">

                                        </p:commandLink>

                                        <h:outputText value=" | " />

                                        <p:commandLink  id="oise-viewphotos-cl"
                                                        ajax="true"
                                                        style="color:blue;"
                                                        oncomplete="PF('blobs-gallery-dialog-var').show()"
                                                        rendered="true"
                                                        update="@form:@parent:@parent:blobs-gallery-dialog
                                                        "
                                                        value="View photos (#{spaceElement.blobList.size()})"
                                                        actionListener="#{fieldInspectionBB.onManageBlobsOnInspectedElement(spaceElement)}">

                                        </p:commandLink>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <p:separator />
                    </p:repeat>
                </p:tab>
            </p:accordionPanel>
        </h:form>

    </p:dialog>


    <p:confirmDialog    id="confirmdialog-global"
                        global="true">
        <h:form id="confirm-global-form">

            <p:commandButton value="Yes"
                             type="button"
                             styleClass="ui-confirmdialog-yes"
                             icon="ui-icon-check" />
            <p:commandButton value="No"
                             type="button"
                             styleClass="ui-confirmdialog-no"
                             icon="ui-icon-check" />
        </h:form>
    </p:confirmDialog>


    <p:dialog id="codeelement-fulltext-dialog"
              widgetVar="codeelement-fulltext-dialog-var"
              header="Full ordinance text"
              closable="true"
              closeOnEscape="true"
              dynamic="true"
              modal="true"
              height="400"
              width="500"
              resizable="true"
              responsive="true">

        <h:form id="codeelement-fulltext-form">

            <h2>
                <h:outputText value="ch. #{fieldInspectionBB.currentInspectedSpaceElement.ordchapterNo}: #{fieldInspectionBB.currentInspectedSpaceElement.ordchapterTitle}" />
            </h2>
            <h3>
                <h:outputText value="§#{fieldInspectionBB.currentInspectedSpaceElement.ordSecNum}:#{fieldInspectionBB.currentInspectedSpaceElement.ordSecTitle}" />
            </h3>
            <h3>
                <h:outputText value="§§#{fieldInspectionBB.currentInspectedSpaceElement.ordSubSecNum} #{fieldInspectionBB.currentInspectedSpaceElement.ordSubSecTitle}" 
                              rendered="#{!empty fieldInspectionBB.currentInspectedSpaceElement.ordSubSecNum}"/>

                <h:outputText value=" | " />
                <h:outputText value="§§#{fieldInspectionBB.currentInspectedSpaceElement.ordSubSubSecNum} #{fieldInspectionBB.currentInspectedSpaceElement.ordSubSubSecNum}" 
                              rendered="#{!empty fieldInspectionBB.currentInspectedSpaceElement.ordSubSubSecNum}"/>
            </h3> 

            <h:outputText id="codeelement-fulltext-ot"
                          value="#{fieldInspectionBB.currentInspectedSpaceElement.ordTechnicalText}" 
                          escape="false"/>

            <h3>Inspection tips</h3>
            <h:outputText id="codeelement-inspectiontips-ot"
                          value="#{fieldInspectionBB.currentInspectedSpaceElement.guideEntry.inspectionGuidelines}" 
                          escape="false"/>

        </h:form>




    </p:dialog>

    <p:dialog id="codeelement-metadata-dialog"
              header="Occ Inspected Space Element Metadata"
              widgetVar="codeelement-metadata-dialog-var"
              closable="true"
              closeOnEscape="true"
              dynamic="true"
              modal="true"
              height="400"
              width="500"
              resizable="true"
              responsive="true">

        <h2>
            <h:outputText value="ch. #{fieldInspectionBB.currentInspectedSpaceElement.ordchapterNo}: #{fieldInspectionBB.currentInspectedSpaceElement.ordchapterTitle}" />
        </h2>
        <h3>
            <h:outputText value="§#{fieldInspectionBB.currentInspectedSpaceElement.ordSecNum}:#{fieldInspectionBB.currentInspectedSpaceElement.ordSecTitle}" />
        </h3>
        <h3>
            <h:outputText value="§§#{fieldInspectionBB.currentInspectedSpaceElement.ordSubSecNum} #{fieldInspectionBB.currentInspectedSpaceElement.ordSubSecTitle}" 
                          rendered="#{!empty fieldInspectionBB.currentInspectedSpaceElement.ordSubSecNum}"/>

            <h:outputText value=" | " />
            <h:outputText value="§§#{fieldInspectionBB.currentInspectedSpaceElement.ordSubSubSecNum} #{fieldInspectionBB.currentInspectedSpaceElement.ordSubSubSecNum}" 
                          rendered="#{!empty fieldInspectionBB.currentInspectedSpaceElement.ordSubSubSecNum}"/>
        </h3> 


        <h:outputText value="Inspected space element ID: #{fieldInspectionBB.currentInspectedSpaceElement.inspectedSpaceElementID}" />
        <p:spacer height="3px" />

        <h:outputText value="Inspected space ID: #{fieldInspectionBB.currentInspectedSpaceElement.inspectedSpaceID}" />
        <p:spacer height="3px" />

        <h:outputText value="occChecklist Space Type Element ID: #{fieldInspectionBB.currentInspectedSpaceElement.occChecklistSpaceTypeElementID}" />
        <p:spacer height="3px" />

        <h:outputText value="Code set element ID: #{fieldInspectionBB.currentInspectedSpaceElement.codeSetElementID}" />
        <p:spacer height="3px" />

        <h:outputText value="Code Element ID: #{fieldInspectionBB.currentInspectedSpaceElement.elementID}" />
        <p:spacer height="3px" />



    </p:dialog>


    <p:dialog id="inspection-finalize-dialog"
              widgetVar="inspection-finalize-dialog-var"
              header="Finalize inspection ID: #{fieldInspectionBB.currentInspection.inspectionID}"
              closable="true"
              closeOnEscape="true"
              dynamic="true"
              modal="true"
              height="400"
              width="500"
              resizable="true"
              responsive="true">


        <div class="p-grid">
           
            <div class="p-col-6">
                <h:form id="inspection-finalize-form">
                    <p:panel id="inspection-determination-panel"
                                        toggleable="true"
                                        collapsed="false"
                                        header="Determination">

                        <p:selectOneMenu rendered="true"
                                         value="#{fieldInspectionBB.selectedDetermination}"
                                         converter="occInspectionDeterminationConverter">
                            <f:selectItem noSelectionOption="true"
                                          itemDisabled="true"
                                          itemLabel="choose a determination" />
                            <f:selectItems value="#{fieldInspectionBB.determinationList}" 
                                           var="det"
                                           itemLabel="#{det.title}"
                                           itemValue="#{det}"/>
                            <p:ajax update="inspection-finalize-commit-cb" />
                        </p:selectOneMenu>

                        <p:spacer height="5px" />

                        <p:commandButton   id="inspection-finalize-commit-cb"
                                           value="Finalzie and lock inspection ID:#{ins.inspectionID} with selected determination"
                                           rendered="#{(systemServicesBB.bbSessionUser.userID eq ins.inspector.userID) or systemServicesBB.bbSessionUser.keyCard.hasSysAdminPermissions}"
                                           icon="fa fa-check-square "
                                           disabled="false"
                                           actionListener="#{fieldInspectionBB.onCertifyInspectionCommitButtonChange}"
                                           update="@form:@parent:inspection-profile-form
                                           @form:@parent:inspectiontools-growl-form
                                           #{fieldInspectionBB.inspectionListComponentForUpdate}" 
                                           oncomplete="PF('inspection-finalize-dialog-var').hide();"
                                           style="margin-right: 5px;"/>

                    </p:panel>
                </h:form>
            </div>
            
            <div class="p-col-6">
                <p:panel id="inspections-inspectiondetails-generalpanel"
                         toggleable="true"
                         collapsed="false"
                         header="Inspection results">
                    
                    <h:form id="inspection-finalize-migrate-form">
                        
                        <p:inputSwitch id="migrate-violations-is" 
                                       value="#{fieldInspectionBB.migrateFailedItemsOnFinalization}"
                                       onLabel="Migrate failed items to code enforcement case"
                                       offLabel="Do not migrate failed items">
                            <p:ajax listener="#{fieldInspectionBB.onToggleMigrateFailedItemsToCase}" />
                        </p:inputSwitch>
                    
                        <h3>Violations marked for migration to CE Case</h3>


                        <ui:repeat id="spaceele-uir-fail"
                                   value="#{fieldInspectionBB.currentInspection.extractFailedItemsForCECaseMigration}"
                                   var="ele_fail_tomigrate">
                            <li>
                                <h:outputText value="#{ele_fail_tomigrate.headerString}" 
                                              escape="false"/>
                                <p:spacer height="2px" />
                                <h:outputText value="findings: #{ele_fail_tomigrate.inspectionNotes}" 
                                              escape="true"
                                              rendered="#{!empty ele_fail_tomigrate.inspectionNotes}"/>
                            </li>
                        </ui:repeat>
                    </h:form>

                </p:panel>
            </div>
        </div>
    </p:dialog>


    <p:dialog id="inspection-followup-dialog"
              widgetVar="inspection-followup-dialog-var"
              header="Setup re-inspection of inspection ID: #{fieldInspectionBB.formFollowUpInspectionTo.inspectionID}"
              closable="true"
              closeOnEscape="true"
              dynamic="true"
              modal="true"
              height="600"
              width="600"
              resizable="true"
              responsive="true">

        <h:form id="inspection-followup-form">

            <div class="p-grid">

                <div class="p-col-4">
                    <h:outputText value="Follow-up to" />
                </div>
                <div class="p-col-8">
                    <h:outputText value="Inspection ID: #{fieldInspectionBB.formFollowUpInspectionTo.inspectionID}" />
                    <h:outputText value="Start Time: #{!empty fieldInspectionBB.formFollowUpInspectionTo.timeStart 
                                                       ? fieldInspectionBB.getPrettyDate(fieldInspectionBB.formFollowupInspectionTo.timeStart) 
                                                       : ''}" />

                </div>
                <div class="p-col-4">
                    <h:outputText value="Reinspection Options:" />
                </div>
                <div class="p-col-8">
                </div>
            </div>
        </h:form>
    </p:dialog>

    <p:dialog id="inspection-reportconfig-dialog"
              widgetVar="inspection-reportconfig-dialog-var"
              header="Configure report of field inspection ID: #{fieldInspectionBB.currentInspection.inspectionID}"
              closable="true"
              closeOnEscape="true"
              dynamic="true"
              modal="true"
              height="600"
              width="600"
              resizable="true"
              responsive="true">

        <h:form id="inspection-reportconfig-form">


            <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">
                <div class="restrict-main-contents-io-link">

                    <p:commandLink  ajax="false" 
                                    action="#{fieldInspectionBB.onFieldInspectionReportCommitLinkClick}"
                                    value="Click to generate inspection report in new tab" 
                                    target="_blank"
                                    style="font-size:5em;"
                                    rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                    />
                </div>
                <div class="ui-g-12 ui-md-6 ui-lg-6 restrict-data-field">
                    <div class="ui-button gray_button">

                        <p:commandButton ajax="true" 
                                         value="Cancel" icon="fa fa-stop" immediate="true"
                                         onclick="PF('inspection-reportconfig-dialog-var').hide()"/>

                    </div>
                </div>
            </div>



            <h2>Report Settings: Include...</h2>
            <div class="p-grid">

                <div class="p-col-6">
                    Parent Object info (Occ Period or CECase)
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{fieldInspectionBB.inspectionReportConfig.includeOccPeriodInfoHeader}" />
                </div>
                <div class="p-col-6">
                    Photos on passed items
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{fieldInspectionBB.inspectionReportConfig.includePhotos_pass}" />
                </div>
                <div class="p-col-6">
                    Photos on violated items
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{fieldInspectionBB.inspectionReportConfig.includePhotos_fail}" />
                </div>
                <div class="p-col-6">
                    Full ordinance text
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{fieldInspectionBB.inspectionReportConfig.includeFullOrdText}" />
                </div>
                <div class="p-col-6">
                    Item notes 
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{fieldInspectionBB.inspectionReportConfig.includeElementNotes}" />
                </div>
                <div class="p-col-6">
                    Inspection timestamp by item
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{fieldInspectionBB.inspectionReportConfig.includeElementLastInspectedInfo}" />
                </div>
                <div class="p-col-6">
                    Compliance granted timestamp by item
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{fieldInspectionBB.inspectionReportConfig.includeElementComplianceInfo}" />
                </div>
                <div class="p-col-6">
                    Inspector signature
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{fieldInspectionBB.inspectionReportConfig.includeSignature}" 
                                             disabled="true"/>
                </div>
                <div class="p-col-6">
                    Remedy info
                </div>
                <div class="p-col-6">
                    <p:selectBooleanCheckbox value="#{fieldInspectionBB.inspectionReportConfig.includeRemedyInfo}" 
                                             disabled="true"/>
                </div>
            </div>



            <p:spacer height="5px" />


        </h:form>

    </p:dialog>

</ui:composition>