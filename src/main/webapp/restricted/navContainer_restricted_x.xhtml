<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <h:outputStylesheet name="css/style.css"/>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet"/>
        <title>codeNforce</title>
    </h:head>
    <h:body>

        <div class="flex-box-container">
            <ui:insert name="top">
                <div class="flexing-box-topbar">
                    <f:view id="navview">
                        <div class="logoBox">
                            <div class="logo-image-wrapper">
                                <h:graphicImage value="/images/tcvcog_logo_inverted.jpg" height="50"/>
                            </div>
                            <div class="logo-title-wrapper">
                                <div class="sys-title" style="font-weight: bold;">codeNforce</div>
                                <div class="sys-title-sub">municipal code enforcement workflow management system</div>
                            </div>
                        </div>
                    </f:view>
                </div>
            </ui:insert>
        </div>

        <p:spacer height="5px"/>

        <div class="flex-box-container">
            <div class="flexing-box-interior">
                <div class="flex-box-container-interior">
                    <f:view id="sessionInfoView">


                        <div id="maincontent">

                            <!-- Left Side Bar -->
                            <div class="toolsidebarcontainer">

                                <div id="toolSidebar" class="sidebar">

                                    <h:form >

                                        <div class="toolSidebarCollapse" id="toolSidebarCollapseId">
                                            <i id="toolSidebarExpansionButtonIcon" class="fa fa-list"></i>
                                        </div>

                                        <div class="toolSidebarExpansion" id="toolSidebarExpansionId">
                                            <div class="toolSidebarTitle">
                                                Configuration Tool 
                                            </div>
                                            <i id="toolSidebarCollapseButtonIcon" class="fa fa-arrow-circle-left"></i>
                                        </div>


                                        <ui:repeat value="#{navigationBB.getSideBarNavList()}"
                                                   var="sidebarnavitem">
                                            <div class="sidebar_menu">
                                                <div class="sidebar_item">
                                                    <div class="sidebar_firstmenu_item" >
                                                        <div class="sidebar_firstmenu_item_containner">
                                                            <i class="#{sidebarnavitem.icon}"/>
                                                            <div class="sidebar_firstmenu_font" >
                                                                #{sidebarnavitem.value}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="sidebar_secondmenu">
                                                        <ui:repeat value="#{sidebarnavitem.subNavitem}" 
                                                                   var="sidebarnavsubnavitem">
                                                            <div class="sidebar_secondmenu_item">
                                                                <div class="sidebar_secondmenu_item_containner">
                                                                    <i class="#{sidebarnavsubnavitem.getIcon()}"/>
                                                                    <div class="sidebar_secondmenu_font" >
                                                                        <p:commandLink
                                                                            style="color: inherit; text-decoration: none"
                                                                            action="#{sidebarnavsubnavitem.getPagePath()}"
                                                                            value="#{sidebarnavsubnavitem.value}" 
                                                                            ajax="false" 
                                                                            />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </ui:repeat>
                                                    </div>
                                                </div>
                                            </div>                                
                                        </ui:repeat>
                                    </h:form>
                                </div>
                            </div>


                            <h:form id="sessionInfoForm">

                                <div class="navbar" >

                                    <ui:repeat value="#{navigationBB.getNavList()}"
                                               var="navitem">

                                        <div class="nav_containner">

                                            <div class="nav_content 
                                                 #{navigationBB.getCurrentPageNavItemValue() eq navitem.value ? 'nav_active' : ''}
                                                 #{view.viewId eq navitem.searchpageurl ? 'nav_active' : ''}">

                                                <div class="nav_font">
                                                    <i class="#{navitem.icon} "/>
                                                    <p:commandLink
                                                        style="color: inherit; text-decoration: none"
                                                        action="#{navitem.getSearchpageurl()}"
                                                        value="#{navitem.value}" 
                                                        ajax="false" 
                                                        />
                                                </div>
                                            </div>

                                            <div class="subnav_containner">

                                                <div class="currentinfo">
                                                    <p:outputLabel value="#{navitem.getCurrentInfo()}"/>
                                                </div>

                                                <ui:repeat value="#{navitem.subNavitem}" 
                                                           var="subnavitem">

                                                    <div class="subnav_content">

                                                        <div class="nav_font">
                                                            <i class="#{subnavitem.getIcon()}"/>
                                                            <p:commandLink
                                                                style="color: inherit; text-decoration: none"
                                                                action="#{subnavitem.getPagePath()}"
                                                                value="#{subnavitem.value}" 
                                                                ajax="false" 
                                                                />
                                                        </div>

                                                    </div>
                                                </ui:repeat> 
                                            </div>

                                            <div class="subnav_containner_stable 
                                                 #{navigationBB.getCurrentPageNavItemValue() eq navitem.value or view.viewId eq navitem.searchpageurl? 'nav_display' : 'nav_hide'} 

                                                 ">
                                                <div class="currentinfo ">
                                                    <p:outputLabel value="#{navitem.getCurrentInfo()}"/>
                                                </div>


                                                <ui:repeat value="#{navitem.subNavitem}" 
                                                           var="subnavitem">

                                                    <div class="subnav_content #{view.viewId eq subnavitem.getPagePath() ? 'navsub_active' : ''}">

                                                        <div class="nav_font">
                                                            <i class="#{subnavitem.getIcon()}"/>
                                                            <p:commandLink
                                                                style="color: inherit; text-decoration: none"
                                                                action="#{subnavitem.getPagePath()}"
                                                                value="#{subnavitem.value}" 
                                                                ajax="false" 
                                                                />
                                                        </div>

                                                    </div>
                                                </ui:repeat> 
                                            </div>
                                        </div>

                                    </ui:repeat>



                                        <div class="navItem_logout">
                                            <p:commandButton    id="navcontres-button-logout"
                                                                action="#{systemServicesBB.logout}" 
                                                                value="Logout #{systemServicesBB.bbSessionUser.person.firstName} 
                                                                | #{systemServicesBB.bbSessionUser.roleType.label} 
                                                                | rnk:#{systemServicesBB.bbSessionUser.roleType.rank} 
                                                                | username: #{systemServicesBB.bbSessionUser.username} 
                                                                | id:#{systemServicesBB.bbSessionUser.userID} "
                                                                ajax="false"/>
                                        </div>

                                        <div class="navItem_logout">
                                            <p:commandButton        id="navbar-button-usersettings"
                                                                    ajax="true" 
                                                                    actionListener="#{userBB.initiateUserUpdates}"
                                                                    rendered="true"
                                                                    disabled="false"
                                                                    oncomplete="PF('navcontainer-dialog-usersettings').show()"
                                                                    value="settings" 
                                                                    update="usersettings-form"
                                                                    icon="fa fa-gear"/>
                                        </div>

                                </div>
                            </h:form>

                                <p:dialog header="User settings" 
                                          widgetVar="navcontainer-dialog-usersettings" 
                                          responsive="true" 
                                          width="800"
                                          modal="false"
                                          height="600">


                                    <h2>User settings for <h:outputText value="#{userBB.currentUser.username}" /></h2>

                                    <p>
                                        <h:outputText value="Role: #{systemServicesBB.bbSessionUser.roleType.label}" />
                                        <h:outputText value=" | " />
                                        <h:outputText value="Rank: #{systemServicesBB.bbSessionUser.roleType.rank}" />
                                        <h:outputText value=" | " />
                                        <h:outputText value="ID: #{systemServicesBB.bbSessionUser.userID} " />
                                    </p>

                                    <p>
                                        <h:outputText value="Notes: " styleClass="bold"/>
                                        <h:outputText value="#{userBB.currentUser.notes}" escape="false" />
                                    </p>

                                    <h:panelGrid columns="2" border="0" 
                                                 cellpadding="5" columnClasses="gridTd, gridTd"
                                                 footerClass="gridFooter">


                                        <h:panelGroup>

                                            <h:form id="usersettings-messages-form-username">
                                                <h:messages id="usersettings-messages-username"
                                                            globalOnly="true" showDetail="true" showSummary="true"
                                                            warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                                </h:messages>
                                            </h:form>
                                            <h:form id="usersettings-form">

                                                <p:outputLabel for="usersettings-it-username">
                                                    <h:outputText value="User name"/>
                                                </p:outputLabel>
                                                <p:inputText id="usersettings-it-username" value="#{userBB.currentUser.username}" 
                                                             size="12"
                                                             maxlength="20"
                                                             tabindex="3" 
                                                             required="true" 
                                                             validatorMessage="Length must be between 5 and 20 characters"
                                                             styleClass="inputText">
                                                    <f:validateLength minimum="5" maximum="20" />
                                                </p:inputText>
                                                <h:message for="usersettings-it-username" showDetail="false" showSummary="true" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                                <p:commandButton    id="usersettings-button-updateusername"
                                                                    ajax="true"
                                                                    actionListener="#{userBB.commitUsernameUpdates}"
                                                                    icon="fa fa-thumbs-o-up"
                                                                    update="usersettings-messages-form-username"
                                                                    value="Update username" 
                                                                    tabindex="3"/>
                                            </h:form>

                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <h:form id="usersettings-messages-form-personlink">
                                                <h:messages id="usersettings-messages-personlink"
                                                            globalOnly="true" showDetail="true" showSummary="true"
                                                            warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                                </h:messages>
                                            </h:form>

                                            <h:form id="usersettings-form-userpersonlink">

                                                <h:outputText value="Your user is currently mapped to: " />
                                                <p:spacer height="5px" />
                                                <h:outputText value="#{userBB.currentUser.person.firstName}" />
                                                <h:outputText value=" " />
                                                <h:outputText value="#{userBB.currentUser.person.lastName}" />
                                                <h:outputText value=" (ID: #{userBB.currentUser.person.personID})" />
                                                <h:outputText value=" " />


                                                <p:spacer height="5px" />

                                                <p:outputLabel  for="usersettings-som-userpersons" value="Available User-type persons:"/>
                                                <p:selectOneMenu id="usersettings-som-userpersons" 
                                                                 required="true" 
                                                                 value="#{userBB.currentUser.person}">
                                                    <f:selectItem itemLabel="select a person..." noSelectionOption="true" />
                                                    <f:selectItems value="#{userBB.userPersonList}"  var="p" itemValue="#{p}" 
                                                                   itemLabel="#{p.firstName} #{p.lastName} (id:#{p.personID})"/>
                                                    <f:converter converterId="personConverter"/>
                                                </p:selectOneMenu>
                                                <h:message for="usersettings-som-userpersons" showDetail="false" showSummary="true" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />

                                                <p:commandButton    id="usersettings-button-updatepersonlink"
                                                                    ajax="true"
                                                                    actionListener="#{userBB.commitUserPersonUpdates}"
                                                                    update="usersettings-messages-form-personlink
                                                                    usersettings-form-userpersonlink"
                                                                    icon="fa fa-thumbs-0-up"
                                                                    value="Update person link" 
                                                                    tabindex="3"/>

                                            </h:form>
                                        </h:panelGroup>



                                        <h:panelGroup>

                                            <h:form id="usersettings-messages-form-updatepassword">
                                                <h:messages id="usersettings-messages-updategepassword"
                                                            globalOnly="true" showDetail="true" showSummary="true"
                                                            warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                                                </h:messages>
                                            </h:form>


                                            <h:form id="usersettings-form-updatepassword">
                                                <p:outputLabel for="usersettings-it-password">
                                                    <h:outputText value="New password (use letters and numbers; at least 8 chars please! "/>
                                                </p:outputLabel>
                                                <p:inputText id="usersettings-it-password" value="#{userBB.formPassword}" 
                                                             size="15"
                                                             maxlength="80"
                                                             tabindex="3" 
                                                             required="true" 
                                                             validatorMessage="Length must be between 8 and 50 characters"
                                                             styleClass="inputText">
                                                    <f:validateLength minimum="8" maximum="50" />
                                                </p:inputText>
                                                <h:message for="usersettings-it-password" showDetail="false" showSummary="true" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                                <p:commandButton    id="usersettings-button-updatepassword"
                                                                    ajax="true"
                                                                    actionListener="#{userBB.commitPasswordUpdates}"
                                                                    update="usersettings-messages-form-updatepassword
                                                                    usersettings-form-updatepassword"
                                                                    icon="fa fa-thumbs-0-up"
                                                                    value="Update password" 
                                                                    tabindex="3"/>
                                            </h:form>
                                        </h:panelGroup>


                                    </h:panelGrid>

                                    <h:form id="usersettings-form-close">                             


                                        <p:commandButton ajax="true" 
                                                         value="Cancel" icon="fa fa-stop" 
                                                         onclick="PF('navcontainer-dialog-usersettings').hide()"
                                                         tabindex="4"/>


                                        <p:commandButton ajax="true" 
                                                         value="Done!" icon="fa thumbs-up" 
                                                         onclick="PF('navcontainer-dialog-usersettings').hide()"
                                                         tabindex="4"/>
                                    </h:form>

                                </p:dialog>

                            <p:spacer height="35px;"/>

                            <div class="flexing-box-pagecontent">
                                <ui:insert name="content">
                                    <p>I am the not content in the template content placeholder. I am not aware of any way for this particular element to ever be displayed to anybody.</p>
                                </ui:insert>
                            </div>
                        </div>
                    </f:view>
                </div>
            </div>


            <ui:remove>

                <div class="flex-box-container">
                    <div class="flexing-box-footer">
                        <ui:insert name="bottom">
                            <div class="footer">
                                <f:view id="footerView">
                                    <p>This database application is maintained and updated by the Turtle Creek Valley Council of Governments.</p>
                                </f:view>
                            </div>
                        </ui:insert>
                    </div>
                </div>
            </ui:remove>
        </div>


        <!--for sidebar dropdown-->
        <script type="text/javascript">
            var dropdown = document.getElementsByClassName("sidebar_firstmenu_item");
            for (var i = 0; i &lt; dropdown.length; i++) {
                var n = dropdown[i];
                n.addEventListener("click", function() {
                this.classList.toggle("sidebar_firstmenu_font_active");
                var dropdownContent = this.nextElementSibling;
                if (dropdownContent.style.display === "block") {
                    dropdownContent.style.display = "none";
                } else {
                    dropdownContent.style.display = "block";
                }
                });
            }

        </script>

        <!--for sidebar expansion-->
        <script type="text/javascript">
            function openSideBar() {
            document.getElementById("toolSidebar").style.width = "250px";
            document.getElementById("maincontent").style.marginLeft = "255px";
            document.getElementById("toolSidebarCollapseId").style.display = "none";
            document.getElementById("toolSidebarExpansionId").style.display = "flex";
            var fm = document.getElementsByClassName("sidebar_firstmenu_font");
            for (var i = 0; i &lt; fm.length; i++) {
            fm[i].style.display = "inline";
            }
            var sm = document.getElementsByClassName("sidebar_secondmenu_font");
            for (var i = 0; i &lt; sm.length; i++) {
            sm[i].style.display = "inline";
            }

            }

            function closeSideBar() {
            document.getElementById("toolSidebar").style.width = "35px";
            document.getElementById("maincontent").style.marginLeft = "40px";
            document.getElementById("toolSidebarCollapseId").style.display = "flex";
            document.getElementById("toolSidebarExpansionId").style.display = "none";
            var fmf = document.getElementsByClassName("sidebar_firstmenu_font");
            for (var i = 0; i &lt; fmf.length; i++) {
            fmf[i].style.display = "none";
            }
            var sm = document.getElementsByClassName("sidebar_secondmenu_font");
            for (var i = 0; i &lt; sm.length; i++) {
            sm[i].style.display = "none";
            }
            }

            function initSideBar(){
            var smi = document.getElementsByClassName("sidebar_secondmenu");
            for (var i = 0; i &lt; smi.length; i++) {
            smi[i].style.display = "none";
            }
            }

            document.getElementById("toolSidebarExpansionButtonIcon").addEventListener("click", openSideBar);
            document.getElementById("toolSidebarCollapseButtonIcon").addEventListener("click", function(){closeSideBar()});
        </script>

    </h:body>
</html>
