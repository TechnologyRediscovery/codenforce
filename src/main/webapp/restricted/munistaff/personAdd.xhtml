<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Add Person</title>
    </h:head>
    <h:body>
        <ui:composition template="../navContainer_restricted.xhtml">
            <ui:define name="content">
                <div class="mainContainer">
                    
                            
                    <h1>Add a new Person</h1>
                    <p>Add a new person to a specified municipality. 
                        Once added here, that Person becomes part of the pool 
                        of folks who can be attached to cases, events, citations, 
                        and much, more.</p>
                    <f:view>
                        
                        <h:form id="person-update-form">
                            
                                <h2>Person ID: <h:outputText id="pers-form-header-id" value="#{personsBB.selectedPerson.personID} -"/> 
                                    <h:outputText id="pers-form-header-fname" value="#{personsBB.selectedPerson.firstName} "/>
                                    <h:outputText id="pers-form-header-lname" value="#{personsBB.selectedPerson.lastName}"/>, 
                                </h2>
                                <p>This record was last updated on: <h:outputText id="pers-form-lastupdated" value="#{personsBB.selectedPerson.lastUpdatedString}"/></p>
                                    
                            <f:subview id="cond-header-pers-update-form" rendered="#{personsBB.selectedPerson.personID == 0}">
                                    <h2>Create a new Person</h2>
                            </f:subview>

                            <h:messages globalOnly="true" showDetail="true" showSummary="true" id="messages-global"
                                            warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                            </h:messages>
                            
                            <h:panelGrid columns="4" border="0" 
                                         cellpadding="5" columnClasses="gridTd, gridTd, gridTd, gridTd"
                                         footerClass="gridFooter">

                    <ui:remove>FIRST ROW</ui:remove>

                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Person Type:" for="personTypeSelectMenu"/>
                                    <p:spacer height="3px"/>
                                    <p:selectOneMenu id="personTypeSelectMenu" required="true" value="#{personsBB.selectedPerson.personType}">
                                        <f:selectItems value="#{personCoordinator.personTypes}"
                                                       var="pt" itemValue="#{pt}" itemLabel="#{pt.label}"/>
                                    </p:selectOneMenu>
                                    <h:message for="personTypeSelectMenu" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>

                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Municipality" for="personMuniSelectMenu"/>
                                    <p:spacer height="3px"/>
                                    <p:selectOneMenu
                                        id="muniSM" tabindex="1" var=""
                                        value="#{personsBB.selectedPerson.muni}">
                                        <f:converter converterId="muniConverter"/>
                                        <f:selectItems id="muniNameList" value="#{sessionBean.userAuthMuniList}" var="m" itemValue="#{m}" itemLabel="#{m.muniName}" />
                                    </p:selectOneMenu>
                                </h:panelGroup>
                                
                                <h:panelGroup></h:panelGroup>
                                <h:panelGroup></h:panelGroup>

                <ui:remove>SECOND ROW</ui:remove>
                                
                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="First Name:" for="formFirstNameIT"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="formFirstNameIT" value="#{personsBB.selectedPerson.firstName}" 
                                                 style="width: 200px;" tabindex="1" required="true" styleClass="inputText"/>
                                    <h:message for="formFirstNameIT" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>
                                

                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Last Name:" for="formLastNameIT"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="formLastNameIT" value="#{personsBB.selectedPerson.lastName}" 
                                                 style="width: 200px;" tabindex="2" required="true" styleClass="inputText"/>
                                    <h:message for="formLastNameIT" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>

                    
                
                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Job Title:" for="formJobTitleIT"/>
                                    <p:inputText id="formJobTitleIT" value="#{personsBB.selectedPerson.jobTitle}"
                                                 style="width: 150px;" tabindex="3" required="false" styleClass="inputText"/>
                                    <p:spacer height="3px"/>
                                    <h:message for="formJobTitleIT" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>
                                <h:panelGroup></h:panelGroup>

                <ui:remove>THIRD ROW</ui:remove>
                                
                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Phone(cell):" for="formCellIT"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="formCellIT" value="#{personsBB.selectedPerson.phoneCell}" 
                                                 style="width: 150px;" tabindex="4" required="false" styleClass="inputText" maxlength="12"/>
                                    <h:message for="formCellIT" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>

                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Phone(home):" for="formHomeIT"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="formHomeIT" value="#{personsBB.selectedPerson.phoneHome}" 
                                                 style="width: 150px;" tabindex="5" required="false" styleClass="inputText" maxlength="12"/>
                                    <h:message for="formHomeIT" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>

                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Phone(work)" for="formWorkIT"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="formWorkIT" value="#{personsBB.selectedPerson.phoneWork}" 
                                                 style="width: 150px;" tabindex="6" required="false" styleClass="inputText" maxlength="12"/>
                                    <h:message for="formWorkIT" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>

                                <h:panelGroup>
                                        
                                    <h:outputLabel styleClass="bold" value="Email:" for="formEmailIT"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="formEmailIT" value="#{personsBB.selectedPerson.email}" 
                                                 style="width: 250px;" tabindex="7" required="false" styleClass="inputText">
                                        <ui:remove>
                                            Thanks SO https://stackoverflow.com/questions/7875108/email-validation-using-regular-expression-in-jsf-2-primefaces 
                                            <f:validateRegex pattern="(^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[\p{L}\p{M}\p{N}.-]*(\.[\p{L}\p{M}]{2,})$)?"/>
                                        </ui:remove>
                                    </p:inputText>
                                    <h:message for="formEmailIT" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>

                <ui:remove>FOURTH ROW</ui:remove>
                                
                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Street:" for="formStreetIT"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="formStreetIT" value="#{personsBB.selectedPerson.addressStreet}" 
                                                 style="width: 250px;" tabindex="9" required="false" styleClass="inputText"/>
                                    <h:message for="formStreetIT" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>

                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="City:" for="formCityIT"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="formCityIT" value="#{personsBB.selectedPerson.addressCity}" 
                                                 style="width: 250px;" tabindex="10" required="false" styleClass="inputText"/>
                                    <h:message for="formCityIT" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>
                

                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="State:" for="formStateIT"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="formStateIT" value="#{personsBB.selectedPerson.addressState}" 
                                                 style="width: 50px;" tabindex="11" required="false" styleClass="inputText"/>
                                    <h:message for="formStateIT" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>
                
                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="ZipCode:" for="formZipIT"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="formZipIT" value="#{personsBB.selectedPerson.addressZip}" 
                                                 style="width: 100px;" tabindex="12" required="false" styleClass="inputText"/>
                                    <h:message for="formZipIT" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>
                
                <ui:remove>FIFTH ROW</ui:remove>

                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Active Person?" for="isActiveFormIS"/>
                                    <p:spacer height="3px"/>
                                    <p:selectBooleanCheckbox id="isActiveFormIS" value="#{personsBB.selectedPerson.active}" tabindex="14"/>
                                </h:panelGroup>
                
                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Allowed to expire?" for="canexpire-sbcb"/>
                                    <p:spacer height="3px"/>
                                    <p:selectBooleanCheckbox id="canexpire-sbcb" value="#{personsBB.selectedPerson.canExpire}" />
                                </h:panelGroup>

                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" for="expiry-date-cal">
                                        <h:outputText value="Expiry date"/>
                                    </h:outputLabel>
                                    <p:spacer height="3px"/>
                                    <p:calendar value="#{personsBB.selectedPerson.expiryDateUtilDate}" 
                                                mode="popup"  id="expiry-date-cal"
                                                showOn="button" pattern="EEE, dd MMM, yyyy"
                                                navigator="true" tabindex="16" timeInput="true" showHour="false" showMinute="false" showSecond="false" showMillisec="false"
                                                showButtonPanel="true" showTodayButton="false"
                                                required="false">
                                    </p:calendar>
                                    <h:message for="expiry-date-cal" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>
                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Expiry notes" for="expiry-notes-it"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="expiry-notes-it" value="#{personsBB.selectedPerson.expiryNotes}" 
                                                 style="width: 100px;" tabindex="12" required="false" styleClass="inputText"/>
                                    <h:message for="expiry-notes-it" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>
                
                <ui:remove>SIXTH ROW</ui:remove>
                
                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Person under 18?" for="isUnder18-pupdate-sbcb"/>
                                    <p:spacer height="3px"/>
                                    <p:selectBooleanCheckbox id="isUnder18-pupdate-sbcb" value="#{personsBB.selectedPerson.under18}" />
                                </h:panelGroup>
                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Composite last name?" for="composite-sbcb"/>
                                    <p:spacer height="3px"/>
                                    <p:selectBooleanCheckbox id="composite-sbcb" value="#{personsBB.selectedPerson.compositeLastName}" />
                                </h:panelGroup>
                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Person data source ID" for="datasource-it"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="datasource-it" value="#{personsBB.selectedPerson.sourceID}" />
                                </h:panelGroup>
                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Business entity?" for="business-sbcb"/>
                                    <p:spacer height="3px"/>
                                    <p:selectBooleanCheckbox id="business-sbcb" value="#{personsBB.selectedPerson.businessEntity}" />
                                </h:panelGroup>
                
                <ui:remove>SEVENTH ROW</ui:remove>
                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Use separate mailing address?" for="sep-mailing-sbcb"/>
                                    <p:spacer height="3px"/>
                                    <p:selectBooleanCheckbox id="sep-mailing-sbcb" value="#{personsBB.selectedPerson.useSeparateMailingAddress}" />
                                </h:panelGroup>
                                <h:panelGroup></h:panelGroup>
                                <h:panelGroup></h:panelGroup>
                                <h:panelGroup></h:panelGroup>
                <ui:remove>EIGTH ROW</ui:remove>

                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Mailing street" for="form-mail-street-it"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="form-mail-street-it" value="#{personsBB.selectedPerson.mailingAddressStreet}" 
                                                 style="width: 250px;" tabindex="9" required="false" styleClass="inputText"/>
                                    <h:message for="form-mail-street-it" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>

                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Mailing city" for="form-mail-city-it"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="form-mail-city-it" value="#{personsBB.selectedPerson.mailingAddressCity}" 
                                                 style="width: 200px;" tabindex="10" required="false" styleClass="inputText"/>
                                    <h:message for="form-mail-city-it" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>
                

                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Mailing state" for="form-mail-state-it"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="form-mail-state-it" value="#{personsBB.selectedPerson.mailingAddressState}" 
                                                 style="width: 50px;" tabindex="11" required="false" styleClass="inputText"/>
                                    <h:message for="form-mail-state-it" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>
                
                                <h:panelGroup>
                                    <h:outputLabel styleClass="bold" value="Mailing zip" for="form-mail-zip-it"/>
                                    <p:spacer height="3px"/>
                                    <p:inputText id="form-mail-zip-it" value="#{personsBB.selectedPerson.mailingAddressZip}" 
                                                 style="width: 100px;" tabindex="12" required="false" styleClass="inputText"/>
                                    <h:message for="form-mail-zip-it" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                </h:panelGroup>


                            </h:panelGrid>
                            
                            <hr />
                            
                            <h:outputLabel styleClass="bold" for="update-desc-ita" value="What data did you update and why?"/>
                            <p:spacer height="5px"/>
                            <p:inputTextarea id="update-desc-ita" style="width: 300px; height: 200px;" value="#{personsBB.updateDescription}" tabindex="1"/>
                            <h:message for="update-desc-ita" showDetail="false" showSummary="true" 
                                               warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                            <p:spacer height="5px"/>
                       
                            
                            <p:spacer height="5px"/>
                            
                            

                            <p:commandButton    id="cancel-cb"
                                                ajax="false" value="Cancel" action="persons" icon="fa fa-stop" immediate="true"/>
                            

                            <p:commandButton id="update-person-cb" ajax="false"
                                            value="Update Person" action="#{personsBB.updatePerson}"
                                             rendered="#{sessionBean.facesUser.keyCard.hasMuniStaffPermissions}" icon="fa fa-check"
                                             disabled="#{personsBB.selectedPerson.personID == 0}"/>

                            <p:commandButton id="new-person-cb" ajax="false"
                                             value="Store new Person" action="#{personsBB.createNewPerson}"
                                             rendered="#{sessionBean.facesUser.keyCard.hasMuniStaffPermissions}" icon="fa fa-plus"
                                             disabled="#{!(personsBB.selectedPerson.personID == 0)}"/>
                                      
                        </h:form>
                    </f:view>
                </div>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

