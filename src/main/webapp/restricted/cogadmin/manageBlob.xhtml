<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Manage uploaded photographs and documents</title>
    </h:head>
    
    <!--TODO: NOT TAB-INDEXED-->
    
    <h:body>
        <ui:composition template="/restricted/navContainer_restricted.xhtml">
            <ui:define name="content">
                <f:view id="blob-info-view">
                    <p:outputPanel id="body-panel">

                        <!-- GLOBAL MESSAGES -->
                        <h:form id="form-messages-global">
                            <p:growl id="messages-global" showDetail="false"/>
                        </h:form>

                        <div class="mainContainer">

                            <!-- DATA CONTAINER -->
                            <div class="ui-g data-container">

                                <!-- LIST DATA CONTAINER --> 
                                <div class="ui-g-12 ui-md-4 ui-lg-4 list-data-container">

                                    <!-- MODE SELECTION --> 
                                    <h:form id="mode-form">
                                        <div class="restrict-main-list-mode-button">
                                            <p:selectOneButton  value="#{manageBlobBB.currentMode}"
                                                                unselectable="false"
                                                                tabindex="1"
                                                                style="width: 100%"
                                                                >

                                                <f:selectItem itemLabel="INFO" itemValue="Info"  />
                                                <f:selectItem itemLabel="VIEW" itemValue="View"  />
                                                <f:selectItem itemLabel="CONNECTIONS" itemValue="Objects" itemDisabled="#{!manageBlobBB.currentBlobSelected}"/>
                                                <f:selectItem itemLabel="UPDATE" itemValue="Update"  itemDisabled="#{!manageBlobBB.currentBlobSelected}"/>

                                                <f:ajax render="@all"/>
                                            </p:selectOneButton>
                                        </div>
                                    </h:form>

                                    <!--QUERY PANEL-->
                                    <p:panel id="blob-search-query-panel"
                                             toggleable="true"
                                             widgetVar="blob-search-query-panel-var"
                                             collapsed="false"
                                             style="width:100%;"
                                             header="File Search">

                                        <!--MESSAGES -->
                                        <h:form id="blob-search-messages-form">
                                            <p:growl id="blob-search-messages" showDetail="false"/>
                                        </h:form>

                                        <h:form id="blob-search-query-form">

                                            <!-- NESTED DATA CONTAINER -->
                                            <div class="ui-g data_container_nested_restrict">

                                                <!-- NESTED DATA FIELD GRID:12-->
                                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">

                                                    <!-- NESTED DATA TITLE -->
                                                    <div class="restrict-main-contents-io-title">
                                                        <h:outputLabel value="Enter Search Criteria"/>
                                                    </div>
                                                </div>

                                                <!-- NESTED DATA CONTENT -->
                                                <div class="restrict-main-contents-io-content">
                                                    <h:outputLabel value="Filename contains..."/>
                                                    <p:inputText id="blob-search-filter-filename"
                                                                 value="#{manageBlobBB.searchFilename}"
                                                                 style="width: 100%;"
                                                                 tabindex="2"
                                                                 styleClass="data_field_value"
                                                                 />

                                                    <p:message for="blob-search-filter-filename" showDetail="false" showSummary="true"/>
                                                </div>

                                                <div class="restrict-main-contents-io-content">
                                                    <h:outputLabel value="Description contains..."/>
                                                    <p:inputText id="blob-search-filter-desc"
                                                                 value="#{manageBlobBB.searchDescription}"
                                                                 style="width: 100%;"
                                                                 tabindex="2"
                                                                 styleClass="data_field_value"
                                                                 />

                                                    <p:message for="blob-search-filter-desc" showDetail="false" showSummary="true"/>
                                                </div>

                                                <div class="restrict-main-contents-io-content">
                                                    <h:outputLabel value="Uploaded before..."/>
                                                    <p:calendar value="#{manageBlobBB.searchBeforeUtil}" 
                                                                mode="popup" 
                                                                tabindex="3"
                                                                id="blob-search-filter-upload-before"
                                                                showOn="button"
                                                                pattern="EEE, dd MMM, yyyy HH:mm"
                                                                navigator="true"
                                                                showButtonPanel="true"
                                                                showTodayButton="true"
                                                                />

                                                    <p:message for="blob-search-filter-upload-before" showDetail="false" showSummary="true"/>
                                                </div>

                                                <div class="restrict-main-contents-io-content">
                                                    <h:outputLabel value="Uploaded after..."/>
                                                    <p:calendar value="#{manageBlobBB.searchAfterUtil}" 
                                                                mode="popup" 
                                                                tabindex="3"
                                                                id="blob-search-filter-upload-after"
                                                                showOn="button"
                                                                pattern="EEE, dd MMM, yyyy HH:mm"
                                                                navigator="true"
                                                                showButtonPanel="true"
                                                                showTodayButton="true"
                                                                />

                                                    <p:message for="blob-search-filter-upload-after" showDetail="false" showSummary="true"/>
                                                </div>

                                            </div>

                                            <!-- NESTED DATA CONTAINER -->
                                            <div class="ui-g data_container_nested_restrict">

                                                <!--NESTED DATA FIELD GRID:12-->
                                                <div class="ui-g-12 ui-md-12 ui-lg-12 restrict-data-field">

                                                    <!-- NESTED DATA BUTTON -->
                                                    <div class="restrict-main-contents-io-button">
                                                        <p:commandButton id="blob-search-exec-cb-0"
                                                                         ajax="true"
                                                                         actionListener="#{manageBlobBB.executeQuery}"
                                                                         icon="fa fa-search"
                                                                         value="Search"
                                                                         style="width: 100%"
                                                                         update=" 
                                                                         @form
                                                                         blob-search-messages-form
                                                                         blob-search-log-form
                                                                         blob-search-results-panel
                                                                         blob-search-clear-cb-0"/>

                                                    </div>

                                                </div>
                                            </div>
                                        </h:form>
                                    </p:panel>

                                    <!-- SEARCH RESULTS PANEL -->
                                    <p:panel id="blob-search-results-panel"
                                             toggleable="true"
                                             widgetVar="blob-search-query-panel-var"
                                             collapsed="false"
                                             style="width:100%;"
                                             header="Search Results">


                                        <h:form id="blob-search-results-form">

                                            <p:dataTable id="blob-search-results-table"
                                                         var="blob"
                                                         value="#{manageBlobBB.blobList}"
                                                         rowKey="#{blob.blobID}"
                                                         tableStyleClass="primeDataTable"
                                                         draggableRows="false" draggableColumns="true"
                                                         tabindex="6"
                                                         >

                                                <p:column headerText="ID:">
                                                    <h:outputText value="#{blob.blobID}"/>
                                                </p:column>
                                                
                                                <p:column headerText="File Type">
                                                    <h:outputText value="#{blob.type.typeID}"/>
                                                    <i class="material-icons status-display-icon-i"><h:outputText value="#{blob.type.typeIcon}"/></i>
                                                </p:column>

                                                <p:column headerText="Filename">
                                                    <h:outputText value="#{blob.filename}"/>
                                                </p:column>

                                                <p:column headerText="Description">
                                                    <h:outputText id="desc" value="#{blob.description}"/>
                                                </p:column>

                                                <p:column width="20%" style="text-align: center" headerText="View">
                                                    <div class="gray_button">
                                                        <p:commandButton id="blob-search-loadblob-button"
                                                                         icon="fa fa-folder-open-o"
                                                                         value="Load"
                                                                         action="#{manageBlobBB.selectBlob(blob)}"
                                                                         ajax="true"
                                                                         update="
                                                                         form-messages-global
                                                                         blob-lists-outpanel"
                                                                         />
                                                    </div>
                                                </p:column>
                                            </p:dataTable>
                                        </h:form>
                                    </p:panel>

                                </div>

                                <!-- OBJECT DATA CONTAINER --> 
                                <div class="ui-g-12 ui-md-8 ui-lg-8 object-data-container">

                                    <!-- OBJECT DATA TITLE --> 
                                    <div class="restrict-main-object-title">

                                        <h:form id="blob-info-header-form">
                                            <h:outputText id="header-ot" styleClass="dataText" value="#{manageBlobBB.selectedBlob.filename}" />
                                            <h:outputText value=" (" />
                                            <h:outputText value="#{manageBlobBB.selectedBlob.blobID}" />
                                            <h:outputText value=") " />
                                        </h:form>

                                    </div>

                                    <!-- Panel of the various Blob panels-->

                                    <p:outputPanel id = "blob-lists-outpanel" >

                                        <!--Info Panel-->
                                        <p:panel id="blobManage-panel-Info"
                                                 toggleable="true"
                                                 collapsed="false"
                                                 header="Info Panel"
                                                 rendered="#{manageBlobBB.activeInfoMode}"
                                                 >

                                            <p:spacer height="10px"/>

                                            <h:form id="blobManage-form-actions">

                                                <p:panelGrid columns="4" 
                                                             layout="grid"
                                                             columnClasses="gridTd, gridTd, gridTd, gridTd" 
                                                             >

                                                    <h:panelGroup>
                                                        <p:outputLabel value="ID:"/>
                                                        <p:spacer height="5px"/>
                                                        <p:outputLabel value="&#160;#{manageBlobBB.selectedBlob.blobID}"/>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Type:"/>
                                                        <p:spacer height="5px"/>
                                                        <i class="material-icons status-display-icon-i"><h:outputText value="#{manageBlobBB.selectedBlob.type.typeIcon}"/></i>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Description:"/>
                                                        <p:spacer height="5px"/>
                                                        <p:outputLabel value="&#160;#{manageBlobBB.selectedBlob.description}"/>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Upload Timestamp:"/>
                                                        <p:spacer height="5px"/>
                                                        <p:outputLabel value="&#160;#{manageBlobBB.selectedBlob.timestamp}"/>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Bytes ID:"/>
                                                        <p:spacer height="5px"/>
                                                        <p:outputLabel> The system does not duplicate files when they are attached to multiple objects.
                                                            This number is the ID number of the file itself in our system.
                                                            If this number is the same as another file in this list, then the two
                                                            files are really the same file, they are just attached to two different things. </p:outputLabel>
                                                        <p:spacer height="5px"/>
                                                        <p:outputLabel value="&#160;#{manageBlobBB.selectedBlob.bytesID}"/>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <p:dataTable id="blob-search-results-table"
                                                                 var="property"
                                                                 value="#{manageBlobBB.selectedBlob.blobMetadata.propertiesList}"
                                                                 rowKey="#{property.key}"
                                                                 tableStyleClass="primeDataTable"
                                                                 draggableRows="false" draggableColumns="true"
                                                                 tabindex="6"
                                                                 >

                                                        <p:column headerText="Metadata Property">
                                                            <h:outputText value="#{property.label}"/>
                                                        </p:column>

                                                        <p:column headerText="Value">
                                                            <h:outputText value="#{manageBlobBB.selectedBlob.blobMetadata.getProperty(property)}"/>
                                                        </p:column>

                                                    </p:dataTable>

                                                </p:panelGrid>

                                                <p:spacer height="10px" />


                                            </h:form>

                                        </p:panel>

                                        <!--View Panel-->
                                        <p:panel id="blobManage-panel-view"
                                                 toggleable="true"
                                                 collapsed="false"
                                                 header="View Panel"
                                                 rendered="#{manageBlobBB.activeViewMode}"
                                                 >

                                            <p:spacer height="10px"/>

                                            <h:form id="blobManage-form-view">

                                                <p:panelGrid columns="4" 
                                                             layout="grid"
                                                             columnClasses="gridTd, gridTd, gridTd, gridTd" 
                                                             >

                                                    <p:outputLabel value="View Image:"/>
                                                    <p:spacer height="10px"/>

                                                    <p:graphicImage width="100%" value="#{blobCoordinator.image}">
                                                        <f:param name="blobID" value="#{manageBlobBB.selectedBlob.blobID}"/>
                                                    </p:graphicImage>

                                                    <p:spacer height="10px"/>
                                                    <p:commandLink value="#{blob.filename}" action="#{manageBlobBB.downloadSelectedBlob()}"/>
                                                    <p:spacer height="10px"/>

                                                </p:panelGrid>

                                                <p:spacer height="10px" />

                                            </h:form>

                                        </p:panel>

                                        <!--Connections Panel-->
                                        <p:panel id="blobManage-panel-objects"
                                                 toggleable="true"
                                                 collapsed="false"
                                                 header="Connections Panel"
                                                 rendered="#{manageBlobBB.activeObjectsMode}"
                                                 >

                                            <p:spacer height="10px"/>

                                            <h:form id="blobManage-form-objects">

                                                <p:panelGrid columns="4" 
                                                             layout="grid"
                                                             columnClasses="gridTd, gridTd, gridTd, gridTd" 
                                                             >

                                                    <p:outputLabel value="Property:" rendered="#{manageBlobBB.connectedProperties.size() != 0}"/>

                                                    <p:dataTable id="connected-property-table"
                                                                 var="prop"
                                                                 value="#{manageBlobBB.connectedProperties}"
                                                                 rowKey="#{prop.propertyID}"
                                                                 tableStyleClass="primeDataTable"
                                                                 draggableRows="false" draggableColumns="true"
                                                                 rendered="#{manageBlobBB.connectedProperties.size() != 0}"
                                                                 >

                                                        <p:column headerText="ID:">
                                                            <h:outputText value="#{prop.propertyID}"/>
                                                        </p:column>

                                                        <p:column headerText="Address">
                                                            <h:outputText value="#{prop.address}"/>
                                                        </p:column>

                                                        <p:column>
                                                            <p:commandButton value="View" icon="fa fa-folder" 
                                                                             action="#{manageBlobBB.goToProperty(prop)}"
                                                                             disabled="#{!manageBlobBB.currentBlobSelected}"/>
                                                        </p:column>

                                                        <p:column>
                                                            <p:commandButton value="Remove Link" 
                                                                             action="#{manageBlobBB.removePropPhotoLink(prop)}"
                                                                             ajax="true"
                                                                             disabled="#{!manageBlobBB.currentBlobSelected}"
                                                                             update="
                                                                             form-messages-global
                                                                             blob-lists-outpanel"/>
                                                        </p:column>
                                                        
                                                    </p:dataTable>

                                                    <h:panelGroup>

                                                        <p:spacer height="5px"/>
                                                        <div class="blobObjectsTableOutputLabel">
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestProperty.address}"/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestProperty.muni.muniName}"/>
                                                        </div>
                                                        <p:spacer height="5px"/>
                                                        <p:commandButton    id="change-property-cb" 
                                                                            onclick="PF('change-property-dialog').show()" 
                                                                            value="change request property" 
                                                                            styleClass="noFill button-size-small"
                                                                            disabled="#{cEActionRequestsBB.isDisabledDueToRoutingNotAllowed}"
                                                                            icon="fa fa-home"
                                                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"/>
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Requestor:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearObjectsTableOutputLabel">
                                                            <p:outputLabel value="&#160;Requestor ID:#{cEActionRequestsBB.selectedRequest.requestor.personID} 
                                                                           (#{cEActionRequestsBB.selectedRequest.requestor.personType.label}): "/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestor.firstName}"/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestor.lastName}"/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestor.addressStreet}"/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestor.addressCity}, "/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestor.addressState}"/>
                                                            <p:outputLabel value="&#160;#{cEActionRequestsBB.selectedRequest.requestor.addressZip}"/>
                                                        </div>
                                                        <p:spacer height="5px"/>
                                                        <p:commandButton    id="change-person-cb"
                                                                            onclick="PF('change-person-dialog').show()" 
                                                                            value="change requestor Person" 
                                                                            styleClass="noFill button-size-small" 
                                                                            icon="fa fa-child"
                                                                            disabled="#{empty cEActionRequestsBB.selectedRequest}"
                                                                            rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}" />
                                                        <p:spacer height="10px"/>
                                                    </h:panelGroup>

                                                </p:panelGrid>

                                                <h3>Attached photos:</h3>

                                                <p:dataTable
                                                    id="photoTable"
                                                    var="photoid"
                                                    value="#{cEActionRequestsBB.selectedRequest.blobIDList}"
                                                    rowKey="#{photoid.intValue()}"
                                                    tableStyleClass="primeDataTable"
                                                    draggableRows="false" tabindex="6">
                                                    <p:column width="10%" headerText="Manage">
                                                        <p:commandButton ajax="true" 
                                                                         actionListener="#{cEActionRequestsBB.deletePhoto(photoid)}"
                                                                         value="Delete" 
                                                                         icon="fa fa-bomb"
                                                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasSysAdminPermissions}"
                                                                         update="photoTable"/>
                                                    </p:column>
                                                    <p:column headerText="Photo">
                                                        <p:graphicImage width="100%" value="#{blobCoordinator.image}">
                                                            <f:param name="blobID" value="#{photoid.intValue()}"/>
                                                        </p:graphicImage>
                                                    </p:column>
                                                    <p:column width="20%" headerText="Description">
                                                        <h:outputText escape="false" value="#{blobCoordinator.getBlob(photoid).description}"/>
                                                    </p:column>
                                                </p:dataTable>

                                            </h:form>

                                        </p:panel>

                                        <!--Update Panel-->
                                        <p:panel id="cearManage-panel-notes"
                                                 toggleable="true"
                                                 collapsed="false"
                                                 header="Notes Panel"
                                                 rendered="#{cEActionRequestsBB.getActiveNotesMode()}"
                                                 >

                                            <p:spacer height="10px"/>

                                            <h:form id="cearManage-form-notes">

                                                <p:panelGrid columns="4" 
                                                             layout="grid"
                                                             columnClasses="gridTd, gridTd, gridTd, gridTd" 
                                                             >

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Officer-only notes:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearNotesTableOutputLabel">
                                                            <p:outputLabel escape="false" value="&#160;#{cEActionRequestsBB.selectedRequest.cogInternalNotes}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                        <p:commandButton onclick="PF('internal-message-dialog').show()" 
                                                                         icon="fa fa-pencil-square-o"
                                                                         value="new note" 
                                                                         styleClass="noFill button-size-small" 
                                                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasCOGStaffPermissions}" />
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="System internal only notes:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearNotesTableOutputLabel">
                                                            <p:outputLabel escape="false" value="&#160;#{cEActionRequestsBB.selectedRequest.muniNotes}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                        <p:commandButton onclick="PF('muni-message-dialog').show()" 
                                                                         value="new note"
                                                                         icon="fa fa-pencil-square-o"
                                                                         styleClass="noFill button-size-small" 
                                                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}" />
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:outputLabel value="Public notes:"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="cearNotesTableOutputLabel">
                                                            <p:outputLabel escape="false" value="&#160;#{cEActionRequestsBB.selectedRequest.publicExternalNotes}"/>
                                                        </div>
                                                        <p:spacer height="10px"/>
                                                        <p:commandButton onclick="PF('public-message-dialog').show()" 
                                                                         value="new note" 
                                                                         icon="fa fa-pencil-square-o"
                                                                         styleClass="noFill button-size-small" 
                                                                         rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}" />
                                                    </h:panelGroup>

                                                </p:panelGrid>

                                                <p:spacer height="10px" />

                                            </h:form>

                                        </p:panel>

                                    </p:outputPanel>


                                </div>

                            </div>

                    </p:outputPanel>


                    <p:dialog   id="propinfo-notes-dialog"
                                height="300" width="750"
                                widgetVar="propinfo-notes-dialog-var"
                                closable="true"
                                header="Note Builder"
                                rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniReaderPermissions}"
                                >

                        <h:form id="propinfo-note-create-form">

                            <h:messages id="propinfo-dialog-note-messages"
                                        globalOnly="true" showDetail="true" showSummary="true"
                                        warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                            </h:messages>

                            <h:panelGrid columns="1"
                                         columnClasses="gridTd, gridTd">

                                <h:panelGroup>
                                    <h:outputText styleClass="ui-label" value="Note text: "/>
                                    <p:editor   id="propinfo-notes-editor"
                                                value="#{propertyProfileBB.formNoteText}"
                                                controls="bold italic underline strikethrough font size style color
                                                bullets numbering center undo redo rule link removeformat"
                                                width="400" required="false"
                                                height="200"/>


                                    <p:spacer height="5px" />
                                    <p:commandButton    id="propinfo-updatemetadata-button-cancel"
                                                        ajax="true"  tabindex="27"
                                                        value="Cancel"
                                                        icon="fa fa-stop"
                                                        immediate="true"
                                                        onclick="PF('propinfo-notes-dialog-var').hide()"
                                                        />

                                    <p:commandButton   id="propinfo-dialog-notes-button-addnote"
                                                       ajax="true" 
                                                       actionListener="#{propertyProfileBB.onNoteCommitButtonChange}"
                                                       oncomplete="PF('propinfo-notes-dialog-var').hide()"
                                                       rendered="#{systemServicesBB.bbSessionUser.keyCard.hasMuniStaffPermissions}"                                                                               
                                                       value="Attach Note"  
                                                       styleClass="inline-button"
                                                       icon="fa fa-sticky-note-o"
                                                       update="propinfo-notes-form"/>
                                </h:panelGroup>
                            </h:panelGrid>
                        </h:form>
                    </p:dialog>

                </f:view>

                <script type="text/javascript">
                    $(function () {
                        $.extend(PF("datatable"), {
                            onKeyDown: function (e) {
                                var key = e.which,
                                        keyCode = $.ui.keyCode;
                                if ((key === keyCode.ENTER || key === keyCode.NUMPAD_ENTER)) {
                                    e.preventDefault();
                                }
                            },
                            onKeyUp: function (e, rowIndex) {
                                var key = e.which,
                                        keyCode = $.ui.keyCode;
                                //.ui-row-editor-check .ui-icon-check .ui-c
                                if ((key === keyCode.ENTER || key === keyCode.NUMPAD_ENTER)) {
                                    this.tbody
                                            .find('.ui-row-editor .ui-icon-check')
                                            .eq(rowIndex)
                                            .click();
                                }
                                if (key === keyCode.ESCAPE) {
                                    this.tbody
                                            .find('.ui-row-editor .ui-icon-close')
                                            .eq(rowIndex)
                                            .click();
                                }
                            }
                        });
                    });
                </script>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

