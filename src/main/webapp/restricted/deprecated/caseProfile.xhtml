<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Case Manager</title>
    </h:head>
    <h:body>
        <ui:composition template="../navContainer_restricted.xhtml">
            <ui:define name="content">
                <div class="mainContainer">
                    <f:view>

                        <h:messages id="caseProfileMessages" globalOnly="true" showDetail="false" showSummary="true"
                                    warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                        </h:messages>

                        <h1>Case Profile: 
                        
                        <h:outputText value="#{caseProfileBB.currentCase.caseName}"/>
                        <span> @ </span>
                        <h:outputText value="#{sessionBean.sessionProperty.address}"/>
                        <span> in </span>
                        <h:outputText value="#{caseProfileBB.currentCase.property.muni.muniName}"/>
                        <span> (case ID#: </span>
                        <h:outputText value="#{caseProfileBB.currentCase.caseID}"/>
                        <span> ) </span></h1>
                        
                        <p:graphicImage width="1000px" style="margin-left: 5px;" value="/resources/phasediagrams/#{caseProfileBB.phaseDiagramImageFilename}"/>
                        <p:spacer height="10px"/>
                         
                        <p:tabView id="ceactionTabView" 
                                   widgetVar="tabview" effect="fade" 
                                   effectDuration="fast">
                            
                            <p:tab title="Events" id="t1Events">
                                     <h2>Event Log</h2>

                                <h:form id="caseProfileForm">

                                    <p:commandButton ajax="false" action="caseEvents" icon="fa fa-plus"
                                                     value="Create new event"/>

                                    <p:spacer height="15px"/>

                                    <p:dataTable
                                        id="caseEventTable"
                                        var="e"
                                        selectionMode="single"
                                        selection="#{caseProfileBB.selectedEvent}"
                                        rowKey="#{e.eventID}"
                                        value="#{caseProfileBB.eventList}"
                                        tableStyleClass="primeDataTable"
                                        resizableColumns="true"
                                        rowExpandMode="multiple"
                                        expandedRow="false"
                                        scrollHeight="400"
                                        filteredValue="#{caseProfileBB.filteredEventList}"
                                        widgetVar="caseEventTable"
                                        >
                                        <!--<p:ajax event="rowSelect" update="selectedRowLabel"/>-->

                                        <p:column width="3%" exportable="false">
                                            <f:facet name="header">
                                                <h:outputText value="Expand"/>
                                            </f:facet>
                                            <p:rowToggler/>
                                        </p:column>

                                        <p:column width="11%" sortBy="#{e.dateOfRecord}">
                                            <f:facet name="header">
                                                <h:outputText value="Date" />
                                            </f:facet>
                                            <h:outputText value="#{e.dateOfRecordPretty}"/>
                                        </p:column>

                                        <p:column width="8%" sortBy="#{e.category.eventType.label}"
                                                  filterBy="#{e.category.eventType.label}">
                                            <f:facet name="header">
                                                <h:outputText value="Type" />
                                            </f:facet>
                                            <h:outputText value="#{e.category.eventType.label}"/>
                                        </p:column>

                                        <p:column width="10%" sortBy="#{e.category.eventCategoryTitle}"
                                                  filterBy="#{e.category.eventCategoryTitle}">
                                            <f:facet name="header">
                                                <h:outputText value="Category" />
                                            </f:facet>
                                            <h:outputText value="#{e.category.eventCategoryTitle}"/>
                                        </p:column>
                                        <p:column width="5%" filterBy="#{e.owner.LName}"
                                                  sortBy="#{e.eventOwcreator}">
                                            <f:facet name="header">
                                                <h:outputText value="Creator" />
                                            </f:facet>
                                            <h:outputText value="#{e.eventOwnerUsercreator}"
                                    </p:column>
                                        <p:column width="20%" style="word-wrap: normal;">
                                            <f:facet name="header">
                                                <h:outputText value="Description" />
                                            </f:facet>
                                            <div class="rowExpansion">
                                                <h:outputText value="#{e.eventDescription}"/>
                                            </div>
                                        </p:column>
                                        <p:column width="5%" exportable="false">
                                            <f:facet name="header">
                                                <h:outputText value="edit" />
                                            </f:facet>
                                            <p:commandButton icon="fa fa-edit"
                                                             action="#{caseProfileBB.editEvent(e)}" 
                                                             ajax="false"/>

                                        </p:column>

                                        <p:rowExpansion>

                                            <div class="outlinedBox">
                                                <h2>Event ID: <h:outputText value="#{e.eventID}"/> </h2>
                                                <h:panelGrid columns="4" cellpadding="10" footerClass="gridFooter"
                                                             columnClasses="gridTd, gridTd, gridTd, gridTd">
                                                    
                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Description" />
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.eventDescription}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Disclose to Municipality Staff?" />
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.discloseToMunicipality}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Disclose to Public?" />
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.discloseToPublic}"/>
                                                        </div>
                                                    </h:panelGroup>
                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Creation time stamp"/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.eventTimeStamp}"/>
                                                        </div>
                                                    </h:panelGroup>
                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Active Event?"/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.activeEvent}"/>
                                                        </div>
                                                    </h:panelGroup>
                                                    
                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="Requires View Confirmation?"/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.requireRequestedEventInsert}"/>
                                                        </div>
                                                    </h:panelGroup>
                                                    
                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="View confirmed by"/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.responderActual.LName}"/>
                                                        </div>
                                                    </h:panelGroup>
                                                    
                                                    <h:panelGroup>
                                                        <h:outputText styleClass="bold" value="View confirmed at"/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{e.responseTimestamp}"/>
                                                        </div>
                                                    </h:panelGroup>
                                                    
                                                    

                                                    <f:facet name="footer" class="leftalign">
                                                        <h:outputLabel styleClass="bold" style="text-align: left" value="Notes"/>
                                                        <p:spacer height="15px"/>
                                                        <div class="rowExpansion" style="text-align: left">
                                                            <h:outputText escape="false" value="#{e.notes}"/>
                                                        </div>
                                                    </f:facet>

                                                </h:panelGrid>
                                            </div>
                                        </p:rowExpansion>
                                    </p:dataTable>
                                    
                                    
                                    <ui:remove>
                                        
                                        <p:commandLink value="Export event history as pdf" ajax="false">
                                            <p:dataExporter type="pdf" target="caseEventTable" fileName="case_#{sessionBean.activeCECase.property.address}_idno#{sessionBean.activeCECase.caseID}_eventHistory"/>
                                        </p:commandLink>
                                    </ui:remove>


                                </h:form>

                            </p:tab>
                             
                            <p:tab title="Case Details" id="t2Details">
                                <h2>Case Phase</h2>

                                <span class="bold">Current phase: </span>
                                <h:outputText class="mono" value="#{caseProfileBB.currentCase.casePhase.label}"/>

                                
                                 <h3>Manually change case phase</h3>
                                <h:form id="casePhaseChangeForm">


                                    <p:selectOneMenu value="#{caseProfileBB.selectedCasePhase}"
                                                     id="casePhaseSOM">

                                        <f:selectItems value="#{caseProfileBB.casePhaseList}"
                                                       var="cp"
                                                       itemValue="#{cp}"
                                                       itemLabel="#{cp.label}"/>
                                    </p:selectOneMenu>
                                    <p:spacer/>
                                    <p:commandButton ajax="false" action="#{caseProfileBB.overrideCasePhase}" icon="fa fa-bullhorn"
                                                         value="Override to selected phase"/>

                                    <p:spacer height="10px"/>

                                    <ui:remove>

                                    <p:commandButton onclick="PF('cd').show()" type="button" icon="fa fa-bullhorn"
                                                     value="Manually override case phase to selected value"/>

                                    <p:confirmDialog message="Manually override a case's phase can cause a spaghetti-like mess of our
                                                     case management process. Note: This action will generate a special event which will
                                                     be analyzed at our next group meeting to discuss changes to our standard protocol to avoid
                                                     the need for any manual case phase changes. Please add a note event to the case to explain
                                                     why the case phase is being changed manually." severity="alert" widgetVar="cd">

                                        <p:commandButton value="Abort override" onclick="PF('cd').hide()" type="button" icon="fa fa-stop"/>
                                        <p:commandButton ajax="false" action="#{caseProfileBB.overrideCasePhase}" icon="fa fa-bullhorn"
                                                             value="Yes, override phase" oncomplete="PF('cd').hide()"/>
                                    </p:confirmDialog>

                                    </ui:remove>

                                </h:form>
                                 
                                 
                                <h2>Next case action</h2>

                                <span class="bold">Next phase: </span>
                                <h:outputText class="mono" value="#{caseProfileBB.nextPhase.label}"/>

                                <p:spacer height="10px"/>

                                <span class="bold">Next action in protocol: </span>

                                <h:outputText value="#{caseProfileBB.eventForTriggeringCasePhaseAdvancement.category.eventCategoryTitle}"/>

                                <!--takeNextAction-->


                                <h2>Case key details</h2>

                                <span class="bold">Case Manager: </span>
                                <h:outputText value="#{caseProfileBB.currentCase.caseManager.LName}"/>

                                <p:spacer height="10px"/>

                                <span class="bold">Date Opened: </span>
                                <h:outputText value="#{caseProfileBB.currentCase.originiationDatePretty}"/>

                                <p:spacer height="10px"/>

                                <span class="bold">Date Closed: </span>
                                <h:outputText value="#{caseProfileBB.currentCase.closingDatePretty}"/>

                                <h2>Case tools</h2>

                                <h3>Update case details</h3>

                                <p:fieldset legend="Expand to update case metadata"
                                            toggleable="true" collapsed="false">

                                    <h:outputText value="You are editing case no. #{caseUpdateBB.currentCase.caseID}"/>
                                    <p:spacer height="10px"/>

                                    <h:form id="updateCaseForm">

                                        <h:panelGrid columns="2" border="0" 
                                                     cellpadding="2" columnClasses="gridTd, gridTd"
                                                     footerClass="gridFooter">
                                            <h:panelGroup>
                                                <h:outputText value="Public access control code"/>
                                            </h:panelGroup> 
                                            <h:panelGroup>
                                                <h:inputText value="#{caseUpdateBB.formControlCode}"/>
                                            </h:panelGroup> 
                                            <h:panelGroup>
                                                <h:outputText value="Case name"/>
                                            </h:panelGroup> 
                                            <h:panelGroup>
                                                <h:inputText value="#{caseUpdateBB.formCaseName}"/>
                                            </h:panelGroup> 
                                            <h:panelGroup>
                                                <h:outputText value="Opening date"/>
                                            </h:panelGroup> 
                                            <h:panelGroup>
                                                <p:calendar value="#{caseUpdateBB.formOriginDate}" 
                                                            mode="popup" tabindex="3"
                                                            id="formCaseOriginationDateCal"
                                                            showOn="button"
                                                            pattern="EEE, dd MMM, yyyy"
                                                            navigator="true"
                                                            showButtonPanel="true"
                                                            showTodayButton="true"
                                                            required="true"/>

                                                <h:message for="formCaseOriginationDateCal" showDetail="false" showSummary="true" 
                                                           warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                            </h:panelGroup>
                                            <h:panelGroup>
                                                <h:outputText value="Notes:"/>
                                            </h:panelGroup> 
                                            <h:panelGroup>
                                                <h:inputTextarea value="#{caseUpdateBB.formCaseNotes}"/>
                                            </h:panelGroup> 


                                        </h:panelGrid>

                                        <p:spacer height="10px"/>

                                        <p:commandButton ajax="false" value="Update Case" action="#{caseUpdateBB.updateCase}"  icon="fa fa-edit"/>

                                    </h:form>
                                </p:fieldset>

                               

                             </p:tab>
                             
                            <p:tab title="Violations" id="t3LViolations">
                                 
                                <h:form id="form_codeViolations">

                                    <h2>Assigned Code Violations</h2>

                                    <h:outputText value="Current Case: #{caseProfileBB.currentCase.caseName}"/>

                                    <p:spacer height="10px"/>

                                    <p:commandButton ajax="false" action="#{caseProfileBB.addViolation}"
                                                     value="Add new code violation to case"
                                                     icon="fa fa-plus"/>
                                    <p:spacer height="15px"/>

                                    <p:dataTable
                                        id="violationTable"
                                        var="v"
                                        selectionMode="mulitiple"
                                        selection="#{caseProfileBB.selectedViolations}"
                                        rowKey="#{v.violationID}"
                                        value="#{caseProfileBB.fullCaseViolationList}"
                                        tableStyleClass="primeDataTable"
                                        expandedRow="false"
                                        rowExpandMode="multiple"
                                        draggableColumns="true"
                                        reflow="true">


                                        <!--<p:ajax event="rowSelect" update="selectedRowLabel"/>-->

                                        <p:column width="4%">
                                            <p:rowToggler />
                                        </p:column>
                                        <p:column width="4%">
                                            <f:facet name="header">
                                                <h:outputText value="ID" />
                                            </f:facet>
                                            <h:outputText value="#{v.violationID}"/>
                                        </p:column>
                                        <p:column>
                                            <f:facet name="header">
                                                <h:outputText value="Code Element" />
                                            </f:facet>
                                            <h:outputText value="#{v.violatedEnfElement.ordSecTitle}: #{v.violatedEnfElement.ordSubSecTitle}"/>
                                        </p:column>

                                        <p:column>
                                            <f:facet name="header">
                                                <h:outputText value="Stipulated Compliance Date" />
                                            </f:facet>
                                            <h:outputText value="#{v.stipulatedComplianceDate}"/>
                                        </p:column>

                                        <p:column>
                                            <f:facet name="header">
                                                <h:outputText value="Actual Compliance Date" />
                                            </f:facet>
                                            <h:outputText value="#{v.actualComplianceDate}"/>
                                        </p:column>

                                        <p:column>
                                            <f:facet name="header">
                                                <h:outputText value="Citations" />
                                            </f:facet>
                                            <h:outputText value="#{v.citationsStringList}"/>
                                        </p:column>
                                        <p:column width="5%">
                                            <f:facet name="header">
                                                <h:outputText value="re-link" />
                                            </f:facet>
                                            <p:commandButton icon="fa fa-link"
                                                             actionListener="#{caseProfileBB.setSelectedViolation(v)}" 
                                                             ajax="true" oncomplete="PF('linkDialog').show()"/>

                                        </p:column>
                                        
                                        


                                        <p:rowExpansion>
                                            
                                            <div class="outlinedBox">
                                                <h3>Event Info</h3>

                                                <h:outputLabel styleClass="bold" value="Violated Element Details: "/>
                                                <h:outputLabel value="#{v.violatedEnfElement.ordchapterTitle}: 
                                                           #{v.violatedEnfElement.ordSecNum} 
                                                           #{v.violatedEnfElement.ordSecTitle}:
                                                           #{v.violatedEnfElement.ordSubSecNum} 
                                                           #{v.violatedEnfElement.ordSubSecTitle}"/>
                                                <p:spacer height="5px"/>

                                                <h:outputText styleClass="mono" value="#{v.violatedEnfElement.ordTechnicalText}"/>

                                                <p:spacer height="5px"/>

                                                <h:outputLabel styleClass="bold" value="Penalty:"/>
                                                <h:outputText value="#{v.penalty}"/>
                                                <p:spacer height="5px"/>

                                                <h:outputLabel styleClass="bold" value="Description: "/>
                                                <h:outputText value="#{v.description}"/>

                                                <p:spacer height="5px"/>

                                                <h:outputLabel styleClass="bold" value="Violation Notes: "/>
                                                <h:outputText value="#{v.notes}" escape="false"/>
                                            </div>
                                        </p:rowExpansion>

                                    </p:dataTable> 
                                    <p style="font-style: italic; font-size: 0.8em; margin-bottom: 0px;">(To clear selections, click a violation while holding down the control key.)</p>
                                    
                                     <p:confirmDialog message="You can swap out the code book element of the selected violation by entering the ID number of the new violation in the box below. 
                                                      You'll probably want to open the codebook for the current muni in a separate window so you can look up the ID numbers easily." severity="alert" widgetVar="linkDialog">

                                        <h:outputLabel value="New CodeBook Element ID number"/>
                                        <p:inputText value="#{caseProfileBB.newViolationCodeBookEleID}"/>
                                        <p:commandButton ajax="true" actionListener="#{caseProfileBB.updateViolationsCodeBookLink}"
                                                         value="Re-Link" icon="fa fa-link" oncomplete="PF('linkDialog').hide()" update="caseProfileMessages"/>
                                    </p:confirmDialog>

                                    <p:spacer height="15px"/>

                                    <p:commandButton ajax="false" action="#{caseProfileBB.recordCompliance}"
                                                     value="Record Compliance "
                                                     icon="fa fa-check" />

                                    <p:commandButton ajax="false" action="#{caseProfileBB.editViolation}"
                                                     value="Edit violation details"
                                                     icon="fa fa-edit"/>


                                    <p:spacer height="5px"/>

                                    <h3>Notice of violation actions</h3>

                                    <p:commandButton ajax="false" action="#{caseProfileBB.createNewNoticeForAllViolations}"
                                                     value="Generate Notice Letter for all Violations"/>
                                    
                                    <p:commandButton disabled="false" ajax="false" 
                                             action="#{caseProfileBB.createNewNoticeForSelectedViolations()}"
                                             value="Generate Notice Letter for selected violations"
                                             icon="fa fa-list"/>
                                    
                                    <p:spacer height="5px"/>

                                    <h3>Citation actions</h3>

                                    <p:commandButton ajax="false" action="#{caseProfileBB.createCitationForAllViolations}"
                                                     value="Generate citation for all Violations"
                                                     icon="fa fa-warning"/>

                                    <p:commandButton ajax="false" action="#{caseProfileBB.createCitationFromSelected}"
                                                     value="Generate citation for selected violations"
                                                     icon="fa fa-warning"/>
                                </h:form>

                             </p:tab>
                             
                             <p:tab title="Notices" id="t4Notices">
                                  <h:form id="noticeOfViolationForm">

                                <p:separator/>

                                <h2>Notices of Violation</h2>
                                <h:outputText value="Current Case: #{caseProfileBB.currentCase.caseName}"/>

                                <p:spacer height="15px"/>


                                <p:dataTable
                                    id="noticeOfViolationTab"
                                    var="notice"
                                    selectionMode="single"
                                    selection="#{caseProfileBB.selectedNotice}"
                                    rowKey="#{notice.noticeID}"
                                    value="#{caseProfileBB.noticeList}"
                                    tableStyleClass="primeDataTable"
                                    expandedRow="false"
                                    rowExpandMode="multiple"
                                    draggableColumns="true"
                                    reflow="true">


                                    <!--<p:ajax event="rowSelect" update="selectedRowLabel"/>-->

                                    <p:column width="4%">
                                        <p:rowToggler />
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Notice No." />
                                        </f:facet>
                                        <h:outputText value="#{notice.noticeID}"/>
                                    </p:column>

                                     <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Date of Record" />
                                        </f:facet>
                                         <h:outputText value="#{notice.dateOfRecordPretty}"/>
                                    </p:column>

                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Queued for Mailing" />
                                        </f:facet>
                                        <h:outputText value="#{notice.requestToSend}"/>
                                    </p:column>

                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Sent Date" />
                                        </f:facet>
                                        <h:outputText value="#{notice.letterSentDatePretty}"/>
                                    </p:column>

                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Returned?" />
                                        </f:facet>
                                        <h:outputText value="#{notice.letterReturnedDatePretty}"/>
                                    </p:column>

                                    <p:rowExpansion>
                                        <div class="outlinedBox">
                                            <h3>Full letter text</h3>
                                            <h:outputText value="#{notice.noticeText}" id="letterTextBox" escape="false"/>
                                        </div>

                                    </p:rowExpansion>


                                </p:dataTable>

                                <p:spacer height="15px"/>

                                <p:commandButton ajax="false" action="#{caseProfileBB.editNoticeOfViolation()}"
                                                 value="Edit notice or queue for mailing"
                                                 icon="fa fa-edit "/>

                                <p:commandButton ajax="false" action="#{caseProfileBB.markNoticeOfViolationAsSent}"
                                                 value="Mark selected notice as sent"
                                                 icon="fa fa-send"/>

                                <p:commandButton ajax="false" action="#{caseProfileBB.markNoticeOfViolationAsReturned}"
                                                 value="Mark selected notice as returned"
                                                 icon="fa fa-mail-reply"/>

                                <p:commandButton ajax="false" action="#{caseProfileBB.deleteNoticeOfViolation}"
                                                 value="Nuke selected notice"
                                                 icon="fa fa-bomb"/>

                            </h:form>


                             </p:tab>
                        
                             <p:tab title="Citations" id="t5Citations">
                                 
                                <h:form id="citationForm">
                                    <p:dataTable
                                        id="citationTable"
                                        var="citation"
                                        selectionMode="single"
                                        selection="#{caseProfileBB.selectedCitation}"
                                        rowKey="#{citation.citationID}"
                                        value="#{caseProfileBB.citationList}"
                                        tableStyleClass="primeDataTable"
                                        expandedRow="false"
                                        rowExpandMode="multiple"
                                        draggableColumns="true"
                                        reflow="true">


                                        <p:column width="4%">
                                            <p:rowToggler />
                                        </p:column>
                                        <p:column width="10%">
                                            <f:facet name="header">
                                                <h:outputText value="Citation ID" />
                                            </f:facet>
                                            <h:outputText value="#{citation.citationID}"/>
                                        </p:column>
                                        <p:column width="10%">
                                            <f:facet name="header">
                                                <h:outputText value="Citation No." />
                                            </f:facet>
                                            <h:outputText value="#{citation.citationNo}"/>
                                        </p:column>
                                        <p:column width="10%">
                                            <f:facet name="header">
                                                <h:outputText value="Court Entity ID" />
                                            </f:facet>
                                            <h:outputText value="#{citation.origin_courtentity.courtEntityName}"/>
                                        </p:column>
                                        <p:column width="15%">
                                            <f:facet name="header">
                                                <h:outputText value="Issuer" />
                                            </f:facet>
                                            <h:outputText value="#{citation.userOwner.LName}"/>
                                        </p:column>
                                        <p:column width="10%">
                                            <f:facet name="header">
                                                <h:outputText value="Date of record" />
                                            </f:facet>
                                            <h:outputText value="#{citation.dateOfRecord}"/>
                                        </p:column>
                                        <p:column width="10%">
                                            <f:facet name="header">
                                                <h:outputText value="Status" />
                                            </f:facet>
                                            <h:outputText value="#{citation.status.statusTitle}"/>
                                        </p:column>

                                        <p:rowExpansion>
                                            <div class="outlinedBox">
                                                
                                            <h:outputLabel value="Notes: "/>
                                                <h:outputText value="#{citation.notes}"/>
                                            <p:spacer height="10px"/>
                                            <h:outputLabel value="Active: "/>
                                                <h:outputText value="#{citation.isActive}"/>
                                            <p:spacer height="10px"/>
                                            <h:outputLabel value="Entry Timestamp: "/>
                                                <h:outputText value="#{citation.timeStamp}"/>
                                            <p:spacer height="10px"/>
                                            </div>
                                        </p:rowExpansion>

                                    </p:dataTable>

                                        <p:commandButton ajax="false" action="#{caseProfileBB.updateCitation}"
                                                     value="Updated selected citation"/>
                                        <ui:remove>
                                            
                                        <p:commandButton ajax="false" action="#{caseProfileBB.deleteCitation}"
                                                     value="Nuke selected citation forever"/>
                                        </ui:remove>

                                    <p:separator/>
                                </h:form>
                                 
                             </p:tab>
                            
                            
                             <p:tab title="Action Requests" id="tab-actionrequests">
                                 
                                <h:form id="actionRequestForm">
                                    <p:dataTable
                                        id="actionRequestTable"
                                        var="r"
                                        selectionMode="single"
                                        selection="#{caseProfileBB.selectedActionRequest}"
                                        rowKey="#{r.requestID}"
                                        value="#{caseProfileBB.currentCase.ceActionRequestList}"
                                        tableStyleClass="primeDataTable"
                                        expandedRow="false"
                                        rowExpandMode="multiple"
                                        draggableColumns="true"
                                        reflow="true">


                                        <p:column width="5%">
                                            <p:rowToggler />
                                        </p:column>

                                        <p:column width="10%">
                                            <f:facet name="header">
                                                <h:outputText value="ID" />
                                            </f:facet>
                                            <div class="wrapText">
                                                <h:outputText value="#{r.requestID}"/>
                                            </div>
                                        </p:column>
                                        <p:column width="15%">
                                            <f:facet name="header">
                                                <h:outputText value="Issue Type" />
                                            </f:facet>
                                            <div class="wrapText">
                                                <h:outputText value="#{r.issueTypeString}"/>
                                            </div>
                                        </p:column>
                                        <p:column width="15%">
                                            <f:facet name="header">
                                                <h:outputText value="Address" />
                                            </f:facet>
                                            <div class="rowExpansion">
                                                <h:outputText value="#{r.requestProperty.address}"/>
                                            </div>
                                        </p:column>
                                        <p:column width="15%">
                                            <f:facet name="header">
                                                <h:outputText value="Submitted" />
                                            </f:facet>
                                            <div class="wrapText">
                                                <h:outputText value="#{r.formattedSubmittedTimeStamp}"/>
                                            </div>
                                        </p:column>

                                        <p:column width="8%">
                                            <f:facet name="header">
                                                <h:outputText value="Age" />
                                            </f:facet>
                                            <h:outputText value="#{r.daysSinceDateOfRecord}"/>
                                        </p:column>

                                        <ui:remove>
                                            
                                        <p:column width="8%">
                                            <f:facet name="header">
                                                <h:outputText value="Link" />
                                            </f:facet>
                                            <!--work out what to do with these references-->
                                            
                                            <p:commandButton icon="fa fa-link" action="#{ceActionRequestsBB.viewSelectedActionRequest}">
                                                <f:setPropertyActionListener value="#{r}" target="#{ceActionRequestsBB.selectedRequest}"/>
                                            </p:commandButton>
                                        </p:column>
                                        </ui:remove>
                                        <p:rowExpansion>

                                            <div class="outlinedBox">
                                                <h3>Code Enforcement Action Request</h3>
                                                <h:panelGrid columns="2" cellpadding="10" footerClass="gridFooter"
                                                             columnClasses="gridTd, gridTd">

                                                    <h:panelGroup>
                                                        <h:outputLabel class="bold" value="Issue Type" />
                                                        <p:spacer height="5px"/>
                                                        <div class="wrapText">
                                                            <h:outputText value="#{r.issueTypeString}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputLabel class="bold" value="Address" />
                                                        <p:spacer height="5px"/>
                                                        <div class="rowExpansion">
                                                            <h:outputText value="#{r.requestProperty.address}"/>
                                                        </div>
                                                    </h:panelGroup>
                                                    <h:panelGroup>
                                                        <h:outputLabel class="bold" value="Date Submitted" />
                                                        <p:spacer height="5px"/>
                                                        <div class="wrapText">
                                                            <h:outputText value="#{r.formattedSubmittedTimeStamp}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputLabel styleClass="bold" value="ID"/>
                                                        <p:spacer height="5px"/>
                                                        <div class="wrapText">
                                                            <h:outputText value="#{r.requestID}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <div class="wrapText">
                                                            <h:outputLabel styleClass="bold" value="Human safety issue?"/>
                                                            <p:spacer height="5px"/>
                                                            <h:outputText value="#{r.isUrgent}"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>

                                                        <div class="wrapText">
                                                            <h:outputLabel styleClass="bold" value="Requestor (#{r.requestor.personType.label}): "/>
                                                            <p:spacer height="5px"/>

                                                            <h:outputText value="#{r.requestor.firstName} "/> 
                                                            <h:outputText value="#{r.requestor.lastName}" />
                                                            <h:outputText value="#{r.requestor.addressStreet}" />
                                                            <h:outputText value="#{r.requestor.addressCity}" />
                                                            <h:outputText value="#{r.requestor.addressState} "/> 
                                                            <h:outputText value="#{r.requestor.addressZip}"/> 
                                                        </div>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <h:outputLabel styleClass="bold" value="Contact: "/>
                                                        <p:spacer height="5px"/>
                                                        <div class="wrapText"> 
                                                            <h:outputText value="Phone (cell): "/>
                                                            <h:outputText value="#{r.requestor.phoneCell}"/> <br />
                                                            <h:outputText value="Phone (work): "/>
                                                            <h:outputText value="#{r.requestor.phoneWork}"/>
                                                            <h:outputText value="Phone (home): "/>
                                                            <h:outputText value="#{r.requestor.phoneHome}"/> <br />
                                                            <h:outputText value="#{r.requestor.email}"/>
                                                        </div>
                                                    </h:panelGroup>



                                                    <f:facet name="footer" class="leftalign">
                                                        <h:outputLabel styleClass="bold" value="Request description"/>
                                                        <p:spacer height="15px"/>
                                                        <div class="rowExpansion" style="leftalign">
                                                            <h:outputText escape="false" value="#{r.requestDescription}"/>
                                                        </div>
                                                    </f:facet>
                                                </h:panelGrid>
                                            </div>

                                        </p:rowExpansion>
                                    </p:dataTable>


                                        <p:commandButton ajax="false" action="#{caseProfileBB.updateCitation}"
                                                     value="Updated selected citation"/>
                                        <ui:remove>
                                            
                                        <p:commandButton ajax="false" action="#{caseProfileBB.deleteCitation}"
                                                     value="Nuke selected citation forever"/>
                                        </ui:remove>

                                    <p:separator/>
                                </h:form>
                                 
                             </p:tab>
                             
                         </p:tabView>
                        
                       
                         <p:dialog header="Code Enforcement Profile" widgetVar="helpdlg" responsive="true">
                            <h2>Code enforcement case profile</h2>
                            <p>This page is the launchpad for all other case-related actions and displays the entire case event history.</p>
                        </p:dialog>
                        <p:commandButton  value="help on this page" onclick="PF('helpdlg').show()" styleClass="noFill" icon="fa fa-question-circle"/>
                        <p:spacer height="10px"/>
                        
                    </f:view>
                </div>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

